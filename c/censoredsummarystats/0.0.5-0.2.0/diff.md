# Comparing `tmp/censoredsummarystats-0.0.5.tar.gz` & `tmp/censoredsummarystats-0.2.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "censoredsummarystats-0.0.5.tar", max compression
+gzip compressed data, was "censoredsummarystats-0.2.0.tar", max compression
```

## Comparing `censoredsummarystats-0.0.5.tar` & `censoredsummarystats-0.2.0.tar`

### file list

```diff
@@ -1,7 +1,7 @@
--rw-r--r--   0        0        0      123 2023-05-10 02:13:31.336281 censoredsummarystats-0.0.5/censoredsummarystats/__init__.py
--rw-r--r--   0        0        0    64146 2023-05-17 00:37:31.628109 censoredsummarystats-0.0.5/censoredsummarystats/statistics.py
--rw-r--r--   0        0        0     2291 2023-04-29 21:55:33.186386 censoredsummarystats-0.0.5/censoredsummarystats/utils.py
--rw-r--r--   0        0        0    11558 2023-03-12 00:39:53.769556 censoredsummarystats-0.0.5/LICENSE
--rw-r--r--   0        0        0      558 2023-05-17 00:37:56.637351 censoredsummarystats-0.0.5/pyproject.toml
--rw-r--r--   0        0        0     4309 2023-05-14 10:11:56.349705 censoredsummarystats-0.0.5/README.md
--rw-r--r--   0        0        0     5005 1970-01-01 00:00:00.000000 censoredsummarystats-0.0.5/PKG-INFO
+-rw-r--r--   0        0        0       45 2023-06-21 07:54:57.798595 censoredsummarystats-0.2.0/censoredsummarystats/__init__.py
+-rw-r--r--   0        0        0    56356 2023-06-21 07:54:57.799594 censoredsummarystats-0.2.0/censoredsummarystats/statistics.py
+-rw-r--r--   0        0        0     2291 2023-06-21 07:54:57.800594 censoredsummarystats-0.2.0/censoredsummarystats/utils.py
+-rw-r--r--   0        0        0    11558 2023-06-21 07:54:57.796594 censoredsummarystats-0.2.0/LICENSE
+-rw-r--r--   0        0        0      558 2023-06-21 08:21:56.981281 censoredsummarystats-0.2.0/pyproject.toml
+-rw-r--r--   0        0        0     8308 2023-06-21 07:54:57.797594 censoredsummarystats-0.2.0/README.md
+-rw-r--r--   0        0        0     8939 1970-01-01 00:00:00.000000 censoredsummarystats-0.2.0/PKG-INFO
```

### Comparing `censoredsummarystats-0.0.5/censoredsummarystats/statistics.py` & `censoredsummarystats-0.2.0/censoredsummarystats/statistics.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,4010 +1,3523 @@
 00000000: 0d0a 696d 706f 7274 206e 756d 7079 2061  ..import numpy a
-00000010: 7320 6e70 0d0a 6672 6f6d 202e 7574 696c  s np..from .util
-00000020: 7320 696d 706f 7274 2073 7472 696e 675f  s import string_
-00000030: 7072 6563 6973 696f 6e2c 206e 756d 6572  precision, numer
-00000040: 6963 5f70 7265 6369 7369 6f6e 0d0a 0d0a  ic_precision....
-00000050: 2320 5365 7420 6465 6661 756c 7420 636f  # Set default co
-00000060: 6c75 6d6e 206e 616d 6573 0d0a 7374 6174  lumn names..stat
-00000070: 5f63 6f6c 203d 2027 5374 6174 6973 7469  _col = 'Statisti
-00000080: 6327 0d0a 7265 7375 6c74 5f63 6f6c 203d  c'..result_col =
-00000090: 2027 5265 7375 6c74 270d 0a63 656e 736f   'Result'..censo
-000000a0: 725f 636f 6c20 3d20 2743 656e 736f 7243  r_col = 'CensorC
-000000b0: 6f6d 706f 6e65 6e74 270d 0a6e 756d 6572  omponent'..numer
-000000c0: 6963 5f63 6f6c 203d 2027 4e75 6d65 7269  ic_col = 'Numeri
-000000d0: 6343 6f6d 706f 6e65 6e74 270d 0a69 6e74  cComponent'..int
-000000e0: 6572 7661 6c5f 636f 6c20 3d20 2749 6e74  erval_col = 'Int
-000000f0: 6572 7661 6c27 0d0a 7065 7263 656e 745f  erval'..percent_
-00000100: 6578 6365 6564 616e 6365 735f 636f 6c20  exceedances_col 
-00000110: 3d20 2750 6572 6365 6e74 4578 6365 6564  = 'PercentExceed
-00000120: 616e 6365 7327 0d0a 6578 6365 6564 616e  ances'..exceedan
-00000130: 6365 735f 636f 6c20 3d20 2745 7863 6565  ces_col = 'Excee
-00000140: 6461 6e63 6573 270d 0a6e 6f6e 5f65 7863  dances'..non_exc
-00000150: 6565 6461 6e63 6573 5f63 6f6c 203d 2027  eedances_col = '
-00000160: 4e6f 6e45 7863 6565 6461 6e63 6573 270d  NonExceedances'.
-00000170: 0a69 676e 6f72 6564 5f63 6f6c 203d 2027  .ignored_col = '
-00000180: 4967 6e6f 7265 6427 0d0a 6c65 6674 5f62  Ignored'..left_b
-00000190: 6f75 6e64 6172 795f 636f 6c20 3d20 275f  oundary_col = '_
-000001a0: 5f4c 6566 7442 6f75 6e64 6172 795f 5f27  _LeftBoundary__'
-000001b0: 0d0a 6c65 6674 5f62 6f75 6e64 5f63 6f6c  ..left_bound_col
-000001c0: 203d 2027 5f5f 4c65 6674 426f 756e 645f   = '__LeftBound_
-000001d0: 5f27 0d0a 6d69 6470 6f69 6e74 5f63 6f6c  _'..midpoint_col
-000001e0: 203d 2027 5f5f 4d69 6450 6f69 6e74 5f5f   = '__MidPoint__
-000001f0: 270d 0a72 6967 6874 5f62 6f75 6e64 5f63  '..right_bound_c
-00000200: 6f6c 203d 2027 5f5f 5269 6768 7442 6f75  ol = '__RightBou
-00000210: 6e64 5f5f 270d 0a72 6967 6874 5f62 6f75  nd__'..right_bou
-00000220: 6e64 6172 795f 636f 6c20 3d20 275f 5f52  ndary_col = '__R
-00000230: 6967 6874 426f 756e 6461 7279 5f5f 270d  ightBoundary__'.
-00000240: 0a0d 0a0d 0a0d 0a23 2525 2043 6f6e 7665  .......#%% Conve
-00000250: 7273 696f 6e20 6265 7477 6565 6e20 7265  rsion between re
-00000260: 7375 6c74 2061 6e64 2069 6e74 6572 7661  sult and interva
-00000270: 6c20 636f 6d70 6f6e 656e 7473 0d0a 0d0a  l components....
-00000280: 2325 2525 2042 6574 7765 656e 2072 6573  #%%% Between res
-00000290: 756c 7420 616e 6420 6365 6e73 6f72 2f6e  ult and censor/n
-000002a0: 756d 6572 6963 2063 6f6d 706f 6e65 6e74  umeric component
-000002b0: 730d 0a0d 0a64 6566 2072 6573 756c 745f  s....def result_
-000002c0: 746f 5f63 6f6d 706f 6e65 6e74 7328 6466  to_components(df
-000002d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000002e0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-000002f0: 6c74 735f 636f 6c2c 0d0a 2020 2020 2020  lts_col,..      
-00000300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000310: 2020 2063 656e 736f 725f 636f 6c3d 6365     censor_col=ce
-00000320: 6e73 6f72 5f63 6f6c 2c0d 0a20 2020 2020  nsor_col,..     
-00000330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000340: 2020 2020 6e75 6d65 7269 635f 636f 6c3d      numeric_col=
-00000350: 6e75 6d65 7269 635f 636f 6c29 3a0d 0a20  numeric_col):.. 
-00000360: 2020 2027 2727 0d0a 2020 2020 4120 6675     '''..    A fu
-00000370: 6e63 7469 6f6e 2074 6861 7420 7365 7061  nction that sepa
-00000380: 7261 7465 7320 6365 6e73 6f72 7320 283c  rates censors (<
-00000390: 2ce2 89a4 2ce2 89a5 2c3e 2920 6672 6f6d  ,...,...,>) from
-000003a0: 2061 2072 6573 756c 742e 2053 706c 6974   a result. Split
-000003b0: 7469 6e67 2074 6865 0d0a 2020 2020 6365  ting the..    ce
-000003c0: 6e73 6f72 2063 6f6d 706f 6e65 6e74 2066  nsor component f
-000003d0: 726f 6d20 7468 6520 6e75 6d65 7269 6320  rom the numeric 
-000003e0: 636f 6d70 6f6e 656e 7420 656e 6162 6c65  component enable
-000003f0: 7320 7468 6520 7573 6520 6f66 206e 756d  s the use of num
-00000400: 6572 6963 0d0a 2020 2020 6461 7461 2074  eric..    data t
-00000410: 7970 6573 2e20 4120 7265 7375 6c74 206f  ypes. A result o
-00000420: 6620 3c31 3020 2873 7472 696e 672f 7465  f <10 (string/te
-00000430: 7874 2920 6973 2073 706c 6974 2069 6e74  xt) is split int
-00000440: 6f20 6120 6365 6e73 6f72 2063 6f6d 706f  o a censor compo
-00000450: 6e65 6e74 0d0a 2020 2020 6f66 203c 2028  nent..    of < (
-00000460: 7374 7269 6e67 2f74 6578 7429 2061 6e64  string/text) and
-00000470: 2061 206e 756d 6572 6963 2063 6f6d 706f   a numeric compo
-00000480: 6e65 6e74 206f 6620 3130 2028 666c 6f61  nent of 10 (floa
-00000490: 742f 6465 6369 6d61 6c29 2e0d 0a0d 0a20  t/decimal)..... 
-000004a0: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-000004b0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-000004c0: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
-000004d0: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
-000004e0: 7261 6d65 2063 6f6e 7461 696e 696e 6720  rame containing 
-000004f0: 6120 636f 6c75 6d6e 2074 6f20 6265 2073  a column to be s
-00000500: 706c 6974 2069 6e74 6f20 636f 6d70 6f6e  plit into compon
-00000510: 656e 7473 0d0a 2020 2020 7265 7375 6c74  ents..    result
-00000520: 735f 636f 6c20 3a20 7374 7269 6e67 0d0a  s_col : string..
-00000530: 2020 2020 2020 2020 436f 6c75 6d6e 206e          Column n
-00000540: 616d 6520 666f 7220 7468 6520 636f 6c75  ame for the colu
-00000550: 6d6e 2074 6861 7420 636f 6e74 6169 6e73  mn that contains
-00000560: 2074 6865 2072 6573 756c 7473 2074 6f20   the results to 
-00000570: 6265 2073 706c 6974 0d0a 2020 2020 6365  be split..    ce
-00000580: 6e73 6f72 5f63 6f6c 203a 2073 7472 696e  nsor_col : strin
-00000590: 670d 0a20 2020 2020 2020 2043 6f6c 756d  g..        Colum
-000005a0: 6e20 6e61 6d65 2074 6f20 6769 7665 2074  n name to give t
-000005b0: 6865 2063 7265 6174 6564 2063 656e 736f  he created censo
-000005c0: 7220 636f 6c75 6d6e 2e0d 0a20 2020 2020  r column...     
-000005d0: 2020 2054 6865 2064 6566 6175 6c74 2069     The default i
-000005e0: 7320 4365 6e73 6f72 436f 6d70 6f6e 656e  s CensorComponen
-000005f0: 742e 0d0a 2020 2020 6e75 6d65 7269 635f  t...    numeric_
-00000600: 636f 6c20 3a20 7374 7269 6e67 0d0a 2020  col : string..  
-00000610: 2020 2020 2020 436f 6c75 6d6e 206e 616d        Column nam
-00000620: 6520 746f 2067 6976 6520 7468 6520 6372  e to give the cr
-00000630: 6561 7465 6420 6e75 6d65 7269 6320 636f  eated numeric co
-00000640: 6c75 6d6e 2e0d 0a20 2020 2020 2020 2054  lumn...        T
-00000650: 6865 2064 6566 6175 6c74 2069 7320 4e75  he default is Nu
-00000660: 6d65 7269 6343 6f6d 706f 6e65 6e74 2e0d  mericComponent..
-00000670: 0a0d 0a20 2020 2052 6574 7572 6e73 0d0a  ...    Returns..
-00000680: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
-00000690: 2064 6620 3a20 4461 7461 4672 616d 650d   df : DataFrame.
-000006a0: 0a20 2020 2020 2020 2049 6e70 7574 2044  .        Input D
-000006b0: 6174 6146 7261 6d65 2077 6974 6820 7477  ataFrame with tw
-000006c0: 6f20 6164 6469 7469 6f6e 616c 2063 6f6c  o additional col
-000006d0: 756d 6e73 2063 7265 6174 6564 2066 6f72  umns created for
-000006e0: 2074 6865 2063 656e 736f 720d 0a20 2020   the censor..   
-000006f0: 2020 2020 2061 6e64 206e 756d 6572 6963       and numeric
-00000700: 2063 6f6d 706f 6e65 6e74 730d 0a0d 0a20   components.... 
-00000710: 2020 2027 2727 0d0a 2020 2020 0d0a 2020     '''..    ..  
-00000720: 2020 2320 4372 6561 7465 2061 2063 6f70    # Create a cop
-00000730: 7920 6f66 2074 6865 2044 6174 6146 7261  y of the DataFra
-00000740: 6d65 0d0a 2020 2020 6466 203d 2064 662e  me..    df = df.
-00000750: 636f 7079 2829 0d0a 2020 2020 0d0a 2020  copy()..    ..  
-00000760: 2020 2320 456e 7375 7265 2074 6865 2076    # Ensure the v
-00000770: 616c 7565 2063 6f6c 756d 6e20 6973 2074  alue column is t
-00000780: 6578 742f 7374 7269 6e67 2064 6174 6120  ext/string data 
-00000790: 7479 7065 2e0d 0a20 2020 2064 665b 7265  type...    df[re
-000007a0: 7375 6c74 735f 636f 6c5d 203d 2064 665b  sults_col] = df[
-000007b0: 7265 7375 6c74 735f 636f 6c5d 2e61 7374  results_col].ast
-000007c0: 7970 6528 7374 7229 0d0a 2020 2020 0d0a  ype(str)..    ..
-000007d0: 2020 2020 2320 4372 6561 7465 2063 656e      # Create cen
-000007e0: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
-000007f0: 636f 6c75 6d6e 7320 6672 6f6d 2072 6573  columns from res
-00000800: 756c 7420 636f 6c75 6d6e 0d0a 2020 2020  ult column..    
-00000810: 6466 5b63 656e 736f 725f 636f 6c5d 203d  df[censor_col] =
-00000820: 2064 665b 7265 7375 6c74 735f 636f 6c5d   df[results_col]
-00000830: 2e73 7472 2e65 7874 7261 6374 2872 2728  .str.extract(r'(
-00000840: 5b3c e289 a4e2 89a5 3e5d 2927 292e 6669  [<......>])').fi
-00000850: 6c6c 6e61 2827 2729 0d0a 2020 2020 6466  llna('')..    df
-00000860: 5b6e 756d 6572 6963 5f63 6f6c 5d20 3d20  [numeric_col] = 
-00000870: 6466 5b72 6573 756c 7473 5f63 6f6c 5d2e  df[results_col].
-00000880: 7374 722e 7265 706c 6163 6528 273c 7ce2  str.replace('<|.
-00000890: 89a4 7ce2 89a5 7c3e 272c 2727 2c72 6567  ..|...|>','',reg
-000008a0: 6578 3d54 7275 6529 2e61 7374 7970 6528  ex=True).astype(
-000008b0: 666c 6f61 7429 0d0a 2020 2020 0d0a 2020  float)..    ..  
-000008c0: 2020 7265 7475 726e 2064 660d 0a0d 0a64    return df....d
-000008d0: 6566 2063 6f6d 706f 6e65 6e74 735f 746f  ef components_to
-000008e0: 5f72 6573 756c 7428 6466 2c0d 0a20 2020  _result(df,..   
-000008f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000900: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
-00000910: 726f 756e 6469 6e67 203d 2054 7275 6529  rounding = True)
-00000920: 3a0d 0a20 2020 2027 2727 0d0a 2020 2020  :..    '''..    
-00000930: 4120 6675 6e63 7469 6f6e 2074 6861 7420  A function that 
-00000940: 636f 6d62 696e 6573 2063 656e 736f 7220  combines censor 
-00000950: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
-00000960: 6f6e 656e 7473 2069 6e74 6f20 6120 636f  onents into a co
-00000970: 6d62 696e 6564 0d0a 2020 2020 7374 7269  mbined..    stri
-00000980: 6e67 2f74 6578 7420 7265 7375 6c74 2e0d  ng/text result..
-00000990: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-000009a0: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
-000009b0: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
-000009c0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
-000009d0: 6174 6146 7261 6d65 2063 6f6e 7461 696e  ataFrame contain
-000009e0: 696e 6720 6365 6e73 6f72 2061 6e64 206e  ing censor and n
-000009f0: 756d 6572 6963 2063 6f6c 756d 6e73 2074  umeric columns t
-00000a00: 6861 7420 7769 6c6c 2062 6520 636f 6d62  hat will be comb
-00000a10: 696e 6564 0d0a 2020 2020 7072 6563 6973  ined..    precis
-00000a20: 696f 6e5f 726f 756e 6469 6e67 203a 2062  ion_rounding : b
-00000a30: 6f6f 6c65 616e 2c20 6f70 7469 6f6e 616c  oolean, optional
-00000a40: 0d0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
-00000a50: 652c 2061 2072 6f75 6e64 696e 6720 6d65  e, a rounding me
-00000a60: 7468 6f64 2069 7320 6170 706c 6965 6420  thod is applied 
-00000a70: 746f 2072 6f75 6e64 2072 6573 756c 7473  to round results
-00000a80: 2074 6f20 6861 7665 206e 6f20 6d6f 7265   to have no more
-00000a90: 0d0a 2020 2020 2020 2020 6465 6369 6d61  ..        decima
-00000aa0: 6c73 2074 6861 6e20 7768 6174 2063 616e  ls than what can
-00000ab0: 2062 6520 6d65 6173 7572 6564 2e0d 0a20   be measured... 
-00000ac0: 2020 2020 2020 2054 6865 2064 6566 6175         The defau
-00000ad0: 6c74 2069 7320 5472 7565 2e0d 0a0d 0a20  lt is True..... 
-00000ae0: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
-00000af0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
-00000b00: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
-00000b10: 2020 2020 2049 6e70 7574 2044 6174 6146       Input DataF
-00000b20: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
-00000b30: 6e73 2061 206e 6577 2073 7472 696e 672f  ns a new string/
-00000b40: 7465 7874 2063 6f6c 756d 6e20 7468 6174  text column that
-00000b50: 2063 6f6d 6269 6e65 730d 0a20 2020 2020   combines..     
-00000b60: 2020 2074 6865 2063 656e 736f 7220 616e     the censor an
-00000b70: 6420 6e75 6d65 7269 6320 636f 6d70 6f6e  d numeric compon
-00000b80: 656e 7473 206f 6620 6120 7265 7375 6c74  ents of a result
-00000b90: 0d0a 0d0a 2020 2020 2727 270d 0a20 2020  ....    '''..   
-00000ba0: 200d 0a20 2020 2023 2043 7265 6174 6520   ..    # Create 
-00000bb0: 6120 636f 7079 206f 6620 7468 6520 4461  a copy of the Da
-00000bc0: 7461 4672 616d 650d 0a20 2020 2064 6620  taFrame..    df 
-00000bd0: 3d20 6466 2e63 6f70 7928 290d 0a20 2020  = df.copy()..   
-00000be0: 200d 0a20 2020 2023 2043 6f6d 6269 6e65   ..    # Combine
-00000bf0: 2074 6865 2063 656e 736f 7220 616e 6420   the censor and 
-00000c00: 6e75 6d65 7269 6320 636f 6d70 6f6e 656e  numeric componen
-00000c10: 7473 2074 6f20 6372 6561 7465 2061 2063  ts to create a c
-00000c20: 6f6d 6269 6e65 6420 7265 7375 6c74 0d0a  ombined result..
-00000c30: 2020 2020 2320 4170 706c 7920 7468 6520      # Apply the 
-00000c40: 6170 7072 6f70 7269 6174 6520 726f 756e  appropriate roun
-00000c50: 6469 6e67 2066 756e 6374 696f 6e73 2069  ding functions i
-00000c60: 6620 7072 6563 6973 696f 6e5f 726f 756e  f precision_roun
-00000c70: 6469 6e67 2069 7320 5472 7565 0d0a 2020  ding is True..  
-00000c80: 2020 6966 2070 7265 6369 7369 6f6e 5f72    if precision_r
-00000c90: 6f75 6e64 696e 673a 0d0a 2020 2020 2020  ounding:..      
-00000ca0: 2020 6466 5b72 6573 756c 745f 636f 6c5d    df[result_col]
-00000cb0: 203d 2064 665b 6365 6e73 6f72 5f63 6f6c   = df[censor_col
-00000cc0: 5d20 2b20 6466 5b6e 756d 6572 6963 5f63  ] + df[numeric_c
-00000cd0: 6f6c 5d2e 6170 706c 7928 7374 7269 6e67  ol].apply(string
-00000ce0: 5f70 7265 6369 7369 6f6e 2c74 686f 7573  _precision,thous
-00000cf0: 616e 6473 5f63 6f6d 6d61 3d54 7275 6529  ands_comma=True)
-00000d00: 0d0a 2020 2020 2020 2020 6466 5b6e 756d  ..        df[num
-00000d10: 6572 6963 5f63 6f6c 5d20 3d20 6466 5b6e  eric_col] = df[n
-00000d20: 756d 6572 6963 5f63 6f6c 5d2e 6170 706c  umeric_col].appl
-00000d30: 7928 6e75 6d65 7269 635f 7072 6563 6973  y(numeric_precis
-00000d40: 696f 6e29 0d0a 2020 2020 656c 7365 3a0d  ion)..    else:.
-00000d50: 0a20 2020 2020 2020 2064 665b 7265 7375  .        df[resu
-00000d60: 6c74 5f63 6f6c 5d20 3d20 6466 5b63 656e  lt_col] = df[cen
-00000d70: 736f 725f 636f 6c5d 202b 2064 665b 6e75  sor_col] + df[nu
-00000d80: 6d65 7269 635f 636f 6c5d 2e61 7374 7970  meric_col].astyp
-00000d90: 6528 7374 7229 0d0a 2020 2020 0d0a 2020  e(str)..    ..  
-00000da0: 2020 7265 7475 726e 2064 660d 0a0d 0a23    return df....#
-00000db0: 2525 2520 4265 7477 6565 6e20 6365 6e73  %%% Between cens
-00000dc0: 6f72 2f6e 756d 6572 6963 2063 6f6d 706f  or/numeric compo
-00000dd0: 6e65 6e74 7320 616e 6420 696e 7465 7276  nents and interv
-00000de0: 616c 2063 6f6d 706f 6e65 6e74 730d 0a0d  al components...
-00000df0: 0a64 6566 2063 6f6d 706f 6e65 6e74 735f  .def components_
-00000e00: 746f 5f69 6e74 6572 7661 6c28 6466 2c0d  to_interval(df,.
-00000e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000e20: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-00000e30: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
-00000e40: 6572 7661 6c20 3d20 4661 6c73 6529 3a0d  erval = False):.
-00000e50: 0a20 2020 2027 2727 0d0a 2020 2020 4120  .    '''..    A 
-00000e60: 6675 6e63 7469 6f6e 2074 6861 7420 7574  function that ut
-00000e70: 696c 6973 6573 2074 6865 2063 656e 736f  ilises the censo
-00000e80: 7220 616e 6420 6e75 6d65 7269 6320 636f  r and numeric co
-00000e90: 6d70 6f6e 656e 7473 2074 6f20 636f 6e76  mponents to conv
-00000ea0: 6572 740d 0a20 2020 2065 6163 6820 7265  ert..    each re
-00000eb0: 7375 6c74 2069 6e74 6f20 696e 7465 7276  sult into interv
-00000ec0: 616c 206e 6f74 6174 696f 6e2e 2046 6f75  al notation. Fou
-00000ed0: 7220 636f 6c75 6d6e 7320 6172 6520 6372  r columns are cr
-00000ee0: 6561 7465 6420 746f 2073 746f 7265 0d0a  eated to store..
-00000ef0: 2020 2020 7468 6520 696e 7465 7276 616c      the interval
-00000f00: 2069 6e66 6f72 6d61 7469 6f6e 2069 6e63   information inc
-00000f10: 6c75 6469 6e67 206c 6566 742f 7269 6768  luding left/righ
-00000f20: 7420 626f 756e 6473 2061 6e64 2077 6865  t bounds and whe
-00000f30: 7468 6572 2074 6865 0d0a 2020 2020 656e  ther the..    en
-00000f40: 6470 6f69 6e74 732f 626f 756e 6461 7269  dpoints/boundari
-00000f50: 6573 2061 7265 2069 6e63 6c75 7369 7665  es are inclusive
-00000f60: 206f 7220 6578 636c 7573 6976 6520 2865   or exclusive (e
-00000f70: 2e67 2e2c 203c 3120 7673 20e2 89a4 3129  .g., <1 vs ...1)
-00000f80: 0d0a 0d0a 2020 2020 5061 7261 6d65 7465  ....    Paramete
-00000f90: 7273 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d  rs..    --------
-00000fa0: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
-00000fb0: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
-00000fc0: 4461 7461 4672 616d 6520 636f 6e74 6169  DataFrame contai
-00000fd0: 6e69 6e67 2074 6865 2063 656e 736f 7220  ning the censor 
-00000fe0: 616e 6420 6e75 6d65 7269 6320 636f 6c75  and numeric colu
-00000ff0: 6d6e 730d 0a20 2020 2069 6e63 6c75 6465  mns..    include
-00001000: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
-00001010: 616c 203a 2062 6f6f 6c65 616e 2c20 6f70  al : boolean, op
-00001020: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
-00001030: 4966 2054 7275 652c 2074 6865 6e20 616c  If True, then al
-00001040: 6c20 706f 7369 7469 7665 2061 6e64 206e  l positive and n
-00001050: 6567 6174 6976 6520 7661 6c75 6573 2061  egative values a
-00001060: 7265 2063 6f6e 7369 6465 7265 640d 0a20  re considered.. 
-00001070: 2020 2020 2020 2065 2e67 2e2c 203c 302e         e.g., <0.
-00001080: 3520 776f 756c 6420 6265 2063 6f6e 7665  5 would be conve
-00001090: 7274 6564 2074 6f20 282d 6e70 2e69 6e66  rted to (-np.inf
-000010a0: 2c35 292e 0d0a 2020 2020 2020 2020 4966  ,5)...        If
-000010b0: 2046 616c 7365 2c20 7468 656e 206f 6e6c   False, then onl
-000010c0: 7920 6e6f 6e2d 6e65 6761 7469 7665 2076  y non-negative v
-000010d0: 616c 7565 7320 6172 6520 636f 6e73 6964  alues are consid
-000010e0: 6572 6564 0d0a 2020 2020 2020 2020 652e  ered..        e.
-000010f0: 672e 2c20 3c30 2e35 2077 6f75 6c64 2062  g., <0.5 would b
-00001100: 6520 636f 6e76 6572 7465 6420 746f 205b  e converted to [
-00001110: 302c 3529 2e0d 0a20 2020 2020 2020 2054  0,5)...        T
-00001120: 6865 2064 6566 6175 6c74 2069 7320 4661  he default is Fa
-00001130: 6c73 652e 0d0a 2020 2020 0d0a 2020 2020  lse...    ..    
-00001140: 5261 6973 6573 0d0a 2020 2020 2d2d 2d2d  Raises..    ----
-00001150: 2d2d 0d0a 2020 2020 5661 6c75 6545 7272  --..    ValueErr
-00001160: 6f72 0d0a 2020 2020 2020 2020 416e 2065  or..        An e
-00001170: 7272 6f72 2074 6861 7420 6973 2072 6574  rror that is ret
-00001180: 7572 6e65 6420 7768 656e 2072 6573 756c  urned when resul
-00001190: 7473 2061 7265 2066 6f75 6e64 2074 6f20  ts are found to 
-000011a0: 6265 206f 7574 7369 6465 2074 6865 0d0a  be outside the..
-000011b0: 2020 2020 2020 2020 6173 7375 6d65 6420          assumed 
-000011c0: 6f72 2064 6566 696e 6564 206c 6f77 6572  or defined lower
-000011d0: 2061 6e64 2075 7070 6572 2062 6f75 6e64   and upper bound
-000011e0: 6172 6965 732e 0d0a 0d0a 2020 2020 5265  aries.....    Re
-000011f0: 7475 726e 730d 0a20 2020 202d 2d2d 2d2d  turns..    -----
-00001200: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
-00001210: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
-00001220: 496e 7075 7420 4461 7461 4672 616d 6520  Input DataFrame 
-00001230: 7769 7468 2066 6f75 7220 6164 6469 7469  with four additi
-00001240: 6f6e 616c 2063 6f6c 756d 6e73 2063 7265  onal columns cre
-00001250: 6174 6564 2074 6861 7420 7374 6f72 6520  ated that store 
-00001260: 7468 650d 0a20 2020 2020 2020 2069 6e66  the..        inf
-00001270: 6f72 6d61 7469 6f6e 2066 6f72 2074 6865  ormation for the
-00001280: 2069 6e74 6572 7661 6c73 2074 6861 7420   intervals that 
-00001290: 7265 7072 6573 656e 7420 7468 6520 7261  represent the ra
-000012a0: 6e67 6520 6f66 2070 6f74 656e 7469 616c  nge of potential
-000012b0: 0d0a 2020 2020 2020 2020 7661 6c75 6573  ..        values
-000012c0: 2066 6f72 2074 6865 2072 6573 756c 7473   for the results
-000012d0: 0d0a 0d0a 2020 2020 2727 270d 0a20 2020  ....    '''..   
-000012e0: 200d 0a20 2020 2023 2043 7265 6174 6520   ..    # Create 
-000012f0: 6120 636f 7079 206f 6620 7468 6520 4461  a copy of the Da
-00001300: 7461 4672 616d 650d 0a20 2020 2064 6620  taFrame..    df 
-00001310: 3d20 6466 2e63 6f70 7928 290d 0a20 2020  = df.copy()..   
-00001320: 200d 0a20 2020 2023 2044 6566 696e 6520   ..    # Define 
-00001330: 7768 6572 6520 7468 6520 6c65 6674 2062  where the left b
-00001340: 6f75 6e64 2069 7320 636c 6f73 6564 0d0a  ound is closed..
-00001350: 2020 2020 6466 5b6c 6566 745f 626f 756e      df[left_boun
-00001360: 6461 7279 5f63 6f6c 5d20 3d20 6e70 2e77  dary_col] = np.w
-00001370: 6865 7265 2864 665b 6365 6e73 6f72 5f63  here(df[censor_c
-00001380: 6f6c 5d2e 6973 696e 285b 2727 2c27 e289  ol].isin(['','..
-00001390: a527 5d29 2c0d 0a20 2020 2020 2020 2020  .']),..         
-000013a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000013b0: 2020 2020 2020 2020 2027 436c 6f73 6564           'Closed
-000013c0: 272c 2027 4f70 656e 2729 0d0a 2020 2020  ', 'Open')..    
-000013d0: 0d0a 2020 2020 2320 4465 6669 6e65 2077  ..    # Define w
-000013e0: 6865 7265 206c 6566 7420 626f 756e 6420  here left bound 
-000013f0: 6973 2075 6e6c 696d 6974 6564 0d0a 2020  is unlimited..  
-00001400: 2020 6466 5b6c 6566 745f 626f 756e 645f    df[left_bound_
-00001410: 636f 6c5d 203d 206e 702e 7768 6572 6528  col] = np.where(
-00001420: 6466 5b63 656e 736f 725f 636f 6c5d 2e69  df[censor_col].i
-00001430: 7369 6e28 5b27 3c27 2c27 e289 a427 5d29  sin(['<','...'])
-00001440: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00001450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001460: 2020 2d6e 702e 696e 662c 2064 665b 6e75    -np.inf, df[nu
-00001470: 6d65 7269 635f 636f 6c5d 290d 0a20 2020  meric_col])..   
-00001480: 200d 0a20 2020 2023 2044 6566 696e 6520   ..    # Define 
-00001490: 7768 6572 6520 7269 6768 7420 626f 756e  where right boun
-000014a0: 6420 6973 2075 6e6c 696d 6974 6564 0d0a  d is unlimited..
-000014b0: 2020 2020 6466 5b72 6967 6874 5f62 6f75      df[right_bou
-000014c0: 6e64 5f63 6f6c 5d20 3d20 6e70 2e77 6865  nd_col] = np.whe
-000014d0: 7265 2864 665b 6365 6e73 6f72 5f63 6f6c  re(df[censor_col
-000014e0: 5d2e 6973 696e 285b 27e2 89a5 272c 273e  ].isin(['...','>
-000014f0: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
-00001500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001510: 2020 2020 2020 6e70 2e69 6e66 2c20 6466        np.inf, df
-00001520: 5b6e 756d 6572 6963 5f63 6f6c 5d29 0d0a  [numeric_col])..
-00001530: 2020 2020 0d0a 2020 2020 2320 4465 6669      ..    # Defi
-00001540: 6e65 2077 6865 7265 2074 6865 2072 6967  ne where the rig
-00001550: 6874 2062 6f75 6e64 2069 7320 636c 6f73  ht bound is clos
-00001560: 6564 0d0a 2020 2020 6466 5b72 6967 6874  ed..    df[right
-00001570: 5f62 6f75 6e64 6172 795f 636f 6c5d 203d  _boundary_col] =
-00001580: 206e 702e 7768 6572 6528 6466 5b63 656e   np.where(df[cen
-00001590: 736f 725f 636f 6c5d 2e69 7369 6e28 5b27  sor_col].isin(['
-000015a0: e289 a427 2c27 275d 292c 0d0a 2020 2020  ...','']),..    
-000015b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000015c0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000015d0: 436c 6f73 6564 272c 2027 4f70 656e 2729  Closed', 'Open')
-000015e0: 0d0a 2020 2020 0d0a 2020 2020 2320 4966  ..    ..    # If
-000015f0: 206c 6566 7420 6365 6e73 6f72 6564 2061   left censored a
-00001600: 7265 2061 7373 756d 6564 2070 6f73 6974  re assumed posit
-00001610: 6976 650d 0a20 2020 2069 6620 6e6f 7420  ive..    if not 
-00001620: 696e 636c 7564 655f 6e65 6761 7469 7665  include_negative
-00001630: 5f69 6e74 6572 7661 6c3a 0d0a 2020 2020  _interval:..    
-00001640: 2020 2020 2320 4368 6563 6b20 666f 7220      # Check for 
-00001650: 616e 7920 6e65 6761 7469 7665 2076 616c  any negative val
-00001660: 7565 7320 2865 7863 6c75 6465 202d 696e  ues (exclude -in
-00001670: 6629 0d0a 2020 2020 2020 2020 6966 2064  f)..        if d
-00001680: 665b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  f[left_bound_col
-00001690: 5d2e 6265 7477 6565 6e28 2d6e 702e 696e  ].between(-np.in
-000016a0: 662c 2030 2c20 696e 636c 7573 6976 653d  f, 0, inclusive=
-000016b0: 276e 6569 7468 6572 2729 2e61 6e79 2829  'neither').any()
-000016c0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000016d0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000016e0: 274e 6567 6174 6976 6520 7661 6c75 6573  'Negative values
-000016f0: 2065 7869 7374 2069 6e20 7468 6520 6461   exist in the da
-00001700: 7461 2e20 5265 736f 6c76 6520 6e65 6761  ta. Resolve nega
-00001710: 7469 7665 270d 0a20 2020 2020 2020 2020  tive'..         
-00001720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001730: 2020 2020 2776 616c 7565 7320 6f72 2073      'values or s
-00001740: 6574 2069 6e63 6c75 6465 5f6e 6567 6174  et include_negat
-00001750: 6976 655f 696e 7465 7276 616c 2074 6f20  ive_interval to 
-00001760: 5472 7565 2729 0d0a 2020 2020 2020 2020  True')..        
-00001770: 2320 5365 7420 616e 7920 2d69 6e66 206c  # Set any -inf l
-00001780: 6566 7420 626f 756e 6473 2074 6f20 3020  eft bounds to 0 
-00001790: 7769 7468 2063 6c6f 7365 6420 626f 756e  with closed boun
-000017a0: 6461 7279 0d0a 2020 2020 2020 2020 636f  dary..        co
-000017b0: 6e64 6974 696f 6e20 3d20 2864 665b 6c65  ndition = (df[le
-000017c0: 6674 5f62 6f75 6e64 5f63 6f6c 5d20 3c20  ft_bound_col] < 
-000017d0: 3029 0d0a 2020 2020 2020 2020 6466 5b6c  0)..        df[l
-000017e0: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-000017f0: 5d20 3d20 6e70 2e77 6865 7265 2863 6f6e  ] = np.where(con
-00001800: 6469 7469 6f6e 2c20 2743 6c6f 7365 6427  dition, 'Closed'
-00001810: 2c20 6466 5b6c 6566 745f 626f 756e 6461  , df[left_bounda
-00001820: 7279 5f63 6f6c 5d29 0d0a 2020 2020 2020  ry_col])..      
-00001830: 2020 6466 5b6c 6566 745f 626f 756e 645f    df[left_bound_
-00001840: 636f 6c5d 203d 206e 702e 7768 6572 6528  col] = np.where(
-00001850: 636f 6e64 6974 696f 6e2c 2030 2e30 2c20  condition, 0.0, 
-00001860: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
-00001870: 6c5d 290d 0a20 2020 200d 0a20 2020 2072  l])..    ..    r
-00001880: 6574 7572 6e20 6466 0d0a 0d0a 0d0a 6465  eturn df......de
-00001890: 6620 696e 7465 7276 616c 5f74 6f5f 636f  f interval_to_co
-000018a0: 6d70 6f6e 656e 7473 2864 662c 0d0a 2020  mponents(df,..  
-000018b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000018c0: 2020 2020 2020 2020 2066 6f63 7573 5f68           focus_h
-000018d0: 6967 685f 706f 7465 6e74 6961 6c20 3d20  igh_potential = 
-000018e0: 5472 7565 2c0d 0a20 2020 2020 2020 2020  True,..         
-000018f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001900: 2020 696e 636c 7564 655f 6e65 6761 7469    include_negati
-00001910: 7665 5f69 6e74 6572 7661 6c20 3d20 4661  ve_interval = Fa
-00001920: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
-00001930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001940: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
-00001950: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
-00001960: 736f 7220 3d20 302e 3235 293a 0d0a 2020  sor = 0.25):..  
-00001970: 2020 2727 270d 0a20 2020 2041 2066 756e    '''..    A fun
-00001980: 6374 696f 6e20 7468 6174 2064 6574 6572  ction that deter
-00001990: 6d69 6e65 7320 7468 6520 6365 6e73 6f72  mines the censor
-000019a0: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
-000019b0: 706f 6e65 6e74 730d 0a20 2020 2066 726f  ponents..    fro
-000019c0: 6d20 696e 7465 7276 616c 730d 0a0d 0a20  m intervals.... 
-000019d0: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-000019e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-000019f0: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
-00001a00: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
-00001a10: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
-00001a20: 6e73 2069 6e74 6572 7661 6c20 696e 666f  ns interval info
-00001a30: 726d 6174 696f 6e0d 0a20 2020 2066 6f63  rmation..    foc
-00001a40: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
-00001a50: 6c20 3a20 626f 6f6c 6561 6e2c 206f 7074  l : boolean, opt
-00001a60: 696f 6e61 6c0d 0a20 2020 2020 2020 2049  ional..        I
-00001a70: 6620 5472 7565 2c20 7468 656e 2069 6e66  f True, then inf
-00001a80: 6f72 6d61 7469 6f6e 206f 6e20 7468 6520  ormation on the 
-00001a90: 6869 6768 6573 7420 706f 7465 6e74 6961  highest potentia
-00001aa0: 6c20 7265 7375 6c74 2077 696c 6c20 6265  l result will be
-00001ab0: 0d0a 2020 2020 2020 2020 666f 6375 7365  ..        focuse
-00001ac0: 6420 6f76 6572 2074 6865 206c 6f77 6573  d over the lowes
-00001ad0: 7420 706f 7465 6e74 6961 6c20 7265 7375  t potential resu
-00001ae0: 6c74 2e0d 0a20 2020 2069 6e63 6c75 6465  lt...    include
-00001af0: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
-00001b00: 616c 203a 2062 6f6f 6c65 616e 2c20 6f70  al : boolean, op
-00001b10: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
-00001b20: 4966 2054 7275 652c 2074 6865 6e20 616c  If True, then al
-00001b30: 6c20 706f 7369 7469 7665 2061 6e64 206e  l positive and n
-00001b40: 6567 6174 6976 6520 7661 6c75 6573 2061  egative values a
-00001b50: 7265 2063 6f6e 7369 6465 7265 640d 0a20  re considered.. 
-00001b60: 2020 2020 2020 2065 2e67 2e2c 203c 302e         e.g., <0.
-00001b70: 3520 776f 756c 6420 6265 2063 6f6e 7665  5 would be conve
-00001b80: 7274 6564 2074 6f20 282d 6e70 2e69 6e66  rted to (-np.inf
-00001b90: 2c35 292e 0d0a 2020 2020 2020 2020 4966  ,5)...        If
-00001ba0: 2046 616c 7365 2c20 7468 656e 206f 6e6c   False, then onl
-00001bb0: 7920 6e6f 6e2d 6e65 6761 7469 7665 2076  y non-negative v
-00001bc0: 616c 7565 7320 6172 6520 636f 6e73 6964  alues are consid
-00001bd0: 6572 6564 0d0a 2020 2020 2020 2020 652e  ered..        e.
-00001be0: 672e 2c20 3c30 2e35 2077 6f75 6c64 2062  g., <0.5 would b
-00001bf0: 6520 636f 6e76 6572 7465 6420 746f 205b  e converted to [
-00001c00: 302c 3529 2e0d 0a20 2020 2020 2020 2054  0,5)...        T
-00001c10: 6869 7320 7365 7474 696e 6720 6f6e 6c79  his setting only
-00001c20: 2061 6666 6563 7473 2072 6573 756c 7473   affects results
-00001c30: 2069 6620 666f 6375 735f 6869 6768 5f70   if focus_high_p
-00001c40: 6f74 656e 7469 616c 2069 7320 4661 6c73  otential is Fals
-00001c50: 652e 0d0a 2020 2020 2020 2020 5468 6520  e...        The 
-00001c60: 6465 6661 756c 7420 6973 2046 616c 7365  default is False
-00001c70: 2e0d 0a20 2020 2070 7265 6369 7369 6f6e  ...    precision
-00001c80: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
-00001c90: 6f70 5f63 656e 736f 7220 3a20 666c 6f61  op_censor : floa
-00001ca0: 742c 206f 7074 696f 6e61 6c0d 0a20 2020  t, optional..   
-00001cb0: 2020 2020 2054 6872 6573 686f 6c64 2066       Threshold f
-00001cc0: 6f72 2072 6570 6f72 7469 6e67 2063 656e  or reporting cen
-00001cd0: 736f 7265 6420 7673 206e 6f6e 2d63 656e  sored vs non-cen
-00001ce0: 736f 7265 6420 7265 7375 6c74 732e 0d0a  sored results...
-00001cf0: 2020 2020 2020 2020 5573 696e 6720 7468          Using th
-00001d00: 6520 6465 6661 756c 742c 2061 2072 6573  e default, a res
-00001d10: 756c 7420 7468 6174 2069 7320 6b6e 6f77  ult that is know
-00001d20: 6e20 746f 2062 6520 696e 2074 6865 2069  n to be in the i
-00001d30: 6e74 6572 7661 6c20 2830 2e33 2c20 302e  nterval (0.3, 0.
-00001d40: 3529 0d0a 2020 2020 2020 2020 776f 756c  5)..        woul
-00001d50: 6420 6265 2072 6574 7572 6e65 6420 6173  d be returned as
-00001d60: 2030 2e34 2c20 7768 6572 6561 7320 6120   0.4, whereas a 
-00001d70: 746f 6c65 7261 6e63 6520 6f66 2030 2077  tolerance of 0 w
-00001d80: 6f75 6c64 2079 6965 6c64 2061 0d0a 2020  ould yield a..  
-00001d90: 2020 2020 2020 7265 7375 6c74 206f 6620        result of 
-00001da0: 3c30 2e35 206f 7220 3e30 2e33 2064 6570  <0.5 or >0.3 dep
-00001db0: 656e 6469 6e67 206f 6e20 7468 6520 7661  ending on the va
-00001dc0: 6c75 6520 6f66 2066 6f63 7573 5f68 6967  lue of focus_hig
-00001dd0: 6865 7374 5f70 6f74 656e 7469 616c 2e0d  hest_potential..
-00001de0: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-00001df0: 6175 6c74 2069 7320 302e 3235 2e0d 0a0d  ault is 0.25....
-00001e00: 0a20 2020 2052 6574 7572 6e73 0d0a 2020  .    Returns..  
-00001e10: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064    -------..    d
-00001e20: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
-00001e30: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
-00001e40: 2077 6865 7265 2069 6e74 6572 7661 6c73   where intervals
-00001e50: 2066 6f72 2072 6573 756c 7473 2068 6176   for results hav
-00001e60: 6520 6265 656e 2061 6e61 6c79 7365 6420  e been analysed 
-00001e70: 746f 2063 656e 736f 7220 616e 640d 0a20  to censor and.. 
-00001e80: 2020 2020 2020 206e 756d 6572 6963 2063         numeric c
-00001e90: 6f6d 706f 6e65 6e74 732e 0d0a 0d0a 2020  omponents.....  
-00001ea0: 2020 2727 270d 0a20 2020 200d 0a20 2020    '''..    ..   
-00001eb0: 2023 2043 7265 6174 6520 6120 636f 7079   # Create a copy
-00001ec0: 206f 6620 7468 6520 4461 7461 4672 616d   of the DataFram
-00001ed0: 650d 0a20 2020 2064 6620 3d20 6466 2e63  e..    df = df.c
-00001ee0: 6f70 7928 290d 0a20 2020 200d 0a20 2020  opy()..    ..   
-00001ef0: 2023 2044 6574 6572 6d69 6e65 2074 6865   # Determine the
-00001f00: 206d 6964 706f 696e 7420 666f 7220 7468   midpoint for th
-00001f10: 6520 696e 7465 7276 616c 2069 6620 6669  e interval if fi
-00001f20: 6e69 7465 2069 6e74 6572 7661 6c0d 0a20  nite interval.. 
-00001f30: 2020 2064 665b 6d69 6470 6f69 6e74 5f63     df[midpoint_c
-00001f40: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2828  ol] = np.where((
-00001f50: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
-00001f60: 6c5d 203e 202d 6e70 2e69 6e66 2920 2620  l] > -np.inf) & 
-00001f70: 2864 665b 7269 6768 745f 626f 756e 645f  (df[right_bound_
-00001f80: 636f 6c5d 203c 206e 702e 696e 6629 2c0d  col] < np.inf),.
-00001f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001fa0: 2020 2020 2020 2020 2020 2020 2020 2030                 0
-00001fb0: 2e35 202a 2028 6466 5b6c 6566 745f 626f  .5 * (df[left_bo
-00001fc0: 756e 645f 636f 6c5d 202b 2064 665b 7269  und_col] + df[ri
-00001fd0: 6768 745f 626f 756e 645f 636f 6c5d 292c  ght_bound_col]),
-00001fe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002000: 6e70 2e6e 616e 290d 0a20 2020 200d 0a20  np.nan)..    .. 
-00002010: 2020 200d 0a20 2020 2023 2044 6566 696e     ..    # Defin
-00002020: 6520 7468 6520 636f 6e64 6974 696f 6e73  e the conditions
-00002030: 2066 6f72 2061 6e20 756e 6365 6e73 6f72   for an uncensor
-00002040: 6564 2072 6573 756c 740d 0a20 2020 2063  ed result..    c
-00002050: 6f6e 6469 7469 6f6e 7320 3d20 5b0d 0a20  onditions = [.. 
-00002060: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
-00002070: 626f 756e 6473 2061 7265 2065 7175 616c  bounds are equal
-00002080: 2c20 7468 656e 2074 6865 2072 6573 756c  , then the resul
-00002090: 7420 6973 2075 6e63 656e 736f 7265 640d  t is uncensored.
-000020a0: 0a20 2020 2020 2020 2028 6466 5b6c 6566  .        (df[lef
-000020b0: 745f 626f 756e 645f 636f 6c5d 203d 3d20  t_bound_col] == 
-000020c0: 6466 5b72 6967 6874 5f62 6f75 6e64 5f63  df[right_bound_c
-000020d0: 6f6c 5d29 2c0d 0a20 2020 2020 2020 2023  ol]),..        #
-000020e0: 2049 6620 7468 6520 626f 756e 6473 2061   If the bounds a
-000020f0: 7265 2066 696e 6974 6520 616e 6420 7468  re finite and th
-00002100: 6520 696e 7465 7276 616c 2069 7320 7769  e interval is wi
-00002110: 7468 696e 2074 6865 2070 7265 6369 7369  thin the precisi
-00002120: 6f6e 2074 6f6c 6572 616e 6365 2c20 6176  on tolerance, av
-00002130: 6f69 6420 7468 6520 7573 6520 6f66 2063  oid the use of c
-00002140: 656e 736f 7273 0d0a 2020 2020 2020 2020  ensors..        
-00002150: 2864 665b 7269 6768 745f 626f 756e 645f  (df[right_bound_
-00002160: 636f 6c5d 202d 2064 665b 6d69 6470 6f69  col] - df[midpoi
-00002170: 6e74 5f63 6f6c 5d29 203c 3d20 6466 5b6d  nt_col]) <= df[m
-00002180: 6964 706f 696e 745f 636f 6c5d 202a 2070  idpoint_col] * p
-00002190: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
-000021a0: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
-000021b0: 720d 0a20 2020 2020 2020 205d 0d0a 2020  r..        ]..  
-000021c0: 2020 0d0a 2020 2020 6365 6e73 6f72 5f72    ..    censor_r
-000021d0: 6573 756c 7473 203d 205b 0d0a 2020 2020  esults = [..    
-000021e0: 2020 2020 2727 2c0d 0a20 2020 2020 2020      '',..       
-000021f0: 2027 270d 0a20 2020 2020 2020 205d 0d0a   ''..        ]..
-00002200: 2020 2020 0d0a 2020 2020 6e75 6d65 7269      ..    numeri
-00002210: 635f 7265 7375 6c74 7320 3d5b 0d0a 2020  c_results =[..  
-00002220: 2020 2020 2020 6466 5b6d 6964 706f 696e        df[midpoin
-00002230: 745f 636f 6c5d 2c0d 0a20 2020 2020 2020  t_col],..       
-00002240: 2064 665b 6d69 6470 6f69 6e74 5f63 6f6c   df[midpoint_col
-00002250: 5d0d 0a20 2020 2020 2020 205d 0d0a 2020  ]..        ]..  
-00002260: 2020 0d0a 2020 2020 2320 4966 2066 6f63    ..    # If foc
-00002270: 7573 6564 206f 6e20 7468 6520 6869 6768  used on the high
-00002280: 6573 7420 706f 7465 6e74 6961 6c20 7265  est potential re
-00002290: 7375 6c74 0d0a 2020 2020 6966 2066 6f63  sult..    if foc
-000022a0: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
-000022b0: 6c3a 0d0a 2020 2020 2020 2020 2320 5365  l:..        # Se
-000022c0: 7420 6365 6e73 6f72 2061 6e64 206e 756d  t censor and num
-000022d0: 6572 6963 2063 6f6d 706f 6e65 6e74 7320  eric components 
-000022e0: 666f 7220 6561 6368 2063 6f6e 6469 7469  for each conditi
-000022f0: 6f6e 0d0a 2020 2020 2020 2020 636f 6e64  on..        cond
-00002300: 6974 696f 6e73 202b 3d20 5b0d 0a20 2020  itions += [..   
-00002310: 2020 2020 2020 2020 2023 2049 6620 7468           # If th
-00002320: 6572 6520 6973 2061 6e20 696e 6669 6e69  ere is an infini
-00002330: 7465 2072 6967 6874 2062 6f75 6e64 2c20  te right bound, 
-00002340: 7468 6520 7265 7375 6c74 2069 7320 7269  the result is ri
-00002350: 6768 7420 6365 6e73 6f72 6564 0d0a 2020  ght censored..  
-00002360: 2020 2020 2020 2020 2020 2864 665b 7269            (df[ri
-00002370: 6768 745f 626f 756e 645f 636f 6c5d 203d  ght_bound_col] =
-00002380: 3d20 6e70 2e69 6e66 2920 2620 2864 665b  = np.inf) & (df[
-00002390: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 5d20  left_bound_col] 
-000023a0: 3e20 2d6e 702e 696e 6629 2026 2028 6466  > -np.inf) & (df
-000023b0: 5b6c 6566 745f 626f 756e 6461 7279 5f63  [left_boundary_c
-000023c0: 6f6c 5d20 3d3d 2027 4f70 656e 2729 2c0d  ol] == 'Open'),.
-000023d0: 0a20 2020 2020 2020 2020 2020 2028 6466  .            (df
-000023e0: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
-000023f0: 5d20 3d3d 206e 702e 696e 6629 2026 2028  ] == np.inf) & (
-00002400: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
-00002410: 6c5d 203e 202d 6e70 2e69 6e66 2920 2620  l] > -np.inf) & 
-00002420: 2864 665b 6c65 6674 5f62 6f75 6e64 6172  (df[left_boundar
-00002430: 795f 636f 6c5d 203d 3d20 2743 6c6f 7365  y_col] == 'Close
-00002440: 6427 292c 0d0a 2020 2020 2020 2020 2020  d'),..          
-00002450: 2020 2320 4f74 6865 7277 6973 652c 2074    # Otherwise, t
-00002460: 6865 2072 6573 756c 7420 7368 6f75 6c64  he result should
-00002470: 2062 6520 6c65 6674 2063 656e 736f 7265   be left censore
-00002480: 640d 0a20 2020 2020 2020 2020 2020 2028  d..            (
-00002490: 6466 5b72 6967 6874 5f62 6f75 6e64 5f63  df[right_bound_c
-000024a0: 6f6c 5d20 3c20 6e70 2e69 6e66 2920 2620  ol] < np.inf) & 
-000024b0: 2864 665b 7269 6768 745f 626f 756e 6461  (df[right_bounda
-000024c0: 7279 5f63 6f6c 5d20 3d3d 2027 4f70 656e  ry_col] == 'Open
-000024d0: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
-000024e0: 2028 6466 5b72 6967 6874 5f62 6f75 6e64   (df[right_bound
-000024f0: 5f63 6f6c 5d20 3c20 6e70 2e69 6e66 2920  _col] < np.inf) 
-00002500: 2620 2864 665b 7269 6768 745f 626f 756e  & (df[right_boun
-00002510: 6461 7279 5f63 6f6c 5d20 3d3d 2027 436c  dary_col] == 'Cl
-00002520: 6f73 6564 2729 0d0a 2020 2020 2020 2020  osed')..        
-00002530: 2020 2020 5d0d 0a20 2020 2020 2020 200d      ]..        .
-00002540: 0a20 2020 2020 2020 2063 656e 736f 725f  .        censor_
-00002550: 7265 7375 6c74 7320 2b3d 205b 0d0a 2020  results += [..  
-00002560: 2020 2020 2020 2020 2020 273e 272c 0d0a            '>',..
-00002570: 2020 2020 2020 2020 2020 2020 27e2 89a5              '...
-00002580: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-00002590: 273c 272c 0d0a 2020 2020 2020 2020 2020  '<',..          
-000025a0: 2020 27e2 89a4 270d 0a20 2020 2020 2020    '...'..       
-000025b0: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
-000025c0: 0d0a 2020 2020 2020 2020 6e75 6d65 7269  ..        numeri
-000025d0: 635f 7265 7375 6c74 7320 2b3d 205b 0d0a  c_results += [..
-000025e0: 2020 2020 2020 2020 2020 2020 6466 5b6c              df[l
-000025f0: 6566 745f 626f 756e 645f 636f 6c5d 2c0d  eft_bound_col],.
-00002600: 0a20 2020 2020 2020 2020 2020 2064 665b  .            df[
-00002610: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 5d2c  left_bound_col],
-00002620: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
-00002630: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
-00002640: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00002650: 6466 5b72 6967 6874 5f62 6f75 6e64 5f63  df[right_bound_c
-00002660: 6f6c 5d0d 0a20 2020 2020 2020 2020 2020  ol]..           
-00002670: 205d 0d0a 2020 2020 2320 456c 7365 2066   ]..    # Else f
-00002680: 6f63 7573 6564 206f 6e20 7468 6520 6c6f  ocused on the lo
-00002690: 7765 7374 2070 6f74 656e 7469 616c 2072  west potential r
-000026a0: 6573 756c 740d 0a20 2020 2065 6c73 653a  esult..    else:
-000026b0: 0d0a 2020 2020 2020 2020 2320 4465 7465  ..        # Dete
-000026c0: 726d 696e 6520 7468 6520 6c6f 7765 7220  rmine the lower 
-000026d0: 626f 756e 640d 0a20 2020 2020 2020 2069  bound..        i
-000026e0: 6620 696e 636c 7564 655f 6e65 6761 7469  f include_negati
-000026f0: 7665 5f69 6e74 6572 7661 6c3a 0d0a 2020  ve_interval:..  
-00002700: 2020 2020 2020 2020 2020 6c6f 7765 725f            lower_
-00002710: 626f 756e 6420 3d20 2d6e 702e 696e 660d  bound = -np.inf.
-00002720: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00002730: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
-00002740: 725f 626f 756e 6420 3d20 302e 300d 0a20  r_bound = 0.0.. 
-00002750: 2020 2020 2020 2023 2053 6574 2063 656e         # Set cen
-00002760: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
-00002770: 636f 6d70 6f6e 656e 7473 2066 6f72 2065  components for e
-00002780: 6163 6820 636f 6e64 6974 696f 6e0d 0a20  ach condition.. 
-00002790: 2020 2020 2020 2063 6f6e 6469 7469 6f6e         condition
-000027a0: 7320 2b3d 205b 0d0a 2020 2020 2020 2020  s += [..        
-000027b0: 2020 2020 2320 4966 2074 6865 206c 6566      # If the lef
-000027c0: 7420 626f 756e 6420 6973 2069 6465 6e74  t bound is ident
-000027d0: 6963 616c 2074 6f20 7468 6520 6c6f 7765  ical to the lowe
-000027e0: 7374 2070 6f74 656e 7469 616c 206c 6f77  st potential low
-000027f0: 6572 2062 6f75 6e64 2c0d 0a20 2020 2020  er bound,..     
-00002800: 2020 2020 2020 2023 2074 6865 6e20 7468         # then th
-00002810: 6520 7265 7375 6c74 2069 7320 6c65 6674  e result is left
-00002820: 2063 656e 736f 7265 640d 0a20 2020 2020   censored..     
-00002830: 2020 2020 2020 2028 6466 5b6c 6566 745f         (df[left_
-00002840: 626f 756e 645f 636f 6c5d 203d 3d20 6c6f  bound_col] == lo
-00002850: 7765 725f 626f 756e 6429 2026 2028 6466  wer_bound) & (df
-00002860: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
-00002870: 5d20 3c20 6e70 2e69 6e66 2920 2620 2864  ] < np.inf) & (d
-00002880: 665b 7269 6768 745f 626f 756e 6461 7279  f[right_boundary
-00002890: 5f63 6f6c 5d20 3d3d 2027 4f70 656e 2729  _col] == 'Open')
-000028a0: 2c0d 0a20 2020 2020 2020 2020 2020 2028  ,..            (
-000028b0: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
-000028c0: 6c5d 203d 3d20 6c6f 7765 725f 626f 756e  l] == lower_boun
-000028d0: 6429 2026 2028 6466 5b72 6967 6874 5f62  d) & (df[right_b
-000028e0: 6f75 6e64 5f63 6f6c 5d20 3c20 6e70 2e69  ound_col] < np.i
-000028f0: 6e66 2920 2620 2864 665b 7269 6768 745f  nf) & (df[right_
-00002900: 626f 756e 6461 7279 5f63 6f6c 5d20 3d3d  boundary_col] ==
-00002910: 2027 436c 6f73 6564 2729 2c0d 0a20 2020   'Closed'),..   
-00002920: 2020 2020 2020 2020 2023 204f 7468 6572           # Other
-00002930: 7769 7365 2c20 7468 6520 7265 7375 6c74  wise, the result
-00002940: 2073 686f 756c 6420 6265 2072 6967 6874   should be right
-00002950: 2063 656e 736f 7265 640d 0a20 2020 2020   censored..     
-00002960: 2020 2020 2020 2028 6466 5b6c 6566 745f         (df[left_
-00002970: 626f 756e 645f 636f 6c5d 203e 206c 6f77  bound_col] > low
-00002980: 6572 5f62 6f75 6e64 2920 2620 2864 665b  er_bound) & (df[
-00002990: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
-000029a0: 6c5d 203d 3d20 274f 7065 6e27 292c 0d0a  l] == 'Open'),..
-000029b0: 2020 2020 2020 2020 2020 2020 2864 665b              (df[
-000029c0: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 5d20  left_bound_col] 
-000029d0: 3e20 6c6f 7765 725f 626f 756e 6429 2026  > lower_bound) &
-000029e0: 2028 6466 5b6c 6566 745f 626f 756e 6461   (df[left_bounda
-000029f0: 7279 5f63 6f6c 5d20 3d3d 2027 436c 6f73  ry_col] == 'Clos
-00002a00: 6564 2729 0d0a 2020 2020 2020 2020 2020  ed')..          
-00002a10: 2020 5d0d 0a20 2020 2020 2020 200d 0a20    ]..        .. 
-00002a20: 2020 2020 2020 2063 656e 736f 725f 7265         censor_re
-00002a30: 7375 6c74 7320 2b3d 205b 0d0a 2020 2020  sults += [..    
-00002a40: 2020 2020 2020 2020 273c 272c 0d0a 2020          '<',..  
-00002a50: 2020 2020 2020 2020 2020 27e2 89a4 272c            '...',
-00002a60: 0d0a 2020 2020 2020 2020 2020 2020 273e  ..            '>
-00002a70: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-00002a80: 27e2 89a5 270d 0a20 2020 2020 2020 2020  '...'..         
-00002a90: 2020 205d 0d0a 2020 2020 2020 2020 0d0a     ]..        ..
-00002aa0: 2020 2020 2020 2020 6e75 6d65 7269 635f          numeric_
-00002ab0: 7265 7375 6c74 7320 2b3d 205b 0d0a 2020  results += [..  
-00002ac0: 2020 2020 2020 2020 2020 6466 5b72 6967            df[rig
-00002ad0: 6874 5f62 6f75 6e64 5f63 6f6c 5d2c 0d0a  ht_bound_col],..
-00002ae0: 2020 2020 2020 2020 2020 2020 6466 5b72              df[r
-00002af0: 6967 6874 5f62 6f75 6e64 5f63 6f6c 5d2c  ight_bound_col],
-00002b00: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
-00002b10: 5b6c 6566 745f 626f 756e 645f 636f 6c5d  [left_bound_col]
-00002b20: 2c0d 0a20 2020 2020 2020 2020 2020 2064  ,..            d
-00002b30: 665b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  f[left_bound_col
-00002b40: 5d0d 0a20 2020 2020 2020 2020 2020 205d  ]..            ]
-00002b50: 0d0a 2020 2020 0d0a 2020 2020 2320 4465  ..    ..    # De
-00002b60: 7465 726d 696e 6520 7468 6520 6365 6e73  termine the cens
-00002b70: 6f72 2061 6e64 206e 756d 6572 6963 2063  or and numeric c
-00002b80: 6f6d 706f 6e65 6e74 730d 0a20 2020 2023  omponents..    #
-00002b90: 2049 6620 6e6f 2063 6f6e 6469 7469 6f6e   If no condition
-00002ba0: 2069 7320 6d65 742c 2064 6566 6175 6c74   is met, default
-00002bb0: 2074 6f20 3c3e 2061 6e64 204e 614e 0d0a   to <> and NaN..
-00002bc0: 2020 2020 6466 5b63 656e 736f 725f 636f      df[censor_co
-00002bd0: 6c5d 203d 206e 702e 7365 6c65 6374 2863  l] = np.select(c
-00002be0: 6f6e 6469 7469 6f6e 732c 2063 656e 736f  onditions, censo
-00002bf0: 725f 7265 7375 6c74 732c 2027 3c3e 2729  r_results, '<>')
-00002c00: 0d0a 2020 2020 6466 5b6e 756d 6572 6963  ..    df[numeric
-00002c10: 5f63 6f6c 5d20 3d20 6e70 2e73 656c 6563  _col] = np.selec
-00002c20: 7428 636f 6e64 6974 696f 6e73 2c20 6e75  t(conditions, nu
-00002c30: 6d65 7269 635f 7265 7375 6c74 732c 206e  meric_results, n
-00002c40: 702e 6e61 6e29 0d0a 2020 2020 0d0a 2020  p.nan)..    ..  
-00002c50: 2020 7265 7475 726e 2064 660d 0a0d 0a23    return df....#
-00002c60: 2525 2520 496e 7465 7276 616c 2063 6f6d  %%% Interval com
-00002c70: 706f 6e65 6e74 7320 746f 2069 6e74 6572  ponents to inter
-00002c80: 7661 6c20 7374 7269 6e67 0d0a 0d0a 6465  val string....de
-00002c90: 6620 696e 7465 7276 616c 5f6e 6f74 6174  f interval_notat
-00002ca0: 696f 6e28 6466 2c0d 0a20 2020 2020 2020  ion(df,..       
-00002cb0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00002cc0: 7265 6369 7369 6f6e 5f72 6f75 6e64 696e  recision_roundin
-00002cd0: 673d 5472 7565 293a 0d0a 2020 2020 2727  g=True):..    ''
-00002ce0: 270d 0a20 2020 2054 6869 7320 6675 6e63  '..    This func
-00002cf0: 7469 6f6e 2063 7265 6174 6573 2061 2063  tion creates a c
-00002d00: 6f6c 756d 6e20 7468 6174 2063 6f6d 6269  olumn that combi
-00002d10: 6e65 7320 7468 6520 696e 7465 7276 616c  nes the interval
-00002d20: 2063 6f6d 706f 6e65 6e74 730d 0a20 2020   components..   
-00002d30: 2069 6e74 6f20 6120 7369 6e67 6c65 2074   into a single t
-00002d40: 6578 7420 6e6f 7461 7469 6f6e 2066 6f72  ext notation for
-00002d50: 2069 6e74 6572 7661 6c73 2e0d 0a0d 0a20   intervals..... 
-00002d60: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-00002d70: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-00002d80: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
-00002d90: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
-00002da0: 7261 6d65 2063 6f6e 7461 696e 696e 6720  rame containing 
-00002db0: 636f 6c75 6d6e 7320 666f 7220 6c65 6674  columns for left
-00002dc0: 2f72 6967 6874 2062 6f75 6e64 7320 616e  /right bounds an
-00002dd0: 6420 626f 756e 6461 7269 6573 0d0a 2020  d boundaries..  
-00002de0: 2020 7072 6563 6973 696f 6e5f 726f 756e    precision_roun
-00002df0: 6469 6e67 203a 2062 6f6f 6c65 616e 2c20  ding : boolean, 
-00002e00: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-00002e10: 2020 4966 2054 7275 652c 2061 2072 6f75    If True, a rou
-00002e20: 6e64 696e 6720 6d65 7468 6f64 2069 7320  nding method is 
-00002e30: 6170 706c 6965 6420 746f 2072 6f75 6e64  applied to round
-00002e40: 2072 6573 756c 7473 2074 6f20 6861 7665   results to have
-00002e50: 206e 6f20 6d6f 7265 0d0a 2020 2020 2020   no more..      
-00002e60: 2020 6465 6369 6d61 6c73 2074 6861 6e20    decimals than 
-00002e70: 7768 6174 2063 616e 2062 6520 6d65 6173  what can be meas
-00002e80: 7572 6564 2e0d 0a20 2020 2020 2020 2054  ured...        T
-00002e90: 6865 2064 6566 6175 6c74 2069 7320 5472  he default is Tr
-00002ea0: 7565 2e0d 0a0d 0a20 2020 2052 6574 7572  ue.....    Retur
-00002eb0: 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d  ns..    -------.
-00002ec0: 0a20 2020 2064 6620 3a20 4461 7461 4672  .    df : DataFr
-00002ed0: 616d 650d 0a20 2020 2020 2020 2044 6174  ame..        Dat
-00002ee0: 6146 7261 6d65 2069 6465 6e74 6963 616c  aFrame identical
-00002ef0: 2074 6f20 696e 7470 7574 2077 6974 6820   to intput with 
-00002f00: 6164 6469 7469 6f6e 616c 2063 6f6c 756d  additional colum
-00002f10: 6e20 7769 7468 2063 6f6d 6269 6e65 640d  n with combined.
-00002f20: 0a20 2020 2020 2020 2069 6e74 6572 7661  .        interva
-00002f30: 6c20 6e6f 7461 7469 6f6e 0d0a 0d0a 2020  l notation....  
-00002f40: 2020 2727 270d 0a20 2020 200d 0a20 2020    '''..    ..   
-00002f50: 2023 2043 7265 6174 6520 6120 636f 7079   # Create a copy
-00002f60: 206f 6620 7468 6520 4461 7461 4672 616d   of the DataFram
-00002f70: 650d 0a20 2020 2064 6620 3d20 6466 2e63  e..    df = df.c
-00002f80: 6f70 7928 290d 0a20 2020 200d 0a20 2020  opy()..    ..   
-00002f90: 2023 2044 6574 6572 6d69 6e65 2074 6865   # Determine the
-00002fa0: 206c 6566 7420 626f 756e 6461 7279 2073   left boundary s
-00002fb0: 796d 626f 6c0d 0a20 2020 2064 665b 696e  ymbol..    df[in
-00002fc0: 7465 7276 616c 5f63 6f6c 5d20 3d20 6e70  terval_col] = np
-00002fd0: 2e77 6865 7265 2864 665b 6c65 6674 5f62  .where(df[left_b
-00002fe0: 6f75 6e64 6172 795f 636f 6c5d 203d 3d20  oundary_col] == 
-00002ff0: 274f 7065 6e27 2c20 2728 272c 2027 5b27  'Open', '(', '['
-00003000: 290d 0a20 2020 200d 0a20 2020 2023 2049  )..    ..    # I
-00003010: 6e63 6f72 706f 7261 7465 206c 6566 7420  ncorporate left 
-00003020: 616e 6420 7269 6768 7420 626f 756e 6473  and right bounds
-00003030: 0d0a 2020 2020 6966 2070 7265 6369 7369  ..    if precisi
-00003040: 6f6e 5f72 6f75 6e64 696e 673a 0d0a 2020  on_rounding:..  
-00003050: 2020 2020 2020 6466 5b69 6e74 6572 7661        df[interva
-00003060: 6c5f 636f 6c5d 202b 3d20 6466 5b6c 6566  l_col] += df[lef
-00003070: 745f 626f 756e 645f 636f 6c5d 2e61 7070  t_bound_col].app
-00003080: 6c79 2873 7472 696e 675f 7072 6563 6973  ly(string_precis
-00003090: 696f 6e29 202b 2027 2c20 2720 2b20 6466  ion) + ', ' + df
-000030a0: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
-000030b0: 5d2e 6170 706c 7928 7374 7269 6e67 5f70  ].apply(string_p
-000030c0: 7265 6369 7369 6f6e 290d 0a20 2020 2065  recision)..    e
-000030d0: 6c73 653a 0d0a 2020 2020 2020 2020 6466  lse:..        df
-000030e0: 5b69 6e74 6572 7661 6c5f 636f 6c5d 202b  [interval_col] +
-000030f0: 3d20 6466 5b6c 6566 745f 626f 756e 645f  = df[left_bound_
-00003100: 636f 6c5d 2e61 7374 7970 6528 7374 7229  col].astype(str)
-00003110: 202b 2027 2c20 2720 2b20 6466 5b72 6967   + ', ' + df[rig
-00003120: 6874 5f62 6f75 6e64 5f63 6f6c 5d2e 6173  ht_bound_col].as
-00003130: 7479 7065 2873 7472 290d 0a20 2020 200d  type(str)..    .
-00003140: 0a20 2020 2023 2044 6574 6572 6d69 6e65  .    # Determine
-00003150: 2074 6865 2072 6967 6874 2062 6f75 6e64   the right bound
-00003160: 6172 7920 7379 6d62 6f6c 0d0a 2020 2020  ary symbol..    
-00003170: 6466 5b69 6e74 6572 7661 6c5f 636f 6c5d  df[interval_col]
-00003180: 202b 3d20 6e70 2e77 6865 7265 2864 665b   += np.where(df[
-00003190: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
-000031a0: 6f6c 5d2e 6973 696e 285b 274f 7065 6e27  ol].isin(['Open'
-000031b0: 5d29 2c20 2729 272c 2027 5d27 290d 0a20  ]), ')', ']').. 
-000031c0: 2020 200d 0a20 2020 2072 6574 7572 6e20     ..    return 
-000031d0: 6466 0d0a 0d0a 0d0a 2325 2520 4d61 7869  df......#%% Maxi
-000031e0: 6d75 6d20 5265 7375 6c74 0d0a 0d0a 6465  mum Result....de
-000031f0: 6620 6d61 7869 6d75 6d5f 696e 7465 7276  f maximum_interv
-00003200: 616c 2864 662c 0d0a 2020 2020 2020 2020  al(df,..        
-00003210: 2020 2020 2020 2020 2020 2020 2067 726f               gro
-00003220: 7570 6279 5f63 6f6c 7329 3a0d 0a20 2020  upby_cols):..   
-00003230: 2027 2727 0d0a 2020 2020 4120 6675 6e63   '''..    A func
-00003240: 7469 6f6e 2074 6861 7420 616e 616c 7973  tion that analys
-00003250: 6573 2074 6865 2069 6e74 6572 7661 6c20  es the interval 
-00003260: 6e6f 7461 7469 6f6e 2066 6f72 6d20 6f66  notation form of
-00003270: 2072 6573 756c 7473 2072 6574 7572 6e65   results returne
-00003280: 640d 0a20 2020 2066 726f 6d20 636f 6d70  d..    from comp
-00003290: 6f6e 656e 7473 5f74 6f5f 696e 7465 7276  onents_to_interv
-000032a0: 616c 2074 6f20 6765 6e65 7261 7465 2061  al to generate a
-000032b0: 206e 6577 2069 6e74 6572 7661 6c20 666f   new interval fo
-000032c0: 7220 7468 6520 6d61 7869 6d75 6d2e 2047  r the maximum. G
-000032d0: 726f 7570 730d 0a20 2020 206f 6620 7265  roups..    of re
-000032e0: 7375 6c74 7320 6361 6e20 6265 2064 6566  sults can be def
-000032f0: 696e 6564 2062 7920 696e 636c 7564 696e  ined by includin
-00003300: 6720 7468 6520 636f 6c75 6d6e 7320 7468  g the columns th
-00003310: 6174 2073 686f 756c 6420 6265 2075 7365  at should be use
-00003320: 6420 746f 0d0a 2020 2020 6372 6561 7465  d to..    create
-00003330: 2067 726f 7570 732e 0d0a 0d0a 2020 2020   groups.....    
-00003340: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
-00003350: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-00003360: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
-00003370: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
-00003380: 6520 7468 6174 2063 6f6e 7461 696e 7320  e that contains 
-00003390: 7265 7375 6c74 7320 696e 2061 2073 7065  results in a spe
-000033a0: 6369 6669 6320 696e 7465 7276 616c 206e  cific interval n
-000033b0: 6f74 6174 696f 6e2e 0d0a 2020 2020 6772  otation...    gr
-000033c0: 6f75 7062 795f 636f 6c73 203a 206c 6973  oupby_cols : lis
-000033d0: 7420 6f66 2073 7472 696e 6773 0d0a 2020  t of strings..  
-000033e0: 2020 2020 2020 4c69 7374 206f 6620 636f        List of co
-000033f0: 6c75 6d6e 206e 616d 6573 2074 6861 7420  lumn names that 
-00003400: 7368 6f75 6c64 2062 6520 7573 6564 2074  should be used t
-00003410: 6f20 6372 6561 7465 2067 726f 7570 732e  o create groups.
-00003420: 0d0a 0d0a 2020 2020 5265 7475 726e 730d  ....    Returns.
-00003430: 0a20 2020 202d 2d2d 2d2d 2d2d 0d0a 2020  .    -------..  
-00003440: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
-00003450: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
-00003460: 616d 6520 7468 6174 2068 6173 2074 6865  ame that has the
-00003470: 2069 6e74 6572 7661 6c20 666f 7220 7468   interval for th
-00003480: 6520 6d61 7869 6d75 6d20 2866 6f72 2065  e maximum (for e
-00003490: 6163 6820 6772 6f75 7020 6966 0d0a 2020  ach group if..  
-000034a0: 2020 2020 2020 636f 6c75 6d6e 206e 616d        column nam
-000034b0: 6573 2061 7265 2070 726f 7669 6465 6420  es are provided 
-000034c0: 666f 7220 6772 6f75 7069 6e67 290d 0a0d  for grouping)...
-000034d0: 0a20 2020 2027 2727 0d0a 2020 2020 0d0a  .    '''..    ..
-000034e0: 2020 2020 2320 4372 6561 7465 2061 2063      # Create a c
-000034f0: 6f70 7920 6f66 2074 6865 2044 6174 6146  opy of the DataF
-00003500: 7261 6d65 0d0a 2020 2020 6466 203d 2064  rame..    df = d
-00003510: 662e 636f 7079 2829 0d0a 2020 2020 0d0a  f.copy()..    ..
-00003520: 2020 2020 2320 4372 6561 7465 2063 6f6c      # Create col
-00003530: 756d 6e20 7468 6174 2069 6e64 6963 6174  umn that indicat
-00003540: 6573 2074 6865 2067 656e 6572 6174 6564  es the generated
-00003550: 2073 7461 7469 7374 6963 2061 6e64 2061   statistic and a
-00003560: 7070 656e 6420 746f 2067 726f 7570 696e  ppend to groupin
-00003570: 6720 6c69 7374 0d0a 2020 2020 6466 5b73  g list..    df[s
-00003580: 7461 745f 636f 6c5d 203d 2027 4d61 7869  tat_col] = 'Maxi
-00003590: 6d75 6d27 0d0a 2020 2020 6772 6f75 7062  mum'..    groupb
-000035a0: 795f 636f 6c73 2e61 7070 656e 6428 7374  y_cols.append(st
-000035b0: 6174 5f63 6f6c 290d 0a20 2020 200d 0a20  at_col)..    .. 
-000035c0: 2020 2023 2044 6574 6572 6d69 6e65 206c     # Determine l
-000035d0: 6566 7420 626f 756e 6420 616e 6420 626f  eft bound and bo
-000035e0: 756e 6461 7279 2066 6f72 206d 6178 696d  undary for maxim
-000035f0: 756d 2066 6f72 2065 6163 6820 6772 6f75  um for each grou
-00003600: 702e 0d0a 2020 2020 0d0a 2020 2020 2320  p...    ..    # 
-00003610: 436f 6e73 6964 6572 2074 6865 206d 6178  Consider the max
-00003620: 696d 756d 2062 6f75 6e64 2066 6f72 2065  imum bound for e
-00003630: 6163 6820 6c65 6674 2062 6f75 6e64 6172  ach left boundar
-00003640: 7920 6f70 7469 6f6e 2074 6f20 6465 7465  y option to dete
-00003650: 726d 696e 650d 0a20 2020 2023 2077 6865  rmine..    # whe
-00003660: 7468 6572 2074 6865 2062 6f75 6e64 2073  ther the bound s
-00003670: 686f 756c 6420 6265 206f 7065 6e20 6f72  hould be open or
-00003680: 2063 6c6f 7365 642e 0d0a 2020 2020 6c65   closed...    le
-00003690: 6674 203d 2064 662e 6772 6f75 7062 7928  ft = df.groupby(
-000036a0: 6772 6f75 7062 795f 636f 6c73 2b5b 6c65  groupby_cols+[le
-000036b0: 6674 5f62 6f75 6e64 6172 795f 636f 6c5d  ft_boundary_col]
-000036c0: 295b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  )[left_bound_col
-000036d0: 5d2e 6d61 7828 292e 756e 7374 6163 6b28  ].max().unstack(
-000036e0: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
-000036f0: 6c29 0d0a 2020 2020 2320 4372 6561 7465  l)..    # Create
-00003700: 206d 6973 7369 6e67 2063 6f6c 756d 6e73   missing columns
-00003710: 0d0a 2020 2020 666f 7220 6974 656d 2069  ..    for item i
-00003720: 6e20 5b27 4f70 656e 272c 2743 6c6f 7365  n ['Open','Close
-00003730: 6427 5d3a 0d0a 2020 2020 2020 2020 6966  d']:..        if
-00003740: 2069 7465 6d20 6e6f 7420 696e 206c 6566   item not in lef
-00003750: 742e 636f 6c75 6d6e 733a 0d0a 2020 2020  t.columns:..    
-00003760: 2020 2020 2020 2020 6c65 6674 5b69 7465          left[ite
-00003770: 6d5d 203d 206e 702e 6e61 6e0d 0a20 2020  m] = np.nan..   
-00003780: 2023 2055 7365 2074 6865 206d 6178 696d   # Use the maxim
-00003790: 756d 2063 6c6f 7365 6420 626f 756e 6461  um closed bounda
-000037a0: 7279 2069 6620 7468 6572 6520 6172 6520  ry if there are 
-000037b0: 6e6f 206f 7065 6e20 626f 756e 6461 7269  no open boundari
-000037c0: 6573 206f 720d 0a20 2020 2023 2069 6620  es or..    # if 
-000037d0: 7468 6520 636c 6f73 6564 2062 6f75 6e64  the closed bound
-000037e0: 6172 7920 6973 206c 6172 6765 7220 7468  ary is larger th
-000037f0: 616e 2074 6865 206c 6172 6765 7374 206f  an the largest o
-00003800: 7065 6e20 626f 756e 6461 7279 0d0a 2020  pen boundary..  
-00003810: 2020 636f 6e64 6974 696f 6e20 3d20 286c    condition = (l
-00003820: 6566 745b 2743 6c6f 7365 6427 5d20 3e20  eft['Closed'] > 
-00003830: 6c65 6674 5b27 4f70 656e 275d 2920 7c20  left['Open']) | 
-00003840: 286c 6566 745b 274f 7065 6e27 5d2e 6973  (left['Open'].is
-00003850: 6e61 2829 290d 0a20 2020 206c 6566 745b  na())..    left[
-00003860: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
-00003870: 6c5d 203d 206e 702e 7768 6572 6528 636f  l] = np.where(co
-00003880: 6e64 6974 696f 6e2c 2743 6c6f 7365 6427  ndition,'Closed'
-00003890: 2c27 4f70 656e 2729 0d0a 2020 2020 6c65  ,'Open')..    le
-000038a0: 6674 5b6c 6566 745f 626f 756e 645f 636f  ft[left_bound_co
-000038b0: 6c5d 203d 206e 702e 7768 6572 6528 636f  l] = np.where(co
-000038c0: 6e64 6974 696f 6e2c 6c65 6674 5b27 436c  ndition,left['Cl
-000038d0: 6f73 6564 275d 2c6c 6566 745b 274f 7065  osed'],left['Ope
-000038e0: 6e27 5d29 0d0a 2020 2020 6c65 6674 203d  n'])..    left =
-000038f0: 206c 6566 745b 5b6c 6566 745f 626f 756e   left[[left_boun
-00003900: 6461 7279 5f63 6f6c 2c6c 6566 745f 626f  dary_col,left_bo
-00003910: 756e 645f 636f 6c5d 5d0d 0a20 2020 200d  und_col]]..    .
-00003920: 0a20 2020 2023 2044 6574 6572 6d69 6e65  .    # Determine
-00003930: 2072 6967 6874 2062 6f75 6e64 2061 6e64   right bound and
-00003940: 2062 6f75 6e64 6172 7920 666f 7220 6d61   boundary for ma
-00003950: 7869 6d75 6d20 666f 7220 6561 6368 2067  ximum for each g
-00003960: 726f 7570 2e0d 0a20 2020 200d 0a20 2020  roup...    ..   
-00003970: 2023 2043 6f6e 7369 6465 7220 7468 6520   # Consider the 
-00003980: 6d61 7869 6d75 6d20 626f 756e 6420 666f  maximum bound fo
-00003990: 7220 6561 6368 2072 6967 6874 2062 6f75  r each right bou
-000039a0: 6e64 6172 7920 6f70 7469 6f6e 2074 6f20  ndary option to 
-000039b0: 6465 7465 726d 696e 650d 0a20 2020 2023  determine..    #
-000039c0: 2077 6865 7468 6572 2074 6865 2062 6f75   whether the bou
-000039d0: 6e64 2073 686f 756c 6420 6265 206f 7065  nd should be ope
-000039e0: 6e20 6f72 2063 6c6f 7365 642e 0d0a 2020  n or closed...  
-000039f0: 2020 7269 6768 7420 3d20 6466 2e67 726f    right = df.gro
-00003a00: 7570 6279 2867 726f 7570 6279 5f63 6f6c  upby(groupby_col
-00003a10: 732b 5b72 6967 6874 5f62 6f75 6e64 6172  s+[right_boundar
-00003a20: 795f 636f 6c5d 295b 7269 6768 745f 626f  y_col])[right_bo
-00003a30: 756e 645f 636f 6c5d 2e6d 6178 2829 2e75  und_col].max().u
-00003a40: 6e73 7461 636b 2872 6967 6874 5f62 6f75  nstack(right_bou
-00003a50: 6e64 6172 795f 636f 6c29 0d0a 2020 2020  ndary_col)..    
-00003a60: 2320 4372 6561 7465 206d 6973 7369 6e67  # Create missing
-00003a70: 2063 6f6c 756d 6e73 0d0a 2020 2020 666f   columns..    fo
-00003a80: 7220 6974 656d 2069 6e20 5b27 4f70 656e  r item in ['Open
-00003a90: 272c 2743 6c6f 7365 6427 5d3a 0d0a 2020  ','Closed']:..  
-00003aa0: 2020 2020 2020 6966 2069 7465 6d20 6e6f        if item no
-00003ab0: 7420 696e 2072 6967 6874 2e63 6f6c 756d  t in right.colum
-00003ac0: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
-00003ad0: 2072 6967 6874 5b69 7465 6d5d 203d 206e   right[item] = n
-00003ae0: 702e 6e61 6e0d 0a20 2020 2023 2055 7365  p.nan..    # Use
-00003af0: 2074 6865 206d 6178 696d 756d 2063 6c6f   the maximum clo
-00003b00: 7365 6420 626f 756e 6461 7279 2069 6620  sed boundary if 
-00003b10: 7468 6572 6520 6172 6520 6e6f 206f 7065  there are no ope
-00003b20: 6e20 626f 756e 6461 7269 6573 206f 720d  n boundaries or.
-00003b30: 0a20 2020 2023 2069 6620 7468 6520 636c  .    # if the cl
-00003b40: 6f73 6564 2062 6f75 6e64 6172 7920 6973  osed boundary is
-00003b50: 206c 6172 6765 7220 7468 616e 206f 7220   larger than or 
-00003b60: 6571 7561 6c20 746f 2074 6865 206c 6172  equal to the lar
-00003b70: 6765 7374 206f 7065 6e20 626f 756e 6461  gest open bounda
-00003b80: 7279 0d0a 2020 2020 636f 6e64 6974 696f  ry..    conditio
-00003b90: 6e20 3d20 2872 6967 6874 5b27 436c 6f73  n = (right['Clos
-00003ba0: 6564 275d 203e 3d20 7269 6768 745b 274f  ed'] >= right['O
-00003bb0: 7065 6e27 5d29 207c 2028 7269 6768 745b  pen']) | (right[
-00003bc0: 274f 7065 6e27 5d2e 6973 6e61 2829 290d  'Open'].isna()).
-00003bd0: 0a20 2020 2072 6967 6874 5b72 6967 6874  .    right[right
-00003be0: 5f62 6f75 6e64 5f63 6f6c 5d20 3d20 6e70  _bound_col] = np
-00003bf0: 2e77 6865 7265 2863 6f6e 6469 7469 6f6e  .where(condition
-00003c00: 2c72 6967 6874 5b27 436c 6f73 6564 275d  ,right['Closed']
-00003c10: 2c72 6967 6874 5b27 4f70 656e 275d 290d  ,right['Open']).
-00003c20: 0a20 2020 2072 6967 6874 5b72 6967 6874  .    right[right
-00003c30: 5f62 6f75 6e64 6172 795f 636f 6c5d 203d  _boundary_col] =
-00003c40: 206e 702e 7768 6572 6528 636f 6e64 6974   np.where(condit
-00003c50: 696f 6e2c 2743 6c6f 7365 6427 2c27 4f70  ion,'Closed','Op
-00003c60: 656e 2729 0d0a 2020 2020 7269 6768 7420  en')..    right 
-00003c70: 3d20 7269 6768 745b 5b72 6967 6874 5f62  = right[[right_b
-00003c80: 6f75 6e64 5f63 6f6c 2c72 6967 6874 5f62  ound_col,right_b
-00003c90: 6f75 6e64 6172 795f 636f 6c5d 5d0d 0a20  oundary_col]].. 
-00003ca0: 2020 200d 0a20 2020 2023 204d 6572 6765     ..    # Merge
-00003cb0: 2074 6865 2074 776f 2062 6f75 6e64 6172   the two boundar
-00003cc0: 6965 7320 746f 2063 7265 6174 6520 7468  ies to create th
-00003cd0: 6520 696e 7465 7276 616c 2066 6f72 2074  e interval for t
-00003ce0: 6865 206d 6178 696d 756d 0d0a 2020 2020  he maximum..    
-00003cf0: 2320 4368 6563 6b20 7468 6174 2074 6865  # Check that the
-00003d00: 206d 6572 6765 2069 7320 312d 746f 2d31   merge is 1-to-1
-00003d10: 0d0a 2020 2020 6466 203d 206c 6566 742e  ..    df = left.
-00003d20: 6d65 7267 6528 7269 6768 742c 2068 6f77  merge(right, how
-00003d30: 203d 2027 6f75 7465 7227 2c20 6f6e 203d   = 'outer', on =
-00003d40: 2067 726f 7570 6279 5f63 6f6c 732c 2076   groupby_cols, v
-00003d50: 616c 6964 6174 6520 3d20 2731 3a31 2729  alidate = '1:1')
-00003d60: 0d0a 2020 2020 0d0a 2020 2020 2320 5265  ..    ..    # Re
-00003d70: 7365 7420 696e 6465 780d 0a20 2020 2064  set index..    d
-00003d80: 6620 3d20 6466 2e72 6573 6574 5f69 6e64  f = df.reset_ind
-00003d90: 6578 2829 0d0a 2020 2020 0d0a 2020 2020  ex()..    ..    
-00003da0: 7265 7475 726e 2064 660d 0a0d 0a64 6566  return df....def
-00003db0: 206d 6178 696d 756d 2864 662c 0d0a 2020   maximum(df,..  
-00003dc0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00003dd0: 735f 636f 6c2c 0d0a 2020 2020 2020 2020  s_col,..        
-00003de0: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
-00003df0: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
-00003e00: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
-00003e10: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-00003e20: 3d20 4661 6c73 652c 0d0a 2020 2020 2020  = False,..      
-00003e30: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
-00003e40: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
-00003e50: 705f 6365 6e73 6f72 203d 2030 2e32 352c  p_censor = 0.25,
-00003e60: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00003e70: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
-00003e80: 203d 2054 7275 6529 3a0d 0a20 2020 2027   = True):..    '
-00003e90: 2727 0d0a 2020 2020 4120 6675 6e63 7469  ''..    A functi
-00003ea0: 6f6e 2074 6861 7420 636f 6d62 696e 6573  on that combines
-00003eb0: 2074 6865 2072 656c 6576 616e 7420 6d61   the relevant ma
-00003ec0: 7869 6d75 6d20 616e 6420 7574 696c 6974  ximum and utilit
-00003ed0: 7920 6675 6e63 7469 6f6e 7320 746f 0d0a  y functions to..
-00003ee0: 2020 2020 6765 6e65 7261 7465 2074 6865      generate the
-00003ef0: 206d 6178 696d 6120 7265 7375 6c74 7320   maxima results 
-00003f00: 666f 7220 6772 6f75 7073 2077 6974 6869  for groups withi
-00003f10: 6e20 6120 4461 7461 4672 616d 652e 0d0a  n a DataFrame...
-00003f20: 0d0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-00003f30: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  ..    ----------
-00003f40: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
-00003f50: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
-00003f60: 7461 4672 616d 6520 7468 6174 2063 6f6e  taFrame that con
-00003f70: 7461 696e 7320 6365 6e73 6f72 6564 206f  tains censored o
-00003f80: 7220 756e 6365 6e73 6f72 6564 2072 6573  r uncensored res
-00003f90: 756c 7473 0d0a 2020 2020 7265 7375 6c74  ults..    result
-00003fa0: 735f 636f 6c20 3a20 7374 7269 6e67 0d0a  s_col : string..
-00003fb0: 2020 2020 2020 2020 5468 6520 636f 6c75          The colu
-00003fc0: 6d6e 206e 616d 6520 666f 7220 7468 6520  mn name for the 
-00003fd0: 636f 6c75 6d6e 2074 6861 7420 636f 6e74  column that cont
-00003fe0: 6169 6e20 7468 6520 7265 7375 6c74 7320  ain the results 
-00003ff0: 6173 2074 6578 742e 0d0a 2020 2020 2020  as text...      
-00004000: 2020 4f6e 6c79 2066 6f75 7220 706f 7373    Only four poss
-00004010: 6962 6c65 2063 656e 736f 7273 2073 686f  ible censors sho
-00004020: 756c 6420 6265 2075 7365 6420 283c 2ce2  uld be used (<,.
-00004030: 89a4 2ce2 89a5 2c3e 292e 0d0a 2020 2020  ..,...,>)...    
-00004040: 6772 6f75 7062 795f 636f 6c73 203a 206c  groupby_cols : l
-00004050: 6973 7473 206f 6620 7374 7269 6e67 7320  ists of strings 
-00004060: 286f 7220 6c69 7374 206f 6620 6c69 7374  (or list of list
-00004070: 7329 2c20 6f70 7469 6f6e 616c 0d0a 2020  s), optional..  
-00004080: 2020 2020 2020 4c69 7374 206f 6620 636f        List of co
-00004090: 6c75 6d6e 206e 616d 6573 2074 6861 7420  lumn names that 
-000040a0: 7368 6f75 6c64 2062 6520 7573 6564 2074  should be used t
-000040b0: 6f20 6372 6561 7465 2067 726f 7570 732e  o create groups.
-000040c0: 2041 206d 6178 696d 756d 0d0a 2020 2020   A maximum..    
-000040d0: 2020 2020 7769 6c6c 2062 6520 666f 756e      will be foun
-000040e0: 6420 7769 7468 696e 2065 6163 6820 6772  d within each gr
-000040f0: 6f75 702e 204d 756c 7469 706c 6520 6c69  oup. Multiple li
-00004100: 7374 7320 6361 6e20 6265 2073 7570 706c  sts can be suppl
-00004110: 6965 6420 746f 0d0a 2020 2020 2020 2020  ied to..        
-00004120: 7065 7266 6f72 6d20 7365 7175 656e 7469  perform sequenti
-00004130: 616c 206d 6178 696d 6120 6265 666f 7265  al maxima before
-00004140: 2063 6f6e 7665 7274 696e 6720 696e 7465   converting inte
-00004150: 7276 616c 7320 746f 2061 2072 6573 756c  rvals to a resul
-00004160: 742e 0d0a 2020 2020 2020 2020 5468 6520  t...        The 
-00004170: 6465 6661 756c 7420 6973 204e 6f6e 652e  default is None.
-00004180: 0d0a 2020 2020 696e 636c 7564 655f 6e65  ..    include_ne
-00004190: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-000041a0: 3a20 626f 6f6c 6561 6e2c 206f 7074 696f  : boolean, optio
-000041b0: 6e61 6c0d 0a20 2020 2020 2020 2049 6620  nal..        If 
-000041c0: 5472 7565 2c20 7468 656e 2061 6c6c 2070  True, then all p
-000041d0: 6f73 6974 6976 6520 616e 6420 6e65 6761  ositive and nega
-000041e0: 7469 7665 2076 616c 7565 7320 6172 6520  tive values are 
-000041f0: 636f 6e73 6964 6572 6564 0d0a 2020 2020  considered..    
-00004200: 2020 2020 652e 672e 2c20 3c30 2e35 2077      e.g., <0.5 w
-00004210: 6f75 6c64 2062 6520 636f 6e76 6572 7465  ould be converte
-00004220: 6420 746f 2028 2d6e 702e 696e 662c 3529  d to (-np.inf,5)
-00004230: 2e0d 0a20 2020 2020 2020 2049 6620 4661  ...        If Fa
-00004240: 6c73 652c 2074 6865 6e20 6f6e 6c79 206e  lse, then only n
-00004250: 6f6e 2d6e 6567 6174 6976 6520 7661 6c75  on-negative valu
-00004260: 6573 2061 7265 2063 6f6e 7369 6465 7265  es are considere
-00004270: 640d 0a20 2020 2020 2020 2065 2e67 2e2c  d..        e.g.,
-00004280: 203c 302e 3520 776f 756c 6420 6265 2063   <0.5 would be c
-00004290: 6f6e 7665 7274 6564 2074 6f20 5b30 2c35  onverted to [0,5
-000042a0: 292e 0d0a 2020 2020 2020 2020 5468 6973  )...        This
-000042b0: 2073 6574 7469 6e67 206f 6e6c 7920 6166   setting only af
-000042c0: 6665 6374 7320 7265 7375 6c74 7320 6966  fects results if
-000042d0: 2066 6f63 7573 5f68 6967 685f 706f 7465   focus_high_pote
-000042e0: 6e74 6961 6c20 6973 2046 616c 7365 2e0d  ntial is False..
-000042f0: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-00004300: 6175 6c74 2069 7320 4661 6c73 652e 0d0a  ault is False...
-00004310: 2020 2020 7072 6563 6973 696f 6e5f 746f      precision_to
-00004320: 6c65 7261 6e63 655f 746f 5f64 726f 705f  lerance_to_drop_
-00004330: 6365 6e73 6f72 203a 2066 6c6f 6174 2c20  censor : float, 
-00004340: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-00004350: 2020 5468 7265 7368 6f6c 6420 666f 7220    Threshold for 
-00004360: 7265 706f 7274 696e 6720 6365 6e73 6f72  reporting censor
-00004370: 6564 2076 7320 6e6f 6e2d 6365 6e73 6f72  ed vs non-censor
-00004380: 6564 2072 6573 756c 7473 2e0d 0a20 2020  ed results...   
-00004390: 2020 2020 2055 7369 6e67 2074 6865 2064       Using the d
-000043a0: 6566 6175 6c74 2c20 6120 7265 7375 6c74  efault, a result
-000043b0: 2074 6861 7420 6973 206b 6e6f 776e 2074   that is known t
-000043c0: 6f20 6265 2069 6e20 7468 6520 696e 7465  o be in the inte
-000043d0: 7276 616c 2028 302e 332c 2030 2e35 290d  rval (0.3, 0.5).
-000043e0: 0a20 2020 2020 2020 2077 6f75 6c64 2062  .        would b
-000043f0: 6520 7265 7475 726e 6564 2061 7320 302e  e returned as 0.
-00004400: 342c 2077 6865 7265 6173 2061 2074 6f6c  4, whereas a tol
-00004410: 6572 616e 6365 206f 6620 3020 776f 756c  erance of 0 woul
-00004420: 6420 7969 656c 6420 610d 0a20 2020 2020  d yield a..     
-00004430: 2020 2072 6573 756c 7420 6f66 203c 302e     result of <0.
-00004440: 3520 6f72 203e 302e 3320 6465 7065 6e64  5 or >0.3 depend
-00004450: 696e 6720 6f6e 2074 6865 2076 616c 7565  ing on the value
-00004460: 206f 6620 666f 6375 735f 6869 6768 6573   of focus_highes
-00004470: 745f 706f 7465 6e74 6961 6c2e 0d0a 2020  t_potential...  
-00004480: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-00004490: 7420 6973 2030 2e32 352e 0d0a 2020 2020  t is 0.25...    
-000044a0: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
-000044b0: 6e67 203a 2062 6f6f 6c65 616e 2c20 6f70  ng : boolean, op
-000044c0: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
-000044d0: 4966 2054 7275 652c 2061 2072 6f75 6e64  If True, a round
-000044e0: 696e 6720 6d65 7468 6f64 2069 7320 6170  ing method is ap
-000044f0: 706c 6965 6420 746f 2072 6f75 6e64 2072  plied to round r
-00004500: 6573 756c 7473 2074 6f20 6861 7665 206e  esults to have n
-00004510: 6f20 6d6f 7265 0d0a 2020 2020 2020 2020  o more..        
-00004520: 6465 6369 6d61 6c73 2074 6861 6e20 7768  decimals than wh
-00004530: 6174 2063 616e 2062 6520 6d65 6173 7572  at can be measur
-00004540: 6564 2e0d 0a20 2020 2020 2020 2054 6865  ed...        The
-00004550: 2064 6566 6175 6c74 2069 7320 5472 7565   default is True
-00004560: 2e0d 0a0d 0a20 2020 2052 6574 7572 6e73  .....    Returns
-00004570: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20  ..    -------.. 
-00004580: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
-00004590: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
-000045a0: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
-000045b0: 6e73 2061 2063 6f6c 756d 6e20 7769 7468  ns a column with
-000045c0: 2074 6865 2072 656c 6576 616e 7420 6d61   the relevant ma
-000045d0: 7869 6d75 6d20 6f72 206d 6178 696d 610d  ximum or maxima.
-000045e0: 0a0d 0a20 2020 2027 2727 0d0a 2020 2020  ...    '''..    
-000045f0: 0d0a 2020 2020 2320 4372 6561 7465 2061  ..    # Create a
-00004600: 2063 6f70 7920 6f66 2074 6865 2044 6174   copy of the Dat
-00004610: 6146 7261 6d65 0d0a 2020 2020 6466 203d  aFrame..    df =
-00004620: 2064 662e 636f 7079 2829 0d0a 2020 2020   df.copy()..    
-00004630: 0d0a 2020 2020 2320 5370 6c69 7420 7468  ..    # Split th
-00004640: 6520 7265 7375 6c74 2069 6e74 6f20 6365  e result into ce
-00004650: 6e73 6f72 2061 6e64 206e 756d 6572 6963  nsor and numeric
-00004660: 2063 6f6d 706f 6e65 6e74 730d 0a20 2020   components..   
-00004670: 2064 6620 3d20 7265 7375 6c74 5f74 6f5f   df = result_to_
-00004680: 636f 6d70 6f6e 656e 7473 2864 662c 7265  components(df,re
-00004690: 7375 6c74 735f 636f 6c29 0d0a 2020 2020  sults_col)..    
-000046a0: 0d0a 2020 2020 2320 436f 6e76 6572 7420  ..    # Convert 
-000046b0: 7468 6520 7265 7375 6c74 7320 6672 6f6d  the results from
-000046c0: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
-000046d0: 7269 6320 636f 6d70 6f6e 656e 7473 2074  ric components t
-000046e0: 6f20 616e 2069 6e74 6572 7661 6c20 7265  o an interval re
-000046f0: 7072 6573 656e 7461 7469 6f6e 0d0a 2020  presentation..  
-00004700: 2020 6466 203d 2063 6f6d 706f 6e65 6e74    df = component
-00004710: 735f 746f 5f69 6e74 6572 7661 6c28 6466  s_to_interval(df
-00004720: 2c20 696e 636c 7564 655f 6e65 6761 7469  , include_negati
-00004730: 7665 5f69 6e74 6572 7661 6c29 0d0a 2020  ve_interval)..  
-00004740: 2020 0d0a 2020 2020 2320 5573 696e 6720    ..    # Using 
-00004750: 7468 6520 696e 7465 7276 616c 732c 2064  the intervals, d
-00004760: 6574 6572 6d69 6e65 2074 6865 2072 616e  etermine the ran
-00004770: 6765 206f 6620 706f 7373 6962 6c65 206d  ge of possible m
-00004780: 6178 696d 610d 0a20 2020 200d 0a20 2020  axima..    ..   
-00004790: 2023 2049 6620 7468 6572 6520 6172 6520   # If there are 
-000047a0: 6e6f 2067 726f 7570 6279 2d63 6f6c 756d  no groupby-colum
-000047b0: 6e73 2c20 7468 656e 2074 616b 6520 6d61  ns, then take ma
-000047c0: 7820 6f66 2061 6c6c 2072 6573 756c 7473  x of all results
-000047d0: 0d0a 2020 2020 6966 206e 6f74 2067 726f  ..    if not gro
-000047e0: 7570 6279 5f63 6f6c 733a 0d0a 2020 2020  upby_cols:..    
-000047f0: 2020 2020 6466 203d 206d 6178 696d 756d      df = maximum
-00004800: 5f69 6e74 6572 7661 6c28 6466 2c20 6772  _interval(df, gr
-00004810: 6f75 7062 795f 636f 6c73 3d5b 5d29 0d0a  oupby_cols=[])..
-00004820: 2020 2020 2320 4966 2074 6865 2067 726f      # If the gro
-00004830: 7570 6279 5f63 6f6c 7320 6973 2061 206c  upby_cols is a l
-00004840: 6973 7420 6f66 206c 6973 7473 2c20 7468  ist of lists, th
-00004850: 656e 2070 6572 666f 726d 206d 756c 7469  en perform multi
-00004860: 706c 6520 6d61 7869 6d75 6d73 0d0a 2020  ple maximums..  
-00004870: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00004880: 6528 6772 6f75 7062 795f 636f 6c73 5b30  e(groupby_cols[0
-00004890: 5d2c 6c69 7374 293a 0d0a 2020 2020 2020  ],list):..      
-000048a0: 2020 666f 7220 6772 6f75 7069 6e67 2069    for grouping i
-000048b0: 6e20 6772 6f75 7062 795f 636f 6c73 3a0d  n groupby_cols:.
-000048c0: 0a20 2020 2020 2020 2020 2020 2023 2055  .            # U
-000048d0: 7369 6e67 2074 6865 2069 6e74 6572 7661  sing the interva
-000048e0: 6c73 2c20 6465 7465 726d 696e 6520 7468  ls, determine th
-000048f0: 6520 7261 6e67 6520 6f66 2070 6f73 7369  e range of possi
-00004900: 626c 6520 6d61 7869 6d61 0d0a 2020 2020  ble maxima..    
-00004910: 2020 2020 2020 2020 6466 203d 206d 6178          df = max
-00004920: 696d 756d 5f69 6e74 6572 7661 6c28 6466  imum_interval(df
-00004930: 2c20 6772 6f75 7069 6e67 290d 0a20 2020  , grouping)..   
-00004940: 2023 2045 6c73 6520 7468 6520 6772 6f75   # Else the grou
-00004950: 7062 795f 636f 6c73 2069 7320 6120 6c69  pby_cols is a li
-00004960: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
-00004970: 6573 0d0a 2020 2020 656c 7365 3a0d 0a20  es..    else:.. 
-00004980: 2020 2020 2020 2064 6620 3d20 6d61 7869         df = maxi
-00004990: 6d75 6d5f 696e 7465 7276 616c 2864 662c  mum_interval(df,
-000049a0: 2067 726f 7570 6279 5f63 6f6c 7329 0d0a   groupby_cols)..
-000049b0: 2020 2020 0d0a 2020 2020 2320 436f 6e76      ..    # Conv
-000049c0: 6572 7420 7468 6520 696e 7465 7276 616c  ert the interval
-000049d0: 2066 6f72 2074 6865 206d 6178 696d 756d   for the maximum
-000049e0: 2069 6e74 6f20 6365 6e73 6f72 2061 6e64   into censor and
-000049f0: 206e 756d 6572 6963 206e 6f74 6174 696f   numeric notatio
-00004a00: 6e0d 0a20 2020 2064 6620 3d20 696e 7465  n..    df = inte
-00004a10: 7276 616c 5f74 6f5f 636f 6d70 6f6e 656e  rval_to_componen
-00004a20: 7473 2864 662c 0d0a 2020 2020 2020 2020  ts(df,..        
-00004a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a40: 2020 2020 2020 2020 666f 6375 735f 6869          focus_hi
-00004a50: 6768 5f70 6f74 656e 7469 616c 203d 2054  gh_potential = T
-00004a60: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
-00004a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a80: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
-00004a90: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-00004aa0: 3d20 696e 636c 7564 655f 6e65 6761 7469  = include_negati
-00004ab0: 7665 5f69 6e74 6572 7661 6c2c 0d0a 2020  ve_interval,..  
-00004ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ad0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00004ae0: 6563 6973 696f 6e5f 746f 6c65 7261 6e63  ecision_toleranc
-00004af0: 655f 746f 5f64 726f 705f 6365 6e73 6f72  e_to_drop_censor
-00004b00: 203d 2070 7265 6369 7369 6f6e 5f74 6f6c   = precision_tol
-00004b10: 6572 616e 6365 5f74 6f5f 6472 6f70 5f63  erance_to_drop_c
-00004b20: 656e 736f 7229 0d0a 2020 2020 0d0a 2020  ensor)..    ..  
-00004b30: 2020 2320 4372 6561 7465 2069 6e74 6572    # Create inter
-00004b40: 7661 6c20 6e6f 7461 7469 6f6e 2066 6f72  val notation for
-00004b50: 2074 6865 206d 6178 696d 756d 0d0a 2020   the maximum..  
-00004b60: 2020 6466 203d 2069 6e74 6572 7661 6c5f    df = interval_
-00004b70: 6e6f 7461 7469 6f6e 2864 662c 2070 7265  notation(df, pre
-00004b80: 6369 7369 6f6e 5f72 6f75 6e64 696e 6729  cision_rounding)
-00004b90: 0d0a 2020 2020 0d0a 2020 2020 2320 436f  ..    ..    # Co
-00004ba0: 6d62 696e 6520 7468 6520 6365 6e73 6f72  mbine the censor
-00004bb0: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
-00004bc0: 706f 6e65 6e74 7320 696e 746f 2061 2072  ponents into a r
-00004bd0: 6573 756c 740d 0a20 2020 2064 6620 3d20  esult..    df = 
-00004be0: 636f 6d70 6f6e 656e 7473 5f74 6f5f 7265  components_to_re
-00004bf0: 7375 6c74 2864 662c 2070 7265 6369 7369  sult(df, precisi
-00004c00: 6f6e 5f72 6f75 6e64 696e 6729 0d0a 2020  on_rounding)..  
-00004c10: 2020 0d0a 2020 2020 2320 4472 6f70 2077    ..    # Drop w
-00004c20: 6f72 6b69 6e67 2063 6f6c 756d 6e73 0d0a  orking columns..
-00004c30: 2020 2020 6466 203d 2064 662e 6472 6f70      df = df.drop
-00004c40: 2864 662e 6669 6c74 6572 2872 6567 6578  (df.filter(regex
-00004c50: 3d27 5f5f 2729 2e63 6f6c 756d 6e73 2c20  ='__').columns, 
-00004c60: 6178 6973 3d31 290d 0a20 2020 200d 0a20  axis=1)..    .. 
-00004c70: 2020 2023 2052 656f 7264 6572 2063 6f6c     # Reorder col
-00004c80: 756d 6e73 0d0a 2020 2020 666f 7220 636f  umns..    for co
-00004c90: 6c20 696e 205b 7374 6174 5f63 6f6c 2c72  l in [stat_col,r
-00004ca0: 6573 756c 745f 636f 6c2c 6365 6e73 6f72  esult_col,censor
-00004cb0: 5f63 6f6c 2c6e 756d 6572 6963 5f63 6f6c  _col,numeric_col
-00004cc0: 2c69 6e74 6572 7661 6c5f 636f 6c5d 3a0d  ,interval_col]:.
-00004cd0: 0a20 2020 2020 2020 2064 665b 636f 6c5d  .        df[col]
-00004ce0: 203d 2064 662e 706f 7028 636f 6c29 0d0a   = df.pop(col)..
-00004cf0: 2020 2020 0d0a 2020 2020 7265 7475 726e      ..    return
-00004d00: 2064 660d 0a0d 0a23 2525 204d 696e 696d   df....#%% Minim
-00004d10: 756d 2052 6573 756c 740d 0a0d 0a64 6566  um Result....def
-00004d20: 206d 696e 696d 756d 5f69 6e74 6572 7661   minimum_interva
-00004d30: 6c28 6466 2c0d 0a20 2020 2020 2020 2020  l(df,..         
-00004d40: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
-00004d50: 7062 795f 636f 6c73 293a 0d0a 2020 2020  pby_cols):..    
-00004d60: 2727 270d 0a20 2020 2041 2066 756e 6374  '''..    A funct
-00004d70: 696f 6e20 7468 6174 2061 6e61 6c79 7365  ion that analyse
-00004d80: 7320 7468 6520 696e 7465 7276 616c 206e  s the interval n
-00004d90: 6f74 6174 696f 6e20 666f 726d 206f 6620  otation form of 
-00004da0: 7265 7375 6c74 7320 7265 7475 726e 6564  results returned
-00004db0: 0d0a 2020 2020 6672 6f6d 2063 6f6d 706f  ..    from compo
-00004dc0: 6e65 6e74 735f 746f 5f69 6e74 6572 7661  nents_to_interva
-00004dd0: 6c20 746f 2067 656e 6572 6174 6520 6120  l to generate a 
-00004de0: 6e65 7720 696e 7465 7276 616c 2066 6f72  new interval for
-00004df0: 2074 6865 206d 696e 696d 756d 2e20 4772   the minimum. Gr
-00004e00: 6f75 7073 0d0a 2020 2020 6f66 2072 6573  oups..    of res
-00004e10: 756c 7473 2063 616e 2062 6520 6465 6669  ults can be defi
-00004e20: 6e65 6420 6279 2069 6e63 6c75 6469 6e67  ned by including
-00004e30: 2074 6865 2063 6f6c 756d 6e73 2074 6861   the columns tha
-00004e40: 7420 7368 6f75 6c64 2062 6520 7573 6564  t should be used
-00004e50: 2074 6f0d 0a20 2020 2063 7265 6174 6520   to..    create 
-00004e60: 6772 6f75 7073 2e0d 0a0d 0a20 2020 2050  groups.....    P
-00004e70: 6172 616d 6574 6572 730d 0a20 2020 202d  arameters..    -
-00004e80: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-00004e90: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
-00004ea0: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
-00004eb0: 2074 6861 7420 636f 6e74 6169 6e73 2072   that contains r
-00004ec0: 6573 756c 7473 2069 6e20 6120 7370 6563  esults in a spec
-00004ed0: 6966 6963 2069 6e74 6572 7661 6c20 6e6f  ific interval no
-00004ee0: 7461 7469 6f6e 2e0d 0a20 2020 2067 726f  tation...    gro
-00004ef0: 7570 6279 5f63 6f6c 7320 3a20 6c69 7374  upby_cols : list
-00004f00: 206f 6620 7374 7269 6e67 730d 0a20 2020   of strings..   
-00004f10: 2020 2020 204c 6973 7420 6f66 2063 6f6c       List of col
-00004f20: 756d 6e20 6e61 6d65 7320 7468 6174 2073  umn names that s
-00004f30: 686f 756c 6420 6265 2075 7365 6420 746f  hould be used to
-00004f40: 2063 7265 6174 6520 6772 6f75 7073 2e0d   create groups..
-00004f50: 0a0d 0a20 2020 2052 6574 7572 6e73 0d0a  ...    Returns..
-00004f60: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
-00004f70: 2064 6620 3a20 4461 7461 4672 616d 650d   df : DataFrame.
-00004f80: 0a20 2020 2020 2020 2044 6174 6146 7261  .        DataFra
-00004f90: 6d65 2074 6861 7420 6861 7320 7468 6520  me that has the 
-00004fa0: 696e 7465 7276 616c 2066 6f72 2074 6865  interval for the
-00004fb0: 206d 696e 696d 756d 2028 666f 7220 6561   minimum (for ea
-00004fc0: 6368 2067 726f 7570 2069 660d 0a20 2020  ch group if..   
-00004fd0: 2020 2020 2063 6f6c 756d 6e20 6e61 6d65       column name
-00004fe0: 7320 6172 6520 7072 6f76 6964 6564 2066  s are provided f
-00004ff0: 6f72 2067 726f 7570 696e 6729 0d0a 0d0a  or grouping)....
-00005000: 2020 2020 2727 270d 0a20 2020 200d 0a20      '''..    .. 
-00005010: 2020 2023 2043 7265 6174 6520 6120 636f     # Create a co
-00005020: 7079 206f 6620 7468 6520 4461 7461 4672  py of the DataFr
-00005030: 616d 650d 0a20 2020 2064 6620 3d20 6466  ame..    df = df
-00005040: 2e63 6f70 7928 290d 0a20 2020 200d 0a20  .copy()..    .. 
-00005050: 2020 2023 2043 7265 6174 6520 636f 6c75     # Create colu
-00005060: 6d6e 2074 6861 7420 696e 6469 6361 7465  mn that indicate
-00005070: 7320 7468 6520 6765 6e65 7261 7465 6420  s the generated 
-00005080: 7374 6174 6973 7469 6320 616e 6420 6170  statistic and ap
-00005090: 7065 6e64 2074 6f20 6772 6f75 7069 6e67  pend to grouping
-000050a0: 206c 6973 740d 0a20 2020 2064 665b 7374   list..    df[st
-000050b0: 6174 5f63 6f6c 5d20 3d20 274d 696e 696d  at_col] = 'Minim
-000050c0: 756d 270d 0a20 2020 2067 726f 7570 6279  um'..    groupby
-000050d0: 5f63 6f6c 732e 6170 7065 6e64 2873 7461  _cols.append(sta
-000050e0: 745f 636f 6c29 0d0a 2020 2020 0d0a 2020  t_col)..    ..  
-000050f0: 2020 2320 4465 7465 726d 696e 6520 6c65    # Determine le
-00005100: 6674 2062 6f75 6e64 2061 6e64 2062 6f75  ft bound and bou
-00005110: 6e64 6172 7920 666f 7220 6d69 6e69 6d75  ndary for minimu
-00005120: 6d20 666f 7220 6561 6368 2067 726f 7570  m for each group
-00005130: 2e0d 0a20 2020 200d 0a20 2020 2023 2043  ...    ..    # C
-00005140: 6f6e 7369 6465 7220 7468 6520 6d69 6e69  onsider the mini
-00005150: 6d75 6d20 626f 756e 6420 666f 7220 6561  mum bound for ea
-00005160: 6368 206c 6566 7420 626f 756e 6461 7279  ch left boundary
-00005170: 206f 7074 696f 6e20 746f 2064 6574 6572   option to deter
-00005180: 6d69 6e65 0d0a 2020 2020 2320 7768 6574  mine..    # whet
-00005190: 6865 7220 7468 6520 626f 756e 6420 7368  her the bound sh
-000051a0: 6f75 6c64 2062 6520 6f70 656e 206f 7220  ould be open or 
-000051b0: 636c 6f73 6564 2e0d 0a20 2020 206c 6566  closed...    lef
-000051c0: 7420 3d20 6466 2e67 726f 7570 6279 2867  t = df.groupby(g
-000051d0: 726f 7570 6279 5f63 6f6c 732b 5b6c 6566  roupby_cols+[lef
-000051e0: 745f 626f 756e 6461 7279 5f63 6f6c 5d29  t_boundary_col])
-000051f0: 5b6c 6566 745f 626f 756e 645f 636f 6c5d  [left_bound_col]
-00005200: 2e6d 696e 2829 2e75 6e73 7461 636b 286c  .min().unstack(l
-00005210: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-00005220: 290d 0a20 2020 2023 2043 7265 6174 6520  )..    # Create 
-00005230: 6d69 7373 696e 6720 636f 6c75 6d6e 730d  missing columns.
-00005240: 0a20 2020 2066 6f72 2069 7465 6d20 696e  .    for item in
-00005250: 205b 274f 7065 6e27 2c27 436c 6f73 6564   ['Open','Closed
-00005260: 275d 3a0d 0a20 2020 2020 2020 2069 6620  ']:..        if 
-00005270: 6974 656d 206e 6f74 2069 6e20 6c65 6674  item not in left
-00005280: 2e63 6f6c 756d 6e73 3a0d 0a20 2020 2020  .columns:..     
-00005290: 2020 2020 2020 206c 6566 745b 6974 656d         left[item
-000052a0: 5d20 3d20 6e70 2e6e 616e 0d0a 2020 2020  ] = np.nan..    
-000052b0: 2320 5573 6520 7468 6520 6d69 6e69 6d75  # Use the minimu
-000052c0: 6d20 636c 6f73 6564 2062 6f75 6e64 6172  m closed boundar
-000052d0: 7920 6966 2074 6865 7265 2061 7265 206e  y if there are n
-000052e0: 6f20 6f70 656e 2062 6f75 6e64 6172 6965  o open boundarie
-000052f0: 7320 6f72 0d0a 2020 2020 2320 6966 2074  s or..    # if t
-00005300: 6865 2063 6c6f 7365 6420 626f 756e 6461  he closed bounda
-00005310: 7279 2069 7320 6c65 7373 2074 6861 6e20  ry is less than 
-00005320: 6f72 2065 7175 616c 2074 6f20 7468 6520  or equal to the 
-00005330: 6c65 6173 7420 6f70 656e 2062 6f75 6e64  least open bound
-00005340: 6172 790d 0a20 2020 2063 6f6e 6469 7469  ary..    conditi
-00005350: 6f6e 203d 2028 6c65 6674 5b27 436c 6f73  on = (left['Clos
-00005360: 6564 275d 203c 3d20 6c65 6674 5b27 4f70  ed'] <= left['Op
-00005370: 656e 275d 2920 7c20 286c 6566 745b 274f  en']) | (left['O
-00005380: 7065 6e27 5d2e 6973 6e61 2829 290d 0a20  pen'].isna()).. 
-00005390: 2020 206c 6566 745b 6c65 6674 5f62 6f75     left[left_bou
-000053a0: 6e64 6172 795f 636f 6c5d 203d 206e 702e  ndary_col] = np.
-000053b0: 7768 6572 6528 636f 6e64 6974 696f 6e2c  where(condition,
-000053c0: 2743 6c6f 7365 6427 2c27 4f70 656e 2729  'Closed','Open')
-000053d0: 0d0a 2020 2020 6c65 6674 5b6c 6566 745f  ..    left[left_
-000053e0: 626f 756e 645f 636f 6c5d 203d 206e 702e  bound_col] = np.
-000053f0: 7768 6572 6528 636f 6e64 6974 696f 6e2c  where(condition,
-00005400: 6c65 6674 5b27 436c 6f73 6564 275d 2c6c  left['Closed'],l
-00005410: 6566 745b 274f 7065 6e27 5d29 0d0a 2020  eft['Open'])..  
-00005420: 2020 6c65 6674 203d 206c 6566 745b 5b6c    left = left[[l
-00005430: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-00005440: 2c6c 6566 745f 626f 756e 645f 636f 6c5d  ,left_bound_col]
-00005450: 5d0d 0a20 2020 200d 0a20 2020 2023 2044  ]..    ..    # D
-00005460: 6574 6572 6d69 6e65 2072 6967 6874 2062  etermine right b
-00005470: 6f75 6e64 2061 6e64 2062 6f75 6e64 6172  ound and boundar
-00005480: 7920 666f 7220 6d69 6e69 6d75 6d20 666f  y for minimum fo
-00005490: 7220 6561 6368 2067 726f 7570 2e0d 0a20  r each group... 
-000054a0: 2020 200d 0a20 2020 2023 2043 6f6e 7369     ..    # Consi
-000054b0: 6465 7220 7468 6520 6d69 6e69 6d75 6d20  der the minimum 
-000054c0: 626f 756e 6420 666f 7220 6561 6368 2072  bound for each r
-000054d0: 6967 6874 2062 6f75 6e64 6172 7920 6f70  ight boundary op
-000054e0: 7469 6f6e 2074 6f20 6465 7465 726d 696e  tion to determin
-000054f0: 650d 0a20 2020 2023 2077 6865 7468 6572  e..    # whether
-00005500: 2074 6865 2062 6f75 6e64 2073 686f 756c   the bound shoul
-00005510: 6420 6265 206f 7065 6e20 6f72 2063 6c6f  d be open or clo
-00005520: 7365 642e 0d0a 2020 2020 7269 6768 7420  sed...    right 
-00005530: 3d20 6466 2e67 726f 7570 6279 2867 726f  = df.groupby(gro
-00005540: 7570 6279 5f63 6f6c 732b 5b72 6967 6874  upby_cols+[right
-00005550: 5f62 6f75 6e64 6172 795f 636f 6c5d 295b  _boundary_col])[
-00005560: 7269 6768 745f 626f 756e 645f 636f 6c5d  right_bound_col]
-00005570: 2e6d 696e 2829 2e75 6e73 7461 636b 2872  .min().unstack(r
-00005580: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
-00005590: 6c29 0d0a 2020 2020 2320 4372 6561 7465  l)..    # Create
-000055a0: 206d 6973 7369 6e67 2063 6f6c 756d 6e73   missing columns
-000055b0: 0d0a 2020 2020 666f 7220 6974 656d 2069  ..    for item i
-000055c0: 6e20 5b27 4f70 656e 272c 2743 6c6f 7365  n ['Open','Close
-000055d0: 6427 5d3a 0d0a 2020 2020 2020 2020 6966  d']:..        if
-000055e0: 2069 7465 6d20 6e6f 7420 696e 2072 6967   item not in rig
-000055f0: 6874 2e63 6f6c 756d 6e73 3a0d 0a20 2020  ht.columns:..   
-00005600: 2020 2020 2020 2020 2072 6967 6874 5b69           right[i
-00005610: 7465 6d5d 203d 206e 702e 6e61 6e0d 0a20  tem] = np.nan.. 
-00005620: 2020 2023 2055 7365 2074 6865 206d 696e     # Use the min
-00005630: 696d 756d 2063 6c6f 7365 6420 626f 756e  imum closed boun
-00005640: 6461 7279 2069 6620 7468 6572 6520 6172  dary if there ar
-00005650: 6520 6e6f 206f 7065 6e20 626f 756e 6461  e no open bounda
-00005660: 7269 6573 206f 720d 0a20 2020 2023 2069  ries or..    # i
-00005670: 6620 7468 6520 636c 6f73 6564 2062 6f75  f the closed bou
-00005680: 6e64 6172 7920 6973 206c 6573 7320 7468  ndary is less th
-00005690: 616e 2074 6865 206c 6561 7374 206f 7065  an the least ope
-000056a0: 6e20 626f 756e 6461 7279 0d0a 2020 2020  n boundary..    
-000056b0: 636f 6e64 6974 696f 6e20 3d20 2872 6967  condition = (rig
-000056c0: 6874 5b27 436c 6f73 6564 275d 203c 2072  ht['Closed'] < r
-000056d0: 6967 6874 5b27 4f70 656e 275d 2920 7c20  ight['Open']) | 
-000056e0: 2872 6967 6874 5b27 4f70 656e 275d 2e69  (right['Open'].i
-000056f0: 736e 6128 2929 0d0a 2020 2020 7269 6768  sna())..    righ
-00005700: 745b 7269 6768 745f 626f 756e 645f 636f  t[right_bound_co
-00005710: 6c5d 203d 206e 702e 7768 6572 6528 636f  l] = np.where(co
-00005720: 6e64 6974 696f 6e2c 7269 6768 745b 2743  ndition,right['C
-00005730: 6c6f 7365 6427 5d2c 7269 6768 745b 274f  losed'],right['O
-00005740: 7065 6e27 5d29 0d0a 2020 2020 7269 6768  pen'])..    righ
-00005750: 745b 7269 6768 745f 626f 756e 6461 7279  t[right_boundary
-00005760: 5f63 6f6c 5d20 3d20 6e70 2e77 6865 7265  _col] = np.where
-00005770: 2863 6f6e 6469 7469 6f6e 2c27 436c 6f73  (condition,'Clos
-00005780: 6564 272c 274f 7065 6e27 290d 0a20 2020  ed','Open')..   
-00005790: 2072 6967 6874 203d 2072 6967 6874 5b5b   right = right[[
-000057a0: 7269 6768 745f 626f 756e 645f 636f 6c2c  right_bound_col,
-000057b0: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
-000057c0: 6f6c 5d5d 0d0a 2020 2020 0d0a 2020 2020  ol]]..    ..    
-000057d0: 2320 4d65 7267 6520 7468 6520 7477 6f20  # Merge the two 
-000057e0: 626f 756e 6461 7269 6573 2074 6f20 6372  boundaries to cr
-000057f0: 6561 7465 2074 6865 2069 6e74 6572 7661  eate the interva
-00005800: 6c20 666f 7220 7468 6520 6d69 6e69 6d75  l for the minimu
-00005810: 6d0d 0a20 2020 2023 2043 6865 636b 2074  m..    # Check t
-00005820: 6861 7420 7468 6520 6d65 7267 6520 6973  hat the merge is
-00005830: 2031 2d74 6f2d 310d 0a20 2020 2064 6620   1-to-1..    df 
-00005840: 3d20 6c65 6674 2e6d 6572 6765 2872 6967  = left.merge(rig
-00005850: 6874 2c20 686f 7720 3d20 276f 7574 6572  ht, how = 'outer
-00005860: 272c 206f 6e20 3d20 6772 6f75 7062 795f  ', on = groupby_
-00005870: 636f 6c73 2c20 7661 6c69 6461 7465 203d  cols, validate =
-00005880: 2027 313a 3127 290d 0a20 2020 200d 0a20   '1:1')..    .. 
-00005890: 2020 2023 2052 6573 6574 2069 6e64 6578     # Reset index
-000058a0: 0d0a 2020 2020 6466 203d 2064 662e 7265  ..    df = df.re
-000058b0: 7365 745f 696e 6465 7828 290d 0a20 2020  set_index()..   
-000058c0: 200d 0a20 2020 2072 6574 7572 6e20 6466   ..    return df
-000058d0: 0d0a 0d0a 6465 6620 6d69 6e69 6d75 6d28  ....def minimum(
-000058e0: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
-000058f0: 2072 6573 756c 7473 5f63 6f6c 2c0d 0a20   results_col,.. 
-00005900: 2020 2020 2020 2020 2020 2067 726f 7570             group
-00005910: 6279 5f63 6f6c 7320 3d20 4e6f 6e65 2c0d  by_cols = None,.
-00005920: 0a20 2020 2020 2020 2020 2020 2069 6e63  .            inc
-00005930: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
-00005940: 7465 7276 616c 203d 2046 616c 7365 2c0d  terval = False,.
-00005950: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00005960: 6369 7369 6f6e 5f74 6f6c 6572 616e 6365  cision_tolerance
-00005970: 5f74 6f5f 6472 6f70 5f63 656e 736f 7220  _to_drop_censor 
-00005980: 3d20 302e 3235 2c0d 0a20 2020 2020 2020  = 0.25,..       
-00005990: 2020 2020 2070 7265 6369 7369 6f6e 5f72       precision_r
-000059a0: 6f75 6e64 696e 6720 3d20 5472 7565 293a  ounding = True):
-000059b0: 0d0a 2020 2020 2727 270d 0a20 2020 2041  ..    '''..    A
-000059c0: 2066 756e 6374 696f 6e20 7468 6174 2063   function that c
-000059d0: 6f6d 6269 6e65 7320 7468 6520 7265 6c65  ombines the rele
-000059e0: 7661 6e74 206d 696e 696d 756d 2061 6e64  vant minimum and
-000059f0: 2075 7469 6c69 7479 2066 756e 6374 696f   utility functio
-00005a00: 6e73 2074 6f0d 0a20 2020 2067 656e 6572  ns to..    gener
-00005a10: 6174 6520 7468 6520 6d69 6e69 6d61 2072  ate the minima r
-00005a20: 6573 756c 7473 2066 6f72 2067 726f 7570  esults for group
-00005a30: 7320 7769 7468 696e 2061 2044 6174 6146  s within a DataF
-00005a40: 7261 6d65 2e0d 0a0d 0a20 2020 2050 6172  rame.....    Par
-00005a50: 616d 6574 6572 730d 0a20 2020 202d 2d2d  ameters..    ---
-00005a60: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
-00005a70: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
-00005a80: 2020 2020 2044 6174 6146 7261 6d65 2074       DataFrame t
-00005a90: 6861 7420 636f 6e74 6169 6e73 2063 656e  hat contains cen
-00005aa0: 736f 7265 6420 6f72 2075 6e63 656e 736f  sored or uncenso
-00005ab0: 7265 6420 7265 7375 6c74 730d 0a20 2020  red results..   
-00005ac0: 2072 6573 756c 7473 5f63 6f6c 203a 2073   results_col : s
-00005ad0: 7472 696e 670d 0a20 2020 2020 2020 2054  tring..        T
-00005ae0: 6865 2063 6f6c 756d 6e20 6e61 6d65 2066  he column name f
-00005af0: 6f72 2074 6865 2063 6f6c 756d 6e20 7468  or the column th
-00005b00: 6174 2063 6f6e 7461 696e 2074 6865 2072  at contain the r
-00005b10: 6573 756c 7473 2061 7320 7465 7874 2e0d  esults as text..
-00005b20: 0a20 2020 2020 2020 204f 6e6c 7920 666f  .        Only fo
-00005b30: 7572 2070 6f73 7369 626c 6520 6365 6e73  ur possible cens
-00005b40: 6f72 7320 7368 6f75 6c64 2062 6520 7573  ors should be us
-00005b50: 6564 2028 3c2c e289 a42c e289 a52c 3e29  ed (<,...,...,>)
-00005b60: 2e0d 0a20 2020 2067 726f 7570 6279 5f63  ...    groupby_c
-00005b70: 6f6c 7320 3a20 6c69 7374 7320 6f66 2073  ols : lists of s
-00005b80: 7472 696e 6773 2028 6f72 206c 6973 7420  trings (or list 
-00005b90: 6f66 206c 6973 7473 292c 206f 7074 696f  of lists), optio
-00005ba0: 6e61 6c0d 0a20 2020 2020 2020 204c 6973  nal..        Lis
-00005bb0: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
-00005bc0: 7320 7468 6174 2073 686f 756c 6420 6265  s that should be
-00005bd0: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
-00005be0: 6772 6f75 7073 2e20 4120 6d69 6e69 6d75  groups. A minimu
-00005bf0: 6d0d 0a20 2020 2020 2020 2077 696c 6c20  m..        will 
-00005c00: 6265 2066 6f75 6e64 2077 6974 6869 6e20  be found within 
-00005c10: 6561 6368 2067 726f 7570 2e20 4d75 6c74  each group. Mult
-00005c20: 6970 6c65 206c 6973 7473 2063 616e 2062  iple lists can b
-00005c30: 6520 7375 7070 6c69 6564 2074 6f0d 0a20  e supplied to.. 
-00005c40: 2020 2020 2020 2070 6572 666f 726d 2073         perform s
-00005c50: 6571 7565 6e74 6961 6c20 6d69 6e69 6d61  equential minima
-00005c60: 2062 6566 6f72 6520 636f 6e76 6572 7469   before converti
-00005c70: 6e67 2069 6e74 6572 7661 6c73 2074 6f20  ng intervals to 
-00005c80: 6120 7265 7375 6c74 2e0d 0a20 2020 2020  a result...     
-00005c90: 2020 2054 6865 2064 6566 6175 6c74 2069     The default i
-00005ca0: 7320 4e6f 6e65 2e0d 0a20 2020 2069 6e63  s None...    inc
-00005cb0: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
-00005cc0: 7465 7276 616c 203a 2062 6f6f 6c65 616e  terval : boolean
-00005cd0: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
-00005ce0: 2020 2020 4966 2054 7275 652c 2074 6865      If True, the
-00005cf0: 6e20 616c 6c20 706f 7369 7469 7665 2061  n all positive a
-00005d00: 6e64 206e 6567 6174 6976 6520 7661 6c75  nd negative valu
-00005d10: 6573 2061 7265 2063 6f6e 7369 6465 7265  es are considere
-00005d20: 640d 0a20 2020 2020 2020 2065 2e67 2e2c  d..        e.g.,
-00005d30: 203c 302e 3520 776f 756c 6420 6265 2063   <0.5 would be c
-00005d40: 6f6e 7665 7274 6564 2074 6f20 282d 6e70  onverted to (-np
-00005d50: 2e69 6e66 2c35 292e 0d0a 2020 2020 2020  .inf,5)...      
-00005d60: 2020 4966 2046 616c 7365 2c20 7468 656e    If False, then
-00005d70: 206f 6e6c 7920 6e6f 6e2d 6e65 6761 7469   only non-negati
-00005d80: 7665 2076 616c 7565 7320 6172 6520 636f  ve values are co
-00005d90: 6e73 6964 6572 6564 0d0a 2020 2020 2020  nsidered..      
-00005da0: 2020 652e 672e 2c20 3c30 2e35 2077 6f75    e.g., <0.5 wou
-00005db0: 6c64 2062 6520 636f 6e76 6572 7465 6420  ld be converted 
-00005dc0: 746f 205b 302c 3529 2e0d 0a20 2020 2020  to [0,5)...     
-00005dd0: 2020 2054 6869 7320 7365 7474 696e 6720     This setting 
-00005de0: 6f6e 6c79 2061 6666 6563 7473 2072 6573  only affects res
-00005df0: 756c 7473 2069 6620 666f 6375 735f 6869  ults if focus_hi
-00005e00: 6768 5f70 6f74 656e 7469 616c 2069 7320  gh_potential is 
-00005e10: 4661 6c73 652e 0d0a 2020 2020 2020 2020  False...        
-00005e20: 5468 6520 6465 6661 756c 7420 6973 2046  The default is F
-00005e30: 616c 7365 2e0d 0a20 2020 2070 7265 6369  alse...    preci
-00005e40: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
-00005e50: 6f5f 6472 6f70 5f63 656e 736f 7220 3a20  o_drop_censor : 
-00005e60: 666c 6f61 742c 206f 7074 696f 6e61 6c0d  float, optional.
-00005e70: 0a20 2020 2020 2020 2054 6872 6573 686f  .        Thresho
-00005e80: 6c64 2066 6f72 2072 6570 6f72 7469 6e67  ld for reporting
-00005e90: 2063 656e 736f 7265 6420 7673 206e 6f6e   censored vs non
-00005ea0: 2d63 656e 736f 7265 6420 7265 7375 6c74  -censored result
-00005eb0: 732e 0d0a 2020 2020 2020 2020 5573 696e  s...        Usin
-00005ec0: 6720 7468 6520 6465 6661 756c 742c 2061  g the default, a
-00005ed0: 2072 6573 756c 7420 7468 6174 2069 7320   result that is 
-00005ee0: 6b6e 6f77 6e20 746f 2062 6520 696e 2074  known to be in t
-00005ef0: 6865 2069 6e74 6572 7661 6c20 2830 2e33  he interval (0.3
-00005f00: 2c20 302e 3529 0d0a 2020 2020 2020 2020  , 0.5)..        
-00005f10: 776f 756c 6420 6265 2072 6574 7572 6e65  would be returne
-00005f20: 6420 6173 2030 2e34 2c20 7768 6572 6561  d as 0.4, wherea
-00005f30: 7320 6120 746f 6c65 7261 6e63 6520 6f66  s a tolerance of
-00005f40: 2030 2077 6f75 6c64 2079 6965 6c64 2061   0 would yield a
-00005f50: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
-00005f60: 206f 6620 3c30 2e35 206f 7220 3e30 2e33   of <0.5 or >0.3
-00005f70: 2064 6570 656e 6469 6e67 206f 6e20 7468   depending on th
-00005f80: 6520 7661 6c75 6520 6f66 2066 6f63 7573  e value of focus
-00005f90: 5f68 6967 6865 7374 5f70 6f74 656e 7469  _highest_potenti
-00005fa0: 616c 2e0d 0a20 2020 2020 2020 2054 6865  al...        The
-00005fb0: 2064 6566 6175 6c74 2069 7320 302e 3235   default is 0.25
-00005fc0: 2e0d 0a20 2020 2070 7265 6369 7369 6f6e  ...    precision
-00005fd0: 5f72 6f75 6e64 696e 6720 3a20 626f 6f6c  _rounding : bool
-00005fe0: 6561 6e2c 206f 7074 696f 6e61 6c0d 0a20  ean, optional.. 
-00005ff0: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00006000: 6120 726f 756e 6469 6e67 206d 6574 686f  a rounding metho
-00006010: 6420 6973 2061 7070 6c69 6564 2074 6f20  d is applied to 
-00006020: 726f 756e 6420 7265 7375 6c74 7320 746f  round results to
-00006030: 2068 6176 6520 6e6f 206d 6f72 650d 0a20   have no more.. 
-00006040: 2020 2020 2020 2064 6563 696d 616c 7320         decimals 
-00006050: 7468 616e 2077 6861 7420 6361 6e20 6265  than what can be
-00006060: 206d 6561 7375 7265 642e 0d0a 2020 2020   measured...    
-00006070: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
-00006080: 6973 2054 7275 652e 0d0a 0d0a 2020 2020  is True.....    
-00006090: 5265 7475 726e 730d 0a20 2020 202d 2d2d  Returns..    ---
-000060a0: 2d2d 2d2d 0d0a 2020 2020 6466 203a 2044  ----..    df : D
-000060b0: 6174 6146 7261 6d65 0d0a 2020 2020 2020  ataFrame..      
-000060c0: 2020 4461 7461 4672 616d 6520 7468 6174    DataFrame that
-000060d0: 2063 6f6e 7461 696e 7320 6120 636f 6c75   contains a colu
-000060e0: 6d6e 2077 6974 6820 7468 6520 7265 6c65  mn with the rele
-000060f0: 7661 6e74 206d 696e 696d 756d 206f 7220  vant minimum or 
-00006100: 6d69 6e69 6d61 0d0a 0d0a 2020 2020 2727  minima....    ''
-00006110: 270d 0a20 2020 200d 0a20 2020 2023 2043  '..    ..    # C
-00006120: 7265 6174 6520 6120 636f 7079 206f 6620  reate a copy of 
-00006130: 7468 6520 4461 7461 4672 616d 650d 0a20  the DataFrame.. 
-00006140: 2020 2064 6620 3d20 6466 2e63 6f70 7928     df = df.copy(
-00006150: 290d 0a20 2020 200d 0a20 2020 2023 2053  )..    ..    # S
-00006160: 706c 6974 2074 6865 2072 6573 756c 7420  plit the result 
-00006170: 696e 746f 2063 656e 736f 7220 616e 6420  into censor and 
-00006180: 6e75 6d65 7269 6320 636f 6d70 6f6e 656e  numeric componen
-00006190: 7473 0d0a 2020 2020 6466 203d 2072 6573  ts..    df = res
-000061a0: 756c 745f 746f 5f63 6f6d 706f 6e65 6e74  ult_to_component
-000061b0: 7328 6466 2c72 6573 756c 7473 5f63 6f6c  s(df,results_col
-000061c0: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
-000061d0: 6f6e 7665 7274 2074 6865 2072 6573 756c  onvert the resul
-000061e0: 7473 2066 726f 6d20 6365 6e73 6f72 2061  ts from censor a
-000061f0: 6e64 206e 756d 6572 6963 2063 6f6d 706f  nd numeric compo
-00006200: 6e65 6e74 7320 746f 2061 6e20 696e 7465  nents to an inte
-00006210: 7276 616c 2072 6570 7265 7365 6e74 6174  rval representat
-00006220: 696f 6e0d 0a20 2020 2064 6620 3d20 636f  ion..    df = co
-00006230: 6d70 6f6e 656e 7473 5f74 6f5f 696e 7465  mponents_to_inte
-00006240: 7276 616c 2864 662c 2069 6e63 6c75 6465  rval(df, include
-00006250: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
-00006260: 616c 290d 0a20 2020 200d 0a20 2020 2023  al)..    ..    #
-00006270: 2055 7369 6e67 2074 6865 2069 6e74 6572   Using the inter
-00006280: 7661 6c73 2c20 6465 7465 726d 696e 6520  vals, determine 
-00006290: 7468 6520 7261 6e67 6520 6f66 2070 6f73  the range of pos
-000062a0: 7369 626c 6520 6d69 6e69 6d61 0d0a 2020  sible minima..  
-000062b0: 2020 0d0a 2020 2020 2320 4966 2074 6865    ..    # If the
-000062c0: 7265 2061 7265 206e 6f20 6772 6f75 7062  re are no groupb
-000062d0: 792d 636f 6c75 6d6e 732c 2074 6865 6e20  y-columns, then 
-000062e0: 7461 6b65 206d 696e 206f 6620 616c 6c20  take min of all 
-000062f0: 7265 7375 6c74 730d 0a20 2020 2069 6620  results..    if 
-00006300: 6e6f 7420 6772 6f75 7062 795f 636f 6c73  not groupby_cols
-00006310: 3a0d 0a20 2020 2020 2020 2064 6620 3d20  :..        df = 
-00006320: 6d69 6e69 6d75 6d5f 696e 7465 7276 616c  minimum_interval
-00006330: 2864 662c 2067 726f 7570 6279 5f63 6f6c  (df, groupby_col
-00006340: 733d 5b5d 290d 0a20 2020 2023 2049 6620  s=[])..    # If 
-00006350: 7468 6520 6772 6f75 7062 795f 636f 6c73  the groupby_cols
-00006360: 2069 7320 6120 6c69 7374 206f 6620 6c69   is a list of li
-00006370: 7374 732c 2074 6865 6e20 7065 7266 6f72  sts, then perfor
-00006380: 6d20 6d75 6c74 6970 6c65 206d 696e 696d  m multiple minim
-00006390: 756d 730d 0a20 2020 2065 6c69 6620 6973  ums..    elif is
-000063a0: 696e 7374 616e 6365 2867 726f 7570 6279  instance(groupby
-000063b0: 5f63 6f6c 735b 305d 2c6c 6973 7429 3a0d  _cols[0],list):.
-000063c0: 0a20 2020 2020 2020 2066 6f72 2067 726f  .        for gro
-000063d0: 7570 696e 6720 696e 2067 726f 7570 6279  uping in groupby
-000063e0: 5f63 6f6c 733a 0d0a 2020 2020 2020 2020  _cols:..        
-000063f0: 2020 2020 2320 5573 696e 6720 7468 6520      # Using the 
-00006400: 696e 7465 7276 616c 732c 2064 6574 6572  intervals, deter
-00006410: 6d69 6e65 2074 6865 2072 616e 6765 206f  mine the range o
-00006420: 6620 706f 7373 6962 6c65 206d 6178 696d  f possible maxim
-00006430: 610d 0a20 2020 2020 2020 2020 2020 2064  a..            d
-00006440: 6620 3d20 6d69 6e69 6d75 6d5f 696e 7465  f = minimum_inte
-00006450: 7276 616c 2864 662c 2067 726f 7570 696e  rval(df, groupin
-00006460: 6729 0d0a 2020 2020 2320 456c 7365 2074  g)..    # Else t
-00006470: 6865 2067 726f 7570 6279 5f63 6f6c 7320  he groupby_cols 
-00006480: 6973 2061 206c 6973 7420 6f66 2063 6f6c  is a list of col
-00006490: 756d 6e20 6e61 6d65 730d 0a20 2020 2065  umn names..    e
-000064a0: 6c73 653a 0d0a 2020 2020 2020 2020 6466  lse:..        df
-000064b0: 203d 206d 696e 696d 756d 5f69 6e74 6572   = minimum_inter
-000064c0: 7661 6c28 6466 2c20 6772 6f75 7062 795f  val(df, groupby_
-000064d0: 636f 6c73 290d 0a20 2020 200d 0a20 2020  cols)..    ..   
-000064e0: 2023 2043 6f6e 7665 7274 2074 6865 2069   # Convert the i
-000064f0: 6e74 6572 7661 6c20 666f 7220 7468 6520  nterval for the 
-00006500: 6d69 6e69 6d75 6d20 696e 746f 2063 656e  minimum into cen
-00006510: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
-00006520: 6e6f 7461 7469 6f6e 0d0a 2020 2020 6466  notation..    df
-00006530: 203d 2069 6e74 6572 7661 6c5f 746f 5f63   = interval_to_c
-00006540: 6f6d 706f 6e65 6e74 7328 6466 2c0d 0a20  omponents(df,.. 
-00006550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006560: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00006570: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
-00006580: 6961 6c20 3d20 4661 6c73 652c 0d0a 2020  ial = False,..  
-00006590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065a0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-000065b0: 636c 7564 655f 6e65 6761 7469 7665 5f69  clude_negative_i
-000065c0: 6e74 6572 7661 6c20 3d20 696e 636c 7564  nterval = includ
-000065d0: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
-000065e0: 7661 6c2c 0d0a 2020 2020 2020 2020 2020  val,..          
-000065f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006600: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
-00006610: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
-00006620: 705f 6365 6e73 6f72 203d 2070 7265 6369  p_censor = preci
-00006630: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
-00006640: 6f5f 6472 6f70 5f63 656e 736f 7229 0d0a  o_drop_censor)..
-00006650: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
-00006660: 7465 2069 6e74 6572 7661 6c20 6e6f 7461  te interval nota
-00006670: 7469 6f6e 2066 6f72 2074 6865 206d 696e  tion for the min
-00006680: 696d 756d 0d0a 2020 2020 6466 203d 2069  imum..    df = i
-00006690: 6e74 6572 7661 6c5f 6e6f 7461 7469 6f6e  nterval_notation
-000066a0: 2864 662c 2070 7265 6369 7369 6f6e 5f72  (df, precision_r
-000066b0: 6f75 6e64 696e 6729 0d0a 2020 2020 0d0a  ounding)..    ..
-000066c0: 2020 2020 2320 436f 6d62 696e 6520 7468      # Combine th
-000066d0: 6520 6365 6e73 6f72 2061 6e64 206e 756d  e censor and num
-000066e0: 6572 6963 2063 6f6d 706f 6e65 6e74 7320  eric components 
-000066f0: 696e 746f 2061 2072 6573 756c 740d 0a20  into a result.. 
-00006700: 2020 2064 6620 3d20 636f 6d70 6f6e 656e     df = componen
-00006710: 7473 5f74 6f5f 7265 7375 6c74 2864 662c  ts_to_result(df,
-00006720: 2070 7265 6369 7369 6f6e 5f72 6f75 6e64   precision_round
-00006730: 696e 6729 0d0a 2020 2020 0d0a 2020 2020  ing)..    ..    
-00006740: 2320 4472 6f70 2077 6f72 6b69 6e67 2063  # Drop working c
-00006750: 6f6c 756d 6e73 0d0a 2020 2020 6466 203d  olumns..    df =
-00006760: 2064 662e 6472 6f70 2864 662e 6669 6c74   df.drop(df.filt
-00006770: 6572 2872 6567 6578 3d27 5f5f 2729 2e63  er(regex='__').c
-00006780: 6f6c 756d 6e73 2c20 6178 6973 3d31 290d  olumns, axis=1).
-00006790: 0a20 2020 200d 0a20 2020 2023 2052 656f  .    ..    # Reo
-000067a0: 7264 6572 2063 6f6c 756d 6e73 0d0a 2020  rder columns..  
-000067b0: 2020 666f 7220 636f 6c20 696e 205b 7374    for col in [st
-000067c0: 6174 5f63 6f6c 2c72 6573 756c 745f 636f  at_col,result_co
-000067d0: 6c2c 6365 6e73 6f72 5f63 6f6c 2c6e 756d  l,censor_col,num
-000067e0: 6572 6963 5f63 6f6c 2c69 6e74 6572 7661  eric_col,interva
-000067f0: 6c5f 636f 6c5d 3a0d 0a20 2020 2020 2020  l_col]:..       
-00006800: 2064 665b 636f 6c5d 203d 2064 662e 706f   df[col] = df.po
-00006810: 7028 636f 6c29 0d0a 2020 2020 0d0a 2020  p(col)..    ..  
-00006820: 2020 7265 7475 726e 2064 660d 0a0d 0a23    return df....#
-00006830: 2525 2041 7665 7261 6765 2052 6573 756c  %% Average Resul
-00006840: 740d 0a0d 0a64 6566 2061 7665 7261 6765  t....def average
-00006850: 5f69 6e74 6572 7661 6c28 6466 2c0d 0a20  _interval(df,.. 
-00006860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006870: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
-00006880: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
-00006890: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
-000068a0: 2061 6e61 6c79 7365 7320 7468 6520 696e   analyses the in
-000068b0: 7465 7276 616c 206e 6f74 6174 696f 6e20  terval notation 
-000068c0: 666f 726d 206f 6620 7265 7375 6c74 7320  form of results 
-000068d0: 7265 7475 726e 6564 0d0a 2020 2020 6672  returned..    fr
-000068e0: 6f6d 2063 6f6d 706f 6e65 6e74 735f 746f  om components_to
-000068f0: 5f69 6e74 6572 7661 6c20 746f 2067 656e  _interval to gen
-00006900: 6572 6174 6520 6120 6e65 7720 696e 7465  erate a new inte
-00006910: 7276 616c 2066 6f72 2074 6865 2061 7665  rval for the ave
-00006920: 7261 6765 2e20 4772 6f75 7073 0d0a 2020  rage. Groups..  
-00006930: 2020 6f66 2072 6573 756c 7473 2063 616e    of results can
-00006940: 2062 6520 6465 6669 6e65 6420 6279 2069   be defined by i
-00006950: 6e63 6c75 6469 6e67 2074 6865 2063 6f6c  ncluding the col
-00006960: 756d 6e73 2074 6861 7420 7368 6f75 6c64  umns that should
-00006970: 2062 6520 7573 6564 2074 6f0d 0a20 2020   be used to..   
-00006980: 2063 7265 6174 6520 6772 6f75 7073 2e0d   create groups..
-00006990: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-000069a0: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
-000069b0: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
-000069c0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
-000069d0: 6174 6146 7261 6d65 2074 6861 7420 636f  ataFrame that co
-000069e0: 6e74 6169 6e73 2072 6573 756c 7473 2069  ntains results i
-000069f0: 6e20 6120 7370 6563 6966 6963 2069 6e74  n a specific int
-00006a00: 6572 7661 6c20 6e6f 7461 7469 6f6e 2e0d  erval notation..
-00006a10: 0a20 2020 2067 726f 7570 6279 5f63 6f6c  .    groupby_col
-00006a20: 7320 3a20 6c69 7374 206f 6620 7374 7269  s : list of stri
-00006a30: 6e67 730d 0a20 2020 2020 2020 204c 6973  ngs..        Lis
-00006a40: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
-00006a50: 7320 7468 6174 2073 686f 756c 6420 6265  s that should be
-00006a60: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
-00006a70: 6772 6f75 7073 2e0d 0a0d 0a20 2020 2052  groups.....    R
-00006a80: 6574 7572 6e73 0d0a 2020 2020 2d2d 2d2d  eturns..    ----
-00006a90: 2d2d 2d0d 0a20 2020 2064 6620 3a20 4461  ---..    df : Da
-00006aa0: 7461 4672 616d 650d 0a20 2020 2020 2020  taFrame..       
-00006ab0: 2044 6174 6146 7261 6d65 2074 6861 7420   DataFrame that 
-00006ac0: 6861 7320 7468 6520 696e 7465 7276 616c  has the interval
-00006ad0: 2066 6f72 2074 6865 2061 7665 7261 6765   for the average
-00006ae0: 2028 666f 7220 6561 6368 2067 726f 7570   (for each group
-00006af0: 2069 660d 0a20 2020 2020 2020 2063 6f6c   if..        col
-00006b00: 756d 6e20 6e61 6d65 7320 6172 6520 7072  umn names are pr
-00006b10: 6f76 6964 6564 2066 6f72 2067 726f 7570  ovided for group
-00006b20: 696e 6729 0d0a 0d0a 2020 2020 2727 270d  ing)....    '''.
-00006b30: 0a20 2020 200d 0a20 2020 2023 2043 7265  .    ..    # Cre
-00006b40: 6174 6520 6120 636f 7079 206f 6620 7468  ate a copy of th
-00006b50: 6520 4461 7461 4672 616d 650d 0a20 2020  e DataFrame..   
-00006b60: 2064 6620 3d20 6466 2e63 6f70 7928 290d   df = df.copy().
-00006b70: 0a20 2020 200d 0a20 2020 2023 2043 7265  .    ..    # Cre
-00006b80: 6174 6520 636f 6c75 6d6e 2074 6861 7420  ate column that 
-00006b90: 696e 6469 6361 7465 7320 7468 6520 6765  indicates the ge
-00006ba0: 6e65 7261 7465 6420 7374 6174 6973 7469  nerated statisti
-00006bb0: 6320 616e 6420 6170 7065 6e64 2074 6f20  c and append to 
-00006bc0: 6772 6f75 7069 6e67 206c 6973 740d 0a20  grouping list.. 
-00006bd0: 2020 2064 665b 7374 6174 5f63 6f6c 5d20     df[stat_col] 
-00006be0: 3d20 2741 7665 7261 6765 270d 0a20 2020  = 'Average'..   
-00006bf0: 2067 726f 7570 6279 5f63 6f6c 732e 6170   groupby_cols.ap
-00006c00: 7065 6e64 2873 7461 745f 636f 6c29 0d0a  pend(stat_col)..
-00006c10: 2020 2020 0d0a 2020 2020 2320 4368 616e      ..    # Chan
-00006c20: 6765 206e 6f74 6174 696f 6e20 6f66 2027  ge notation of '
-00006c30: 436c 6f73 6564 2720 616e 6420 274f 7065  Closed' and 'Ope
-00006c40: 6e27 2062 6f75 6e64 6172 6965 7320 746f  n' boundaries to
-00006c50: 2030 2061 6e64 2031 2c20 7265 7370 6563   0 and 1, respec
-00006c60: 7469 7665 6c79 0d0a 2020 2020 2320 5468  tively..    # Th
-00006c70: 6520 7072 6573 656e 6365 206f 6620 616e  e presence of an
-00006c80: 7920 6f70 656e 2062 6f75 6e64 6172 6965  y open boundarie
-00006c90: 7320 6f6e 206f 6e65 2073 6964 6520 656e  s on one side en
-00006ca0: 7375 7265 2074 6861 7420 7468 6520 696e  sure that the in
-00006cb0: 7465 7276 616c 2066 6f72 2074 6865 2061  terval for the a
-00006cc0: 7665 7261 6765 2069 7320 616c 736f 0d0a  verage is also..
-00006cd0: 2020 2020 2320 6f70 656e 206f 6e20 7468      # open on th
-00006ce0: 6174 2073 6964 650d 0a20 2020 2064 665b  at side..    df[
-00006cf0: 5b6c 6566 745f 626f 756e 6461 7279 5f63  [left_boundary_c
-00006d00: 6f6c 2c72 6967 6874 5f62 6f75 6e64 6172  ol,right_boundar
-00006d10: 795f 636f 6c5d 5d20 3d20 6466 5b5b 6c65  y_col]] = df[[le
-00006d20: 6674 5f62 6f75 6e64 6172 795f 636f 6c2c  ft_boundary_col,
-00006d30: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
-00006d40: 6f6c 5d5d 2e72 6570 6c61 6365 285b 2743  ol]].replace(['C
-00006d50: 6c6f 7365 6427 2c27 4f70 656e 275d 2c20  losed','Open'], 
-00006d60: 5b30 2c31 5d29 0d0a 2020 2020 0d0a 2020  [0,1])..    ..  
-00006d70: 2020 2320 4765 7420 7468 6520 6c65 6674    # Get the left
-00006d80: 2f72 6967 6874 2062 6f75 6e64 7320 6f66  /right bounds of
-00006d90: 2074 6865 2061 7665 7261 6765 2062 7920   the average by 
-00006da0: 6176 6572 6167 696e 6720 626f 756e 6473  averaging bounds
-00006db0: 2077 6974 6869 6e20 7468 6520 6772 6f75   within the grou
-00006dc0: 700d 0a20 2020 2023 2044 6574 6572 6d69  p..    # Determi
-00006dd0: 6e65 2077 6865 7468 6572 2061 6e79 204f  ne whether any O
-00006de0: 7065 6e20 286e 6f77 2076 616c 7565 206f  pen (now value o
-00006df0: 6620 3129 2062 6f75 6e64 6172 6965 7320  f 1) boundaries 
-00006e00: 6578 6973 742e 2049 6620 7468 6572 6520  exist. If there 
-00006e10: 6172 650d 0a20 2020 2023 2061 6e79 206f  are..    # any o
-00006e20: 7065 6e20 626f 756e 6461 7269 6573 2075  pen boundaries u
-00006e30: 7365 6420 696e 2074 6865 2061 7665 7261  sed in the avera
-00006e40: 6765 2c20 7468 656e 2074 6865 2072 6573  ge, then the res
-00006e50: 756c 7469 6e67 2061 7665 7261 6765 2077  ulting average w
-00006e60: 696c 6c20 6265 206f 7065 6e0d 0a20 2020  ill be open..   
-00006e70: 2064 6620 3d20 6466 2e67 726f 7570 6279   df = df.groupby
-00006e80: 2867 726f 7570 6279 5f63 6f6c 7329 2e61  (groupby_cols).a
-00006e90: 6767 282a 2a7b 0d0a 2020 2020 2020 2020  gg(**{..        
-00006ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006eb0: 2020 2020 6c65 6674 5f62 6f75 6e64 6172      left_boundar
-00006ec0: 795f 636f 6c3a 2028 6c65 6674 5f62 6f75  y_col: (left_bou
-00006ed0: 6e64 6172 795f 636f 6c2c 2027 6d61 7827  ndary_col, 'max'
-00006ee0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00006ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f00: 275f 5f4d 696e 696d 756d 5f5f 273a 2028  '__Minimum__': (
-00006f10: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 2c27  left_bound_col,'
-00006f20: 6d69 6e27 292c 0d0a 2020 2020 2020 2020  min'),..        
-00006f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f40: 2020 2020 6c65 6674 5f62 6f75 6e64 5f63      left_bound_c
-00006f50: 6f6c 3a20 286c 6566 745f 626f 756e 645f  ol: (left_bound_
-00006f60: 636f 6c2c 276d 6561 6e27 292c 0d0a 2020  col,'mean'),..  
-00006f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f80: 2020 2020 2020 2020 2020 7269 6768 745f            right_
-00006f90: 626f 756e 645f 636f 6c3a 2028 7269 6768  bound_col: (righ
-00006fa0: 745f 626f 756e 645f 636f 6c2c 276d 6561  t_bound_col,'mea
-00006fb0: 6e27 292c 0d0a 2020 2020 2020 2020 2020  n'),..          
-00006fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fd0: 2020 275f 5f4d 6178 696d 756d 5f5f 273a    '__Maximum__':
-00006fe0: 2028 7269 6768 745f 626f 756e 645f 636f   (right_bound_co
-00006ff0: 6c2c 276d 6178 2729 2c0d 0a20 2020 2020  l,'max'),..     
-00007000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007010: 2020 2020 2020 2072 6967 6874 5f62 6f75         right_bou
-00007020: 6e64 6172 795f 636f 6c3a 2028 7269 6768  ndary_col: (righ
-00007030: 745f 626f 756e 6461 7279 5f63 6f6c 2c27  t_boundary_col,'
-00007040: 6d61 7827 290d 0a20 2020 2020 2020 2020  max')..         
-00007050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007060: 2020 207d 290d 0a20 2020 200d 0a20 2020     })..    ..   
-00007070: 2023 2052 6570 6c61 6365 2069 6e74 6567   # Replace integ
-00007080: 6572 7320 7769 7468 2074 6578 7420 666f  ers with text fo
-00007090: 7220 626f 756e 6461 7269 6573 0d0a 2020  r boundaries..  
-000070a0: 2020 6466 5b5b 6c65 6674 5f62 6f75 6e64    df[[left_bound
-000070b0: 6172 795f 636f 6c2c 7269 6768 745f 626f  ary_col,right_bo
-000070c0: 756e 6461 7279 5f63 6f6c 5d5d 203d 2064  undary_col]] = d
-000070d0: 665b 5b6c 6566 745f 626f 756e 6461 7279  f[[left_boundary
-000070e0: 5f63 6f6c 2c72 6967 6874 5f62 6f75 6e64  _col,right_bound
-000070f0: 6172 795f 636f 6c5d 5d2e 7265 706c 6163  ary_col]].replac
-00007100: 6528 5b30 2c31 5d2c 205b 2743 6c6f 7365  e([0,1], ['Close
-00007110: 6427 2c27 4f70 656e 275d 290d 0a20 2020  d','Open'])..   
-00007120: 200d 0a20 2020 2023 204d 6561 6e73 2077   ..    # Means w
-00007130: 6974 6820 696e 6669 6e69 7465 2076 616c  ith infinite val
-00007140: 7565 7320 7072 6f64 7563 6520 6e61 6e20  ues produce nan 
-00007150: 7661 6c75 6573 2072 6174 6865 7220 7468  values rather th
-00007160: 616e 206e 702e 696e 6620 7661 6c75 6573  an np.inf values
-00007170: 0d0a 2020 2020 2320 436f 6e76 6572 7420  ..    # Convert 
-00007180: 6e61 6e20 746f 2069 6e66 206f 6e6c 7920  nan to inf only 
-00007190: 6966 2069 6e66 696e 6974 6520 7661 6c75  if infinite valu
-000071a0: 6573 2061 7265 2069 6e63 6c75 6465 6420  es are included 
-000071b0: 696e 2074 6865 206d 6561 6e0d 0a20 2020  in the mean..   
-000071c0: 2064 665b 6c65 6674 5f62 6f75 6e64 5f63   df[left_bound_c
-000071d0: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2864  ol] = np.where(d
-000071e0: 665b 275f 5f4d 696e 696d 756d 5f5f 275d  f['__Minimum__']
-000071f0: 203d 3d20 2d6e 702e 696e 662c 202d 6e70   == -np.inf, -np
-00007200: 2e69 6e66 2c20 6466 5b6c 6566 745f 626f  .inf, df[left_bo
-00007210: 756e 645f 636f 6c5d 290d 0a20 2020 2064  und_col])..    d
-00007220: 665b 7269 6768 745f 626f 756e 645f 636f  f[right_bound_co
-00007230: 6c5d 203d 206e 702e 7768 6572 6528 6466  l] = np.where(df
-00007240: 5b27 5f5f 4d61 7869 6d75 6d5f 5f27 5d20  ['__Maximum__'] 
-00007250: 3d3d 206e 702e 696e 662c 206e 702e 696e  == np.inf, np.in
-00007260: 662c 2064 665b 7269 6768 745f 626f 756e  f, df[right_boun
-00007270: 645f 636f 6c5d 290d 0a20 2020 200d 0a20  d_col])..    .. 
-00007280: 2020 2023 2052 6573 6574 2069 6e64 6578     # Reset index
-00007290: 0d0a 2020 2020 6466 203d 2064 662e 7265  ..    df = df.re
-000072a0: 7365 745f 696e 6465 7828 290d 0a20 2020  set_index()..   
-000072b0: 200d 0a20 2020 2072 6574 7572 6e20 6466   ..    return df
-000072c0: 0d0a 0d0a 6465 6620 6176 6572 6167 6528  ....def average(
-000072d0: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
-000072e0: 2072 6573 756c 7473 5f63 6f6c 2c0d 0a20   results_col,.. 
-000072f0: 2020 2020 2020 2020 2020 2067 726f 7570             group
-00007300: 6279 5f63 6f6c 7320 3d20 4e6f 6e65 2c0d  by_cols = None,.
-00007310: 0a20 2020 2020 2020 2020 2020 2066 6f63  .            foc
-00007320: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
-00007330: 6c20 3d20 5472 7565 2c0d 0a20 2020 2020  l = True,..     
-00007340: 2020 2020 2020 2069 6e63 6c75 6465 5f6e         include_n
-00007350: 6567 6174 6976 655f 696e 7465 7276 616c  egative_interval
-00007360: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
-00007370: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-00007380: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
-00007390: 6f70 5f63 656e 736f 7220 3d20 302e 3235  op_censor = 0.25
-000073a0: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
-000073b0: 7265 6369 7369 6f6e 5f72 6f75 6e64 696e  recision_roundin
-000073c0: 6720 3d20 5472 7565 293a 0d0a 2020 2020  g = True):..    
-000073d0: 2727 270d 0a20 2020 2041 2066 756e 6374  '''..    A funct
-000073e0: 696f 6e20 7468 6174 2063 6f6d 6269 6e65  ion that combine
-000073f0: 7320 7468 6520 7265 6c65 7661 6e74 2061  s the relevant a
-00007400: 7665 7261 6765 2061 6e64 2075 7469 6c69  verage and utili
-00007410: 7479 2066 756e 6374 696f 6e73 2074 6f0d  ty functions to.
-00007420: 0a20 2020 2067 656e 6572 6174 6520 7468  .    generate th
-00007430: 6520 6176 6572 6167 6520 7265 7375 6c74  e average result
-00007440: 7320 666f 7220 6772 6f75 7073 2077 6974  s for groups wit
-00007450: 6869 6e20 6120 4461 7461 4672 616d 652e  hin a DataFrame.
-00007460: 0d0a 0d0a 2020 2020 5061 7261 6d65 7465  ....    Paramete
-00007470: 7273 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d  rs..    --------
-00007480: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
-00007490: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
-000074a0: 4461 7461 4672 616d 6520 7468 6174 2063  DataFrame that c
-000074b0: 6f6e 7461 696e 7320 6365 6e73 6f72 6564  ontains censored
-000074c0: 206f 7220 756e 6365 6e73 6f72 6564 2072   or uncensored r
-000074d0: 6573 756c 7473 0d0a 2020 2020 7265 7375  esults..    resu
-000074e0: 6c74 735f 636f 6c20 3a20 7374 7269 6e67  lts_col : string
-000074f0: 0d0a 2020 2020 2020 2020 5468 6520 636f  ..        The co
-00007500: 6c75 6d6e 206e 616d 6520 666f 7220 7468  lumn name for th
-00007510: 6520 636f 6c75 6d6e 2074 6861 7420 636f  e column that co
-00007520: 6e74 6169 6e20 7468 6520 7265 7375 6c74  ntain the result
-00007530: 7320 6173 2074 6578 742e 0d0a 2020 2020  s as text...    
-00007540: 2020 2020 4f6e 6c79 2066 6f75 7220 706f      Only four po
-00007550: 7373 6962 6c65 2063 656e 736f 7273 2073  ssible censors s
-00007560: 686f 756c 6420 6265 2075 7365 6420 283c  hould be used (<
-00007570: 2ce2 89a4 2ce2 89a5 2c3e 292e 0d0a 2020  ,...,...,>)...  
-00007580: 2020 6772 6f75 7062 795f 636f 6c73 203a    groupby_cols :
-00007590: 206c 6973 7473 206f 6620 7374 7269 6e67   lists of string
-000075a0: 7320 286f 7220 6c69 7374 206f 6620 6c69  s (or list of li
-000075b0: 7374 7329 2c20 6f70 7469 6f6e 616c 0d0a  sts), optional..
-000075c0: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
-000075d0: 636f 6c75 6d6e 206e 616d 6573 2074 6861  column names tha
-000075e0: 7420 7368 6f75 6c64 2062 6520 7573 6564  t should be used
-000075f0: 2074 6f20 6372 6561 7465 2067 726f 7570   to create group
-00007600: 732e 2041 6e20 6176 6572 6167 650d 0a20  s. An average.. 
-00007610: 2020 2020 2020 2077 696c 6c20 6265 2066         will be f
-00007620: 6f75 6e64 2077 6974 6869 6e20 6561 6368  ound within each
-00007630: 2067 726f 7570 2e20 4d75 6c74 6970 6c65   group. Multiple
-00007640: 206c 6973 7473 2063 616e 2062 6520 7375   lists can be su
-00007650: 7070 6c69 6564 2074 6f0d 0a20 2020 2020  pplied to..     
-00007660: 2020 2070 6572 666f 726d 2073 6571 7565     perform seque
-00007670: 6e74 6961 6c20 6176 6572 6167 696e 6720  ntial averaging 
-00007680: 6265 666f 7265 2063 6f6e 7665 7274 696e  before convertin
-00007690: 6720 696e 7465 7276 616c 7320 746f 2061  g intervals to a
-000076a0: 2072 6573 756c 742e 0d0a 2020 2020 2020   result...      
-000076b0: 2020 5468 6520 6465 6661 756c 7420 6973    The default is
-000076c0: 204e 6f6e 652e 0d0a 2020 2020 666f 6375   None...    focu
-000076d0: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
-000076e0: 203a 2062 6f6f 6c65 616e 2c20 6f70 7469   : boolean, opti
-000076f0: 6f6e 616c 0d0a 2020 2020 2020 2020 4966  onal..        If
-00007700: 2054 7275 652c 2074 6865 6e20 696e 666f   True, then info
-00007710: 726d 6174 696f 6e20 6f6e 2074 6865 2068  rmation on the h
-00007720: 6967 6865 7374 2070 6f74 656e 7469 616c  ighest potential
-00007730: 2072 6573 756c 7420 7769 6c6c 2062 650d   result will be.
-00007740: 0a20 2020 2020 2020 2066 6f63 7573 6564  .        focused
-00007750: 206f 7665 7220 7468 6520 6c6f 7765 7374   over the lowest
-00007760: 2070 6f74 656e 7469 616c 2072 6573 756c   potential resul
-00007770: 742e 0d0a 2020 2020 696e 636c 7564 655f  t...    include_
-00007780: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
-00007790: 6c20 3a20 626f 6f6c 6561 6e2c 206f 7074  l : boolean, opt
-000077a0: 696f 6e61 6c0d 0a20 2020 2020 2020 2049  ional..        I
-000077b0: 6620 5472 7565 2c20 7468 656e 2061 6c6c  f True, then all
-000077c0: 2070 6f73 6974 6976 6520 616e 6420 6e65   positive and ne
-000077d0: 6761 7469 7665 2076 616c 7565 7320 6172  gative values ar
-000077e0: 6520 636f 6e73 6964 6572 6564 0d0a 2020  e considered..  
-000077f0: 2020 2020 2020 652e 672e 2c20 3c30 2e35        e.g., <0.5
-00007800: 2077 6f75 6c64 2062 6520 636f 6e76 6572   would be conver
-00007810: 7465 6420 746f 2028 2d6e 702e 696e 662c  ted to (-np.inf,
-00007820: 3529 2e0d 0a20 2020 2020 2020 2049 6620  5)...        If 
-00007830: 4661 6c73 652c 2074 6865 6e20 6f6e 6c79  False, then only
-00007840: 206e 6f6e 2d6e 6567 6174 6976 6520 7661   non-negative va
-00007850: 6c75 6573 2061 7265 2063 6f6e 7369 6465  lues are conside
-00007860: 7265 640d 0a20 2020 2020 2020 2065 2e67  red..        e.g
-00007870: 2e2c 203c 302e 3520 776f 756c 6420 6265  ., <0.5 would be
-00007880: 2063 6f6e 7665 7274 6564 2074 6f20 5b30   converted to [0
-00007890: 2c35 292e 0d0a 2020 2020 2020 2020 5468  ,5)...        Th
-000078a0: 6973 2073 6574 7469 6e67 206f 6e6c 7920  is setting only 
-000078b0: 6166 6665 6374 7320 7265 7375 6c74 7320  affects results 
-000078c0: 6966 2066 6f63 7573 5f68 6967 685f 706f  if focus_high_po
-000078d0: 7465 6e74 6961 6c20 6973 2046 616c 7365  tential is False
-000078e0: 2e0d 0a20 2020 2020 2020 2054 6865 2064  ...        The d
-000078f0: 6566 6175 6c74 2069 7320 4661 6c73 652e  efault is False.
-00007900: 0d0a 2020 2020 7072 6563 6973 696f 6e5f  ..    precision_
-00007910: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
-00007920: 705f 6365 6e73 6f72 203a 2066 6c6f 6174  p_censor : float
-00007930: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
-00007940: 2020 2020 5468 7265 7368 6f6c 6420 666f      Threshold fo
-00007950: 7220 7265 706f 7274 696e 6720 6365 6e73  r reporting cens
-00007960: 6f72 6564 2076 7320 6e6f 6e2d 6365 6e73  ored vs non-cens
-00007970: 6f72 6564 2072 6573 756c 7473 2e0d 0a20  ored results... 
-00007980: 2020 2020 2020 2055 7369 6e67 2074 6865         Using the
-00007990: 2064 6566 6175 6c74 2c20 6120 7265 7375   default, a resu
-000079a0: 6c74 2074 6861 7420 6973 206b 6e6f 776e  lt that is known
-000079b0: 2074 6f20 6265 2069 6e20 7468 6520 696e   to be in the in
-000079c0: 7465 7276 616c 2028 302e 332c 2030 2e35  terval (0.3, 0.5
-000079d0: 290d 0a20 2020 2020 2020 2077 6f75 6c64  )..        would
-000079e0: 2062 6520 7265 7475 726e 6564 2061 7320   be returned as 
-000079f0: 302e 342c 2077 6865 7265 6173 2061 2074  0.4, whereas a t
-00007a00: 6f6c 6572 616e 6365 206f 6620 3020 776f  olerance of 0 wo
-00007a10: 756c 6420 7969 656c 6420 610d 0a20 2020  uld yield a..   
-00007a20: 2020 2020 2072 6573 756c 7420 6f66 203c       result of <
-00007a30: 302e 3520 6f72 203e 302e 3320 6465 7065  0.5 or >0.3 depe
-00007a40: 6e64 696e 6720 6f6e 2074 6865 2076 616c  nding on the val
-00007a50: 7565 206f 6620 666f 6375 735f 6869 6768  ue of focus_high
-00007a60: 6573 745f 706f 7465 6e74 6961 6c2e 0d0a  est_potential...
-00007a70: 2020 2020 2020 2020 5468 6520 6465 6661          The defa
-00007a80: 756c 7420 6973 2030 2e32 352e 0d0a 2020  ult is 0.25...  
-00007a90: 2020 7072 6563 6973 696f 6e5f 726f 756e    precision_roun
-00007aa0: 6469 6e67 203a 2062 6f6f 6c65 616e 2c20  ding : boolean, 
-00007ab0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-00007ac0: 2020 4966 2054 7275 652c 2061 2072 6f75    If True, a rou
-00007ad0: 6e64 696e 6720 6d65 7468 6f64 2069 7320  nding method is 
-00007ae0: 6170 706c 6965 6420 746f 2072 6f75 6e64  applied to round
-00007af0: 2072 6573 756c 7473 2074 6f20 6861 7665   results to have
-00007b00: 206e 6f20 6d6f 7265 0d0a 2020 2020 2020   no more..      
-00007b10: 2020 6465 6369 6d61 6c73 2074 6861 6e20    decimals than 
-00007b20: 7768 6174 2063 616e 2062 6520 6d65 6173  what can be meas
-00007b30: 7572 6564 2e0d 0a20 2020 2020 2020 2054  ured...        T
-00007b40: 6865 2064 6566 6175 6c74 2069 7320 5472  he default is Tr
-00007b50: 7565 2e0d 0a0d 0a20 2020 2052 6574 7572  ue.....    Retur
-00007b60: 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d  ns..    -------.
-00007b70: 0a20 2020 2064 6620 3a20 4461 7461 4672  .    df : DataFr
-00007b80: 616d 650d 0a20 2020 2020 2020 2044 6174  ame..        Dat
-00007b90: 6146 7261 6d65 2074 6861 7420 636f 6e74  aFrame that cont
-00007ba0: 6169 6e73 2063 616c 6375 6c61 7465 6420  ains calculated 
-00007bb0: 6176 6572 6167 6573 0d0a 0d0a 2020 2020  averages....    
-00007bc0: 2727 270d 0a20 2020 200d 0a20 2020 2023  '''..    ..    #
-00007bd0: 2043 7265 6174 6520 6120 636f 7079 206f   Create a copy o
-00007be0: 6620 7468 6520 4461 7461 4672 616d 650d  f the DataFrame.
-00007bf0: 0a20 2020 2064 6620 3d20 6466 2e63 6f70  .    df = df.cop
-00007c00: 7928 290d 0a20 2020 200d 0a20 2020 2023  y()..    ..    #
-00007c10: 2053 706c 6974 2074 6865 2072 6573 756c   Split the resul
-00007c20: 7420 696e 746f 2063 656e 736f 7220 616e  t into censor an
-00007c30: 6420 6e75 6d65 7269 6320 636f 6d70 6f6e  d numeric compon
-00007c40: 656e 7473 0d0a 2020 2020 6466 203d 2072  ents..    df = r
-00007c50: 6573 756c 745f 746f 5f63 6f6d 706f 6e65  esult_to_compone
-00007c60: 6e74 7328 6466 2c72 6573 756c 7473 5f63  nts(df,results_c
-00007c70: 6f6c 290d 0a20 2020 200d 0a20 2020 2023  ol)..    ..    #
-00007c80: 2043 6f6e 7665 7274 2074 6865 2072 6573   Convert the res
-00007c90: 756c 7473 2066 726f 6d20 6365 6e73 6f72  ults from censor
-00007ca0: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
-00007cb0: 706f 6e65 6e74 7320 746f 2061 6e20 696e  ponents to an in
-00007cc0: 7465 7276 616c 2072 6570 7265 7365 6e74  terval represent
-00007cd0: 6174 696f 6e0d 0a20 2020 2064 6620 3d20  ation..    df = 
-00007ce0: 636f 6d70 6f6e 656e 7473 5f74 6f5f 696e  components_to_in
-00007cf0: 7465 7276 616c 2864 662c 2069 6e63 6c75  terval(df, inclu
-00007d00: 6465 5f6e 6567 6174 6976 655f 696e 7465  de_negative_inte
-00007d10: 7276 616c 290d 0a20 2020 200d 0a20 2020  rval)..    ..   
-00007d20: 2023 2055 7369 6e67 2074 6865 2069 6e74   # Using the int
-00007d30: 6572 7661 6c73 2c20 6465 7465 726d 696e  ervals, determin
-00007d40: 6520 7468 6520 7261 6e67 6520 6f66 2070  e the range of p
-00007d50: 6f73 7369 626c 6520 6176 6572 6167 6573  ossible averages
-00007d60: 0d0a 2020 2020 0d0a 2020 2020 2320 4966  ..    ..    # If
-00007d70: 2074 6865 7265 2061 7265 206e 6f20 6772   there are no gr
-00007d80: 6f75 7062 792d 636f 6c75 6d6e 732c 2074  oupby-columns, t
-00007d90: 6865 6e20 7461 6b65 2061 7665 7261 6765  hen take average
-00007da0: 206f 6620 616c 6c20 7265 7375 6c74 730d   of all results.
-00007db0: 0a20 2020 2069 6620 6e6f 7420 6772 6f75  .    if not grou
-00007dc0: 7062 795f 636f 6c73 3a0d 0a20 2020 2020  pby_cols:..     
-00007dd0: 2020 2064 6620 3d20 6176 6572 6167 655f     df = average_
-00007de0: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
-00007df0: 7570 6279 5f63 6f6c 733d 5b5d 290d 0a20  upby_cols=[]).. 
-00007e00: 2020 2023 2049 6620 7468 6520 6772 6f75     # If the grou
-00007e10: 7062 795f 636f 6c73 2069 7320 6120 6c69  pby_cols is a li
-00007e20: 7374 206f 6620 6c69 7374 732c 2074 6865  st of lists, the
-00007e30: 6e20 7065 7266 6f72 6d20 6d75 6c74 6970  n perform multip
-00007e40: 6c65 2061 7665 7261 6765 730d 0a20 2020  le averages..   
-00007e50: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00007e60: 2867 726f 7570 6279 5f63 6f6c 735b 305d  (groupby_cols[0]
-00007e70: 2c6c 6973 7429 3a0d 0a20 2020 2020 2020  ,list):..       
-00007e80: 2066 6f72 2067 726f 7570 696e 6720 696e   for grouping in
-00007e90: 2067 726f 7570 6279 5f63 6f6c 733a 0d0a   groupby_cols:..
-00007ea0: 2020 2020 2020 2020 2020 2020 2320 5573              # Us
-00007eb0: 696e 6720 7468 6520 696e 7465 7276 616c  ing the interval
-00007ec0: 732c 2064 6574 6572 6d69 6e65 2074 6865  s, determine the
-00007ed0: 2072 616e 6765 206f 6620 706f 7373 6962   range of possib
-00007ee0: 6c65 206d 6178 696d 610d 0a20 2020 2020  le maxima..     
-00007ef0: 2020 2020 2020 2064 6620 3d20 6176 6572         df = aver
-00007f00: 6167 655f 696e 7465 7276 616c 2864 662c  age_interval(df,
-00007f10: 2067 726f 7570 696e 6729 0d0a 2020 2020   grouping)..    
-00007f20: 2320 456c 7365 2074 6865 2067 726f 7570  # Else the group
-00007f30: 6279 5f63 6f6c 7320 6973 2061 206c 6973  by_cols is a lis
-00007f40: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
-00007f50: 730d 0a20 2020 2065 6c73 653a 0d0a 2020  s..    else:..  
-00007f60: 2020 2020 2020 6466 203d 2061 7665 7261        df = avera
-00007f70: 6765 5f69 6e74 6572 7661 6c28 6466 2c20  ge_interval(df, 
-00007f80: 6772 6f75 7062 795f 636f 6c73 290d 0a20  groupby_cols).. 
-00007f90: 2020 200d 0a20 2020 2023 2043 6f6e 7665     ..    # Conve
-00007fa0: 7274 2074 6865 2069 6e74 6572 7661 6c20  rt the interval 
-00007fb0: 666f 7220 7468 6520 6176 6572 6167 6520  for the average 
-00007fc0: 696e 746f 2063 656e 736f 7220 616e 6420  into censor and 
-00007fd0: 6e75 6d65 7269 6320 6e6f 7461 7469 6f6e  numeric notation
-00007fe0: 0d0a 2020 2020 6466 203d 2069 6e74 6572  ..    df = inter
-00007ff0: 7661 6c5f 746f 5f63 6f6d 706f 6e65 6e74  val_to_component
-00008000: 7328 6466 2c0d 0a20 2020 2020 2020 2020  s(df,..         
-00008010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008020: 2020 2020 2020 2066 6f63 7573 5f68 6967         focus_hig
-00008030: 685f 706f 7465 6e74 6961 6c20 3d20 666f  h_potential = fo
-00008040: 6375 735f 6869 6768 5f70 6f74 656e 7469  cus_high_potenti
-00008050: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
-00008060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008070: 2020 2020 2069 6e63 6c75 6465 5f6e 6567       include_neg
-00008080: 6174 6976 655f 696e 7465 7276 616c 203d  ative_interval =
-00008090: 2069 6e63 6c75 6465 5f6e 6567 6174 6976   include_negativ
-000080a0: 655f 696e 7465 7276 616c 2c0d 0a20 2020  e_interval,..   
-000080b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080c0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-000080d0: 6369 7369 6f6e 5f74 6f6c 6572 616e 6365  cision_tolerance
-000080e0: 5f74 6f5f 6472 6f70 5f63 656e 736f 7220  _to_drop_censor 
-000080f0: 3d20 7072 6563 6973 696f 6e5f 746f 6c65  = precision_tole
-00008100: 7261 6e63 655f 746f 5f64 726f 705f 6365  rance_to_drop_ce
-00008110: 6e73 6f72 290d 0a20 2020 200d 0a20 2020  nsor)..    ..   
-00008120: 2023 2043 7265 6174 6520 696e 7465 7276   # Create interv
-00008130: 616c 206e 6f74 6174 696f 6e20 666f 7220  al notation for 
-00008140: 7468 6520 6176 6572 6167 650d 0a20 2020  the average..   
-00008150: 2064 6620 3d20 696e 7465 7276 616c 5f6e   df = interval_n
-00008160: 6f74 6174 696f 6e28 6466 2c20 7072 6563  otation(df, prec
-00008170: 6973 696f 6e5f 726f 756e 6469 6e67 290d  ision_rounding).
-00008180: 0a20 2020 200d 0a20 2020 2023 2043 6f6d  .    ..    # Com
-00008190: 6269 6e65 2074 6865 2063 656e 736f 7220  bine the censor 
-000081a0: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
-000081b0: 6f6e 656e 7473 2069 6e74 6f20 6120 7265  onents into a re
-000081c0: 7375 6c74 0d0a 2020 2020 6466 203d 2063  sult..    df = c
-000081d0: 6f6d 706f 6e65 6e74 735f 746f 5f72 6573  omponents_to_res
-000081e0: 756c 7428 6466 2c20 7072 6563 6973 696f  ult(df, precisio
-000081f0: 6e5f 726f 756e 6469 6e67 290d 0a20 2020  n_rounding)..   
-00008200: 200d 0a20 2020 2023 2044 726f 7020 776f   ..    # Drop wo
-00008210: 726b 696e 6720 636f 6c75 6d6e 730d 0a20  rking columns.. 
-00008220: 2020 2064 6620 3d20 6466 2e64 726f 7028     df = df.drop(
-00008230: 6466 2e66 696c 7465 7228 7265 6765 783d  df.filter(regex=
-00008240: 275f 5f27 292e 636f 6c75 6d6e 732c 2061  '__').columns, a
-00008250: 7869 733d 3129 0d0a 2020 2020 0d0a 2020  xis=1)..    ..  
-00008260: 2020 2320 5265 6f72 6465 7220 636f 6c75    # Reorder colu
-00008270: 6d6e 730d 0a20 2020 2066 6f72 2063 6f6c  mns..    for col
-00008280: 2069 6e20 5b73 7461 745f 636f 6c2c 7265   in [stat_col,re
-00008290: 7375 6c74 5f63 6f6c 2c63 656e 736f 725f  sult_col,censor_
-000082a0: 636f 6c2c 6e75 6d65 7269 635f 636f 6c2c  col,numeric_col,
-000082b0: 696e 7465 7276 616c 5f63 6f6c 5d3a 0d0a  interval_col]:..
-000082c0: 2020 2020 2020 2020 6466 5b63 6f6c 5d20          df[col] 
-000082d0: 3d20 6466 2e70 6f70 2863 6f6c 290d 0a20  = df.pop(col).. 
-000082e0: 2020 200d 0a20 2020 2072 6574 7572 6e20     ..    return 
-000082f0: 6466 0d0a 0d0a 2325 2520 5065 7263 656e  df....#%% Percen
-00008300: 7469 6c65 2052 6573 756c 740d 0a0d 0a64  tile Result....d
-00008310: 6566 2070 6572 6365 6e74 696c 655f 696e  ef percentile_in
-00008320: 7465 7276 616c 2864 662c 0d0a 2020 2020  terval(df,..    
-00008330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008340: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
-00008350: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00008360: 2020 2020 2020 2020 2020 2070 6572 6365             perce
-00008370: 6e74 696c 652c 0d0a 2020 2020 2020 2020  ntile,..        
-00008380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008390: 6d65 7468 6f64 203d 2027 6861 7a65 6e27  method = 'hazen'
-000083a0: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
-000083b0: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
-000083c0: 2061 6e61 6c79 7365 7320 7468 6520 696e   analyses the in
-000083d0: 7465 7276 616c 206e 6f74 6174 696f 6e20  terval notation 
-000083e0: 666f 726d 206f 6620 7265 7375 6c74 7320  form of results 
-000083f0: 7265 7475 726e 6564 0d0a 2020 2020 6672  returned..    fr
-00008400: 6f6d 2063 6f6d 706f 6e65 6e74 735f 746f  om components_to
-00008410: 5f69 6e74 6572 7661 6c20 746f 2067 656e  _interval to gen
-00008420: 6572 6174 6520 6120 6e65 7720 696e 7465  erate a new inte
-00008430: 7276 616c 2066 6f72 2070 6572 6365 6e74  rval for percent
-00008440: 696c 6573 2e20 4772 6f75 7073 0d0a 2020  iles. Groups..  
-00008450: 2020 6f66 2072 6573 756c 7473 2063 616e    of results can
-00008460: 2062 6520 6465 6669 6e65 6420 6279 2069   be defined by i
-00008470: 6e63 6c75 6469 6e67 2074 6865 2063 6f6c  ncluding the col
-00008480: 756d 6e73 2074 6861 7420 7368 6f75 6c64  umns that should
-00008490: 2062 6520 7573 6564 2074 6f0d 0a20 2020   be used to..   
-000084a0: 2063 7265 6174 6520 6772 6f75 7073 2e0d   create groups..
-000084b0: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-000084c0: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
-000084d0: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
-000084e0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
-000084f0: 6174 6146 7261 6d65 2074 6861 7420 636f  ataFrame that co
-00008500: 6e74 6169 6e73 2072 6573 756c 7473 2069  ntains results i
-00008510: 6e20 6120 7370 6563 6966 6963 2069 6e74  n a specific int
-00008520: 6572 7661 6c20 6e6f 7461 7469 6f6e 2e0d  erval notation..
-00008530: 0a20 2020 2067 726f 7570 6279 5f63 6f6c  .    groupby_col
-00008540: 7320 3a20 6c69 7374 206f 6620 7374 7269  s : list of stri
-00008550: 6e67 730d 0a20 2020 2020 2020 204c 6973  ngs..        Lis
-00008560: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
-00008570: 7320 7468 6174 2073 686f 756c 6420 6265  s that should be
-00008580: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
-00008590: 6772 6f75 7073 2e0d 0a20 2020 2070 6572  groups...    per
-000085a0: 6365 6e74 696c 6520 3a20 666c 6f61 740d  centile : float.
-000085b0: 0a20 2020 2020 2020 2054 6865 2064 6573  .        The des
-000085c0: 6972 6564 2070 6572 6365 6e74 696c 652e  ired percentile.
-000085d0: 2056 616c 7565 7320 7368 6f75 6c64 2062   Values should b
-000085e0: 6520 6265 7477 6565 6e20 3020 616e 6420  e between 0 and 
-000085f0: 3130 302e 0d0a 2020 2020 6d65 7468 6f64  100...    method
-00008600: 203a 2073 7472 696e 670d 0a20 2020 2020   : string..     
-00008610: 2020 2054 6865 2070 6572 6365 6e74 696c     The percentil
-00008620: 6520 6d65 7468 6f64 2e20 5468 6520 6f70  e method. The op
-00008630: 7469 6f6e 7320 616e 6420 6465 6669 6e69  tions and defini
-00008640: 7469 6f6e 7320 636f 6d65 2066 726f 6d3a  tions come from:
-00008650: 0d0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
-00008660: 7470 733a 2f2f 656e 7669 726f 6e6d 656e  tps://environmen
-00008670: 742e 676f 7674 2e6e 7a2f 6173 7365 7473  t.govt.nz/assets
-00008680: 2f50 7562 6c69 6361 7469 6f6e 732f 4669  /Publications/Fi
-00008690: 6c65 732f 6861 7a65 6e2d 7065 7263 656e  les/hazen-percen
-000086a0: 7469 6c65 2d63 616c 6375 6c61 746f 722d  tile-calculator-
-000086b0: 322e 786c 730d 0a20 2020 2020 2020 2020  2.xls..         
-000086c0: 2020 204f 7074 696f 6e73 2069 6e63 6c75     Options inclu
-000086d0: 6465 2074 6865 2066 6f6c 6c6f 7769 6e67  de the following
-000086e0: 2c20 6f72 6465 7265 6420 6672 6f6d 206c  , ordered from l
-000086f0: 6172 6765 7374 2074 6f20 736d 616c 6c65  argest to smalle
-00008700: 7374 2072 6573 756c 742e 0d0a 2020 2020  st result...    
-00008710: 2020 2020 2020 2020 2d20 7765 6962 616c          - weibal
-00008720: 6c0d 0a20 2020 2020 2020 2020 2020 202d  l..            -
-00008730: 2074 756b 6579 0d0a 2020 2020 2020 2020   tukey..        
-00008740: 2020 2020 2d20 626c 6f6d 0d0a 2020 2020      - blom..    
-00008750: 2020 2020 2020 2020 2d20 6861 7a65 6e0d          - hazen.
-00008760: 0a20 2020 2020 2020 2020 2020 202d 2065  .            - e
-00008770: 7863 656c 0d0a 2020 2020 2020 2020 5468  xcel..        Th
-00008780: 6520 6465 6661 756c 7420 6973 2068 617a  e default is haz
-00008790: 656e 2e0d 0a0d 0a20 2020 2052 6574 7572  en.....    Retur
-000087a0: 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d  ns..    -------.
-000087b0: 0a20 2020 2064 6620 3a20 4461 7461 4672  .    df : DataFr
-000087c0: 616d 650d 0a20 2020 2020 2020 2044 6174  ame..        Dat
-000087d0: 6146 7261 6d65 2074 6861 7420 6861 7320  aFrame that has 
-000087e0: 7468 6520 696e 7465 7276 616c 2066 6f72  the interval for
-000087f0: 2074 6865 2070 6572 6365 6e74 696c 6520   the percentile 
-00008800: 2866 6f72 2065 6163 6820 6772 6f75 7020  (for each group 
-00008810: 6966 0d0a 2020 2020 2020 2020 636f 6c75  if..        colu
-00008820: 6d6e 206e 616d 6573 2061 7265 2070 726f  mn names are pro
-00008830: 7669 6465 6420 666f 7220 6772 6f75 7069  vided for groupi
-00008840: 6e67 290d 0a0d 0a20 2020 2027 2727 0d0a  ng)....    '''..
-00008850: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
-00008860: 7465 2061 2063 6f70 7920 6f66 2074 6865  te a copy of the
-00008870: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
-00008880: 6466 203d 2064 662e 636f 7079 2829 0d0a  df = df.copy()..
-00008890: 2020 2020 0d0a 2020 2020 2320 4368 6563      ..    # Chec
-000088a0: 6b20 7468 6520 7065 7263 656e 7469 6c65  k the percentile
-000088b0: 2069 7320 6265 7477 6565 6e20 3020 616e   is between 0 an
-000088c0: 6420 310d 0a20 2020 2069 6620 7065 7263  d 1..    if perc
-000088d0: 656e 7469 6c65 203c 2030 206f 7220 7065  entile < 0 or pe
-000088e0: 7263 656e 7469 6c65 203e 2031 3030 3a0d  rcentile > 100:.
-000088f0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-00008900: 616c 7565 4572 726f 7228 6627 5065 7263  alueError(f'Perc
-00008910: 656e 7469 6c65 206f 7574 206f 6620 7261  entile out of ra
-00008920: 6e67 652e 2041 7474 656d 7074 6564 2070  nge. Attempted p
-00008930: 6572 6365 6e74 696c 653a 207b 7065 7263  ercentile: {perc
-00008940: 656e 7469 6c65 7d27 290d 0a20 2020 200d  entile}')..    .
-00008950: 0a20 2020 2023 2043 7265 6174 6520 636f  .    # Create co
-00008960: 6c75 6d6e 2074 6861 7420 696e 6469 6361  lumn that indica
-00008970: 7465 7320 7468 6520 6765 6e65 7261 7465  tes the generate
-00008980: 6420 7374 6174 6973 7469 6320 616e 6420  d statistic and 
-00008990: 6170 7065 6e64 2074 6f20 6772 6f75 7069  append to groupi
-000089a0: 6e67 206c 6973 740d 0a20 2020 2064 665b  ng list..    df[
-000089b0: 7374 6174 5f63 6f6c 5d20 3d20 6627 5065  stat_col] = f'Pe
-000089c0: 7263 656e 7469 6c65 2d7b 7065 7263 656e  rcentile-{percen
-000089d0: 7469 6c65 7d27 0d0a 2020 2020 6772 6f75  tile}'..    grou
-000089e0: 7062 795f 636f 6c73 2e61 7070 656e 6428  pby_cols.append(
-000089f0: 7374 6174 5f63 6f6c 290d 0a20 2020 200d  stat_col)..    .
-00008a00: 0a20 2020 2023 2043 6f6e 7665 7274 2070  .    # Convert p
-00008a10: 6572 6365 6e74 696c 6520 746f 2062 6520  ercentile to be 
-00008a20: 6265 7477 6565 6e20 3020 616e 6420 310d  between 0 and 1.
-00008a30: 0a20 2020 2070 6572 6365 6e74 696c 6520  .    percentile 
-00008a40: 3d20 7065 7263 656e 7469 6c65 2f31 3030  = percentile/100
-00008a50: 0d0a 2020 2020 0d0a 2020 2020 2320 4465  ..    ..    # De
-00008a60: 7465 726d 696e 6520 7369 7a65 206f 6620  termine size of 
-00008a70: 6561 6368 2067 726f 7570 0d0a 2020 2020  each group..    
-00008a80: 6466 5b27 5f5f 5369 7a65 5f5f 275d 203d  df['__Size__'] =
-00008a90: 2064 662e 6772 6f75 7062 7928 6772 6f75   df.groupby(grou
-00008aa0: 7062 795f 636f 6c73 292e 7472 616e 7366  pby_cols).transf
-00008ab0: 6f72 6d28 2773 697a 6527 290d 0a20 2020  orm('size')..   
-00008ac0: 200d 0a20 2020 2023 2053 6574 2076 616c   ..    # Set val
-00008ad0: 7565 7320 666f 7220 7065 7263 656e 7469  ues for percenti
-00008ae0: 6c65 206d 6574 686f 6473 0d0a 2020 2020  le methods..    
-00008af0: 6d65 7468 6f64 5f64 6963 7420 3d20 7b27  method_dict = {'
-00008b00: 7765 6962 616c 6c27 3a30 2e30 2c20 2774  weiball':0.0, 't
-00008b10: 756b 6579 273a 312f 332c 2027 626c 6f6d  ukey':1/3, 'blom
-00008b20: 273a 332f 382c 2027 6861 7a65 6e27 3a31  ':3/8, 'hazen':1
-00008b30: 2f32 2c20 2765 7863 656c 273a 312e 307d  /2, 'excel':1.0}
-00008b40: 0d0a 2020 2020 2320 6874 7470 733a 2f2f  ..    # https://
-00008b50: 656e 2e77 696b 6970 6564 6961 2e6f 7267  en.wikipedia.org
-00008b60: 2f77 696b 692f 5065 7263 656e 7469 6c65  /wiki/Percentile
-00008b70: 0d0a 2020 2020 4320 3d20 6d65 7468 6f64  ..    C = method
-00008b80: 5f64 6963 745b 6d65 7468 6f64 5d0d 0a20  _dict[method].. 
-00008b90: 2020 200d 0a20 2020 2023 2043 616c 6375     ..    # Calcu
-00008ba0: 6c61 7465 206d 696e 696d 756d 2064 6174  late minimum dat
-00008bb0: 6120 7369 7a65 2066 6f72 2070 6572 6365  a size for perce
-00008bc0: 6e74 696c 6520 6d65 7468 6f64 2074 6f20  ntile method to 
-00008bd0: 0d0a 2020 2020 2320 656e 7375 7265 2072  ..    # ensure r
-00008be0: 616e 6b20 6973 2061 7420 6c65 6173 7420  ank is at least 
-00008bf0: 3120 616e 6420 6e6f 206d 6f72 6520 7468  1 and no more th
-00008c00: 616e 206c 656e 2864 6174 6129 0d0a 2020  an len(data)..  
-00008c10: 2020 6d69 6e69 6d75 6d5f 7369 7a65 203d    minimum_size =
-00008c20: 2072 6f75 6e64 2843 202b 2028 312d 4329   round(C + (1-C)
-00008c30: 2a6d 6178 2828 312d 7065 7263 656e 7469  *max((1-percenti
-00008c40: 6c65 292f 7065 7263 656e 7469 6c65 2c0d  le)/percentile,.
-00008c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c70: 2020 2020 2020 2020 7065 7263 656e 7469          percenti
-00008c80: 6c65 2f28 312d 7065 7263 656e 7469 6c65  le/(1-percentile
-00008c90: 2929 2c31 3029 0d0a 2020 2020 0d0a 2020  )),10)..    ..  
-00008ca0: 2020 2320 4f6e 6c79 2063 6f6e 7369 6465    # Only conside
-00008cb0: 7220 6772 6f75 7073 2074 6861 7420 6d65  r groups that me
-00008cc0: 6574 2074 6865 206d 696e 696d 756d 2073  et the minimum s
-00008cd0: 697a 6520 7265 7175 6972 656d 656e 740d  ize requirement.
-00008ce0: 0a20 2020 2064 6620 3d20 6466 5b64 665b  .    df = df[df[
-00008cf0: 275f 5f53 697a 655f 5f27 5d20 3e3d 206d  '__Size__'] >= m
-00008d00: 696e 696d 756d 5f73 697a 655d 0d0a 2020  inimum_size]..  
-00008d10: 2020 0d0a 2020 2020 2320 4465 7465 726d    ..    # Determ
-00008d20: 696e 6520 6c65 6674 2062 6f75 6e64 2061  ine left bound a
-00008d30: 6e64 2062 6f75 6e64 6172 7920 666f 7220  nd boundary for 
-00008d40: 6561 6368 2067 726f 7570 0d0a 2020 2020  each group..    
-00008d50: 0d0a 2020 2020 2320 4368 616e 6765 206e  ..    # Change n
-00008d60: 6f74 6174 696f 6e20 6f66 2027 436c 6f73  otation of 'Clos
-00008d70: 6564 2720 616e 6420 274f 7065 6e27 2062  ed' and 'Open' b
-00008d80: 6f75 6e64 6172 6965 7320 746f 2030 2061  oundaries to 0 a
-00008d90: 6e64 2031 2c20 7265 7370 6563 7469 7665  nd 1, respective
-00008da0: 6c79 0d0a 2020 2020 2320 5573 6520 3020  ly..    # Use 0 
-00008db0: 666f 7220 636c 6f73 6564 2074 6f20 656e  for closed to en
-00008dc0: 7375 7265 2074 6861 7420 636c 6f73 6564  sure that closed
-00008dd0: 2062 6f75 6e64 6172 6965 7320 6172 6520   boundaries are 
-00008de0: 736f 7274 6564 206c 6573 7320 7468 616e  sorted less than
-00008df0: 206f 7065 6e0d 0a20 2020 2023 2062 6f75   open..    # bou
-00008e00: 6e64 6172 6965 7320 7768 656e 2074 6865  ndaries when the
-00008e10: 206c 6566 7420 626f 756e 6420 6973 2074   left bound is t
-00008e20: 6965 640d 0a20 2020 2064 665b 6c65 6674  ied..    df[left
-00008e30: 5f62 6f75 6e64 6172 795f 636f 6c5d 203d  _boundary_col] =
-00008e40: 2064 665b 6c65 6674 5f62 6f75 6e64 6172   df[left_boundar
-00008e50: 795f 636f 6c5d 2e72 6570 6c61 6365 285b  y_col].replace([
-00008e60: 2743 6c6f 7365 6427 2c27 4f70 656e 275d  'Closed','Open']
-00008e70: 2c20 5b30 2c31 5d29 0d0a 2020 2020 0d0a  , [0,1])..    ..
-00008e80: 2020 2020 2320 536f 7274 206c 6566 7420      # Sort left 
-00008e90: 626f 756e 6420 7661 6c75 6573 0d0a 2020  bound values..  
-00008ea0: 2020 6c65 6674 203d 2064 662e 636f 7079    left = df.copy
-00008eb0: 2829 5b67 726f 7570 6279 5f63 6f6c 732b  ()[groupby_cols+
-00008ec0: 5b27 5f5f 5369 7a65 5f5f 272c 6c65 6674  ['__Size__',left
-00008ed0: 5f62 6f75 6e64 6172 795f 636f 6c2c 6c65  _boundary_col,le
-00008ee0: 6674 5f62 6f75 6e64 5f63 6f6c 5d5d 2e73  ft_bound_col]].s
-00008ef0: 6f72 745f 7661 6c75 6573 2862 793d 5b6c  ort_values(by=[l
-00008f00: 6566 745f 626f 756e 645f 636f 6c2c 6c65  eft_bound_col,le
-00008f10: 6674 5f62 6f75 6e64 6172 795f 636f 6c5d  ft_boundary_col]
-00008f20: 290d 0a20 2020 200d 0a20 2020 2023 2041  )..    ..    # A
-00008f30: 6464 2069 6e64 6578 2066 6f72 2065 6163  dd index for eac
-00008f40: 6820 6772 6f75 700d 0a20 2020 206c 6566  h group..    lef
-00008f50: 745b 275f 5f49 6e64 6578 5f5f 275d 203d  t['__Index__'] =
-00008f60: 206c 6566 742e 6772 6f75 7062 7928 6772   left.groupby(gr
-00008f70: 6f75 7062 795f 636f 6c73 292e 6375 6d63  oupby_cols).cumc
-00008f80: 6f75 6e74 2829 202b 2031 0d0a 2020 2020  ount() + 1..    
-00008f90: 0d0a 2020 2020 2320 4465 7465 726d 696e  ..    # Determin
-00008fa0: 6520 7468 6520 7261 6e6b 2069 6e20 6561  e the rank in ea
-00008fb0: 6368 2067 726f 7570 2066 6f72 2074 6865  ch group for the
-00008fc0: 2070 6572 6365 6e74 696c 650d 0a20 2020   percentile..   
-00008fd0: 206c 6566 745b 275f 5f52 616e 6b5f 5f27   left['__Rank__'
-00008fe0: 5d20 3d20 726f 756e 6428 4320 2b20 7065  ] = round(C + pe
-00008ff0: 7263 656e 7469 6c65 2a28 6c65 6674 5b27  rcentile*(left['
-00009000: 5f5f 5369 7a65 5f5f 275d 202b 2031 202d  __Size__'] + 1 -
-00009010: 2032 2a43 292c 3829 0d0a 2020 2020 0d0a   2*C),8)..    ..
-00009020: 2020 2020 2320 4765 6e65 7261 7465 2070      # Generate p
-00009030: 726f 7869 6d69 7479 206f 6620 6561 6368  roximity of each
-00009040: 2072 6573 756c 7420 746f 2070 6572 6365   result to perce
-00009050: 6e74 696c 6520 7261 6e6b 2075 7369 6e67  ntile rank using
-00009060: 2074 6865 2069 6e64 6578 0d0a 2020 2020   the index..    
-00009070: 6c65 6674 5b27 5f5f 5072 6f78 696d 6974  left['__Proximit
-00009080: 795f 5f27 5d20 3d20 300d 0a20 2020 200d  y__'] = 0..    .
-00009090: 0a20 2020 2063 6f6e 6469 7469 6f6e 7320  .    conditions 
-000090a0: 3d20 5b0d 0a20 2020 2020 2020 2023 2049  = [..        # I
-000090b0: 6620 7468 6520 7065 7263 656e 7469 6c65  f the percentile
-000090c0: 2072 616e 6b20 6973 2061 2077 686f 6c65   rank is a whole
-000090d0: 206e 756d 6265 722c 2074 6865 6e20 7573   number, then us
-000090e0: 6520 7468 6174 2069 6e64 6578 2072 6573  e that index res
-000090f0: 756c 740d 0a20 2020 2020 2020 2028 6c65  ult..        (le
-00009100: 6674 5b27 5f5f 5261 6e6b 5f5f 275d 203d  ft['__Rank__'] =
-00009110: 3d20 6c65 6674 5b27 5f5f 496e 6465 785f  = left['__Index_
-00009120: 5f27 5d29 2c0d 0a20 2020 2020 2020 2023  _']),..        #
-00009130: 2049 6620 7468 6520 7065 7263 656e 7469   If the percenti
-00009140: 6c65 2072 616e 6b20 6973 206c 6573 7320  le rank is less 
-00009150: 7468 616e 2031 2061 626f 7665 2074 6865  than 1 above the
-00009160: 2069 6e64 6578 2076 616c 7565 2c0d 0a20   index value,.. 
-00009170: 2020 2020 2020 2023 2074 6865 6e20 6173         # then as
-00009180: 7369 676e 2074 6865 2061 7070 726f 7072  sign the appropr
-00009190: 6961 7465 2063 6f6e 7472 6962 7574 696f  iate contributio
-000091a0: 6e20 746f 2074 6861 7420 696e 6465 7820  n to that index 
-000091b0: 7661 6c75 650d 0a20 2020 2020 2020 2028  value..        (
-000091c0: 6c65 6674 5b27 5f5f 5261 6e6b 5f5f 275d  left['__Rank__']
-000091d0: 202d 206c 6566 745b 275f 5f49 6e64 6578   - left['__Index
-000091e0: 5f5f 275d 292e 6265 7477 6565 6e28 302c  __']).between(0,
-000091f0: 312c 696e 636c 7573 6976 653d 276e 6569  1,inclusive='nei
-00009200: 7468 6572 2729 2c0d 0a20 2020 2020 2020  ther'),..       
-00009210: 2023 2049 6620 7468 6520 7065 7263 656e   # If the percen
-00009220: 7469 6c65 2072 616e 6b20 6973 206c 6573  tile rank is les
-00009230: 7320 7468 616e 2031 2062 656c 6f77 2074  s than 1 below t
-00009240: 6865 2069 6e64 6578 2076 616c 7565 2c0d  he index value,.
-00009250: 0a20 2020 2020 2020 2023 2074 6865 6e20  .        # then 
-00009260: 6173 7369 676e 2074 6865 2061 7070 726f  assign the appro
-00009270: 7072 6961 7465 2063 6f6e 7472 6962 7574  priate contribut
-00009280: 696f 6e20 746f 2074 6861 7420 696e 6465  ion to that inde
-00009290: 7820 7661 6c75 650d 0a20 2020 2020 2020  x value..       
-000092a0: 2028 6c65 6674 5b27 5f5f 496e 6465 785f   (left['__Index_
-000092b0: 5f27 5d20 2d20 6c65 6674 5b27 5f5f 5261  _'] - left['__Ra
-000092c0: 6e6b 5f5f 275d 292e 6265 7477 6565 6e28  nk__']).between(
-000092d0: 302c 312c 696e 636c 7573 6976 653d 276e  0,1,inclusive='n
-000092e0: 6569 7468 6572 2729 0d0a 2020 2020 2020  either')..      
-000092f0: 2020 5d0d 0a20 2020 200d 0a20 2020 2072    ]..    ..    r
-00009300: 6573 756c 7473 203d 205b 0d0a 2020 2020  esults = [..    
-00009310: 2020 2020 312c 0d0a 2020 2020 2020 2020      1,..        
-00009320: 3120 2d20 286c 6566 745b 275f 5f52 616e  1 - (left['__Ran
-00009330: 6b5f 5f27 5d20 2d20 6c65 6674 5b27 5f5f  k__'] - left['__
-00009340: 496e 6465 785f 5f27 5d29 2c0d 0a20 2020  Index__']),..   
-00009350: 2020 2020 2031 202d 2028 6c65 6674 5b27       1 - (left['
-00009360: 5f5f 496e 6465 785f 5f27 5d20 2d20 6c65  __Index__'] - le
-00009370: 6674 5b27 5f5f 5261 6e6b 5f5f 275d 292c  ft['__Rank__']),
-00009380: 0d0a 2020 2020 2020 2020 5d0d 0a20 2020  ..        ]..   
-00009390: 200d 0a20 2020 206c 6566 745b 275f 5f50   ..    left['__P
-000093a0: 726f 7869 6d69 7479 5f5f 275d 203d 206e  roximity__'] = n
-000093b0: 702e 7365 6c65 6374 2863 6f6e 6469 7469  p.select(conditi
-000093c0: 6f6e 732c 2072 6573 756c 7473 2c20 6e70  ons, results, np
-000093d0: 2e6e 616e 290d 0a20 2020 200d 0a20 2020  .nan)..    ..   
-000093e0: 2023 2044 726f 7020 6e6f 6e2d 636f 6e74   # Drop non-cont
-000093f0: 7269 6275 7469 6e67 2072 6f77 730d 0a20  ributing rows.. 
-00009400: 2020 206c 6566 7420 3d20 6c65 6674 5b6c     left = left[l
-00009410: 6566 745b 275f 5f50 726f 7869 6d69 7479  eft['__Proximity
-00009420: 5f5f 275d 203e 2030 5d0d 0a20 2020 200d  __'] > 0]..    .
-00009430: 0a20 2020 2023 2043 616c 6375 6c61 7465  .    # Calculate
-00009440: 2063 6f6e 7472 6962 7574 696f 6e20 666f   contribution fo
-00009450: 7220 696e 6465 7820 7661 6c75 6573 2074  r index values t
-00009460: 6861 7420 636f 6e74 7269 6275 7465 2074  hat contribute t
-00009470: 6f20 7468 6520 7265 7375 6c74 0d0a 2020  o the result..  
-00009480: 2020 6c65 6674 5b27 5f5f 436f 6e74 7269    left['__Contri
-00009490: 6275 7469 6f6e 5f5f 275d 203d 206c 6566  bution__'] = lef
-000094a0: 745b 275f 5f50 726f 7869 6d69 7479 5f5f  t['__Proximity__
-000094b0: 275d 202a 206c 6566 745b 6c65 6674 5f62  '] * left[left_b
-000094c0: 6f75 6e64 5f63 6f6c 5d0d 0a20 2020 200d  ound_col]..    .
-000094d0: 0a20 2020 2023 2044 6574 6572 6d69 6e65  .    # Determine
-000094e0: 206c 6566 7420 626f 756e 6420 616e 6420   left bound and 
-000094f0: 626f 756e 6461 7279 2075 7369 6e67 2074  boundary using t
-00009500: 6865 2073 756d 206f 6620 7468 6520 636f  he sum of the co
-00009510: 6e74 7269 6275 7469 6f6e 730d 0a20 2020  ntributions..   
-00009520: 2023 2061 6e64 2061 6e20 6f70 656e 2062   # and an open b
-00009530: 6f75 6e64 6172 7920 6966 2061 6e79 206f  oundary if any o
-00009540: 6620 7468 6520 636f 6e74 7269 6275 7469  f the contributi
-00009550: 6e67 2076 616c 7565 7320 6973 206f 7065  ng values is ope
-00009560: 6e0d 0a20 2020 206c 6566 7420 3d20 6c65  n..    left = le
-00009570: 6674 2e67 726f 7570 6279 2867 726f 7570  ft.groupby(group
-00009580: 6279 5f63 6f6c 7329 2e61 6767 282a 2a7b  by_cols).agg(**{
-00009590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000095a0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-000095b0: 6674 5f62 6f75 6e64 6172 795f 636f 6c3a  ft_boundary_col:
-000095c0: 2028 6c65 6674 5f62 6f75 6e64 6172 795f   (left_boundary_
-000095d0: 636f 6c2c 2027 6d61 7827 292c 0d0a 2020  col, 'max'),..  
-000095e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095f0: 2020 2020 2020 2020 2020 6c65 6674 5f62            left_b
-00009600: 6f75 6e64 5f63 6f6c 3a20 2827 5f5f 436f  ound_col: ('__Co
-00009610: 6e74 7269 6275 7469 6f6e 5f5f 272c 2773  ntribution__','s
-00009620: 756d 2729 2c0d 0a20 2020 2020 2020 2020  um'),..         
-00009630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009640: 2020 2027 5f5f 4d69 6e69 6d75 6d5f 5f27     '__Minimum__'
-00009650: 3a20 2827 5f5f 436f 6e74 7269 6275 7469  : ('__Contributi
-00009660: 6f6e 5f5f 272c 276d 696e 2729 0d0a 2020  on__','min')..  
-00009670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009680: 2020 2020 2020 2020 2020 7d29 0d0a 2020            })..  
-00009690: 2020 0d0a 2020 2020 2320 5265 706c 6163    ..    # Replac
-000096a0: 6520 7468 6520 6e75 6d65 7269 6320 7661  e the numeric va
-000096b0: 6c75 6520 666f 7220 7468 6520 626f 756e  lue for the boun
-000096c0: 6461 7279 0d0a 2020 2020 6c65 6674 5b6c  dary..    left[l
-000096d0: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-000096e0: 5d20 3d20 6c65 6674 5b6c 6566 745f 626f  ] = left[left_bo
-000096f0: 756e 6461 7279 5f63 6f6c 5d2e 7265 706c  undary_col].repl
-00009700: 6163 6528 5b30 2c31 5d2c 205b 2743 6c6f  ace([0,1], ['Clo
-00009710: 7365 6427 2c27 4f70 656e 275d 290d 0a20  sed','Open']).. 
-00009720: 2020 200d 0a20 2020 2023 204d 6561 6e73     ..    # Means
-00009730: 2077 6974 6820 696e 6669 6e69 7465 2076   with infinite v
-00009740: 616c 7565 7320 7072 6f64 7563 6520 6e61  alues produce na
-00009750: 6e20 7661 6c75 6573 2072 6174 6865 7220  n values rather 
-00009760: 7468 616e 206e 702e 696e 6620 7661 6c75  than np.inf valu
-00009770: 6573 0d0a 2020 2020 2320 436f 6e76 6572  es..    # Conver
-00009780: 7420 6e61 6e20 746f 2069 6e66 206f 6e6c  t nan to inf onl
-00009790: 7920 6966 2069 6e66 696e 6974 6520 7661  y if infinite va
-000097a0: 6c75 6573 2061 7265 2069 6e63 6c75 6465  lues are include
-000097b0: 6420 696e 2074 6865 206d 6561 6e0d 0a20  d in the mean.. 
-000097c0: 2020 206c 6566 745b 6c65 6674 5f62 6f75     left[left_bou
-000097d0: 6e64 5f63 6f6c 5d20 3d20 6e70 2e77 6865  nd_col] = np.whe
-000097e0: 7265 286c 6566 745b 275f 5f4d 696e 696d  re(left['__Minim
-000097f0: 756d 5f5f 275d 203d 3d20 2d6e 702e 696e  um__'] == -np.in
-00009800: 662c 202d 6e70 2e69 6e66 2c20 6c65 6674  f, -np.inf, left
-00009810: 5b6c 6566 745f 626f 756e 645f 636f 6c5d  [left_bound_col]
-00009820: 290d 0a20 2020 200d 0a20 2020 2023 2044  )..    ..    # D
-00009830: 6574 6572 6d69 6e65 2072 6967 6874 2062  etermine right b
-00009840: 6f75 6e64 2061 6e64 2062 6f75 6e64 6172  ound and boundar
-00009850: 7920 666f 7220 6561 6368 2067 726f 7570  y for each group
-00009860: 0d0a 2020 2020 0d0a 2020 2020 2320 4368  ..    ..    # Ch
-00009870: 616e 6765 206e 6f74 6174 696f 6e20 6f66  ange notation of
-00009880: 2027 436c 6f73 6564 2720 616e 6420 274f   'Closed' and 'O
-00009890: 7065 6e27 2062 6f75 6e64 6172 6965 7320  pen' boundaries 
-000098a0: 746f 2031 2061 6e64 2030 2c20 7265 7370  to 1 and 0, resp
-000098b0: 6563 7469 7665 6c79 0d0a 2020 2020 2320  ectively..    # 
-000098c0: 5573 6520 3120 666f 7220 636c 6f73 6564  Use 1 for closed
-000098d0: 2074 6f20 656e 7375 7265 2074 6861 7420   to ensure that 
-000098e0: 636c 6f73 6564 2062 6f75 6e64 6172 6965  closed boundarie
-000098f0: 7320 6172 6520 736f 7274 6564 206c 6172  s are sorted lar
-00009900: 6765 7220 7468 616e 206f 7065 6e0d 0a20  ger than open.. 
-00009910: 2020 2023 2062 6f75 6e64 6172 6965 7320     # boundaries 
-00009920: 7768 656e 2074 6865 2072 6967 6874 2062  when the right b
-00009930: 6f75 6e64 2069 7320 7469 6564 0d0a 2020  ound is tied..  
-00009940: 2020 6466 5b72 6967 6874 5f62 6f75 6e64    df[right_bound
-00009950: 6172 795f 636f 6c5d 203d 2064 665b 7269  ary_col] = df[ri
-00009960: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
-00009970: 5d2e 7265 706c 6163 6528 5b27 436c 6f73  ].replace(['Clos
-00009980: 6564 272c 274f 7065 6e27 5d2c 205b 312c  ed','Open'], [1,
-00009990: 305d 290d 0a20 2020 200d 0a20 2020 2023  0])..    ..    #
-000099a0: 2053 6f72 7420 7269 6768 7420 626f 756e   Sort right boun
-000099b0: 6420 7661 6c75 6573 0d0a 2020 2020 7269  d values..    ri
-000099c0: 6768 7420 3d20 6466 2e63 6f70 7928 295b  ght = df.copy()[
-000099d0: 6772 6f75 7062 795f 636f 6c73 2b5b 275f  groupby_cols+['_
-000099e0: 5f53 697a 655f 5f27 2c72 6967 6874 5f62  _Size__',right_b
-000099f0: 6f75 6e64 6172 795f 636f 6c2c 7269 6768  oundary_col,righ
-00009a00: 745f 626f 756e 645f 636f 6c5d 5d2e 736f  t_bound_col]].so
-00009a10: 7274 5f76 616c 7565 7328 6279 3d5b 7269  rt_values(by=[ri
-00009a20: 6768 745f 626f 756e 645f 636f 6c2c 7269  ght_bound_col,ri
-00009a30: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
-00009a40: 5d29 0d0a 2020 2020 0d0a 2020 2020 2320  ])..    ..    # 
-00009a50: 4164 6420 696e 6465 7820 666f 7220 6561  Add index for ea
-00009a60: 6368 2067 726f 7570 0d0a 2020 2020 7269  ch group..    ri
-00009a70: 6768 745b 275f 5f49 6e64 6578 5f5f 275d  ght['__Index__']
-00009a80: 203d 2072 6967 6874 2e67 726f 7570 6279   = right.groupby
-00009a90: 2867 726f 7570 6279 5f63 6f6c 7329 2e63  (groupby_cols).c
-00009aa0: 756d 636f 756e 7428 2920 2b20 310d 0a20  umcount() + 1.. 
-00009ab0: 2020 200d 0a20 2020 2023 2044 6574 6572     ..    # Deter
-00009ac0: 6d69 6e65 2074 6865 2072 616e 6b20 696e  mine the rank in
-00009ad0: 2065 6163 6820 6772 6f75 7020 666f 7220   each group for 
-00009ae0: 7468 6520 7065 7263 656e 7469 6c65 0d0a  the percentile..
-00009af0: 2020 2020 7269 6768 745b 275f 5f52 616e      right['__Ran
-00009b00: 6b5f 5f27 5d20 3d20 726f 756e 6428 4320  k__'] = round(C 
-00009b10: 2b20 7065 7263 656e 7469 6c65 2a28 7269  + percentile*(ri
-00009b20: 6768 745b 275f 5f53 697a 655f 5f27 5d20  ght['__Size__'] 
-00009b30: 2b20 3120 2d20 322a 4329 2c38 290d 0a20  + 1 - 2*C),8).. 
-00009b40: 2020 200d 0a20 2020 2023 2047 656e 6572     ..    # Gener
-00009b50: 6174 6520 7072 6f78 696d 6974 7920 6f66  ate proximity of
-00009b60: 2065 6163 6820 7265 7375 6c74 2074 6f20   each result to 
-00009b70: 7065 7263 656e 7469 6c65 2072 616e 6b20  percentile rank 
-00009b80: 7573 696e 6720 7468 6520 696e 6465 780d  using the index.
-00009b90: 0a20 2020 2072 6967 6874 5b27 5f5f 5072  .    right['__Pr
-00009ba0: 6f78 696d 6974 795f 5f27 5d20 3d20 300d  oximity__'] = 0.
-00009bb0: 0a20 2020 200d 0a20 2020 2063 6f6e 6469  .    ..    condi
-00009bc0: 7469 6f6e 7320 3d20 5b0d 0a20 2020 2020  tions = [..     
-00009bd0: 2020 2023 2049 6620 7468 6520 7065 7263     # If the perc
-00009be0: 656e 7469 6c65 2072 616e 6b20 6973 2061  entile rank is a
-00009bf0: 2077 686f 6c65 206e 756d 6265 722c 2074   whole number, t
-00009c00: 6865 6e20 7573 6520 7468 6174 2069 6e64  hen use that ind
-00009c10: 6578 2072 6573 756c 740d 0a20 2020 2020  ex result..     
-00009c20: 2020 2028 7269 6768 745b 275f 5f52 616e     (right['__Ran
-00009c30: 6b5f 5f27 5d20 3d3d 2072 6967 6874 5b27  k__'] == right['
-00009c40: 5f5f 496e 6465 785f 5f27 5d29 2c0d 0a20  __Index__']),.. 
-00009c50: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
-00009c60: 7065 7263 656e 7469 6c65 2072 616e 6b20  percentile rank 
-00009c70: 6973 206c 6573 7320 7468 616e 2031 2061  is less than 1 a
-00009c80: 626f 7665 2074 6865 2069 6e64 6578 2076  bove the index v
-00009c90: 616c 7565 2c0d 0a20 2020 2020 2020 2023  alue,..        #
-00009ca0: 2074 6865 6e20 6173 7369 676e 2074 6865   then assign the
-00009cb0: 2061 7070 726f 7072 6961 7465 2063 6f6e   appropriate con
-00009cc0: 7472 6962 7574 696f 6e20 746f 2074 6861  tribution to tha
-00009cd0: 7420 696e 6465 7820 7661 6c75 650d 0a20  t index value.. 
-00009ce0: 2020 2020 2020 2028 7269 6768 745b 275f         (right['_
-00009cf0: 5f52 616e 6b5f 5f27 5d20 2d20 7269 6768  _Rank__'] - righ
-00009d00: 745b 275f 5f49 6e64 6578 5f5f 275d 292e  t['__Index__']).
-00009d10: 6265 7477 6565 6e28 302c 312c 696e 636c  between(0,1,incl
-00009d20: 7573 6976 653d 276e 6569 7468 6572 2729  usive='neither')
-00009d30: 2c0d 0a20 2020 2020 2020 2023 2049 6620  ,..        # If 
-00009d40: 7468 6520 7065 7263 656e 7469 6c65 2072  the percentile r
-00009d50: 616e 6b20 6973 206c 6573 7320 7468 616e  ank is less than
-00009d60: 2031 2062 656c 6f77 2074 6865 2069 6e64   1 below the ind
-00009d70: 6578 2076 616c 7565 2c0d 0a20 2020 2020  ex value,..     
-00009d80: 2020 2023 2074 6865 6e20 6173 7369 676e     # then assign
-00009d90: 2074 6865 2061 7070 726f 7072 6961 7465   the appropriate
-00009da0: 2063 6f6e 7472 6962 7574 696f 6e20 746f   contribution to
-00009db0: 2074 6861 7420 696e 6465 7820 7661 6c75   that index valu
-00009dc0: 650d 0a20 2020 2020 2020 2028 7269 6768  e..        (righ
-00009dd0: 745b 275f 5f49 6e64 6578 5f5f 275d 202d  t['__Index__'] -
-00009de0: 2072 6967 6874 5b27 5f5f 5261 6e6b 5f5f   right['__Rank__
-00009df0: 275d 292e 6265 7477 6565 6e28 302c 312c  ']).between(0,1,
-00009e00: 696e 636c 7573 6976 653d 276e 6569 7468  inclusive='neith
-00009e10: 6572 2729 0d0a 2020 2020 2020 2020 5d0d  er')..        ].
-00009e20: 0a20 2020 200d 0a20 2020 2072 6573 756c  .    ..    resul
-00009e30: 7473 203d 205b 0d0a 2020 2020 2020 2020  ts = [..        
-00009e40: 312c 0d0a 2020 2020 2020 2020 3120 2d20  1,..        1 - 
-00009e50: 2872 6967 6874 5b27 5f5f 5261 6e6b 5f5f  (right['__Rank__
-00009e60: 275d 202d 2072 6967 6874 5b27 5f5f 496e  '] - right['__In
-00009e70: 6465 785f 5f27 5d29 2c0d 0a20 2020 2020  dex__']),..     
-00009e80: 2020 2031 202d 2028 7269 6768 745b 275f     1 - (right['_
-00009e90: 5f49 6e64 6578 5f5f 275d 202d 2072 6967  _Index__'] - rig
-00009ea0: 6874 5b27 5f5f 5261 6e6b 5f5f 275d 292c  ht['__Rank__']),
-00009eb0: 0d0a 2020 2020 2020 2020 5d0d 0a20 2020  ..        ]..   
-00009ec0: 200d 0a20 2020 2072 6967 6874 5b27 5f5f   ..    right['__
-00009ed0: 5072 6f78 696d 6974 795f 5f27 5d20 3d20  Proximity__'] = 
-00009ee0: 6e70 2e73 656c 6563 7428 636f 6e64 6974  np.select(condit
-00009ef0: 696f 6e73 2c20 7265 7375 6c74 732c 206e  ions, results, n
-00009f00: 702e 6e61 6e29 0d0a 2020 2020 0d0a 2020  p.nan)..    ..  
-00009f10: 2020 2320 4472 6f70 206e 6f6e 2d63 6f6e    # Drop non-con
-00009f20: 7472 6962 7574 696e 6720 726f 7773 0d0a  tributing rows..
-00009f30: 2020 2020 7269 6768 7420 3d20 7269 6768      right = righ
-00009f40: 745b 7269 6768 745b 275f 5f50 726f 7869  t[right['__Proxi
-00009f50: 6d69 7479 5f5f 275d 203e 2030 5d0d 0a20  mity__'] > 0].. 
-00009f60: 2020 200d 0a20 2020 2023 2043 616c 6375     ..    # Calcu
-00009f70: 6c61 7465 2063 6f6e 7472 6962 7574 696f  late contributio
-00009f80: 6e20 666f 7220 696e 6465 7820 7661 6c75  n for index valu
-00009f90: 6573 2074 6861 7420 636f 6e74 7269 6275  es that contribu
-00009fa0: 7465 2074 6f20 7468 6520 7265 7375 6c74  te to the result
-00009fb0: 0d0a 2020 2020 7269 6768 745b 275f 5f43  ..    right['__C
-00009fc0: 6f6e 7472 6962 7574 696f 6e5f 5f27 5d20  ontribution__'] 
-00009fd0: 3d20 7269 6768 745b 275f 5f50 726f 7869  = right['__Proxi
-00009fe0: 6d69 7479 5f5f 275d 202a 2072 6967 6874  mity__'] * right
-00009ff0: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
-0000a000: 5d0d 0a20 2020 200d 0a20 2020 2023 2044  ]..    ..    # D
-0000a010: 6574 6572 6d69 6e65 2072 6967 6874 2062  etermine right b
-0000a020: 6f75 6e64 2061 6e64 2062 6f75 6e64 6172  ound and boundar
-0000a030: 7920 7573 696e 6720 7468 6520 7375 6d20  y using the sum 
-0000a040: 6f66 2074 6865 2063 6f6e 7472 6962 7574  of the contribut
-0000a050: 696f 6e73 0d0a 2020 2020 2320 616e 6420  ions..    # and 
-0000a060: 616e 206f 7065 6e20 626f 756e 6461 7279  an open boundary
-0000a070: 2069 6620 616e 7920 6f66 2074 6865 2063   if any of the c
-0000a080: 6f6e 7472 6962 7574 696e 6720 7661 6c75  ontributing valu
-0000a090: 6573 2069 7320 6f70 656e 0d0a 2020 2020  es is open..    
-0000a0a0: 7269 6768 7420 3d20 7269 6768 742e 6772  right = right.gr
-0000a0b0: 6f75 7062 7928 6772 6f75 7062 795f 636f  oupby(groupby_co
-0000a0c0: 6c73 292e 6167 6728 2a2a 7b0d 0a20 2020  ls).agg(**{..   
-0000a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0e0: 2020 2020 2020 2020 2072 6967 6874 5f62           right_b
-0000a0f0: 6f75 6e64 5f63 6f6c 3a20 2827 5f5f 436f  ound_col: ('__Co
-0000a100: 6e74 7269 6275 7469 6f6e 5f5f 272c 2773  ntribution__','s
-0000a110: 756d 2729 2c0d 0a20 2020 2020 2020 2020  um'),..         
+00000010: 7320 6e70 0d0a 696d 706f 7274 2070 616e  s np..import pan
+00000020: 6461 7320 6173 2070 640d 0a66 726f 6d20  das as pd..from 
+00000030: 6461 7461 636c 6173 7365 7320 696d 706f  dataclasses impo
+00000040: 7274 2064 6174 6163 6c61 7373 0d0a 696d  rt dataclass..im
+00000050: 706f 7274 2063 6f70 790d 0a66 726f 6d20  port copy..from 
+00000060: 6365 6e73 6f72 6564 7375 6d6d 6172 7973  censoredsummarys
+00000070: 7461 7473 2e75 7469 6c73 2069 6d70 6f72  tats.utils impor
+00000080: 7420 7374 7269 6e67 5f70 7265 6369 7369  t string_precisi
+00000090: 6f6e 2c20 6e75 6d65 7269 635f 7072 6563  on, numeric_prec
+000000a0: 6973 696f 6e0d 0a0d 0a40 6461 7461 636c  ision....@datacl
+000000b0: 6173 730d 0a63 6c61 7373 2043 656e 736f  ass..class Censo
+000000c0: 7265 6444 6174 613a 0d0a 2020 2020 6461  redData:..    da
+000000d0: 7461 3a20 7064 2e63 6f72 652e 6672 616d  ta: pd.core.fram
+000000e0: 652e 4461 7461 4672 616d 650d 0a20 2020  e.DataFrame..   
+000000f0: 2076 616c 7565 5f63 6f6c 3a20 7374 720d   value_col: str.
+00000100: 0a20 2020 2073 7461 745f 636f 6c3a 2073  .    stat_col: s
+00000110: 7472 203d 2027 5374 6174 6973 7469 6327  tr = 'Statistic'
+00000120: 0d0a 2020 2020 7265 7375 6c74 5f63 6f6c  ..    result_col
+00000130: 3a20 7374 7220 3d20 2752 6573 756c 7427  : str = 'Result'
+00000140: 0d0a 2020 2020 6365 6e73 6f72 5f63 6f6c  ..    censor_col
+00000150: 3a20 7374 7220 3d20 2743 656e 736f 7243  : str = 'CensorC
+00000160: 6f6d 706f 6e65 6e74 270d 0a20 2020 206e  omponent'..    n
+00000170: 756d 6572 6963 5f63 6f6c 3a20 7374 7220  umeric_col: str 
+00000180: 3d20 274e 756d 6572 6963 436f 6d70 6f6e  = 'NumericCompon
+00000190: 656e 7427 0d0a 2020 2020 6c65 6674 5f62  ent'..    left_b
+000001a0: 6f75 6e64 6172 795f 636f 6c3a 2073 7472  oundary_col: str
+000001b0: 203d 2027 4c65 6674 426f 756e 6461 7279   = 'LeftBoundary
+000001c0: 270d 0a20 2020 206c 6566 745f 626f 756e  '..    left_boun
+000001d0: 645f 636f 6c3a 2073 7472 203d 2027 4c65  d_col: str = 'Le
+000001e0: 6674 426f 756e 6427 0d0a 2020 2020 7269  ftBound'..    ri
+000001f0: 6768 745f 626f 756e 645f 636f 6c3a 2073  ght_bound_col: s
+00000200: 7472 203d 2027 5269 6768 7442 6f75 6e64  tr = 'RightBound
+00000210: 270d 0a20 2020 2072 6967 6874 5f62 6f75  '..    right_bou
+00000220: 6e64 6172 795f 636f 6c3a 2073 7472 203d  ndary_col: str =
+00000230: 2027 5269 6768 7442 6f75 6e64 6172 7927   'RightBoundary'
+00000240: 0d0a 2020 2020 696e 7465 7276 616c 5f63  ..    interval_c
+00000250: 6f6c 3a20 7374 7220 3d20 2749 6e74 6572  ol: str = 'Inter
+00000260: 7661 6c27 0d0a 2020 2020 7468 7265 7368  val'..    thresh
+00000270: 6f6c 645f 636f 6c3a 2073 7472 203d 2027  old_col: str = '
+00000280: 5468 7265 7368 6f6c 6427 0d0a 2020 2020  Threshold'..    
+00000290: 6578 6365 6564 616e 6365 735f 636f 6c3a  exceedances_col:
+000002a0: 2073 7472 203d 2027 4578 6365 6564 616e   str = 'Exceedan
+000002b0: 6365 7327 0d0a 2020 2020 6e6f 6e5f 6578  ces'..    non_ex
+000002c0: 6365 6564 616e 6365 735f 636f 6c3a 2073  ceedances_col: s
+000002d0: 7472 203d 2027 4e6f 6e45 7863 6565 6461  tr = 'NonExceeda
+000002e0: 6e63 6573 270d 0a20 2020 2069 676e 6f72  nces'..    ignor
+000002f0: 6564 5f63 6f6c 3a20 7374 7220 3d20 2749  ed_col: str = 'I
+00000300: 676e 6f72 6564 270d 0a20 2020 2069 6e63  gnored'..    inc
+00000310: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
+00000320: 7465 7276 616c 3a20 626f 6f6c 203d 2046  terval: bool = F
+00000330: 616c 7365 0d0a 2020 2020 666f 6375 735f  alse..    focus_
+00000340: 6869 6768 5f70 6f74 656e 7469 616c 3a20  high_potential: 
+00000350: 626f 6f6c 203d 2054 7275 650d 0a20 2020  bool = True..   
+00000360: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
+00000370: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
+00000380: 736f 723a 2066 6c6f 6174 203d 2030 2e32  sor: float = 0.2
+00000390: 350d 0a20 2020 2070 7265 6369 7369 6f6e  5..    precision
+000003a0: 5f72 6f75 6e64 696e 673a 2062 6f6f 6c20  _rounding: bool 
+000003b0: 3d20 5472 7565 0d0a 2020 2020 0d0a 2020  = True..    ..  
+000003c0: 2020 6465 6620 5f5f 706f 7374 5f69 6e69    def __post_ini
+000003d0: 745f 5f28 7365 6c66 293a 0d0a 2020 2020  t__(self):..    
+000003e0: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+000003f0: 456e 7375 7265 2074 6861 7420 7072 6f76  Ensure that prov
+00000400: 6964 6564 2064 6174 6120 6973 2061 2063  ided data is a c
+00000410: 6f70 7920 616e 6420 6e6f 7420 696e 6465  opy and not inde
+00000420: 7865 640d 0a20 2020 2020 2020 2073 656c  xed..        sel
+00000430: 662e 6461 7461 203d 2073 656c 662e 6461  f.data = self.da
+00000440: 7461 2e63 6f70 7928 292e 7265 7365 745f  ta.copy().reset_
+00000450: 696e 6465 7828 290d 0a20 2020 2020 2020  index()..       
+00000460: 200d 0a20 2020 2020 2020 2023 2525 2043   ..        #%% C
+00000470: 6865 636b 2063 6f6c 756d 6e20 6e61 6d65  heck column name
+00000480: 730d 0a20 2020 2020 2020 200d 0a20 2020  s..        ..   
+00000490: 2020 2020 2023 2043 6865 636b 2074 6861       # Check tha
+000004a0: 7420 6765 6e65 7261 7465 6420 636f 6c75  t generated colu
+000004b0: 6d6e 7320 646f 6e27 7420 636f 6e66 6c69  mns don't confli
+000004c0: 6374 2077 2f20 6578 6973 7469 6e67 2063  ct w/ existing c
+000004d0: 6f6c 756d 6e20 6e61 6d65 730d 0a20 2020  olumn names..   
+000004e0: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
+000004f0: 756d 6e73 203d 205b 6174 7472 6962 7574  umns = [attribut
+00000500: 6520 666f 7220 6174 7472 6962 7574 6520  e for attribute 
+00000510: 696e 2073 656c 662e 5f5f 616e 6e6f 7461  in self.__annota
+00000520: 7469 6f6e 735f 5f0d 0a20 2020 2020 2020  tions__..       
+00000530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000540: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00000550: 7474 7269 6275 7465 2e65 6e64 7377 6974  ttribute.endswit
+00000560: 6828 275f 636f 6c27 2920 616e 640d 0a20  h('_col') and.. 
+00000570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000590: 2020 2020 2020 6174 7472 6962 7574 6520        attribute 
+000005a0: 213d 2027 7661 6c75 655f 636f 6c27 5d0d  != 'value_col'].
+000005b0: 0a20 2020 2020 2020 2066 6f72 2063 6f6c  .        for col
+000005c0: 2069 6e20 6372 6561 7465 645f 636f 6c75   in created_colu
+000005d0: 6d6e 733a 0d0a 2020 2020 2020 2020 2020  mns:..          
+000005e0: 2020 636f 6c5f 6e61 6d65 203d 2067 6574    col_name = get
+000005f0: 6174 7472 2873 656c 662c 2063 6f6c 290d  attr(self, col).
+00000600: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00000610: 2863 6f6c 5f6e 616d 6520 696e 2073 656c  (col_name in sel
+00000620: 662e 6461 7461 2e63 6f6c 756d 6e73 2920  f.data.columns) 
+00000630: 2620 2863 6f6c 5f6e 616d 6520 213d 2073  & (col_name != s
+00000640: 656c 662e 7661 6c75 655f 636f 6c29 3a0d  elf.value_col):.
+00000650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000660: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00000670: 7228 2754 6865 2064 6174 6120 636f 6e74  r('The data cont
+00000680: 6169 6e73 2061 2063 6f6c 756d 6e20 6e61  ains a column na
+00000690: 6d65 6420 270d 0a20 2020 2020 2020 2020  med '..         
+000006a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000006b0: 2020 2020 2020 2020 6627 227b 636f 6c5f          f'"{col_
+000006c0: 6e61 6d65 7d22 2077 6869 6368 206d 6179  name}" which may
+000006d0: 2062 6520 7573 6564 2069 6e20 7468 6520   be used in the 
+000006e0: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+000006f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000700: 2020 2020 276f 7574 7075 742e 2045 6974      'output. Eit
+00000710: 6865 7220 7265 6e61 6d65 2074 6869 7320  her rename this 
+00000720: 636f 6c75 6d6e 2027 0d0a 2020 2020 2020  column '..      
+00000730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000740: 2020 2020 2020 2020 2020 2027 6f72 2070             'or p
+00000750: 726f 7669 6465 2061 6e20 616c 7465 726e  rovide an altern
+00000760: 6174 6976 6520 7661 6c75 6520 666f 7220  ative value for 
+00000770: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+00000780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000790: 2020 2020 6627 7b63 6f6c 7d20 7768 656e      f'{col} when
+000007a0: 2069 6e69 7469 616c 6973 696e 6720 4365   initialising Ce
+000007b0: 6e73 6f72 6564 4461 7461 4672 616d 652e  nsoredDataFrame.
+000007c0: 2729 0d0a 2020 2020 2020 2020 0d0a 2020  ')..        ..  
+000007d0: 2020 2020 2020 2325 2520 5370 6c69 7420        #%% Split 
+000007e0: 7661 6c75 6520 696e 746f 2063 656e 736f  value into censo
+000007f0: 722f 6e75 6d65 7269 6320 636f 6d70 6f6e  r/numeric compon
+00000800: 656e 7473 0d0a 2020 2020 2020 2020 0d0a  ents..        ..
+00000810: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+00000820: 6966 2076 616c 7565 2063 6f6c 756d 6e20  if value column 
+00000830: 6973 206e 6f74 2073 7472 696e 6720 7479  is not string ty
+00000840: 7065 0d0a 2020 2020 2020 2020 6966 2073  pe..        if s
+00000850: 656c 662e 6461 7461 5b73 656c 662e 7661  elf.data[self.va
+00000860: 6c75 655f 636f 6c5d 2e64 7479 7065 2021  lue_col].dtype !
+00000870: 3d20 7374 723a 0d0a 2020 2020 2020 2020  = str:..        
+00000880: 2020 2020 2320 4966 206e 6f74 2c20 636f      # If not, co
+00000890: 6e76 6572 7420 746f 2073 7472 696e 670d  nvert to string.
+000008a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000008b0: 662e 6461 7461 5b73 656c 662e 7661 6c75  f.data[self.valu
+000008c0: 655f 636f 6c5d 203d 2073 656c 662e 6461  e_col] = self.da
+000008d0: 7461 5b73 656c 662e 7661 6c75 655f 636f  ta[self.value_co
+000008e0: 6c5d 2e61 7374 7970 6528 7374 7229 0d0a  l].astype(str)..
+000008f0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00000900: 2020 2320 4372 6561 7465 2063 656e 736f    # Create censo
+00000910: 7220 636f 6c75 6d6e 2066 726f 6d20 7661  r column from va
+00000920: 6c75 6520 636f 6c75 6d6e 0d0a 2020 2020  lue column..    
+00000930: 2020 2020 7365 6c66 2e64 6174 615b 7365      self.data[se
+00000940: 6c66 2e63 656e 736f 725f 636f 6c5d 203d  lf.censor_col] =
+00000950: 2028 7365 6c66 2e64 6174 615b 7365 6c66   (self.data[self
+00000960: 2e76 616c 7565 5f63 6f6c 5d0d 0a20 2020  .value_col]..   
+00000970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000990: 2020 202e 7374 722e 6578 7472 6163 7428     .str.extract(
+000009a0: 7227 285b 3ce2 89a4 e289 a53e 5d29 2729  r'([<......>])')
+000009b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000009c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000009d0: 2020 2020 2020 2020 2e66 696c 6c6e 6128          .fillna(
+000009e0: 2727 290d 0a20 2020 2020 2020 2020 2020  '')..           
+000009f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000a00: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00000a10: 2020 2020 2020 2320 4368 6563 6b20 7468        # Check th
+00000a20: 6174 2074 6865 7265 2069 7320 6f6e 6c79  at there is only
+00000a30: 2061 2073 696e 676c 6520 6365 6e73 6f72   a single censor
+00000a40: 2063 6f6d 706f 6e65 6e74 0d0a 2020 2020   component..    
+00000a50: 2020 2020 6966 2073 656c 662e 6461 7461      if self.data
+00000a60: 5b73 656c 662e 6365 6e73 6f72 5f63 6f6c  [self.censor_col
+00000a70: 5d2e 7374 722e 6c65 6e28 292e 6d61 7828  ].str.len().max(
+00000a80: 2920 3e20 313a 0d0a 2020 2020 2020 2020  ) > 1:..        
+00000a90: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00000aa0: 7272 6f72 2827 4120 7661 6c75 6520 6578  rror('A value ex
+00000ab0: 6973 7473 2069 6e20 7468 6520 6461 7461  ists in the data
+00000ac0: 2077 6974 6820 6d75 6c74 6970 6c65 2027   with multiple '
+00000ad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00000ae0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00000af0: 6365 6e73 6f72 2063 6f6d 706f 6e65 6e74  censor component
+00000b00: 732e 2729 0d0a 2020 2020 2020 2020 2320  s.')..        # 
+00000b10: 4372 6561 7465 206e 756d 6572 6963 2063  Create numeric c
+00000b20: 6f6c 756d 6e20 6672 6f6d 2076 616c 7565  olumn from value
+00000b30: 2063 6f6c 756d 6e0d 0a20 2020 2020 2020   column..       
+00000b40: 2073 656c 662e 6461 7461 5b73 656c 662e   self.data[self.
+00000b50: 6e75 6d65 7269 635f 636f 6c5d 203d 2028  numeric_col] = (
+00000b60: 7365 6c66 2e64 6174 615b 7365 6c66 2e76  self.data[self.v
+00000b70: 616c 7565 5f63 6f6c 5d0d 0a20 2020 2020  alue_col]..     
+00000b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000ba0: 2020 2e73 7472 2e72 6570 6c61 6365 2827    .str.replace('
+00000bb0: 3c7c e289 a47c e289 a57c 3e27 2c27 272c  <|...|...|>','',
+00000bc0: 7265 6765 783d 5472 7565 290d 0a20 2020  regex=True)..   
+00000bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000bf0: 2020 2020 2e61 7374 7970 6528 666c 6f61      .astype(floa
+00000c00: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+00000c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000c20: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00000c30: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00000c40: 2325 2520 4372 6561 7465 2069 6e74 6572  #%% Create inter
+00000c50: 7661 6c20 666f 7220 7661 6c75 6520 286c  val for value (l
+00000c60: 6566 742f 7269 6768 7420 626f 756e 6473  eft/right bounds
+00000c70: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+00000c80: 2020 2020 2023 2044 6566 696e 6520 7768       # Define wh
+00000c90: 6572 6520 7468 6520 6c65 6674 2062 6f75  ere the left bou
+00000ca0: 6e64 2069 7320 636c 6f73 6564 0d0a 2020  nd is closed..  
+00000cb0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
+00000cc0: 7365 6c66 2e6c 6566 745f 626f 756e 6461  self.left_bounda
+00000cd0: 7279 5f63 6f6c 5d20 3d20 280d 0a20 2020  ry_col] = (..   
+00000ce0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00000cf0: 7768 6572 6528 7365 6c66 2e64 6174 615b  where(self.data[
+00000d00: 7365 6c66 2e63 656e 736f 725f 636f 6c5d  self.censor_col]
+00000d10: 2e69 7369 6e28 5b27 272c 27e2 89a5 275d  .isin(['','...']
+00000d20: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00000d30: 2020 2020 2020 2020 2020 2020 2027 436c               'Cl
+00000d40: 6f73 6564 272c 0d0a 2020 2020 2020 2020  osed',..        
+00000d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000d60: 2027 4f70 656e 270d 0a20 2020 2020 2020   'Open'..       
+00000d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000d80: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00000d90: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00000da0: 0d0a 2020 2020 2020 2020 2320 4465 6669  ..        # Defi
+00000db0: 6e65 2077 6865 7265 2074 6865 206c 6566  ne where the lef
+00000dc0: 7420 626f 756e 6420 6973 2075 6e6c 696d  t bound is unlim
+00000dd0: 6974 6564 0d0a 2020 2020 2020 2020 7365  ited..        se
+00000de0: 6c66 2e64 6174 615b 7365 6c66 2e6c 6566  lf.data[self.lef
+00000df0: 745f 626f 756e 645f 636f 6c5d 203d 2028  t_bound_col] = (
+00000e00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00000e10: 2020 6e70 2e77 6865 7265 2873 656c 662e    np.where(self.
+00000e20: 6461 7461 5b73 656c 662e 6365 6e73 6f72  data[self.censor
+00000e30: 5f63 6f6c 5d2e 6973 696e 285b 273c 272c  _col].isin(['<',
+00000e40: 27e2 89a4 275d 292c 0d0a 2020 2020 2020  '...']),..      
+00000e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e60: 2020 2020 2020 2020 2020 2020 202d 6e70               -np
+00000e70: 2e69 6e66 2c0d 0a20 2020 2020 2020 2020  .inf,..         
+00000e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e90: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00000ea0: 6174 615b 7365 6c66 2e6e 756d 6572 6963  ata[self.numeric
+00000eb0: 5f63 6f6c 5d0d 0a20 2020 2020 2020 2020  _col]..         
+00000ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000ed0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00000ee0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00000ef0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00000f00: 2020 2320 4465 6669 6e65 2077 6865 7265    # Define where
+00000f10: 2074 6865 2072 6967 6874 2062 6f75 6e64   the right bound
+00000f20: 2069 7320 756e 6c69 6d69 7465 640d 0a20   is unlimited.. 
+00000f30: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
+00000f40: 5b73 656c 662e 7269 6768 745f 626f 756e  [self.right_boun
+00000f50: 645f 636f 6c5d 203d 2028 0d0a 2020 2020  d_col] = (..    
+00000f60: 2020 2020 2020 2020 2020 2020 6e70 2e77              np.w
+00000f70: 6865 7265 2873 656c 662e 6461 7461 5b73  here(self.data[s
+00000f80: 656c 662e 6365 6e73 6f72 5f63 6f6c 5d2e  elf.censor_col].
+00000f90: 6973 696e 285b 27e2 89a5 272c 273e 275d  isin(['...','>']
+00000fa0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00000fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000fc0: 2020 2020 2020 206e 702e 696e 662c 0d0a         np.inf,..
+00000fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000ff0: 2020 2073 656c 662e 6461 7461 5b73 656c     self.data[sel
+00001000: 662e 6e75 6d65 7269 635f 636f 6c5d 0d0a  f.numeric_col]..
+00001010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001030: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+00001040: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00001050: 200d 0a20 2020 2020 2020 2023 2044 6566   ..        # Def
+00001060: 696e 6520 7768 6572 6520 7468 6520 7269  ine where the ri
+00001070: 6768 7420 626f 756e 6420 6973 2063 6c6f  ght bound is clo
+00001080: 7365 640d 0a20 2020 2020 2020 2073 656c  sed..        sel
+00001090: 662e 6461 7461 5b73 656c 662e 7269 6768  f.data[self.righ
+000010a0: 745f 626f 756e 6461 7279 5f63 6f6c 5d20  t_boundary_col] 
+000010b0: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
+000010c0: 2020 2020 206e 702e 7768 6572 6528 7365       np.where(se
+000010d0: 6c66 2e64 6174 615b 7365 6c66 2e63 656e  lf.data[self.cen
+000010e0: 736f 725f 636f 6c5d 2e69 7369 6e28 5b27  sor_col].isin(['
+000010f0: e289 a427 2c27 275d 292c 0d0a 2020 2020  ...','']),..    
+00001100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001110: 2020 2020 2027 436c 6f73 6564 272c 0d0a       'Closed',..
+00001120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001130: 2020 2020 2020 2020 2027 4f70 656e 270d           'Open'.
+00001140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001150: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00001160: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00001170: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00001180: 2020 2320 4966 206c 6566 7420 6365 6e73    # If left cens
+00001190: 6f72 6564 2061 7265 2061 7373 756d 6564  ored are assumed
+000011a0: 2070 6f73 6974 6976 650d 0a20 2020 2020   positive..     
+000011b0: 2020 2069 6620 6e6f 7420 7365 6c66 2e69     if not self.i
+000011c0: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
+000011d0: 696e 7465 7276 616c 3a0d 0a20 2020 2020  interval:..     
+000011e0: 2020 2020 2020 2023 2043 6865 636b 2066         # Check f
+000011f0: 6f72 2061 6e79 206e 6567 6174 6976 6520  or any negative 
+00001200: 7661 6c75 6573 2028 6578 636c 7564 6520  values (exclude 
+00001210: 2d69 6e66 290d 0a20 2020 2020 2020 2020  -inf)..         
+00001220: 2020 2069 6620 2873 656c 662e 6461 7461     if (self.data
+00001230: 5b73 656c 662e 6c65 6674 5f62 6f75 6e64  [self.left_bound
+00001240: 5f63 6f6c 5d0d 0a20 2020 2020 2020 2020  _col]..         
+00001250: 2020 2020 2020 2020 2020 202e 6265 7477             .betw
+00001260: 6565 6e28 2d6e 702e 696e 662c 2030 2c20  een(-np.inf, 0, 
+00001270: 696e 636c 7573 6976 653d 276e 6569 7468  inclusive='neith
+00001280: 6572 2729 0d0a 2020 2020 2020 2020 2020  er')..          
+00001290: 2020 2020 2020 2020 2020 2e61 6e79 2829            .any()
+000012a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000012b0: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
+000012c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000012d0: 5661 6c75 6545 7272 6f72 2827 4e65 6761  ValueError('Nega
+000012e0: 7469 7665 2076 616c 7565 7320 6578 6973  tive values exis
+000012f0: 7420 696e 2074 6865 2064 6174 612e 2052  t in the data. R
+00001300: 6573 6f6c 7665 2027 0d0a 2020 2020 2020  esolve '..      
+00001310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001320: 2020 2020 2020 2020 2020 2027 6e65 6761             'nega
+00001330: 7469 7665 2076 616c 7565 7320 6f72 2073  tive values or s
+00001340: 6574 2027 0d0a 2020 2020 2020 2020 2020  et '..          
+00001350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001360: 2020 2020 2020 2027 696e 636c 7564 655f         'include_
+00001370: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
+00001380: 6c20 3d20 5472 7565 2729 0d0a 2020 2020  l = True')..    
+00001390: 2020 2020 2020 2020 2320 5365 7420 616e          # Set an
+000013a0: 7920 2d69 6e66 206c 6566 7420 626f 756e  y -inf left boun
+000013b0: 6473 2074 6f20 3020 7769 7468 2063 6c6f  ds to 0 with clo
+000013c0: 7365 6420 626f 756e 6461 7279 0d0a 2020  sed boundary..  
+000013d0: 2020 2020 2020 2020 2020 636f 6e64 6974            condit
+000013e0: 696f 6e20 3d20 2873 656c 662e 6461 7461  ion = (self.data
+000013f0: 5b73 656c 662e 6c65 6674 5f62 6f75 6e64  [self.left_bound
+00001400: 5f63 6f6c 5d20 3c20 3029 0d0a 2020 2020  _col] < 0)..    
+00001410: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+00001420: 615b 7365 6c66 2e6c 6566 745f 626f 756e  a[self.left_boun
+00001430: 6461 7279 5f63 6f6c 5d20 3d20 280d 0a20  dary_col] = (.. 
+00001440: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00001450: 702e 7768 6572 6528 636f 6e64 6974 696f  p.where(conditio
+00001460: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00001470: 2020 2020 2020 2020 2020 2020 2027 436c               'Cl
+00001480: 6f73 6564 272c 0d0a 2020 2020 2020 2020  osed',..        
+00001490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014a0: 2073 656c 662e 6461 7461 5b73 656c 662e   self.data[self.
+000014b0: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+000014c0: 6c5d 0d0a 2020 2020 2020 2020 2020 2020  l]..            
+000014d0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+000014e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014f0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00001500: 656c 662e 6461 7461 5b73 656c 662e 6c65  elf.data[self.le
+00001510: 6674 5f62 6f75 6e64 5f63 6f6c 5d20 3d20  ft_bound_col] = 
+00001520: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00001530: 2020 206e 702e 7768 6572 6528 636f 6e64     np.where(cond
+00001540: 6974 696f 6e2c 0d0a 2020 2020 2020 2020  ition,..        
+00001550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001560: 2030 2e30 2c0d 0a20 2020 2020 2020 2020   0.0,..         
+00001570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001580: 7365 6c66 2e64 6174 615b 7365 6c66 2e6c  self.data[self.l
+00001590: 6566 745f 626f 756e 645f 636f 6c5d 0d0a  eft_bound_col]..
+000015a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000015b0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+000015c0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+000015d0: 2020 2023 2525 2055 7469 6c69 7479 206d     #%% Utility m
+000015e0: 6574 686f 6473 0d0a 2020 2020 0d0a 2020  ethods..    ..  
+000015f0: 2020 6465 6620 696e 7465 7276 616c 5f6e    def interval_n
+00001600: 6f74 6174 696f 6e28 7365 6c66 2c20 696e  otation(self, in
+00001610: 706c 6163 6520 3d20 4661 6c73 6529 3a0d  place = False):.
+00001620: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00001630: 2020 2023 2043 7265 6174 6520 6120 636f     # Create a co
+00001640: 7079 206f 6620 7468 6520 6461 7461 0d0a  py of the data..
+00001650: 2020 2020 2020 2020 6466 203d 2073 656c          df = sel
+00001660: 662e 6461 7461 2e63 6f70 7928 290d 0a20  f.data.copy().. 
+00001670: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00001680: 2023 2044 6574 6572 6d69 6e65 2074 6865   # Determine the
+00001690: 206c 6566 7420 626f 756e 6461 7279 2073   left boundary s
+000016a0: 796d 626f 6c0d 0a20 2020 2020 2020 2064  ymbol..        d
+000016b0: 665b 7365 6c66 2e69 6e74 6572 7661 6c5f  f[self.interval_
+000016c0: 636f 6c5d 203d 2028 0d0a 2020 2020 2020  col] = (..      
+000016d0: 2020 2020 2020 6e70 2e77 6865 7265 2864        np.where(d
+000016e0: 665b 7365 6c66 2e6c 6566 745f 626f 756e  f[self.left_boun
+000016f0: 6461 7279 5f63 6f6c 5d20 3d3d 2027 4f70  dary_col] == 'Op
+00001700: 656e 272c 0d0a 2020 2020 2020 2020 2020  en',..          
+00001710: 2020 2020 2020 2020 2020 2027 2827 2c0d             '(',.
+00001720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001730: 2020 2020 2020 275b 270d 0a20 2020 2020        '['..     
+00001740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001750: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
+00001760: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00001770: 2020 2020 2320 496e 636f 7270 6f72 6174      # Incorporat
+00001780: 6520 6c65 6674 2061 6e64 2072 6967 6874  e left and right
+00001790: 2062 6f75 6e64 730d 0a20 2020 2020 2020   bounds..       
+000017a0: 2069 6620 7365 6c66 2e70 7265 6369 7369   if self.precisi
+000017b0: 6f6e 5f72 6f75 6e64 696e 673a 0d0a 2020  on_rounding:..  
+000017c0: 2020 2020 2020 2020 2020 6466 5b73 656c            df[sel
+000017d0: 662e 696e 7465 7276 616c 5f63 6f6c 5d20  f.interval_col] 
+000017e0: 2b3d 2028 0d0a 2020 2020 2020 2020 2020  += (..          
+000017f0: 2020 2020 2020 6466 5b73 656c 662e 6c65        df[self.le
+00001800: 6674 5f62 6f75 6e64 5f63 6f6c 5d2e 6170  ft_bound_col].ap
+00001810: 706c 7928 7374 7269 6e67 5f70 7265 6369  ply(string_preci
+00001820: 7369 6f6e 2920 2b20 272c 2027 202b 200d  sion) + ', ' + .
+00001830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001840: 2064 665b 7365 6c66 2e72 6967 6874 5f62   df[self.right_b
+00001850: 6f75 6e64 5f63 6f6c 5d2e 6170 706c 7928  ound_col].apply(
+00001860: 7374 7269 6e67 5f70 7265 6369 7369 6f6e  string_precision
+00001870: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00001880: 2020 2029 0d0a 2020 2020 2020 2020 656c     )..        el
+00001890: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000018a0: 2064 665b 7365 6c66 2e69 6e74 6572 7661   df[self.interva
+000018b0: 6c5f 636f 6c5d 202b 3d20 280d 0a20 2020  l_col] += (..   
+000018c0: 2020 2020 2020 2020 2020 2020 2064 665b               df[
+000018d0: 7365 6c66 2e6c 6566 745f 626f 756e 645f  self.left_bound_
+000018e0: 636f 6c5d 2e61 7374 7970 6528 7374 7229  col].astype(str)
+000018f0: 202b 2027 2c20 2720 2b20 0d0a 2020 2020   + ', ' + ..    
+00001900: 2020 2020 2020 2020 2020 2020 6466 5b73              df[s
+00001910: 656c 662e 7269 6768 745f 626f 756e 645f  elf.right_bound_
+00001920: 636f 6c5d 2e61 7374 7970 6528 7374 7229  col].astype(str)
+00001930: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001940: 2020 290d 0a20 2020 2020 2020 200d 0a20    )..        .. 
+00001950: 2020 2020 2020 2023 2044 6574 6572 6d69         # Determi
+00001960: 6e65 2074 6865 2072 6967 6874 2062 6f75  ne the right bou
+00001970: 6e64 6172 7920 7379 6d62 6f6c 0d0a 2020  ndary symbol..  
+00001980: 2020 2020 2020 6466 5b73 656c 662e 696e        df[self.in
+00001990: 7465 7276 616c 5f63 6f6c 5d20 2b3d 2028  terval_col] += (
+000019a0: 0d0a 2020 2020 2020 2020 2020 2020 6e70  ..            np
+000019b0: 2e77 6865 7265 2864 665b 7365 6c66 2e72  .where(df[self.r
+000019c0: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
+000019d0: 6c5d 203d 3d20 274f 7065 6e27 2c0d 0a20  l] == 'Open',.. 
+000019e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000019f0: 2020 2020 2729 272c 0d0a 2020 2020 2020      ')',..      
+00001a00: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00001a10: 5d27 0d0a 2020 2020 2020 2020 2020 2020  ]'..            
+00001a20: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00001a30: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00001a40: 2020 200d 0a20 2020 2020 2020 2023 2052     ..        # R
+00001a50: 6570 6c61 6365 206f 7220 7265 7475 726e  eplace or return
+00001a60: 2072 6573 756c 740d 0a20 2020 2020 2020   result..       
+00001a70: 2069 6620 696e 706c 6163 653a 0d0a 2020   if inplace:..  
+00001a80: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00001a90: 6174 6120 3d20 6466 0d0a 2020 2020 2020  ata = df..      
+00001aa0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00001ab0: 2020 2020 2072 6574 7572 6e20 6466 0d0a       return df..
+00001ac0: 2020 2020 0d0a 2020 2020 6465 6620 636f      ..    def co
+00001ad0: 6d70 6f6e 656e 7473 5f66 726f 6d5f 696e  mponents_from_in
+00001ae0: 7465 7276 616c 2873 656c 662c 0d0a 2020  terval(self,..  
+00001af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001b00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00001b10: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
+00001b20: 6961 6c2c 0d0a 2020 2020 2020 2020 2020  ial,..          
+00001b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001b40: 2020 2020 2020 2069 6e70 6c61 6365 203d         inplace =
+00001b50: 2046 616c 7365 293a 0d0a 2020 2020 2020   False):..      
+00001b60: 2020 0d0a 2020 2020 2020 2020 2320 4372    ..        # Cr
+00001b70: 6561 7465 2061 2063 6f70 7920 6f66 2074  eate a copy of t
+00001b80: 6865 2064 6174 610d 0a20 2020 2020 2020  he data..       
+00001b90: 2064 6620 3d20 7365 6c66 2e64 6174 612e   df = self.data.
+00001ba0: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
+00001bb0: 0d0a 2020 2020 2020 2020 2320 4465 7465  ..        # Dete
+00001bc0: 726d 696e 6520 7468 6520 6d69 6470 6f69  rmine the midpoi
+00001bd0: 6e74 2066 6f72 2074 6865 2069 6e74 6572  nt for the inter
+00001be0: 7661 6c20 6966 2066 696e 6974 6520 696e  val if finite in
+00001bf0: 7465 7276 616c 0d0a 2020 2020 2020 2020  terval..        
+00001c00: 6466 5b27 5f5f 4d69 6450 6f69 6e74 5f5f  df['__MidPoint__
+00001c10: 275d 203d 2028 0d0a 2020 2020 2020 2020  '] = (..        
+00001c20: 2020 2020 6e70 2e77 6865 7265 2828 6466      np.where((df
+00001c30: 5b73 656c 662e 6c65 6674 5f62 6f75 6e64  [self.left_bound
+00001c40: 5f63 6f6c 5d20 3e20 2d6e 702e 696e 6629  _col] > -np.inf)
+00001c50: 2026 200d 0a20 2020 2020 2020 2020 2020   & ..           
+00001c60: 2020 2020 2020 2020 2020 2864 665b 7365            (df[se
+00001c70: 6c66 2e72 6967 6874 5f62 6f75 6e64 5f63  lf.right_bound_c
+00001c80: 6f6c 5d20 3c20 6e70 2e69 6e66 292c 0d0a  ol] < np.inf),..
+00001c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001ca0: 302e 3520 2a20 2864 665b 7365 6c66 2e6c  0.5 * (df[self.l
+00001cb0: 6566 745f 626f 756e 645f 636f 6c5d 202b  eft_bound_col] +
+00001cc0: 2064 665b 7365 6c66 2e72 6967 6874 5f62   df[self.right_b
+00001cd0: 6f75 6e64 5f63 6f6c 5d29 2c0d 0a20 2020  ound_col]),..   
+00001ce0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00001cf0: 6e61 6e0d 0a20 2020 2020 2020 2020 2020  nan..           
+00001d00: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00001d10: 2020 2020 290d 0a20 2020 2020 2020 200d      )..        .
+00001d20: 0a20 2020 2020 2020 2023 2053 7461 7274  .        # Start
+00001d30: 2077 6974 6820 7468 6520 636f 6e64 6974   with the condit
+00001d40: 696f 6e73 2074 6861 7420 7072 6f64 7563  ions that produc
+00001d50: 6520 616e 2075 6e63 656e 736f 7265 6420  e an uncensored 
+00001d60: 7265 7375 6c74 0d0a 2020 2020 2020 2020  result..        
+00001d70: 636f 6e64 6974 696f 6e73 203d 205b 0d0a  conditions = [..
+00001d80: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+00001d90: 2074 6865 2062 6f75 6e64 7320 6172 6520   the bounds are 
+00001da0: 6571 7561 6c2c 2074 6865 6e20 7468 6520  equal, then the 
+00001db0: 7265 7375 6c74 2069 7320 756e 6365 6e73  result is uncens
+00001dc0: 6f72 6564 0d0a 2020 2020 2020 2020 2020  ored..          
+00001dd0: 2020 2864 665b 7365 6c66 2e6c 6566 745f    (df[self.left_
+00001de0: 626f 756e 645f 636f 6c5d 203d 3d20 0d0a  bound_col] == ..
+00001df0: 2020 2020 2020 2020 2020 2020 2064 665b               df[
+00001e00: 7365 6c66 2e72 6967 6874 5f62 6f75 6e64  self.right_bound
+00001e10: 5f63 6f6c 5d29 2c0d 0a20 2020 2020 2020  _col]),..       
+00001e20: 2020 2020 2023 2049 6620 7468 6520 626f       # If the bo
+00001e30: 756e 6473 2061 7265 2066 696e 6974 6520  unds are finite 
+00001e40: 616e 6420 7468 6520 696e 7465 7276 616c  and the interval
+00001e50: 2069 7320 7769 7468 696e 2074 6865 200d   is within the .
+00001e60: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
+00001e70: 7265 6369 7369 6f6e 2074 6f6c 6572 616e  recision toleran
+00001e80: 6365 2c20 7468 656e 2074 6865 2072 6573  ce, then the res
+00001e90: 756c 7420 6973 2075 6e63 656e 736f 7265  ult is uncensore
+00001ea0: 640d 0a20 2020 2020 2020 2020 2020 2028  d..            (
+00001eb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001ec0: 2020 2864 665b 7365 6c66 2e72 6967 6874    (df[self.right
+00001ed0: 5f62 6f75 6e64 5f63 6f6c 5d20 2d20 6466  _bound_col] - df
+00001ee0: 5b27 5f5f 4d69 6450 6f69 6e74 5f5f 275d  ['__MidPoint__']
+00001ef0: 2920 3c3d 200d 0a20 2020 2020 2020 2020  ) <= ..         
+00001f00: 2020 2020 2020 2064 665b 275f 5f4d 6964         df['__Mid
+00001f10: 506f 696e 745f 5f27 5d20 2a20 0d0a 2020  Point__'] * ..  
+00001f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001f40: 2020 7365 6c66 2e70 7265 6369 7369 6f6e    self.precision
+00001f50: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
+00001f60: 6f70 5f63 656e 736f 7229 0d0a 2020 2020  op_censor)..    
+00001f70: 2020 2020 2020 2020 5d0d 0a20 2020 2020          ]..     
+00001f80: 2020 200d 0a20 2020 2020 2020 2063 656e     ..        cen
+00001f90: 736f 725f 7265 7375 6c74 7320 3d20 5b0d  sor_results = [.
+00001fa0: 0a20 2020 2020 2020 2020 2020 2027 272c  .            '',
+00001fb0: 0d0a 2020 2020 2020 2020 2020 2020 2727  ..            ''
+00001fc0: 0d0a 2020 2020 2020 2020 2020 2020 5d0d  ..            ].
+00001fd0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00001fe0: 2020 206e 756d 6572 6963 5f72 6573 756c     numeric_resul
+00001ff0: 7473 203d 5b0d 0a20 2020 2020 2020 2020  ts =[..         
+00002000: 2020 2064 665b 275f 5f4d 6964 506f 696e     df['__MidPoin
+00002010: 745f 5f27 5d2c 0d0a 2020 2020 2020 2020  t__'],..        
+00002020: 2020 2020 6466 5b27 5f5f 4d69 6450 6f69      df['__MidPoi
+00002030: 6e74 5f5f 275d 0d0a 2020 2020 2020 2020  nt__']..        
+00002040: 2020 2020 5d0d 0a20 2020 2020 2020 200d      ]..        .
+00002050: 0a20 2020 2020 2020 2023 2049 6620 666f  .        # If fo
+00002060: 6375 7365 6420 6f6e 2074 6865 2068 6967  cused on the hig
+00002070: 6865 7374 2070 6f74 656e 7469 616c 2072  hest potential r
+00002080: 6573 756c 740d 0a20 2020 2020 2020 2069  esult..        i
+00002090: 6620 666f 6375 735f 6869 6768 5f70 6f74  f focus_high_pot
+000020a0: 656e 7469 616c 3a0d 0a20 2020 2020 2020  ential:..       
+000020b0: 2020 2020 2023 2053 6574 2063 656e 736f       # Set censo
+000020c0: 7220 616e 6420 6e75 6d65 7269 6320 636f  r and numeric co
+000020d0: 6d70 6f6e 656e 7473 2066 6f72 2065 6163  mponents for eac
+000020e0: 6820 636f 6e64 6974 696f 6e0d 0a20 2020  h condition..   
+000020f0: 2020 2020 2020 2020 2063 6f6e 6469 7469           conditi
+00002100: 6f6e 7320 2b3d 205b 0d0a 2020 2020 2020  ons += [..      
+00002110: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
+00002120: 6865 7265 2069 7320 616e 2069 6e66 696e  here is an infin
+00002130: 6974 6520 7269 6768 7420 626f 756e 642c  ite right bound,
+00002140: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002150: 2020 2320 7468 656e 2074 6865 2072 6573    # then the res
+00002160: 756c 7420 6973 2072 6967 6874 2063 656e  ult is right cen
+00002170: 736f 7265 640d 0a20 2020 2020 2020 2020  sored..         
+00002180: 2020 2020 2020 2023 2077 6865 7265 2063         # where c
+00002190: 6c6f 7365 6420 626f 756e 6461 7279 2069  losed boundary i
+000021a0: 6e64 6963 6174 6573 2070 6f74 656e 7469  ndicates potenti
+000021b0: 616c 2065 7175 616c 6974 790d 0a20 2020  al equality..   
+000021c0: 2020 2020 2020 2020 2020 2020 2028 0d0a               (..
+000021d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000021e0: 2020 2020 2864 665b 7365 6c66 2e72 6967      (df[self.rig
+000021f0: 6874 5f62 6f75 6e64 5f63 6f6c 5d20 3d3d  ht_bound_col] ==
+00002200: 206e 702e 696e 6629 2026 200d 0a20 2020   np.inf) & ..   
+00002210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002220: 2028 6466 5b73 656c 662e 6c65 6674 5f62   (df[self.left_b
+00002230: 6f75 6e64 5f63 6f6c 5d20 3e20 2d6e 702e  ound_col] > -np.
+00002240: 696e 6629 2026 200d 0a20 2020 2020 2020  inf) & ..       
+00002250: 2020 2020 2020 2020 2020 2020 2028 6466               (df
+00002260: 5b73 656c 662e 6c65 6674 5f62 6f75 6e64  [self.left_bound
+00002270: 6172 795f 636f 6c5d 203d 3d20 274f 7065  ary_col] == 'Ope
+00002280: 6e27 290d 0a20 2020 2020 2020 2020 2020  n')..           
+00002290: 2020 2020 2029 2c0d 0a20 2020 2020 2020       ),..       
+000022a0: 2020 2020 2020 2020 2028 0d0a 2020 2020           (..    
+000022b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000022c0: 2864 665b 7365 6c66 2e72 6967 6874 5f62  (df[self.right_b
+000022d0: 6f75 6e64 5f63 6f6c 5d20 3d3d 206e 702e  ound_col] == np.
+000022e0: 696e 6629 2026 200d 0a20 2020 2020 2020  inf) & ..       
+000022f0: 2020 2020 2020 2020 2020 2020 2028 6466               (df
+00002300: 5b73 656c 662e 6c65 6674 5f62 6f75 6e64  [self.left_bound
+00002310: 5f63 6f6c 5d20 3e20 2d6e 702e 696e 6629  _col] > -np.inf)
+00002320: 2026 200d 0a20 2020 2020 2020 2020 2020   & ..           
+00002330: 2020 2020 2020 2020 2028 6466 5b73 656c           (df[sel
+00002340: 662e 6c65 6674 5f62 6f75 6e64 6172 795f  f.left_boundary_
+00002350: 636f 6c5d 203d 3d20 2743 6c6f 7365 6427  col] == 'Closed'
+00002360: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00002370: 2020 2029 2c0d 0a20 2020 2020 2020 2020     ),..         
+00002380: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
+00002390: 7365 2c20 7468 6520 7265 7375 6c74 2069  se, the result i
+000023a0: 7320 6c65 6674 2063 656e 736f 7265 640d  s left censored.
+000023b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000023c0: 2023 2077 6865 7265 2063 6c6f 7365 6420   # where closed 
+000023d0: 626f 756e 6461 7279 2069 6e64 6963 6174  boundary indicat
+000023e0: 6573 2070 6f74 656e 7469 616c 2065 7175  es potential equ
+000023f0: 616c 6974 790d 0a20 2020 2020 2020 2020  ality..         
+00002400: 2020 2020 2020 2028 0d0a 2020 2020 2020         (..      
+00002410: 2020 2020 2020 2020 2020 2020 2020 2864                (d
+00002420: 665b 7365 6c66 2e72 6967 6874 5f62 6f75  f[self.right_bou
+00002430: 6e64 5f63 6f6c 5d20 3c20 6e70 2e69 6e66  nd_col] < np.inf
+00002440: 2920 2620 0d0a 2020 2020 2020 2020 2020  ) & ..          
+00002450: 2020 2020 2020 2020 2020 2864 665b 7365            (df[se
+00002460: 6c66 2e72 6967 6874 5f62 6f75 6e64 6172  lf.right_boundar
+00002470: 795f 636f 6c5d 203d 3d20 274f 7065 6e27  y_col] == 'Open'
+00002480: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00002490: 2020 2029 2c0d 0a20 2020 2020 2020 2020     ),..         
+000024a0: 2020 2020 2020 2028 0d0a 2020 2020 2020         (..      
+000024b0: 2020 2020 2020 2020 2020 2020 2020 2864                (d
+000024c0: 665b 7365 6c66 2e72 6967 6874 5f62 6f75  f[self.right_bou
+000024d0: 6e64 5f63 6f6c 5d20 3c20 6e70 2e69 6e66  nd_col] < np.inf
+000024e0: 2920 2620 0d0a 2020 2020 2020 2020 2020  ) & ..          
+000024f0: 2020 2020 2020 2020 2020 2864 665b 7365            (df[se
+00002500: 6c66 2e72 6967 6874 5f62 6f75 6e64 6172  lf.right_boundar
+00002510: 795f 636f 6c5d 203d 3d20 2743 6c6f 7365  y_col] == 'Close
+00002520: 6427 290d 0a20 2020 2020 2020 2020 2020  d')..           
+00002530: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00002540: 2020 2020 2020 2020 5d0d 0a20 2020 2020          ]..     
+00002550: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00002560: 2020 2020 2063 656e 736f 725f 7265 7375       censor_resu
+00002570: 6c74 7320 2b3d 205b 0d0a 2020 2020 2020  lts += [..      
+00002580: 2020 2020 2020 2020 2020 273e 272c 0d0a            '>',..
+00002590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000025a0: 27e2 89a5 272c 0d0a 2020 2020 2020 2020  '...',..        
+000025b0: 2020 2020 2020 2020 273c 272c 0d0a 2020          '<',..  
+000025c0: 2020 2020 2020 2020 2020 2020 2020 27e2                '.
+000025d0: 89a4 270d 0a20 2020 2020 2020 2020 2020  ..'..           
+000025e0: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
+000025f0: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+00002600: 2020 6e75 6d65 7269 635f 7265 7375 6c74    numeric_result
+00002610: 7320 2b3d 205b 0d0a 2020 2020 2020 2020  s += [..        
+00002620: 2020 2020 2020 2020 6466 5b73 656c 662e          df[self.
+00002630: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 5d2c  left_bound_col],
+00002640: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002650: 2020 6466 5b73 656c 662e 6c65 6674 5f62    df[self.left_b
+00002660: 6f75 6e64 5f63 6f6c 5d2c 0d0a 2020 2020  ound_col],..    
+00002670: 2020 2020 2020 2020 2020 2020 6466 5b73              df[s
+00002680: 656c 662e 7269 6768 745f 626f 756e 645f  elf.right_bound_
+00002690: 636f 6c5d 2c0d 0a20 2020 2020 2020 2020  col],..         
+000026a0: 2020 2020 2020 2064 665b 7365 6c66 2e72         df[self.r
+000026b0: 6967 6874 5f62 6f75 6e64 5f63 6f6c 5d0d  ight_bound_col].
+000026c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000026d0: 205d 0d0a 2020 2020 2020 2020 2320 456c   ]..        # El
+000026e0: 7365 2066 6f63 7573 6564 206f 6e20 7468  se focused on th
+000026f0: 6520 6c6f 7765 7374 2070 6f74 656e 7469  e lowest potenti
+00002700: 616c 2072 6573 756c 740d 0a20 2020 2020  al result..     
+00002710: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00002720: 2020 2020 2020 2320 4465 7465 726d 696e        # Determin
+00002730: 6520 7468 6520 6c6f 7765 7220 626f 756e  e the lower boun
+00002740: 640d 0a20 2020 2020 2020 2020 2020 2069  d..            i
+00002750: 6620 7365 6c66 2e69 6e63 6c75 6465 5f6e  f self.include_n
+00002760: 6567 6174 6976 655f 696e 7465 7276 616c  egative_interval
+00002770: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00002780: 2020 206c 6f77 6572 5f62 6f75 6e64 203d     lower_bound =
+00002790: 202d 6e70 2e69 6e66 0d0a 2020 2020 2020   -np.inf..      
+000027a0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000027b0: 2020 2020 2020 2020 2020 2020 206c 6f77               low
+000027c0: 6572 5f62 6f75 6e64 203d 2030 2e30 0d0a  er_bound = 0.0..
+000027d0: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
+000027e0: 7420 6365 6e73 6f72 2061 6e64 206e 756d  t censor and num
+000027f0: 6572 6963 2063 6f6d 706f 6e65 6e74 7320  eric components 
+00002800: 666f 7220 6561 6368 2063 6f6e 6469 7469  for each conditi
+00002810: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+00002820: 636f 6e64 6974 696f 6e73 202b 3d20 5b0d  conditions += [.
+00002830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002840: 2023 2049 6620 7468 6520 6c65 6674 2062   # If the left b
+00002850: 6f75 6e64 2069 7320 6964 656e 7469 6361  ound is identica
+00002860: 6c20 746f 2074 6865 206c 6f77 6572 2062  l to the lower b
+00002870: 6f75 6e64 2c0d 0a20 2020 2020 2020 2020  ound,..         
+00002880: 2020 2020 2020 2023 2074 6865 6e20 7468         # then th
+00002890: 6520 7265 7375 6c74 2069 7320 6c65 6674  e result is left
+000028a0: 2063 656e 736f 7265 640d 0a20 2020 2020   censored..     
+000028b0: 2020 2020 2020 2020 2020 2023 2077 6865             # whe
+000028c0: 7265 2063 6c6f 7365 6420 626f 756e 6461  re closed bounda
+000028d0: 7279 2069 6e64 6963 6174 6573 2070 6f74  ry indicates pot
+000028e0: 656e 7469 616c 2065 7175 616c 6974 790d  ential equality.
+000028f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002900: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+00002910: 2020 2020 2020 2020 2864 665b 7365 6c66          (df[self
+00002920: 2e6c 6566 745f 626f 756e 645f 636f 6c5d  .left_bound_col]
+00002930: 203d 3d20 6c6f 7765 725f 626f 756e 6429   == lower_bound)
+00002940: 2026 200d 0a20 2020 2020 2020 2020 2020   & ..           
+00002950: 2020 2020 2020 2020 2028 6466 5b73 656c           (df[sel
+00002960: 662e 7269 6768 745f 626f 756e 645f 636f  f.right_bound_co
+00002970: 6c5d 203c 206e 702e 696e 6629 2026 200d  l] < np.inf) & .
+00002980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002990: 2020 2020 2028 6466 5b73 656c 662e 7269       (df[self.ri
+000029a0: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
+000029b0: 5d20 3d3d 2027 4f70 656e 2729 0d0a 2020  ] == 'Open')..  
+000029c0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+000029d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000029e0: 2020 280d 0a20 2020 2020 2020 2020 2020    (..           
+000029f0: 2020 2020 2020 2020 2028 6466 5b73 656c           (df[sel
+00002a00: 662e 6c65 6674 5f62 6f75 6e64 5f63 6f6c  f.left_bound_col
+00002a10: 5d20 3d3d 206c 6f77 6572 5f62 6f75 6e64  ] == lower_bound
+00002a20: 2920 2620 0d0a 2020 2020 2020 2020 2020  ) & ..          
+00002a30: 2020 2020 2020 2020 2020 2864 665b 7365            (df[se
+00002a40: 6c66 2e72 6967 6874 5f62 6f75 6e64 5f63  lf.right_bound_c
+00002a50: 6f6c 5d20 3c20 6e70 2e69 6e66 2920 2620  ol] < np.inf) & 
+00002a60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002a70: 2020 2020 2020 2864 665b 7365 6c66 2e72        (df[self.r
+00002a80: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
+00002a90: 6c5d 203d 3d20 2743 6c6f 7365 6427 290d  l] == 'Closed').
+00002aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002ab0: 2029 2c0d 0a20 2020 2020 2020 2020 2020   ),..           
+00002ac0: 2020 2020 2023 204f 7468 6572 7769 7365       # Otherwise
+00002ad0: 2c20 7468 6520 7265 7375 6c74 2069 7320  , the result is 
+00002ae0: 7269 6768 7420 6365 6e73 6f72 6564 0d0a  right censored..
+00002af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b00: 2320 7768 6572 6520 636c 6f73 6564 2062  # where closed b
+00002b10: 6f75 6e64 6172 7920 696e 6469 6361 7465  oundary indicate
+00002b20: 7320 706f 7465 6e74 6961 6c20 6571 7561  s potential equa
+00002b30: 6c69 7479 0d0a 2020 2020 2020 2020 2020  lity..          
+00002b40: 2020 2020 2020 280d 0a20 2020 2020 2020        (..       
+00002b50: 2020 2020 2020 2020 2020 2020 2028 6466               (df
+00002b60: 5b73 656c 662e 6c65 6674 5f62 6f75 6e64  [self.left_bound
+00002b70: 5f63 6f6c 5d20 3e20 6c6f 7765 725f 626f  _col] > lower_bo
+00002b80: 756e 6429 2026 0d0a 2020 2020 2020 2020  und) &..        
+00002b90: 2020 2020 2020 2020 2020 2020 2864 665b              (df[
+00002ba0: 7365 6c66 2e6c 6566 745f 626f 756e 6461  self.left_bounda
+00002bb0: 7279 5f63 6f6c 5d20 3d3d 2027 4f70 656e  ry_col] == 'Open
+00002bc0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+00002bd0: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
+00002be0: 2020 2020 2020 2020 280d 0a20 2020 2020          (..     
+00002bf0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00002c00: 6466 5b73 656c 662e 6c65 6674 5f62 6f75  df[self.left_bou
+00002c10: 6e64 5f63 6f6c 5d20 3e20 6c6f 7765 725f  nd_col] > lower_
+00002c20: 626f 756e 6429 2026 0d0a 2020 2020 2020  bound) &..      
+00002c30: 2020 2020 2020 2020 2020 2020 2020 2864                (d
+00002c40: 665b 7365 6c66 2e6c 6566 745f 626f 756e  f[self.left_boun
+00002c50: 6461 7279 5f63 6f6c 5d20 3d3d 2027 436c  dary_col] == 'Cl
+00002c60: 6f73 6564 2729 0d0a 2020 2020 2020 2020  osed')..        
+00002c70: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00002c80: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
+00002c90: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00002ca0: 2020 2020 2020 2020 6365 6e73 6f72 5f72          censor_r
+00002cb0: 6573 756c 7473 202b 3d20 5b0d 0a20 2020  esults += [..   
+00002cc0: 2020 2020 2020 2020 2020 2020 2027 3c27               '<'
+00002cd0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00002ce0: 2020 2027 e289 a427 2c0d 0a20 2020 2020     '...',..     
+00002cf0: 2020 2020 2020 2020 2020 2027 3e27 2c0d             '>',.
+00002d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002d10: 2027 e289 a527 0d0a 2020 2020 2020 2020   '...'..        
+00002d20: 2020 2020 2020 2020 5d0d 0a20 2020 2020          ]..     
+00002d30: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00002d40: 2020 2020 206e 756d 6572 6963 5f72 6573       numeric_res
+00002d50: 756c 7473 202b 3d20 5b0d 0a20 2020 2020  ults += [..     
+00002d60: 2020 2020 2020 2020 2020 2064 665b 7365             df[se
+00002d70: 6c66 2e72 6967 6874 5f62 6f75 6e64 5f63  lf.right_bound_c
+00002d80: 6f6c 5d2c 0d0a 2020 2020 2020 2020 2020  ol],..          
+00002d90: 2020 2020 2020 6466 5b73 656c 662e 7269        df[self.ri
+00002da0: 6768 745f 626f 756e 645f 636f 6c5d 2c0d  ght_bound_col],.
+00002db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002dc0: 2064 665b 7365 6c66 2e6c 6566 745f 626f   df[self.left_bo
+00002dd0: 756e 645f 636f 6c5d 2c0d 0a20 2020 2020  und_col],..     
+00002de0: 2020 2020 2020 2020 2020 2064 665b 7365             df[se
+00002df0: 6c66 2e6c 6566 745f 626f 756e 645f 636f  lf.left_bound_co
+00002e00: 6c5d 0d0a 2020 2020 2020 2020 2020 2020  l]..            
+00002e10: 2020 2020 5d0d 0a20 2020 2020 2020 200d      ]..        .
+00002e20: 0a20 2020 2020 2020 2023 2044 6574 6572  .        # Deter
+00002e30: 6d69 6e65 2074 6865 2063 656e 736f 7220  mine the censor 
+00002e40: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
+00002e50: 6f6e 656e 7473 0d0a 2020 2020 2020 2020  onents..        
+00002e60: 2320 4966 206e 6f20 636f 6e64 6974 696f  # If no conditio
+00002e70: 6e20 6973 206d 6574 2c20 6465 6661 756c  n is met, defaul
+00002e80: 7420 746f 203c 3e20 616e 6420 4e61 4e0d  t to <> and NaN.
+00002e90: 0a20 2020 2020 2020 2064 665b 7365 6c66  .        df[self
+00002ea0: 2e63 656e 736f 725f 636f 6c5d 203d 206e  .censor_col] = n
+00002eb0: 702e 7365 6c65 6374 2863 6f6e 6469 7469  p.select(conditi
+00002ec0: 6f6e 732c 0d0a 2020 2020 2020 2020 2020  ons,..          
+00002ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ef0: 2020 2020 2063 656e 736f 725f 7265 7375       censor_resu
+00002f00: 6c74 732c 0d0a 2020 2020 2020 2020 2020  lts,..          
+00002f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f30: 2020 2020 2027 3c3e 2729 0d0a 2020 2020       '<>')..    
+00002f40: 2020 2020 6466 5b73 656c 662e 6e75 6d65      df[self.nume
+00002f50: 7269 635f 636f 6c5d 203d 206e 702e 7365  ric_col] = np.se
+00002f60: 6c65 6374 2863 6f6e 6469 7469 6f6e 732c  lect(conditions,
+00002f70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fa0: 2020 6e75 6d65 7269 635f 7265 7375 6c74    numeric_result
+00002fb0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00002fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fe0: 2020 2020 6e70 2e6e 616e 290d 0a20 2020      np.nan)..   
+00002ff0: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+00003000: 2052 6570 6c61 6365 206f 7220 7265 7475   Replace or retu
+00003010: 726e 2072 6573 756c 740d 0a20 2020 2020  rn result..     
+00003020: 2020 2069 6620 696e 706c 6163 653a 0d0a     if inplace:..
+00003030: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00003040: 2e64 6174 6120 3d20 6466 0d0a 2020 2020  .data = df..    
+00003050: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00003060: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
+00003070: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00003080: 6465 6620 7265 7375 6c74 5f66 726f 6d5f  def result_from_
+00003090: 636f 6d70 6f6e 656e 7473 2873 656c 662c  components(self,
+000030a0: 2069 6e70 6c61 6365 203d 2046 616c 7365   inplace = False
+000030b0: 293a 0d0a 2020 2020 2020 2020 0d0a 2020  ):..        ..  
+000030c0: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
+000030d0: 2063 6f70 7920 6f66 2074 6865 2064 6174   copy of the dat
+000030e0: 610d 0a20 2020 2020 2020 2064 6620 3d20  a..        df = 
+000030f0: 7365 6c66 2e64 6174 612e 636f 7079 2829  self.data.copy()
+00003100: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00003110: 2020 2020 2320 436f 6d62 696e 6520 7468      # Combine th
+00003120: 6520 6365 6e73 6f72 2061 6e64 206e 756d  e censor and num
+00003130: 6572 6963 2063 6f6d 706f 6e65 6e74 7320  eric components 
+00003140: 746f 2063 7265 6174 6520 6120 636f 6d62  to create a comb
+00003150: 696e 6564 2072 6573 756c 740d 0a20 2020  ined result..   
+00003160: 2020 2020 2023 2041 7070 6c79 2074 6865       # Apply the
+00003170: 2061 7070 726f 7072 6961 7465 2072 6f75   appropriate rou
+00003180: 6e64 696e 6720 6675 6e63 7469 6f6e 7320  nding functions 
+00003190: 6966 2070 7265 6369 7369 6f6e 5f72 6f75  if precision_rou
+000031a0: 6e64 696e 6720 3d20 5472 7565 0d0a 2020  nding = True..  
+000031b0: 2020 2020 2020 6966 2073 656c 662e 7072        if self.pr
+000031c0: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
+000031d0: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+000031e0: 665b 7365 6c66 2e72 6573 756c 745f 636f  f[self.result_co
+000031f0: 6c5d 203d 2028 0d0a 2020 2020 2020 2020  l] = (..        
+00003200: 2020 2020 2020 2020 6466 5b73 656c 662e          df[self.
+00003210: 6365 6e73 6f72 5f63 6f6c 5d20 2b20 0d0a  censor_col] + ..
+00003220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003230: 6466 5b73 656c 662e 6e75 6d65 7269 635f  df[self.numeric_
+00003240: 636f 6c5d 0d0a 2020 2020 2020 2020 2020  col]..          
+00003250: 2020 2020 2020 2020 2020 2e61 7070 6c79            .apply
+00003260: 2873 7472 696e 675f 7072 6563 6973 696f  (string_precisio
+00003270: 6e2c 2074 686f 7573 616e 6473 5f63 6f6d  n, thousands_com
+00003280: 6d61 203d 2054 7275 6529 0d0a 2020 2020  ma = True)..    
+00003290: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+000032a0: 2020 2020 2020 2020 2020 2064 665b 7365             df[se
+000032b0: 6c66 2e6e 756d 6572 6963 5f63 6f6c 5d20  lf.numeric_col] 
+000032c0: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
+000032d0: 2020 2020 2064 665b 7365 6c66 2e6e 756d       df[self.num
+000032e0: 6572 6963 5f63 6f6c 5d0d 0a20 2020 2020  eric_col]..     
+000032f0: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+00003300: 6170 706c 7928 6e75 6d65 7269 635f 7072  apply(numeric_pr
+00003310: 6563 6973 696f 6e29 0d0a 2020 2020 2020  ecision)..      
+00003320: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00003330: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00003340: 2020 2020 2020 2020 6466 5b73 656c 662e          df[self.
+00003350: 7265 7375 6c74 5f63 6f6c 5d20 3d20 280d  result_col] = (.
+00003360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003370: 2064 665b 7365 6c66 2e63 656e 736f 725f   df[self.censor_
+00003380: 636f 6c5d 202b 200d 0a20 2020 2020 2020  col] + ..       
+00003390: 2020 2020 2020 2020 2064 665b 7365 6c66           df[self
+000033a0: 2e6e 756d 6572 6963 5f63 6f6c 5d2e 6173  .numeric_col].as
+000033b0: 7479 7065 2873 7472 290d 0a20 2020 2020  type(str)..     
+000033c0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+000033d0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000033e0: 2320 5265 706c 6163 6520 6f72 2072 6574  # Replace or ret
+000033f0: 7572 6e20 7265 7375 6c74 0d0a 2020 2020  urn result..    
+00003400: 2020 2020 6966 2069 6e70 6c61 6365 3a0d      if inplace:.
+00003410: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00003420: 662e 6461 7461 203d 2064 660d 0a20 2020  f.data = df..   
+00003430: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00003440: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00003450: 660d 0a20 2020 2020 2020 200d 0a20 2020  f..        ..   
+00003460: 2064 6566 206d 6572 6765 5f63 6f75 6e74   def merge_count
+00003470: 7328 7365 6c66 2c0d 0a20 2020 2020 2020  s(self,..       
+00003480: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00003490: 6174 5f64 6174 612c 0d0a 2020 2020 2020  at_data,..      
+000034a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000034b0: 6f75 6e74 5f63 6f6c 732c 0d0a 2020 2020  ount_cols,..    
+000034c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034d0: 2067 726f 7570 6279 5f63 6f6c 7320 3d20   groupby_cols = 
+000034e0: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+000034f0: 0d0a 2020 2020 2020 2020 2320 4368 6563  ..        # Chec
+00003500: 6b20 7468 6174 2063 6f75 6e74 5f63 6f6c  k that count_col
+00003510: 7320 6973 2061 206c 6973 740d 0a20 2020  s is a list..   
+00003520: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+00003530: 7374 616e 6365 2863 6f75 6e74 5f63 6f6c  stance(count_col
+00003540: 732c 206c 6973 7429 3a0d 0a20 2020 2020  s, list):..     
+00003550: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00003560: 7565 4572 726f 7228 2763 6f75 6e74 5f63  ueError('count_c
+00003570: 6f6c 7320 6d75 7374 2062 6520 6120 6c69  ols must be a li
+00003580: 7374 2e20 270d 0a20 2020 2020 2020 2020  st. '..         
+00003590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035a0: 2020 2020 6627 7b63 6f75 6e74 5f63 6f6c      f'{count_col
+000035b0: 733d 7d20 7761 7320 7061 7373 6564 2e27  s=} was passed.'
+000035c0: 290d 0a20 2020 2020 2020 2023 2043 6865  )..        # Che
+000035d0: 636b 2074 6861 7420 6974 656d 7320 6172  ck that items ar
+000035e0: 6520 616c 6c20 7374 7269 6e67 730d 0a20  e all strings.. 
+000035f0: 2020 2020 2020 2069 6620 6e6f 7420 2861         if not (a
+00003600: 6c6c 2869 7369 6e73 7461 6e63 6528 6e61  ll(isinstance(na
+00003610: 6d65 2c20 7374 7229 2066 6f72 206e 616d  me, str) for nam
+00003620: 6520 696e 2063 6f75 6e74 5f63 6f6c 7329  e in count_cols)
+00003630: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00003640: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00003650: 2827 636f 756e 745f 636f 6c73 206d 7573  ('count_cols mus
+00003660: 7420 6265 2061 206c 6973 7420 6f66 2073  t be a list of s
+00003670: 7472 696e 6773 2e20 270d 0a20 2020 2020  trings. '..     
+00003680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003690: 2020 2020 2020 2020 2020 2020 6627 7b63              f'{c
+000036a0: 6f75 6e74 5f63 6f6c 733d 7d20 7761 7320  ount_cols=} was 
+000036b0: 7061 7373 6564 2e27 290d 0a20 2020 2020  passed.')..     
+000036c0: 2020 2023 2043 6865 636b 2074 6861 7420     # Check that 
+000036d0: 6e61 6d65 7320 6172 6520 756e 6971 7565  names are unique
+000036e0: 0d0a 2020 2020 2020 2020 6966 2028 6c65  ..        if (le
+000036f0: 6e28 636f 756e 745f 636f 6c73 2920 213d  n(count_cols) !=
+00003700: 206c 656e 2873 6574 2863 6f75 6e74 5f63   len(set(count_c
+00003710: 6f6c 7329 2929 3a0d 0a20 2020 2020 2020  ols))):..       
+00003720: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00003730: 4572 726f 7228 2763 6f75 6e74 5f63 6f6c  Error('count_col
+00003740: 7320 6d75 7374 2063 6f6e 7461 696e 2075  s must contain u
+00003750: 6e69 7175 6520 7374 7269 6e67 732e 2027  nique strings. '
+00003760: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003770: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00003780: 277b 636f 756e 745f 636f 6c73 3d7d 2077  '{count_cols=} w
+00003790: 6173 2070 6173 7365 642e 2729 0d0a 2020  as passed.')..  
+000037a0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000037b0: 2320 4372 6561 7465 2061 2063 6f70 7920  # Create a copy 
+000037c0: 6f66 2074 6865 2064 6174 610d 0a20 2020  of the data..   
+000037d0: 2020 2020 2064 6620 3d20 7365 6c66 2e64       df = self.d
+000037e0: 6174 612e 636f 7079 2829 0d0a 2020 2020  ata.copy()..    
+000037f0: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+00003800: 4966 2067 726f 7570 6279 5f63 6f6c 7320  If groupby_cols 
+00003810: 6973 204e 6f6e 650d 0a20 2020 2020 2020  is None..       
+00003820: 2069 6620 6772 6f75 7062 795f 636f 6c73   if groupby_cols
+00003830: 203d 3d20 4e6f 6e65 3a0d 0a20 2020 2020   == None:..     
+00003840: 2020 2020 2020 2023 2043 6865 636b 2074         # Check t
+00003850: 6861 7420 7369 6e67 6c65 2063 6f75 6e74  hat single count
+00003860: 5f63 6f6c 2070 726f 7669 6465 640d 0a20  _col provided.. 
+00003870: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00003880: 6e28 636f 756e 745f 636f 6c73 2920 213d  n(count_cols) !=
+00003890: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
+000038a0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000038b0: 4572 726f 7228 2741 2073 696e 676c 6520  Error('A single 
+000038c0: 636f 6c75 6d6e 206e 616d 6520 7368 6f75  column name shou
+000038d0: 6c64 2062 6520 7072 6f76 6964 6564 2061  ld be provided a
+000038e0: 7320 270d 0a20 2020 2020 2020 2020 2020  s '..           
+000038f0: 2020 2020 2020 2020 2027 6120 6c69 7374           'a list
+00003900: 2077 6865 6e20 6772 6f75 7062 795f 636f   when groupby_co
+00003910: 6c73 2069 7320 6e6f 7420 7072 6f76 6964  ls is not provid
+00003920: 6564 2061 7320 616e 2069 6e70 7574 2e20  ed as an input. 
+00003930: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+00003940: 2020 2020 2020 2066 277b 636f 756e 745f         f'{count_
+00003950: 636f 6c73 3d7d 2077 6173 2070 6173 7365  cols=} was passe
+00003960: 642e 2729 0d0a 2020 2020 2020 2020 2020  d.')..          
+00003970: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00003980: 2020 2020 2020 2020 2023 204f 7574 7075           # Outpu
+00003990: 7420 6c65 6e67 7468 206f 6620 6461 7461  t length of data
+000039a0: 2061 7320 636f 756e 7420 696e 2073 7461   as count in sta
+000039b0: 745f 6461 7461 0d0a 2020 2020 2020 2020  t_data..        
+000039c0: 2020 2020 2020 2020 7374 6174 5f64 6174          stat_dat
+000039d0: 615b 636f 756e 745f 636f 6c73 5b30 5d5d  a[count_cols[0]]
+000039e0: 203d 206c 656e 2864 6629 0d0a 2020 2020   = len(df)..    
+000039f0: 2020 2020 2320 4966 2067 726f 7570 6279      # If groupby
+00003a00: 5f63 6f6c 7320 6973 206c 6973 7420 6f66  _cols is list of
+00003a10: 2073 7472 696e 6773 2c0d 0a20 2020 2020   strings,..     
+00003a20: 2020 2065 6c69 6620 2861 6c6c 2869 7369     elif (all(isi
+00003a30: 6e73 7461 6e63 6528 6e61 6d65 2c20 7374  nstance(name, st
+00003a40: 7229 2066 6f72 206e 616d 6520 696e 2067  r) for name in g
+00003a50: 726f 7570 6279 5f63 6f6c 7329 293a 0d0a  roupby_cols)):..
+00003a60: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
+00003a70: 6563 6b20 7468 6174 2073 696e 676c 6520  eck that single 
+00003a80: 636f 756e 745f 636f 6c20 7072 6f76 6964  count_col provid
+00003a90: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
+00003aa0: 6966 206c 656e 2863 6f75 6e74 5f63 6f6c  if len(count_col
+00003ab0: 7329 2021 3d20 313a 0d0a 2020 2020 2020  s) != 1:..      
+00003ac0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00003ad0: 5661 6c75 6545 7272 6f72 2827 4120 7369  ValueError('A si
+00003ae0: 6e67 6c65 2063 6f6c 756d 6e20 6e61 6d65  ngle column name
+00003af0: 2073 686f 756c 6420 6265 2070 726f 7669   should be provi
+00003b00: 6465 6420 6173 2027 0d0a 2020 2020 2020  ded as '..      
+00003b10: 2020 2020 2020 2020 2020 2020 2020 2761                'a
+00003b20: 206c 6973 7420 7768 656e 2067 726f 7570   list when group
+00003b30: 6279 5f63 6f6c 7320 6973 206e 6f74 2070  by_cols is not p
+00003b40: 726f 7669 6465 6420 6173 2061 6e20 696e  rovided as an in
+00003b50: 7075 742e 2027 0d0a 2020 2020 2020 2020  put. '..        
+00003b60: 2020 2020 2020 2020 2020 2020 6627 7b63              f'{c
+00003b70: 6f75 6e74 5f63 6f6c 733d 7d20 7761 7320  ount_cols=} was 
+00003b80: 7061 7373 6564 2e27 290d 0a20 2020 2020  passed.')..     
+00003b90: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00003ba0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00003bb0: 4f75 7470 7574 2073 697a 6520 6f66 2067  Output size of g
+00003bc0: 726f 7570 730d 0a20 2020 2020 2020 2020  roups..         
+00003bd0: 2020 2020 2020 2064 6620 3d20 2864 662e         df = (df.
+00003be0: 6772 6f75 7062 7928 6772 6f75 7062 795f  groupby(groupby_
+00003bf0: 636f 6c73 290d 0a20 2020 2020 2020 2020  cols)..         
+00003c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c10: 2020 2020 202e 7369 7a65 2829 0d0a 2020       .size()..  
+00003c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c30: 2020 2020 2020 2020 2020 2020 2e72 656e              .ren
+00003c40: 616d 6528 636f 6c75 6d6e 733d 7b27 7369  ame(columns={'si
+00003c50: 7a65 273a 2063 6f75 6e74 5f63 6f6c 735b  ze': count_cols[
+00003c60: 305d 7d29 0d0a 2020 2020 2020 2020 2020  0]})..          
+00003c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c80: 2020 2020 2e72 6573 6574 5f69 6e64 6578      .reset_index
+00003c90: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
+00003ca0: 2020 2020 2023 204d 6572 6765 2063 6f75       # Merge cou
+00003cb0: 6e74 2069 6e66 6f20 746f 2073 7461 7420  nt info to stat 
+00003cc0: 6461 7461 0d0a 2020 2020 2020 2020 2020  data..          
+00003cd0: 2020 2020 2020 7374 6174 5f64 6174 6120        stat_data 
+00003ce0: 3d20 7374 6174 5f64 6174 612e 6d65 7267  = stat_data.merg
+00003cf0: 6528 6466 2c0d 0a20 2020 2020 2020 2020  e(df,..         
+00003d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d20: 2020 2068 6f77 3d27 6f75 7465 7227 2c0d     how='outer',.
+00003d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d50: 2020 2020 2020 2020 2020 2020 206f 6e3d               on=
+00003d60: 6772 6f75 7062 795f 636f 6c73 290d 0a20  groupby_cols).. 
+00003d70: 2020 2020 2020 2023 2045 6c73 6520 6772         # Else gr
+00003d80: 6f75 7062 795f 636f 6c73 2069 7320 6c69  oupby_cols is li
+00003d90: 7374 206f 6620 6c69 7374 730d 0a20 2020  st of lists..   
+00003da0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00003db0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+00003dc0: 7468 6520 6c69 7374 206c 656e 6774 6873  the list lengths
+00003dd0: 2061 7265 2069 6465 6e74 6963 616c 0d0a   are identical..
+00003de0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00003df0: 6c65 6e28 636f 756e 745f 636f 6c73 2920  len(count_cols) 
+00003e00: 213d 206c 656e 2867 726f 7570 6279 5f63  != len(groupby_c
+00003e10: 6f6c 7329 293a 0d0a 2020 2020 2020 2020  ols)):..        
+00003e20: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00003e30: 6c75 6545 7272 6f72 2827 636f 756e 745f  lueError('count_
+00003e40: 636f 6c73 206d 7573 7420 6861 7665 2074  cols must have t
+00003e50: 6865 2073 616d 6520 6e75 6d62 6572 206f  he same number o
+00003e60: 6620 270d 0a20 2020 2020 2020 2020 2020  f '..           
+00003e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e80: 2020 2020 2020 2763 6f6c 756d 6e20 6e61        'column na
+00003e90: 6d65 7320 6173 2074 6865 7265 2061 7265  mes as there are
+00003ea0: 2067 726f 7570 696e 6720 6c69 7374 7320   grouping lists 
+00003eb0: 696e 2027 0d0a 2020 2020 2020 2020 2020  in '..          
+00003ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ed0: 2020 2020 2020 2027 6772 6f75 7062 795f         'groupby_
+00003ee0: 636f 6c73 2e27 290d 0a20 2020 2020 2020  cols.')..       
+00003ef0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00003f00: 2020 2020 2020 2020 2020 2020 2320 4c6f              # Lo
+00003f10: 6f70 2074 6872 6f75 6768 206c 6973 7420  op through list 
+00003f20: 6f66 2067 726f 7570 696e 6773 2061 6e64  of groupings and
+00003f30: 2073 756d 2063 6f75 6e74 730d 0a20 2020   sum counts..   
+00003f40: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00003f50: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
+00003f60: 6772 6f75 7062 795f 636f 6c73 2929 3a0d  groupby_cols)):.
+00003f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003f80: 2020 2020 2064 665b 636f 756e 745f 636f       df[count_co
+00003f90: 6c73 5b69 5d5d 203d 2031 0d0a 2020 2020  ls[i]] = 1..    
+00003fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003fb0: 6466 203d 2028 6466 2e67 726f 7570 6279  df = (df.groupby
+00003fc0: 2867 726f 7570 6279 5f63 6f6c 735b 695d  (groupby_cols[i]
+00003fd0: 295b 636f 756e 745f 636f 6c73 5b3a 692b  )[count_cols[:i+
+00003fe0: 315d 5d0d 0a20 2020 2020 2020 2020 2020  1]]..           
+00003ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004000: 2020 202e 7375 6d28 290d 0a20 2020 2020     .sum()..     
+00004010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004020: 2020 2020 2020 2020 202e 7265 7365 745f           .reset_
+00004030: 696e 6465 7828 2929 0d0a 2020 2020 2020  index())..      
+00004040: 2020 2020 2020 2020 2020 2320 4d65 7267            # Merg
+00004050: 6520 636f 756e 7420 696e 666f 2074 6f20  e count info to 
+00004060: 7374 6174 2064 6174 6120 7573 696e 6720  stat data using 
+00004070: 6c61 7374 2067 726f 7570 696e 670d 0a20  last grouping.. 
+00004080: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00004090: 7461 745f 6461 7461 203d 2073 7461 745f  tat_data = stat_
+000040a0: 6461 7461 2e6d 6572 6765 2864 662c 0d0a  data.merge(df,..
+000040b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000040c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000040d0: 2020 2020 2020 2020 2020 2020 686f 773d              how=
+000040e0: 276f 7574 6572 272c 0d0a 2020 2020 2020  'outer',..      
+000040f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004110: 2020 2020 2020 6f6e 3d67 726f 7570 6279        on=groupby
+00004120: 5f63 6f6c 735b 2d31 5d29 0d0a 2020 2020  _cols[-1])..    
+00004130: 2020 2020 7265 7475 726e 2073 7461 745f      return stat_
+00004140: 6461 7461 0d0a 2020 2020 2020 2020 0d0a  data..        ..
+00004150: 2020 2020 2020 2020 0d0a 2020 2020 2325          ..    #%
+00004160: 2520 5374 6174 6973 7469 6320 696e 7465  % Statistic inte
+00004170: 7276 616c 206d 6574 686f 6473 0d0a 2020  rval methods..  
+00004180: 2020 0d0a 2020 2020 6465 6620 6d61 7869    ..    def maxi
+00004190: 6d75 6d5f 696e 7465 7276 616c 2873 656c  mum_interval(sel
+000041a0: 662c 2067 726f 7570 6279 5f63 6f6c 732c  f, groupby_cols,
+000041b0: 2069 6e70 6c61 6365 203d 2046 616c 7365   inplace = False
+000041c0: 293a 0d0a 2020 2020 2020 2020 0d0a 2020  ):..        ..  
+000041d0: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
+000041e0: 2063 6f70 7920 6f66 2074 6865 2064 6174   copy of the dat
+000041f0: 610d 0a20 2020 2020 2020 2064 6620 3d20  a..        df = 
+00004200: 7365 6c66 2e64 6174 612e 636f 7079 2829  self.data.copy()
+00004210: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00004220: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
+00004230: 6c65 6674 2062 6f75 6e64 2061 6e64 2062  left bound and b
+00004240: 6f75 6e64 6172 7920 666f 7220 6d61 7869  oundary for maxi
+00004250: 6d75 6d20 6f66 2065 6163 6820 6772 6f75  mum of each grou
+00004260: 702e 0d0a 2020 2020 2020 2020 0d0a 2020  p...        ..  
+00004270: 2020 2020 2020 2320 4465 7465 726d 696e        # Determin
+00004280: 6520 7768 6574 6865 7220 7468 6520 6c61  e whether the la
+00004290: 7267 6573 7420 6c65 6674 2062 6f75 6e64  rgest left bound
+000042a0: 2069 7320 6f70 656e 206f 7220 636c 6f73   is open or clos
+000042b0: 6564 2062 790d 0a20 2020 2020 2020 2023  ed by..        #
+000042c0: 2063 6f6d 7061 7269 6e67 2074 6865 206c   comparing the l
+000042d0: 6172 6765 7374 206f 7065 6e20 616e 6420  argest open and 
+000042e0: 6c61 7267 6573 7420 636c 6f73 6564 2062  largest closed b
+000042f0: 6f75 6e64 0d0a 2020 2020 2020 2020 6c65  ound..        le
+00004300: 6674 203d 2028 0d0a 2020 2020 2020 2020  ft = (..        
+00004310: 2020 2020 6466 2e67 726f 7570 6279 2867      df.groupby(g
+00004320: 726f 7570 6279 5f63 6f6c 7320 2b20 5b73  roupby_cols + [s
+00004330: 656c 662e 6c65 6674 5f62 6f75 6e64 6172  elf.left_boundar
+00004340: 795f 636f 6c5d 290d 0a20 2020 2020 2020  y_col])..       
+00004350: 2020 2020 2020 2020 205b 7365 6c66 2e6c           [self.l
+00004360: 6566 745f 626f 756e 645f 636f 6c5d 0d0a  eft_bound_col]..
+00004370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004380: 2e6d 6178 2829 0d0a 2020 2020 2020 2020  .max()..        
+00004390: 2020 2020 2020 2020 2e75 6e73 7461 636b          .unstack
+000043a0: 2873 656c 662e 6c65 6674 5f62 6f75 6e64  (self.left_bound
+000043b0: 6172 795f 636f 6c29 0d0a 2020 2020 2020  ary_col)..      
+000043c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000043d0: 2023 2045 6e73 7572 6520 626f 7468 2062   # Ensure both b
+000043e0: 6f75 6e64 6172 7920 7479 7065 7320 6578  oundary types ex
+000043f0: 6973 740d 0a20 2020 2020 2020 2066 6f72  ist..        for
+00004400: 2069 7465 6d20 696e 205b 274f 7065 6e27   item in ['Open'
+00004410: 2c27 436c 6f73 6564 275d 3a0d 0a20 2020  ,'Closed']:..   
+00004420: 2020 2020 2020 2020 2069 6620 6974 656d           if item
+00004430: 206e 6f74 2069 6e20 6c65 6674 2e63 6f6c   not in left.col
+00004440: 756d 6e73 3a0d 0a20 2020 2020 2020 2020  umns:..         
+00004450: 2020 2020 2020 206c 6566 745b 6974 656d         left[item
+00004460: 5d20 3d20 6e70 2e6e 616e 0d0a 2020 2020  ] = np.nan..    
+00004470: 2020 2020 2320 5573 6520 7468 6520 6d61      # Use the ma
+00004480: 7869 6d75 6d20 636c 6f73 6564 2062 6f75  ximum closed bou
+00004490: 6e64 6172 7920 6966 2074 6865 7265 2061  ndary if there a
+000044a0: 7265 206e 6f20 6f70 656e 2062 6f75 6e64  re no open bound
+000044b0: 6172 6965 7320 6f72 0d0a 2020 2020 2020  aries or..      
+000044c0: 2020 2320 6966 2074 6865 2063 6c6f 7365    # if the close
+000044d0: 6420 626f 756e 6461 7279 2069 7320 6c61  d boundary is la
+000044e0: 7267 6572 2074 6861 6e20 7468 6520 6c61  rger than the la
+000044f0: 7267 6573 7420 6f70 656e 2062 6f75 6e64  rgest open bound
+00004500: 6172 790d 0a20 2020 2020 2020 2063 6f6e  ary..        con
+00004510: 6469 7469 6f6e 203d 2028 6c65 6674 5b27  dition = (left['
+00004520: 436c 6f73 6564 275d 203e 206c 6566 745b  Closed'] > left[
+00004530: 274f 7065 6e27 5d29 207c 2028 6c65 6674  'Open']) | (left
+00004540: 5b27 4f70 656e 275d 2e69 736e 6128 2929  ['Open'].isna())
+00004550: 0d0a 2020 2020 2020 2020 6c65 6674 5b73  ..        left[s
+00004560: 656c 662e 6c65 6674 5f62 6f75 6e64 6172  elf.left_boundar
+00004570: 795f 636f 6c5d 203d 2028 0d0a 2020 2020  y_col] = (..    
+00004580: 2020 2020 2020 2020 6e70 2e77 6865 7265          np.where
+00004590: 2863 6f6e 6469 7469 6f6e 2c0d 0a20 2020  (condition,..   
+000045a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045b0: 2020 2743 6c6f 7365 6427 2c0d 0a20 2020    'Closed',..   
+000045c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045d0: 2020 274f 7065 6e27 0d0a 2020 2020 2020    'Open'..      
+000045e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000045f0: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
+00004600: 0a20 2020 2020 2020 206c 6566 745b 7365  .        left[se
+00004610: 6c66 2e6c 6566 745f 626f 756e 645f 636f  lf.left_bound_co
+00004620: 6c5d 203d 2028 0d0a 2020 2020 2020 2020  l] = (..        
+00004630: 2020 2020 6e70 2e77 6865 7265 2863 6f6e      np.where(con
+00004640: 6469 7469 6f6e 2c0d 0a20 2020 2020 2020  dition,..       
+00004650: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+00004660: 6674 5b27 436c 6f73 6564 275d 2c0d 0a20  ft['Closed'],.. 
+00004670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004680: 2020 2020 6c65 6674 5b27 4f70 656e 275d      left['Open']
+00004690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000046a0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000046b0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000046c0: 206c 6566 7420 3d20 6c65 6674 5b5b 7365   left = left[[se
+000046d0: 6c66 2e6c 6566 745f 626f 756e 6461 7279  lf.left_boundary
+000046e0: 5f63 6f6c 2c20 7365 6c66 2e6c 6566 745f  _col, self.left_
+000046f0: 626f 756e 645f 636f 6c5d 5d0d 0a20 2020  bound_col]]..   
+00004700: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+00004710: 2044 6574 6572 6d69 6e65 2072 6967 6874   Determine right
+00004720: 2062 6f75 6e64 2061 6e64 2062 6f75 6e64   bound and bound
+00004730: 6172 7920 666f 7220 6d61 7869 6d75 6d20  ary for maximum 
+00004740: 6f66 2065 6163 6820 6772 6f75 702e 0d0a  of each group...
+00004750: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00004760: 2020 0d0a 2020 2020 2020 2020 2320 4465    ..        # De
+00004770: 7465 726d 696e 6520 7768 6574 6865 7220  termine whether 
+00004780: 7468 6520 6c61 7267 6573 7420 7269 6768  the largest righ
+00004790: 7420 626f 756e 6420 6973 206f 7065 6e20  t bound is open 
+000047a0: 6f72 2063 6c6f 7365 6420 6279 0d0a 2020  or closed by..  
+000047b0: 2020 2020 2020 2320 636f 6d70 6172 696e        # comparin
+000047c0: 6720 7468 6520 6c61 7267 6573 7420 6f70  g the largest op
+000047d0: 656e 2061 6e64 206c 6172 6765 7374 2063  en and largest c
+000047e0: 6c6f 7365 6420 626f 756e 640d 0a20 2020  losed bound..   
+000047f0: 2020 2020 2072 6967 6874 203d 2028 0d0a       right = (..
+00004800: 2020 2020 2020 2020 2020 2020 6466 2e67              df.g
+00004810: 726f 7570 6279 2867 726f 7570 6279 5f63  roupby(groupby_c
+00004820: 6f6c 7320 2b20 5b73 656c 662e 7269 6768  ols + [self.righ
+00004830: 745f 626f 756e 6461 7279 5f63 6f6c 5d29  t_boundary_col])
+00004840: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004850: 2020 5b73 656c 662e 7269 6768 745f 626f    [self.right_bo
+00004860: 756e 645f 636f 6c5d 0d0a 2020 2020 2020  und_col]..      
+00004870: 2020 2020 2020 2020 2020 2e6d 6178 2829            .max()
+00004880: 2e0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00004890: 2020 2075 6e73 7461 636b 2873 656c 662e     unstack(self.
+000048a0: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
+000048b0: 6f6c 290d 0a20 2020 2020 2020 2020 2020  ol)..           
+000048c0: 2029 0d0a 2020 2020 2020 2020 2320 456e   )..        # En
+000048d0: 7375 7265 2062 6f74 6820 626f 756e 6461  sure both bounda
+000048e0: 7279 2074 7970 6573 2065 7869 7374 0d0a  ry types exist..
+000048f0: 2020 2020 2020 2020 666f 7220 6974 656d          for item
+00004900: 2069 6e20 5b27 4f70 656e 272c 2743 6c6f   in ['Open','Clo
+00004910: 7365 6427 5d3a 0d0a 2020 2020 2020 2020  sed']:..        
+00004920: 2020 2020 6966 2069 7465 6d20 6e6f 7420      if item not 
+00004930: 696e 2072 6967 6874 2e63 6f6c 756d 6e73  in right.columns
+00004940: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00004950: 2020 2072 6967 6874 5b69 7465 6d5d 203d     right[item] =
+00004960: 206e 702e 6e61 6e0d 0a20 2020 2020 2020   np.nan..       
+00004970: 2023 2055 7365 2074 6865 206d 6178 696d   # Use the maxim
+00004980: 756d 2063 6c6f 7365 6420 626f 756e 6461  um closed bounda
+00004990: 7279 2069 6620 7468 6572 6520 6172 6520  ry if there are 
+000049a0: 6e6f 206f 7065 6e20 626f 756e 6461 7269  no open boundari
+000049b0: 6573 206f 720d 0a20 2020 2020 2020 2023  es or..        #
+000049c0: 2069 6620 7468 6520 636c 6f73 6564 2062   if the closed b
+000049d0: 6f75 6e64 6172 7920 6973 206c 6172 6765  oundary is large
+000049e0: 7220 7468 616e 206f 7220 6571 7561 6c20  r than or equal 
+000049f0: 746f 2074 6865 206c 6172 6765 7374 200d  to the largest .
+00004a00: 0a20 2020 2020 2020 2023 206f 7065 6e20  .        # open 
+00004a10: 626f 756e 6461 7279 0d0a 2020 2020 2020  boundary..      
+00004a20: 2020 636f 6e64 6974 696f 6e20 3d20 2872    condition = (r
+00004a30: 6967 6874 5b27 436c 6f73 6564 275d 203e  ight['Closed'] >
+00004a40: 3d20 7269 6768 745b 274f 7065 6e27 5d29  = right['Open'])
+00004a50: 207c 2028 7269 6768 745b 274f 7065 6e27   | (right['Open'
+00004a60: 5d2e 6973 6e61 2829 290d 0a20 2020 2020  ].isna())..     
+00004a70: 2020 2072 6967 6874 5b73 656c 662e 7269     right[self.ri
+00004a80: 6768 745f 626f 756e 645f 636f 6c5d 203d  ght_bound_col] =
+00004a90: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+00004aa0: 6e70 2e77 6865 7265 2863 6f6e 6469 7469  np.where(conditi
+00004ab0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+00004ac0: 2020 2020 2020 2020 2020 7269 6768 745b            right[
+00004ad0: 2743 6c6f 7365 6427 5d2c 0d0a 2020 2020  'Closed'],..    
+00004ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004af0: 2072 6967 6874 5b27 4f70 656e 275d 0d0a   right['Open']..
+00004b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b10: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00004b20: 2020 2020 290d 0a20 2020 2020 2020 2072      )..        r
+00004b30: 6967 6874 5b73 656c 662e 7269 6768 745f  ight[self.right_
+00004b40: 626f 756e 6461 7279 5f63 6f6c 5d20 3d20  boundary_col] = 
+00004b50: 280d 0a20 2020 2020 2020 2020 2020 206e  (..            n
+00004b60: 702e 7768 6572 6528 636f 6e64 6974 696f  p.where(conditio
+00004b70: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00004b80: 2020 2020 2020 2020 2027 436c 6f73 6564           'Closed
+00004b90: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00004ba0: 2020 2020 2020 2020 2027 4f70 656e 270d           'Open'.
+00004bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004bc0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00004bd0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00004be0: 7269 6768 7420 3d20 7269 6768 745b 5b73  right = right[[s
+00004bf0: 656c 662e 7269 6768 745f 626f 756e 645f  elf.right_bound_
+00004c00: 636f 6c2c 2073 656c 662e 7269 6768 745f  col, self.right_
+00004c10: 626f 756e 6461 7279 5f63 6f6c 5d5d 0d0a  boundary_col]]..
+00004c20: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00004c30: 2020 2320 4d65 7267 6520 7468 6520 7477    # Merge the tw
+00004c40: 6f20 626f 756e 6461 7269 6573 2074 6f20  o boundaries to 
+00004c50: 6372 6561 7465 2074 6865 2069 6e74 6572  create the inter
+00004c60: 7661 6c20 666f 7220 7468 6520 6d61 7869  val for the maxi
+00004c70: 6d75 6d0d 0a20 2020 2020 2020 2023 2043  mum..        # C
+00004c80: 6865 636b 2074 6861 7420 7468 6520 6d65  heck that the me
+00004c90: 7267 6520 6973 2031 2d74 6f2d 310d 0a20  rge is 1-to-1.. 
+00004ca0: 2020 2020 2020 2064 6620 3d20 6c65 6674         df = left
+00004cb0: 2e6d 6572 6765 2872 6967 6874 2c0d 0a20  .merge(right,.. 
+00004cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cd0: 2020 2020 2020 2068 6f77 203d 2027 6f75         how = 'ou
+00004ce0: 7465 7227 2c0d 0a20 2020 2020 2020 2020  ter',..         
+00004cf0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00004d00: 6e20 3d20 6772 6f75 7062 795f 636f 6c73  n = groupby_cols
+00004d10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00004d20: 2020 2020 2020 2020 2020 2076 616c 6964             valid
+00004d30: 6174 6520 3d20 2731 3a31 2729 0d0a 2020  ate = '1:1')..  
+00004d40: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00004d50: 2320 4372 6561 7465 2061 2063 6f6c 756d  # Create a colum
+00004d60: 6e20 7468 6174 2069 6e64 6963 6174 6573  n that indicates
+00004d70: 2074 6865 2067 656e 6572 6174 6564 2073   the generated s
+00004d80: 7461 7469 7374 6963 0d0a 2020 2020 2020  tatistic..      
+00004d90: 2020 6466 5b73 656c 662e 7374 6174 5f63    df[self.stat_c
+00004da0: 6f6c 5d20 3d20 274d 6178 696d 756d 270d  ol] = 'Maximum'.
+00004db0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00004dc0: 2020 2023 2052 656f 7264 6572 2063 6f6c     # Reorder col
+00004dd0: 756d 6e73 0d0a 2020 2020 2020 2020 6466  umns..        df
+00004de0: 203d 2064 665b 5b73 656c 662e 7374 6174   = df[[self.stat
+00004df0: 5f63 6f6c 2c0d 0a20 2020 2020 2020 2020  _col,..         
+00004e00: 2020 2020 2020 2020 7365 6c66 2e6c 6566          self.lef
+00004e10: 745f 626f 756e 6461 7279 5f63 6f6c 2c0d  t_boundary_col,.
+00004e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004e30: 2020 7365 6c66 2e6c 6566 745f 626f 756e    self.left_boun
+00004e40: 645f 636f 6c2c 0d0a 2020 2020 2020 2020  d_col,..        
+00004e50: 2020 2020 2020 2020 2073 656c 662e 7269           self.ri
+00004e60: 6768 745f 626f 756e 645f 636f 6c2c 0d0a  ght_bound_col,..
+00004e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e80: 2073 656c 662e 7269 6768 745f 626f 756e   self.right_boun
+00004e90: 6461 7279 5f63 6f6c 0d0a 2020 2020 2020  dary_col..      
+00004ea0: 2020 2020 2020 2020 2020 205d 5d0d 0a20             ]].. 
+00004eb0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00004ec0: 2023 2052 6573 6574 2069 6e64 6578 0d0a   # Reset index..
+00004ed0: 2020 2020 2020 2020 6466 203d 2064 662e          df = df.
+00004ee0: 7265 7365 745f 696e 6465 7828 290d 0a20  reset_index().. 
+00004ef0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00004f00: 2023 2052 6570 6c61 6365 206f 7220 7265   # Replace or re
+00004f10: 7475 726e 2072 6573 756c 740d 0a20 2020  turn result..   
+00004f20: 2020 2020 2069 6620 696e 706c 6163 653a       if inplace:
+00004f30: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00004f40: 6c66 2e64 6174 6120 3d20 6466 0d0a 2020  lf.data = df..  
+00004f50: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00004f60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00004f70: 6466 0d0a 2020 2020 0d0a 2020 2020 6465  df..    ..    de
+00004f80: 6620 6d69 6e69 6d75 6d5f 696e 7465 7276  f minimum_interv
+00004f90: 616c 2873 656c 662c 2067 726f 7570 6279  al(self, groupby
+00004fa0: 5f63 6f6c 732c 2069 6e70 6c61 6365 203d  _cols, inplace =
+00004fb0: 2046 616c 7365 293a 0d0a 2020 2020 2020   False):..      
+00004fc0: 2020 0d0a 2020 2020 2020 2020 2320 4372    ..        # Cr
+00004fd0: 6561 7465 2061 2063 6f70 7920 6f66 2074  eate a copy of t
+00004fe0: 6865 2064 6174 610d 0a20 2020 2020 2020  he data..       
+00004ff0: 2064 6620 3d20 7365 6c66 2e64 6174 612e   df = self.data.
+00005000: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
+00005010: 0d0a 2020 2020 2020 2020 2320 4465 7465  ..        # Dete
+00005020: 726d 696e 6520 6c65 6674 2062 6f75 6e64  rmine left bound
+00005030: 2061 6e64 2062 6f75 6e64 6172 7920 666f   and boundary fo
+00005040: 7220 6d69 6e69 6d75 6d20 6f66 2065 6163  r minimum of eac
+00005050: 6820 6772 6f75 702e 0d0a 2020 2020 2020  h group...      
+00005060: 2020 0d0a 2020 2020 2020 2020 2320 4465    ..        # De
+00005070: 7465 726d 696e 6520 7768 6574 6865 7220  termine whether 
+00005080: 7468 6520 6c65 6173 7420 6c65 6674 2062  the least left b
+00005090: 6f75 6e64 2069 7320 6f70 656e 206f 7220  ound is open or 
+000050a0: 636c 6f73 6564 2062 790d 0a20 2020 2020  closed by..     
+000050b0: 2020 2023 2063 6f6d 7061 7269 6e67 2074     # comparing t
+000050c0: 6865 206c 6561 7374 206f 7065 6e20 616e  he least open an
+000050d0: 6420 6c65 6173 7420 636c 6f73 6564 2062  d least closed b
+000050e0: 6f75 6e64 0d0a 2020 2020 2020 2020 6c65  ound..        le
+000050f0: 6674 203d 2028 0d0a 2020 2020 2020 2020  ft = (..        
+00005100: 2020 2020 6466 2e67 726f 7570 6279 2867      df.groupby(g
+00005110: 726f 7570 6279 5f63 6f6c 7320 2b20 5b73  roupby_cols + [s
+00005120: 656c 662e 6c65 6674 5f62 6f75 6e64 6172  elf.left_boundar
+00005130: 795f 636f 6c5d 290d 0a20 2020 2020 2020  y_col])..       
+00005140: 2020 2020 2020 2020 205b 7365 6c66 2e6c           [self.l
+00005150: 6566 745f 626f 756e 645f 636f 6c5d 0d0a  eft_bound_col]..
+00005160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005170: 2e6d 696e 2829 0d0a 2020 2020 2020 2020  .min()..        
+00005180: 2020 2020 2020 2020 2e75 6e73 7461 636b          .unstack
+00005190: 2873 656c 662e 6c65 6674 5f62 6f75 6e64  (self.left_bound
+000051a0: 6172 795f 636f 6c29 0d0a 2020 2020 2020  ary_col)..      
+000051b0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000051c0: 2023 2045 6e73 7572 6520 626f 7468 2062   # Ensure both b
+000051d0: 6f75 6e64 6172 7920 7479 7065 7320 6578  oundary types ex
+000051e0: 6973 740d 0a20 2020 2020 2020 2066 6f72  ist..        for
+000051f0: 2069 7465 6d20 696e 205b 274f 7065 6e27   item in ['Open'
+00005200: 2c27 436c 6f73 6564 275d 3a0d 0a20 2020  ,'Closed']:..   
+00005210: 2020 2020 2020 2020 2069 6620 6974 656d           if item
+00005220: 206e 6f74 2069 6e20 6c65 6674 2e63 6f6c   not in left.col
+00005230: 756d 6e73 3a0d 0a20 2020 2020 2020 2020  umns:..         
+00005240: 2020 2020 2020 206c 6566 745b 6974 656d         left[item
+00005250: 5d20 3d20 6e70 2e6e 616e 0d0a 2020 2020  ] = np.nan..    
+00005260: 2020 2020 2320 5573 6520 7468 6520 6d69      # Use the mi
+00005270: 6e69 6d75 6d20 636c 6f73 6564 2062 6f75  nimum closed bou
+00005280: 6e64 6172 7920 6966 2074 6865 7265 2061  ndary if there a
+00005290: 7265 206e 6f20 6f70 656e 2062 6f75 6e64  re no open bound
+000052a0: 6172 6965 7320 6f72 0d0a 2020 2020 2020  aries or..      
+000052b0: 2020 2320 6966 2074 6865 2063 6c6f 7365    # if the close
+000052c0: 6420 626f 756e 6461 7279 2069 7320 6c65  d boundary is le
+000052d0: 7373 2074 6861 6e20 6f72 2065 7175 616c  ss than or equal
+000052e0: 2074 6f20 7468 6520 6c65 6173 740d 0a20   to the least.. 
+000052f0: 2020 2020 2020 2023 206f 7065 6e20 626f         # open bo
+00005300: 756e 6461 7279 0d0a 2020 2020 2020 2020  undary..        
+00005310: 636f 6e64 6974 696f 6e20 3d20 286c 6566  condition = (lef
+00005320: 745b 2743 6c6f 7365 6427 5d20 3c3d 206c  t['Closed'] <= l
+00005330: 6566 745b 274f 7065 6e27 5d29 207c 2028  eft['Open']) | (
+00005340: 6c65 6674 5b27 4f70 656e 275d 2e69 736e  left['Open'].isn
+00005350: 6128 2929 0d0a 2020 2020 2020 2020 6c65  a())..        le
+00005360: 6674 5b73 656c 662e 6c65 6674 5f62 6f75  ft[self.left_bou
+00005370: 6e64 6172 795f 636f 6c5d 203d 2028 0d0a  ndary_col] = (..
+00005380: 2020 2020 2020 2020 2020 2020 6e70 2e77              np.w
+00005390: 6865 7265 2863 6f6e 6469 7469 6f6e 2c0d  here(condition,.
+000053a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000053b0: 2020 2020 2020 2743 6c6f 7365 6427 2c0d        'Closed',.
+000053c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000053d0: 2020 2020 2020 274f 7065 6e27 0d0a 2020        'Open'..  
+000053e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000053f0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+00005400: 2020 290d 0a20 2020 2020 2020 206c 6566    )..        lef
+00005410: 745b 7365 6c66 2e6c 6566 745f 626f 756e  t[self.left_boun
+00005420: 645f 636f 6c5d 203d 2028 0d0a 2020 2020  d_col] = (..    
+00005430: 2020 2020 2020 2020 6e70 2e77 6865 7265          np.where
+00005440: 2863 6f6e 6469 7469 6f6e 2c0d 0a20 2020  (condition,..   
+00005450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005460: 2020 6c65 6674 5b27 436c 6f73 6564 275d    left['Closed']
+00005470: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00005480: 2020 2020 2020 2020 6c65 6674 5b27 4f70          left['Op
+00005490: 656e 275d 0d0a 2020 2020 2020 2020 2020  en']..          
+000054a0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+000054b0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+000054c0: 2020 2020 206c 6566 7420 3d20 6c65 6674       left = left
+000054d0: 5b5b 7365 6c66 2e6c 6566 745f 626f 756e  [[self.left_boun
+000054e0: 6461 7279 5f63 6f6c 2c20 7365 6c66 2e6c  dary_col, self.l
+000054f0: 6566 745f 626f 756e 645f 636f 6c5d 5d0d  eft_bound_col]].
+00005500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005510: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+00005520: 2020 2023 2044 6574 6572 6d69 6e65 2072     # Determine r
+00005530: 6967 6874 2062 6f75 6e64 2061 6e64 2062  ight bound and b
+00005540: 6f75 6e64 6172 7920 666f 7220 6d69 6e69  oundary for mini
+00005550: 6d75 6d20 6f66 2065 6163 6820 6772 6f75  mum of each grou
+00005560: 702e 0d0a 2020 2020 2020 2020 2020 2020  p...            
+00005570: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+00005580: 4465 7465 726d 696e 6520 7768 6574 6865  Determine whethe
+00005590: 7220 7468 6520 6c65 6173 7420 7269 6768  r the least righ
+000055a0: 7420 626f 756e 6420 6973 206f 7065 6e20  t bound is open 
+000055b0: 6f72 2063 6c6f 7365 6420 6279 0d0a 2020  or closed by..  
+000055c0: 2020 2020 2020 2320 636f 6d70 6172 696e        # comparin
+000055d0: 6720 7468 6520 6c65 6173 7420 6f70 656e  g the least open
+000055e0: 2061 6e64 206c 6561 7374 2063 6c6f 7365   and least close
+000055f0: 6420 626f 756e 640d 0a20 2020 2020 2020  d bound..       
+00005600: 2072 6967 6874 203d 2028 0d0a 2020 2020   right = (..    
+00005610: 2020 2020 2020 2020 6466 2e67 726f 7570          df.group
+00005620: 6279 2867 726f 7570 6279 5f63 6f6c 7320  by(groupby_cols 
+00005630: 2b20 5b73 656c 662e 7269 6768 745f 626f  + [self.right_bo
+00005640: 756e 6461 7279 5f63 6f6c 5d29 0d0a 2020  undary_col])..  
+00005650: 2020 2020 2020 2020 2020 2020 2020 5b73                [s
+00005660: 656c 662e 7269 6768 745f 626f 756e 645f  elf.right_bound_
+00005670: 636f 6c5d 0d0a 2020 2020 2020 2020 2020  col]..          
+00005680: 2020 2020 2020 2e6d 696e 2829 2e0d 0a20        .min()... 
+00005690: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000056a0: 6e73 7461 636b 2873 656c 662e 7269 6768  nstack(self.righ
+000056b0: 745f 626f 756e 6461 7279 5f63 6f6c 290d  t_boundary_col).
+000056c0: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+000056d0: 2020 2020 2020 2020 2320 456e 7375 7265          # Ensure
+000056e0: 2062 6f74 6820 626f 756e 6461 7279 2074   both boundary t
+000056f0: 7970 6573 2065 7869 7374 0d0a 2020 2020  ypes exist..    
+00005700: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
+00005710: 5b27 4f70 656e 272c 2743 6c6f 7365 6427  ['Open','Closed'
+00005720: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00005730: 6966 2069 7465 6d20 6e6f 7420 696e 2072  if item not in r
+00005740: 6967 6874 2e63 6f6c 756d 6e73 3a0d 0a20  ight.columns:.. 
+00005750: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00005760: 6967 6874 5b69 7465 6d5d 203d 206e 702e  ight[item] = np.
+00005770: 6e61 6e0d 0a20 2020 2020 2020 2023 2055  nan..        # U
+00005780: 7365 2074 6865 206d 696e 696d 756d 2063  se the minimum c
+00005790: 6c6f 7365 6420 626f 756e 6461 7279 2069  losed boundary i
+000057a0: 6620 7468 6572 6520 6172 6520 6e6f 206f  f there are no o
+000057b0: 7065 6e20 626f 756e 6461 7269 6573 206f  pen boundaries o
+000057c0: 720d 0a20 2020 2020 2020 2023 2069 6620  r..        # if 
+000057d0: 7468 6520 636c 6f73 6564 2062 6f75 6e64  the closed bound
+000057e0: 6172 7920 6973 206c 6573 7320 7468 616e  ary is less than
+000057f0: 2074 6865 206c 6561 7374 206f 7065 6e20   the least open 
+00005800: 626f 756e 6461 7279 0d0a 2020 2020 2020  boundary..      
+00005810: 2020 636f 6e64 6974 696f 6e20 3d20 2872    condition = (r
+00005820: 6967 6874 5b27 436c 6f73 6564 275d 203c  ight['Closed'] <
+00005830: 2072 6967 6874 5b27 4f70 656e 275d 2920   right['Open']) 
+00005840: 7c20 2872 6967 6874 5b27 4f70 656e 275d  | (right['Open']
+00005850: 2e69 736e 6128 2929 0d0a 2020 2020 2020  .isna())..      
+00005860: 2020 7269 6768 745b 7365 6c66 2e72 6967    right[self.rig
+00005870: 6874 5f62 6f75 6e64 5f63 6f6c 5d20 3d20  ht_bound_col] = 
+00005880: 280d 0a20 2020 2020 2020 2020 2020 206e  (..            n
+00005890: 702e 7768 6572 6528 636f 6e64 6974 696f  p.where(conditio
+000058a0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+000058b0: 2020 2020 2020 2020 2072 6967 6874 5b27           right['
+000058c0: 436c 6f73 6564 275d 2c0d 0a20 2020 2020  Closed'],..     
+000058d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000058e0: 7269 6768 745b 274f 7065 6e27 5d0d 0a20  right['Open'].. 
+000058f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005900: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00005910: 2020 2029 0d0a 2020 2020 2020 2020 7269     )..        ri
+00005920: 6768 745b 7365 6c66 2e72 6967 6874 5f62  ght[self.right_b
+00005930: 6f75 6e64 6172 795f 636f 6c5d 203d 2028  oundary_col] = (
+00005940: 0d0a 2020 2020 2020 2020 2020 2020 6e70  ..            np
+00005950: 2e77 6865 7265 2863 6f6e 6469 7469 6f6e  .where(condition
+00005960: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00005970: 2020 2020 2020 2020 2743 6c6f 7365 6427          'Closed'
+00005980: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00005990: 2020 2020 2020 2020 274f 7065 6e27 0d0a          'Open'..
+000059a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059b0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+000059c0: 2020 2020 290d 0a20 2020 2020 2020 2072      )..        r
+000059d0: 6967 6874 203d 2072 6967 6874 5b5b 7365  ight = right[[se
+000059e0: 6c66 2e72 6967 6874 5f62 6f75 6e64 5f63  lf.right_bound_c
+000059f0: 6f6c 2c20 7365 6c66 2e72 6967 6874 5f62  ol, self.right_b
+00005a00: 6f75 6e64 6172 795f 636f 6c5d 5d0d 0a20  oundary_col]].. 
+00005a10: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00005a20: 2023 204d 6572 6765 2074 6865 2074 776f   # Merge the two
+00005a30: 2062 6f75 6e64 6172 6965 7320 746f 2063   boundaries to c
+00005a40: 7265 6174 6520 7468 6520 696e 7465 7276  reate the interv
+00005a50: 616c 2066 6f72 2074 6865 206d 6178 696d  al for the maxim
+00005a60: 756d 0d0a 2020 2020 2020 2020 2320 4368  um..        # Ch
+00005a70: 6563 6b20 7468 6174 2074 6865 206d 6572  eck that the mer
+00005a80: 6765 2069 7320 312d 746f 2d31 0d0a 2020  ge is 1-to-1..  
+00005a90: 2020 2020 2020 6466 203d 206c 6566 742e        df = left.
+00005aa0: 6d65 7267 6528 7269 6768 742c 0d0a 2020  merge(right,..  
+00005ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ac0: 2020 2020 2020 686f 7720 3d20 276f 7574        how = 'out
+00005ad0: 6572 272c 0d0a 2020 2020 2020 2020 2020  er',..          
+00005ae0: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
+00005af0: 203d 2067 726f 7570 6279 5f63 6f6c 732c   = groupby_cols,
+00005b00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005b10: 2020 2020 2020 2020 2020 7661 6c69 6461            valida
+00005b20: 7465 203d 2027 313a 3127 290d 0a20 2020  te = '1:1')..   
+00005b30: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+00005b40: 2043 7265 6174 6520 6120 636f 6c75 6d6e   Create a column
+00005b50: 2074 6861 7420 696e 6469 6361 7465 7320   that indicates 
+00005b60: 7468 6520 6765 6e65 7261 7465 6420 7374  the generated st
+00005b70: 6174 6973 7469 630d 0a20 2020 2020 2020  atistic..       
+00005b80: 2064 665b 7365 6c66 2e73 7461 745f 636f   df[self.stat_co
+00005b90: 6c5d 203d 2027 4d69 6e69 6d75 6d27 0d0a  l] = 'Minimum'..
+00005ba0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00005bb0: 2020 2320 5265 6f72 6465 7220 636f 6c75    # Reorder colu
+00005bc0: 6d6e 730d 0a20 2020 2020 2020 2064 6620  mns..        df 
+00005bd0: 3d20 6466 5b5b 7365 6c66 2e73 7461 745f  = df[[self.stat_
+00005be0: 636f 6c2c 0d0a 2020 2020 2020 2020 2020  col,..          
+00005bf0: 2020 2020 2020 2073 656c 662e 6c65 6674         self.left
+00005c00: 5f62 6f75 6e64 6172 795f 636f 6c2c 0d0a  _boundary_col,..
+00005c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c20: 2073 656c 662e 6c65 6674 5f62 6f75 6e64   self.left_bound
+00005c30: 5f63 6f6c 2c0d 0a20 2020 2020 2020 2020  _col,..         
+00005c40: 2020 2020 2020 2020 7365 6c66 2e72 6967          self.rig
+00005c50: 6874 5f62 6f75 6e64 5f63 6f6c 2c0d 0a20  ht_bound_col,.. 
+00005c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c70: 7365 6c66 2e72 6967 6874 5f62 6f75 6e64  self.right_bound
+00005c80: 6172 795f 636f 6c0d 0a20 2020 2020 2020  ary_col..       
+00005c90: 2020 2020 2020 2020 2020 5d5d 0d0a 2020            ]]..  
+00005ca0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00005cb0: 2320 5265 7365 7420 696e 6465 780d 0a20  # Reset index.. 
+00005cc0: 2020 2020 2020 2064 6620 3d20 6466 2e72         df = df.r
+00005cd0: 6573 6574 5f69 6e64 6578 2829 0d0a 2020  eset_index()..  
+00005ce0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00005cf0: 2320 5265 706c 6163 6520 6f72 2072 6574  # Replace or ret
+00005d00: 7572 6e20 7265 7375 6c74 0d0a 2020 2020  urn result..    
+00005d10: 2020 2020 6966 2069 6e70 6c61 6365 3a0d      if inplace:.
+00005d20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005d30: 662e 6461 7461 203d 2064 660d 0a20 2020  f.data = df..   
+00005d40: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00005d50: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00005d60: 660d 0a20 2020 200d 0a20 2020 2064 6566  f..    ..    def
+00005d70: 206d 6561 6e5f 6f72 5f73 756d 5f69 6e74   mean_or_sum_int
+00005d80: 6572 7661 6c28 7365 6c66 2c0d 0a20 2020  erval(self,..   
+00005d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005da0: 2020 2020 2020 2020 2020 7374 6174 2c0d            stat,.
+00005db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005dc0: 2020 2020 2020 2020 2020 2020 2020 6772                gr
+00005dd0: 6f75 7062 795f 636f 6c73 2c0d 0a20 2020  oupby_cols,..   
+00005de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005df0: 2020 2020 2020 2020 2020 696e 706c 6163            inplac
+00005e00: 6520 3d20 4661 6c73 6529 3a0d 0a20 2020  e = False):..   
+00005e10: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+00005e20: 2043 7265 6174 6520 6120 636f 7079 206f   Create a copy o
+00005e30: 6620 7468 6520 6461 7461 0d0a 2020 2020  f the data..    
+00005e40: 2020 2020 6466 203d 2073 656c 662e 6461      df = self.da
+00005e50: 7461 2e63 6f70 7928 290d 0a20 2020 2020  ta.copy()..     
+00005e60: 2020 200d 0a20 2020 2020 2020 2023 2043     ..        # C
+00005e70: 6865 636b 2066 6f72 2076 616c 6964 2073  heck for valid s
+00005e80: 7461 7420 6675 6e63 7469 6f6e 730d 0a20  tat functions.. 
+00005e90: 2020 2020 2020 2069 6620 7374 6174 206e         if stat n
+00005ea0: 6f74 2069 6e20 5b27 6d65 616e 272c 2773  ot in ['mean','s
+00005eb0: 756d 275d 3a0d 0a20 2020 2020 2020 2020  um']:..         
+00005ec0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00005ed0: 726f 7228 2749 7420 6973 206e 6f74 2072  ror('It is not r
+00005ee0: 6563 6f6d 6d65 6e64 6564 2066 6f72 2075  ecommended for u
+00005ef0: 7365 7273 2074 6f20 7573 6520 7468 6520  sers to use the 
+00005f00: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+00005f10: 2020 2027 6675 6e63 7469 6f6e 206d 6561     'function mea
+00005f20: 6e5f 6f72 5f73 756d 5f69 6e74 6572 7661  n_or_sum_interva
+00005f30: 6c2e 2055 7365 206d 6561 6e5f 696e 7465  l. Use mean_inte
+00005f40: 7276 616c 206f 7220 270d 0a20 2020 2020  rval or '..     
+00005f50: 2020 2020 2020 2020 2020 2027 7375 6d5f             'sum_
+00005f60: 696e 7465 7276 616c 2069 6e73 7465 6164  interval instead
+00005f70: 2e20 546f 2075 7365 2074 6869 7320 6675  . To use this fu
+00005f80: 6e63 7469 6f6e 2074 6865 2076 616c 7565  nction the value
+00005f90: 2066 6f72 2027 0d0a 2020 2020 2020 2020   for '..        
+00005fa0: 2020 2020 2020 2020 2722 7374 6174 2220          '"stat" 
+00005fb0: 6d75 7374 2062 6520 226d 6561 6e22 206f  must be "mean" o
+00005fc0: 7220 2273 756d 222e 2027 0d0a 2020 2020  r "sum". '..    
+00005fd0: 2020 2020 2020 2020 2020 2020 6627 5468              f'Th
+00005fe0: 6520 7072 6f76 6964 6564 2076 616c 7565  e provided value
+00005ff0: 2077 6173 2022 7b73 7461 747d 222e 2729   was "{stat}".')
+00006000: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00006010: 2020 2020 2320 4372 6561 7465 2061 2063      # Create a c
+00006020: 6f6c 756d 6e20 7468 6174 2069 6e64 6963  olumn that indic
+00006030: 6174 6573 2074 6865 2067 656e 6572 6174  ates the generat
+00006040: 6564 2073 7461 7469 7374 6963 200d 0a20  ed statistic .. 
+00006050: 2020 2020 2020 2064 665b 7365 6c66 2e73         df[self.s
+00006060: 7461 745f 636f 6c5d 203d 2073 7461 742e  tat_col] = stat.
+00006070: 6361 7069 7461 6c69 7a65 2829 0d0a 2020  capitalize()..  
+00006080: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00006090: 2320 4368 616e 6765 206e 6f74 6174 696f  # Change notatio
+000060a0: 6e20 6f66 2027 436c 6f73 6564 2720 616e  n of 'Closed' an
+000060b0: 6420 274f 7065 6e27 2062 6f75 6e64 6172  d 'Open' boundar
+000060c0: 6965 7320 746f 2030 2061 6e64 2031 2c20  ies to 0 and 1, 
+000060d0: 0d0a 2020 2020 2020 2020 2320 7265 7370  ..        # resp
+000060e0: 6563 7469 7665 6c79 2e20 5468 6520 7072  ectively. The pr
+000060f0: 6573 656e 6365 206f 6620 616e 7920 6f70  esence of any op
+00006100: 656e 2062 6f75 6e64 6172 6965 7320 6f6e  en boundaries on
+00006110: 206f 6e65 2073 6964 6520 656e 7375 7265   one side ensure
+00006120: 730d 0a20 2020 2020 2020 2023 2074 6861  s..        # tha
+00006130: 7420 7468 6520 696e 7465 7276 616c 2066  t the interval f
+00006140: 6f72 2074 6865 2072 6573 756c 7420 6973  or the result is
+00006150: 2061 6c73 6f20 6f70 656e 206f 6e20 7468   also open on th
+00006160: 6174 2073 6964 650d 0a20 2020 2020 2020  at side..       
+00006170: 2064 665b 5b73 656c 662e 6c65 6674 5f62   df[[self.left_b
+00006180: 6f75 6e64 6172 795f 636f 6c2c 2073 656c  oundary_col, sel
+00006190: 662e 7269 6768 745f 626f 756e 6461 7279  f.right_boundary
+000061a0: 5f63 6f6c 5d5d 203d 2028 0d0a 2020 2020  _col]] = (..    
+000061b0: 2020 2020 2020 2020 6466 5b5b 7365 6c66          df[[self
+000061c0: 2e6c 6566 745f 626f 756e 6461 7279 5f63  .left_boundary_c
+000061d0: 6f6c 2c20 7365 6c66 2e72 6967 6874 5f62  ol, self.right_b
+000061e0: 6f75 6e64 6172 795f 636f 6c5d 5d0d 0a20  oundary_col]].. 
+000061f0: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+00006200: 7265 706c 6163 6528 5b27 436c 6f73 6564  replace(['Closed
+00006210: 272c 274f 7065 6e27 5d2c 205b 302c 315d  ','Open'], [0,1]
+00006220: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
+00006230: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00006240: 2020 2020 2320 4765 7420 7468 6520 6c65      # Get the le
+00006250: 6674 2f72 6967 6874 2062 6f75 6e64 7320  ft/right bounds 
+00006260: 6f66 2074 6865 2072 6573 756c 7420 6279  of the result by
+00006270: 2061 7665 7261 6769 6e67 206f 7220 6164   averaging or ad
+00006280: 6469 6e67 2061 6c6c 200d 0a20 2020 2020  ding all ..     
+00006290: 2020 2023 206c 6566 742f 7269 6768 7420     # left/right 
+000062a0: 626f 756e 6473 2077 6974 6869 6e20 7468  bounds within th
+000062b0: 6520 6772 6f75 702e 0d0a 2020 2020 2020  e group...      
+000062c0: 2020 2320 4465 7465 726d 696e 6520 7768    # Determine wh
+000062d0: 6574 6865 7220 616e 7920 4f70 656e 2028  ether any Open (
+000062e0: 6e6f 7720 7661 6c75 6520 6f66 2031 2920  now value of 1) 
+000062f0: 626f 756e 6461 7269 6573 2065 7869 7374  boundaries exist
+00006300: 2e0d 0a20 2020 2020 2020 2023 2049 6620  ...        # If 
+00006310: 7468 6572 6520 6172 6520 616e 7920 6f70  there are any op
+00006320: 656e 2062 6f75 6e64 6172 6965 7320 7573  en boundaries us
+00006330: 6564 2069 6e20 7468 6520 626f 756e 6420  ed in the bound 
+00006340: 6d65 616e 2f73 756d 2c0d 0a20 2020 2020  mean/sum,..     
+00006350: 2020 2023 2074 6865 6e20 7468 6520 7265     # then the re
+00006360: 7375 6c74 696e 6720 6d65 616e 2f73 756d  sulting mean/sum
+00006370: 2077 696c 6c20 6265 206f 7065 6e0d 0a20   will be open.. 
+00006380: 2020 2020 2020 2064 6620 3d20 280d 0a20         df = (.. 
+00006390: 2020 2020 2020 2020 2020 2064 662e 6772             df.gr
+000063a0: 6f75 7062 7928 6772 6f75 7062 795f 636f  oupby(groupby_co
+000063b0: 6c73 202b 205b 7365 6c66 2e73 7461 745f  ls + [self.stat_
+000063c0: 636f 6c5d 290d 0a20 2020 2020 2020 2020  col])..         
+000063d0: 2020 2020 2020 202e 6167 6728 2a2a 7b0d         .agg(**{.
+000063e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000063f0: 2020 2020 2073 656c 662e 6c65 6674 5f62       self.left_b
+00006400: 6f75 6e64 6172 795f 636f 6c3a 2028 7365  oundary_col: (se
+00006410: 6c66 2e6c 6566 745f 626f 756e 6461 7279  lf.left_boundary
+00006420: 5f63 6f6c 2c20 276d 6178 2729 2c0d 0a20  _col, 'max'),.. 
+00006430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006440: 2020 2027 5f5f 4d69 6e69 6d75 6d5f 5f27     '__Minimum__'
+00006450: 3a20 2873 656c 662e 6c65 6674 5f62 6f75  : (self.left_bou
+00006460: 6e64 5f63 6f6c 2c20 276d 696e 2729 2c0d  nd_col, 'min'),.
+00006470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006480: 2020 2020 2073 656c 662e 6c65 6674 5f62       self.left_b
+00006490: 6f75 6e64 5f63 6f6c 3a20 2873 656c 662e  ound_col: (self.
+000064a0: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 2c20  left_bound_col, 
+000064b0: 7374 6174 292c 0d0a 2020 2020 2020 2020  stat),..        
+000064c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000064d0: 2e72 6967 6874 5f62 6f75 6e64 5f63 6f6c  .right_bound_col
+000064e0: 3a20 2873 656c 662e 7269 6768 745f 626f  : (self.right_bo
+000064f0: 756e 645f 636f 6c2c 2073 7461 7429 2c0d  und_col, stat),.
+00006500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006510: 2020 2020 2027 5f5f 4d61 7869 6d75 6d5f       '__Maximum_
+00006520: 5f27 3a20 2873 656c 662e 7269 6768 745f  _': (self.right_
+00006530: 626f 756e 645f 636f 6c2c 2027 6d61 7827  bound_col, 'max'
+00006540: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00006550: 2020 2020 2020 2020 7365 6c66 2e72 6967          self.rig
+00006560: 6874 5f62 6f75 6e64 6172 795f 636f 6c3a  ht_boundary_col:
+00006570: 2028 7365 6c66 2e72 6967 6874 5f62 6f75   (self.right_bou
+00006580: 6e64 6172 795f 636f 6c2c 2027 6d61 7827  ndary_col, 'max'
+00006590: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000065a0: 2020 2020 2020 207d 290d 0a20 2020 2020         })..     
+000065b0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000065c0: 2020 0d0a 2020 2020 2020 2020 2320 5265    ..        # Re
+000065d0: 706c 6163 6520 696e 7465 6765 7273 2077  place integers w
+000065e0: 6974 6820 7465 7874 2066 6f72 2062 6f75  ith text for bou
+000065f0: 6e64 6172 6965 730d 0a20 2020 2020 2020  ndaries..       
+00006600: 2064 665b 5b73 656c 662e 6c65 6674 5f62   df[[self.left_b
+00006610: 6f75 6e64 6172 795f 636f 6c2c 2073 656c  oundary_col, sel
+00006620: 662e 7269 6768 745f 626f 756e 6461 7279  f.right_boundary
+00006630: 5f63 6f6c 5d5d 203d 2028 0d0a 2020 2020  _col]] = (..    
+00006640: 2020 2020 2020 2020 6466 5b5b 7365 6c66          df[[self
+00006650: 2e6c 6566 745f 626f 756e 6461 7279 5f63  .left_boundary_c
+00006660: 6f6c 2c20 7365 6c66 2e72 6967 6874 5f62  ol, self.right_b
+00006670: 6f75 6e64 6172 795f 636f 6c5d 5d0d 0a20  oundary_col]].. 
+00006680: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+00006690: 7265 706c 6163 6528 5b30 2c31 5d2c 205b  replace([0,1], [
+000066a0: 2743 6c6f 7365 6427 2c27 4f70 656e 275d  'Closed','Open']
+000066b0: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
+000066c0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+000066d0: 2020 2020 2320 4d65 616e 732f 7375 6d73      # Means/sums
+000066e0: 2077 6974 6820 696e 6669 6e69 7465 2076   with infinite v
+000066f0: 616c 7565 7320 7072 6f64 7563 6520 6e61  alues produce na
+00006700: 6e20 7661 6c75 6573 2072 6174 6865 7220  n values rather 
+00006710: 7468 616e 200d 0a20 2020 2020 2020 2023  than ..        #
+00006720: 206e 702e 696e 6620 7661 6c75 6573 2e20   np.inf values. 
+00006730: 436f 6e76 6572 7420 6e61 6e20 746f 2069  Convert nan to i
+00006740: 6e66 206f 6e6c 7920 6966 2069 6e66 696e  nf only if infin
+00006750: 6974 6520 7661 6c75 6573 2061 7265 0d0a  ite values are..
+00006760: 2020 2020 2020 2020 2320 696e 636c 7564          # includ
+00006770: 6564 2069 6e20 7468 6520 6d65 616e 2f73  ed in the mean/s
+00006780: 756d 0d0a 2020 2020 2020 2020 6466 5b73  um..        df[s
+00006790: 656c 662e 6c65 6674 5f62 6f75 6e64 5f63  elf.left_bound_c
+000067a0: 6f6c 5d20 3d20 280d 0a20 2020 2020 2020  ol] = (..       
+000067b0: 2020 2020 206e 702e 7768 6572 6528 6466       np.where(df
+000067c0: 5b27 5f5f 4d69 6e69 6d75 6d5f 5f27 5d20  ['__Minimum__'] 
+000067d0: 3d3d 202d 6e70 2e69 6e66 2c0d 0a20 2020  == -np.inf,..   
+000067e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000067f0: 2020 2d6e 702e 696e 662c 0d0a 2020 2020    -np.inf,..    
+00006800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006810: 2064 665b 7365 6c66 2e6c 6566 745f 626f   df[self.left_bo
+00006820: 756e 645f 636f 6c5d 0d0a 2020 2020 2020  und_col]..      
+00006830: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00006840: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
+00006850: 0a20 2020 2020 2020 2064 665b 7365 6c66  .        df[self
+00006860: 2e72 6967 6874 5f62 6f75 6e64 5f63 6f6c  .right_bound_col
+00006870: 5d20 3d20 280d 0a20 2020 2020 2020 2020  ] = (..         
+00006880: 2020 206e 702e 7768 6572 6528 6466 5b27     np.where(df['
+00006890: 5f5f 4d61 7869 6d75 6d5f 5f27 5d20 3d3d  __Maximum__'] ==
+000068a0: 206e 702e 696e 662c 0d0a 2020 2020 2020   np.inf,..      
+000068b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000068c0: 702e 696e 662c 0d0a 2020 2020 2020 2020  p.inf,..        
+000068d0: 2020 2020 2020 2020 2020 2020 2064 665b               df[
+000068e0: 7365 6c66 2e72 6967 6874 5f62 6f75 6e64  self.right_bound
+000068f0: 5f63 6f6c 5d0d 0a20 2020 2020 2020 2020  _col]..         
+00006900: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00006910: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00006920: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00006930: 2320 5265 6f72 6465 7220 636f 6c75 6d6e  # Reorder column
+00006940: 730d 0a20 2020 2020 2020 2064 6620 3d20  s..        df = 
+00006950: 6466 5b5b 7365 6c66 2e6c 6566 745f 626f  df[[self.left_bo
+00006960: 756e 6461 7279 5f63 6f6c 2c0d 0a20 2020  undary_col,..   
+00006970: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00006980: 6c66 2e6c 6566 745f 626f 756e 645f 636f  lf.left_bound_co
+00006990: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+000069a0: 2020 2020 2073 656c 662e 7269 6768 745f       self.right_
+000069b0: 626f 756e 645f 636f 6c2c 0d0a 2020 2020  bound_col,..    
+000069c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000069d0: 662e 7269 6768 745f 626f 756e 6461 7279  f.right_boundary
+000069e0: 5f63 6f6c 0d0a 2020 2020 2020 2020 2020  _col..          
+000069f0: 2020 2020 2020 205d 5d0d 0a20 2020 2020         ]]..     
+00006a00: 2020 200d 0a20 2020 2020 2020 2023 2052     ..        # R
+00006a10: 6573 6574 2069 6e64 6578 0d0a 2020 2020  eset index..    
+00006a20: 2020 2020 6466 203d 2064 662e 7265 7365      df = df.rese
+00006a30: 745f 696e 6465 7828 290d 0a20 2020 2020  t_index()..     
+00006a40: 2020 200d 0a20 2020 2020 2020 2023 2052     ..        # R
+00006a50: 6570 6c61 6365 206f 7220 7265 7475 726e  eplace or return
+00006a60: 2072 6573 756c 740d 0a20 2020 2020 2020   result..       
+00006a70: 2069 6620 696e 706c 6163 653a 0d0a 2020   if inplace:..  
+00006a80: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00006a90: 6174 6120 3d20 6466 0d0a 2020 2020 2020  ata = df..      
+00006aa0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00006ab0: 2020 2020 2072 6574 7572 6e20 6466 0d0a       return df..
+00006ac0: 2020 2020 0d0a 2020 2020 6465 6620 6d65      ..    def me
+00006ad0: 616e 5f69 6e74 6572 7661 6c28 7365 6c66  an_interval(self
+00006ae0: 2c20 6772 6f75 7062 795f 636f 6c73 2c20  , groupby_cols, 
+00006af0: 696e 706c 6163 6520 3d20 4661 6c73 6529  inplace = False)
+00006b00: 3a0d 0a20 2020 2020 2020 200d 0a20 2020  :..        ..   
+00006b10: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00006b20: 2e6d 6561 6e5f 6f72 5f73 756d 5f69 6e74  .mean_or_sum_int
+00006b30: 6572 7661 6c28 276d 6561 6e27 2c20 6772  erval('mean', gr
+00006b40: 6f75 7062 795f 636f 6c73 2c20 696e 706c  oupby_cols, inpl
+00006b50: 6163 6529 0d0a 2020 2020 0d0a 2020 2020  ace)..    ..    
+00006b60: 6465 6620 6164 645f 696e 7465 7276 616c  def add_interval
+00006b70: 2873 656c 662c 2067 726f 7570 6279 5f63  (self, groupby_c
+00006b80: 6f6c 732c 2069 6e70 6c61 6365 203d 2046  ols, inplace = F
+00006b90: 616c 7365 293a 0d0a 2020 2020 2020 2020  alse):..        
+00006ba0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00006bb0: 2073 656c 662e 6d65 616e 5f6f 725f 7375   self.mean_or_su
+00006bc0: 6d5f 696e 7465 7276 616c 2827 7375 6d27  m_interval('sum'
+00006bd0: 2c20 6772 6f75 7062 795f 636f 6c73 2c20  , groupby_cols, 
+00006be0: 696e 706c 6163 6529 0d0a 2020 2020 0d0a  inplace)..    ..
+00006bf0: 2020 2020 6465 6620 7065 7263 656e 7469      def percenti
+00006c00: 6c65 5f69 6e74 6572 7661 6c28 7365 6c66  le_interval(self
+00006c10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00006c20: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00006c30: 726f 7570 6279 5f63 6f6c 732c 0d0a 2020  roupby_cols,..  
+00006c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c50: 2020 2020 2020 2020 2020 7065 7263 656e            percen
+00006c60: 7469 6c65 2c0d 0a20 2020 2020 2020 2020  tile,..         
+00006c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c80: 2020 206d 6574 686f 6420 3d20 2768 617a     method = 'haz
+00006c90: 656e 272c 0d0a 2020 2020 2020 2020 2020  en',..          
+00006ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006cb0: 2020 696e 706c 6163 6520 3d20 4661 6c73    inplace = Fals
+00006cc0: 6529 3a0d 0a20 2020 2020 2020 200d 0a20  e):..        .. 
+00006cd0: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+00006ce0: 6120 636f 7079 206f 6620 7468 6520 6461  a copy of the da
+00006cf0: 7461 0d0a 2020 2020 2020 2020 6466 203d  ta..        df =
+00006d00: 2073 656c 662e 6461 7461 2e63 6f70 7928   self.data.copy(
+00006d10: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+00006d20: 2020 2020 2023 2043 6f6e 7665 7274 2070       # Convert p
+00006d30: 6572 6365 6e74 696c 6520 746f 2062 6520  ercentile to be 
+00006d40: 6265 7477 6565 6e20 3020 616e 6420 310d  between 0 and 1.
+00006d50: 0a20 2020 2020 2020 2070 6572 6365 6e74  .        percent
+00006d60: 696c 6520 3d20 7065 7263 656e 7469 6c65  ile = percentile
+00006d70: 2f31 3030 0d0a 2020 2020 2020 2020 0d0a  /100..        ..
+00006d80: 2020 2020 2020 2020 2320 4465 7465 726d          # Determ
+00006d90: 696e 6520 7369 7a65 206f 6620 6561 6368  ine size of each
+00006da0: 2067 726f 7570 0d0a 2020 2020 2020 2020   group..        
+00006db0: 6966 2067 726f 7570 6279 5f63 6f6c 7320  if groupby_cols 
+00006dc0: 3d3d 204e 6f6e 653a 0d0a 2020 2020 2020  == None:..      
+00006dd0: 2020 2020 2020 6466 5b27 5f5f 5369 7a65        df['__Size
+00006de0: 5f5f 275d 203d 206c 656e 2864 6629 0d0a  __'] = len(df)..
+00006df0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00006e00: 2020 2020 2020 2020 2020 2064 665b 275f             df['_
+00006e10: 5f53 697a 655f 5f27 5d20 3d20 6466 2e67  _Size__'] = df.g
+00006e20: 726f 7570 6279 2867 726f 7570 6279 5f63  roupby(groupby_c
+00006e30: 6f6c 7329 2e74 7261 6e73 666f 726d 2827  ols).transform('
+00006e40: 7369 7a65 2729 0d0a 2020 2020 2020 2020  size')..        
+00006e50: 0d0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
+00006e60: 7661 6c75 6573 2066 6f72 2070 6572 6365  values for perce
+00006e70: 6e74 696c 6520 6d65 7468 6f64 730d 0a20  ntile methods.. 
+00006e80: 2020 2020 2020 206d 6574 686f 645f 6469         method_di
+00006e90: 6374 203d 207b 2777 6569 6261 6c6c 273a  ct = {'weiball':
+00006ea0: 2030 2e30 2c0d 0a20 2020 2020 2020 2020   0.0,..         
+00006eb0: 2020 2020 2020 2020 2020 2020 2020 2774                't
+00006ec0: 756b 6579 273a 2031 2f33 2c0d 0a20 2020  ukey': 1/3,..   
+00006ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ee0: 2020 2020 2762 6c6f 6d27 3a20 332f 382c      'blom': 3/8,
+00006ef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006f00: 2020 2020 2020 2020 2027 6861 7a65 6e27           'hazen'
+00006f10: 3a20 312f 322c 0d0a 2020 2020 2020 2020  : 1/2,..        
+00006f20: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00006f30: 6578 6365 6c27 3a31 2e30 7d0d 0a20 2020  excel':1.0}..   
+00006f40: 2020 2020 2023 2068 7474 7073 3a2f 2f65       # https://e
+00006f50: 6e2e 7769 6b69 7065 6469 612e 6f72 672f  n.wikipedia.org/
+00006f60: 7769 6b69 2f50 6572 6365 6e74 696c 650d  wiki/Percentile.
+00006f70: 0a20 2020 2020 2020 2043 203d 206d 6574  .        C = met
+00006f80: 686f 645f 6469 6374 5b6d 6574 686f 645d  hod_dict[method]
+00006f90: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00006fa0: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
+00006fb0: 6d69 6e69 6d75 6d20 6461 7461 2073 697a  minimum data siz
+00006fc0: 6520 666f 7220 7065 7263 656e 7469 6c65  e for percentile
+00006fd0: 206d 6574 686f 6420 746f 200d 0a20 2020   method to ..   
+00006fe0: 2020 2020 2023 2065 6e73 7572 6520 7261       # ensure ra
+00006ff0: 6e6b 2069 7320 6174 206c 6561 7374 2031  nk is at least 1
+00007000: 2061 6e64 206e 6f20 6d6f 7265 2074 6861   and no more tha
+00007010: 6e20 6c65 6e28 6461 7461 290d 0a20 2020  n len(data)..   
+00007020: 2020 2020 206d 696e 696d 756d 5f73 697a       minimum_siz
+00007030: 6520 3d20 726f 756e 6428 4320 2b20 2831  e = round(C + (1
+00007040: 2d43 292a 6d61 7828 2831 2d70 6572 6365  -C)*max((1-perce
+00007050: 6e74 696c 6529 2f70 6572 6365 6e74 696c  ntile)/percentil
+00007060: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00007070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007080: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00007090: 6572 6365 6e74 696c 652f 2831 2d70 6572  ercentile/(1-per
+000070a0: 6365 6e74 696c 6529 292c 3130 290d 0a20  centile)),10).. 
+000070b0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000070c0: 2023 204f 6e6c 7920 636f 6e73 6964 6572   # Only consider
+000070d0: 2067 726f 7570 7320 7468 6174 206d 6565   groups that mee
+000070e0: 7420 7468 6520 6d69 6e69 6d75 6d20 7369  t the minimum si
+000070f0: 7a65 2072 6571 7569 7265 6d65 6e74 0d0a  ze requirement..
+00007100: 2020 2020 2020 2020 2320 6466 203d 2064          # df = d
+00007110: 665b 6466 5b27 5f5f 5369 7a65 5f5f 275d  f[df['__Size__']
+00007120: 203e 3d20 6d69 6e69 6d75 6d5f 7369 7a65   >= minimum_size
+00007130: 5d0d 0a20 2020 2020 2020 2064 665b 275f  ]..        df['_
+00007140: 5f57 6172 6e69 6e67 5f5f 275d 203d 2027  _Warning__'] = '
+00007150: 270d 0a20 2020 2020 2020 2063 6f6e 6469  '..        condi
+00007160: 7469 6f6e 203d 2028 6466 5b27 5f5f 5369  tion = (df['__Si
+00007170: 7a65 5f5f 275d 203c 206d 696e 696d 756d  ze__'] < minimum
+00007180: 5f73 697a 6529 0d0a 2020 2020 2020 2020  _size)..        
+00007190: 6966 2070 6572 6365 6e74 696c 6520 3e20  if percentile > 
+000071a0: 302e 353a 0d0a 2020 2020 2020 2020 2020  0.5:..          
+000071b0: 2020 6466 2e6c 6f63 5b63 6f6e 6469 7469    df.loc[conditi
+000071c0: 6f6e 2c20 275f 5f57 6172 6e69 6e67 5f5f  on, '__Warning__
+000071d0: 275d 203d 2027 2028 6c6f 7720 636f 756e  '] = ' (low coun
+000071e0: 742c 2075 7365 6420 6d61 7829 270d 0a20  t, used max)'.. 
+000071f0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00007200: 2020 2020 2020 2020 2020 6466 2e6c 6f63            df.loc
+00007210: 5b63 6f6e 6469 7469 6f6e 2c20 275f 5f57  [condition, '__W
+00007220: 6172 6e69 6e67 5f5f 275d 203d 2027 2028  arning__'] = ' (
+00007230: 6c6f 7720 636f 756e 742c 2075 7365 6420  low count, used 
+00007240: 6d69 6e29 270d 0a20 2020 2020 2020 200d  min)'..        .
+00007250: 0a20 2020 2020 2020 2023 2044 6574 6572  .        # Deter
+00007260: 6d69 6e65 206c 6566 7420 626f 756e 6420  mine left bound 
+00007270: 616e 6420 626f 756e 6461 7279 2066 6f72  and boundary for
+00007280: 2065 6163 6820 6772 6f75 700d 0a20 2020   each group..   
+00007290: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+000072a0: 2043 6861 6e67 6520 6e6f 7461 7469 6f6e   Change notation
+000072b0: 206f 6620 2743 6c6f 7365 6427 2061 6e64   of 'Closed' and
+000072c0: 2027 4f70 656e 2720 626f 756e 6461 7269   'Open' boundari
+000072d0: 6573 2074 6f20 3020 616e 6420 312c 0d0a  es to 0 and 1,..
+000072e0: 2020 2020 2020 2020 2320 7265 7370 6563          # respec
+000072f0: 7469 7665 6c79 2e20 5573 6520 3020 666f  tively. Use 0 fo
+00007300: 7220 636c 6f73 6564 2074 6f20 656e 7375  r closed to ensu
+00007310: 7265 2074 6861 7420 636c 6f73 6564 2062  re that closed b
+00007320: 6f75 6e64 6172 6965 7320 6172 650d 0a20  oundaries are.. 
+00007330: 2020 2020 2020 2023 2073 6f72 7465 6420         # sorted 
+00007340: 6c65 7373 2074 6861 6e20 6f70 656e 2062  less than open b
+00007350: 6f75 6e64 6172 6965 7320 7768 656e 2074  oundaries when t
+00007360: 6865 206c 6566 7420 626f 756e 6420 6973  he left bound is
+00007370: 2074 6965 640d 0a20 2020 2020 2020 2064   tied..        d
+00007380: 665b 7365 6c66 2e6c 6566 745f 626f 756e  f[self.left_boun
+00007390: 6461 7279 5f63 6f6c 5d20 3d20 280d 0a20  dary_col] = (.. 
+000073a0: 2020 2020 2020 2020 2020 2064 665b 7365             df[se
+000073b0: 6c66 2e6c 6566 745f 626f 756e 6461 7279  lf.left_boundary
+000073c0: 5f63 6f6c 5d0d 0a20 2020 2020 2020 2020  _col]..         
+000073d0: 2020 2020 2020 202e 7265 706c 6163 6528         .replace(
+000073e0: 5b27 436c 6f73 6564 272c 274f 7065 6e27  ['Closed','Open'
+000073f0: 5d2c 205b 302c 315d 290d 0a20 2020 2020  ], [0,1])..     
+00007400: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00007410: 2020 0d0a 2020 2020 2020 2020 2320 536f    ..        # So
+00007420: 7274 206c 6566 7420 626f 756e 6420 7661  rt left bound va
+00007430: 6c75 6573 0d0a 2020 2020 2020 2020 6772  lues..        gr
+00007440: 6f75 7069 6e67 203d 205b 275f 5f53 697a  ouping = ['__Siz
+00007450: 655f 5f27 2c20 7365 6c66 2e6c 6566 745f  e__', self.left_
+00007460: 626f 756e 6461 7279 5f63 6f6c 2c20 7365  boundary_col, se
+00007470: 6c66 2e6c 6566 745f 626f 756e 645f 636f  lf.left_bound_co
+00007480: 6c5d 0d0a 2020 2020 2020 2020 6966 2067  l]..        if g
+00007490: 726f 7570 6279 5f63 6f6c 7320 213d 204e  roupby_cols != N
+000074a0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000074b0: 2020 6772 6f75 7069 6e67 203d 2067 726f    grouping = gro
+000074c0: 7570 6279 5f63 6f6c 7320 2b20 6772 6f75  upby_cols + grou
+000074d0: 7069 6e67 0d0a 2020 2020 2020 2020 0d0a  ping..        ..
+000074e0: 2020 2020 2020 2020 6c65 6674 203d 2028          left = (
+000074f0: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
+00007500: 2e63 6f70 7928 295b 6772 6f75 7069 6e67  .copy()[grouping
+00007510: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00007520: 2020 202e 736f 7274 5f76 616c 7565 7328     .sort_values(
+00007530: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007540: 2020 2020 2020 6279 203d 205b 7365 6c66        by = [self
+00007550: 2e6c 6566 745f 626f 756e 645f 636f 6c2c  .left_bound_col,
+00007560: 2073 656c 662e 6c65 6674 5f62 6f75 6e64   self.left_bound
+00007570: 6172 795f 636f 6c5d 0d0a 2020 2020 2020  ary_col]..      
+00007580: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00007590: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+000075a0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+000075b0: 2020 2320 4164 6420 696e 6465 7820 666f    # Add index fo
+000075c0: 7220 6561 6368 2067 726f 7570 0d0a 2020  r each group..  
+000075d0: 2020 2020 2020 6966 2067 726f 7570 6279        if groupby
+000075e0: 5f63 6f6c 7320 3d3d 204e 6f6e 653a 0d0a  _cols == None:..
+000075f0: 2020 2020 2020 2020 2020 2020 6c65 6674              left
+00007600: 5b27 5f5f 496e 6465 785f 5f27 5d20 3d20  ['__Index__'] = 
+00007610: 7261 6e67 6528 312c 2031 2b6c 656e 286c  range(1, 1+len(l
+00007620: 6566 7429 290d 0a20 2020 2020 2020 2065  eft))..        e
+00007630: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00007640: 2020 6c65 6674 5b27 5f5f 496e 6465 785f    left['__Index_
+00007650: 5f27 5d20 3d20 6c65 6674 2e67 726f 7570  _'] = left.group
+00007660: 6279 2867 726f 7570 6279 5f63 6f6c 7329  by(groupby_cols)
+00007670: 2e63 756d 636f 756e 7428 2920 2b20 310d  .cumcount() + 1.
+00007680: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00007690: 2020 2023 2044 6574 6572 6d69 6e65 2074     # Determine t
+000076a0: 6865 2072 616e 6b20 696e 2065 6163 6820  he rank in each 
+000076b0: 6772 6f75 7020 666f 7220 7468 6520 7065  group for the pe
+000076c0: 7263 656e 7469 6c65 0d0a 2020 2020 2020  rcentile..      
+000076d0: 2020 2320 5573 6520 726f 756e 6469 6e67    # Use rounding
+000076e0: 2061 7420 3820 6465 6369 6d61 6c73 2074   at 8 decimals t
+000076f0: 6f20 7072 6576 656e 7420 6172 7469 6669  o prevent artifi
+00007700: 6369 616c 2064 6563 696d 616c 730d 0a20  cial decimals.. 
+00007710: 2020 2020 2020 206c 6566 745b 275f 5f52         left['__R
+00007720: 616e 6b5f 5f27 5d20 3d20 726f 756e 6428  ank__'] = round(
+00007730: 0d0a 2020 2020 2020 2020 2020 2020 4320  ..            C 
+00007740: 2b20 7065 7263 656e 7469 6c65 2a28 6c65  + percentile*(le
+00007750: 6674 5b27 5f5f 5369 7a65 5f5f 275d 202b  ft['__Size__'] +
+00007760: 2031 202d 2032 2a43 292c 0d0a 2020 2020   1 - 2*C),..    
+00007770: 2020 2020 2020 2020 380d 0a20 2020 2020          8..     
+00007780: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00007790: 2020 0d0a 2020 2020 2020 2020 2320 4861    ..        # Ha
+000077a0: 6e64 6c65 2073 6974 7561 7469 6f6e 7320  ndle situations 
+000077b0: 7768 6572 6520 7261 6e6b 2069 7320 6f75  where rank is ou
+000077c0: 7473 6964 6520 7468 6520 7261 6e67 6520  tside the range 
+000077d0: 3120 746f 206c 656e 6774 6820 6f66 2064  1 to length of d
+000077e0: 6174 610d 0a20 2020 2020 2020 2063 6f6e  ata..        con
+000077f0: 6469 7469 6f6e 7320 3d20 5b0d 0a20 2020  ditions = [..   
+00007800: 2020 2020 2020 2020 2023 2055 7365 206d           # Use m
+00007810: 6178 696d 756d 2072 616e 6b20 6966 2072  aximum rank if r
+00007820: 616e 6b20 6973 206c 6172 6765 7220 7468  ank is larger th
+00007830: 616e 2074 6865 206c 656e 6774 6820 6f66  an the length of
+00007840: 2074 6865 2064 6174 6173 6574 0d0a 2020   the dataset..  
+00007850: 2020 2020 2020 2020 2020 286c 6566 745b            (left[
+00007860: 275f 5f52 616e 6b5f 5f27 5d20 3e20 6c65  '__Rank__'] > le
+00007870: 6674 5b27 5f5f 5369 7a65 5f5f 275d 292c  ft['__Size__']),
+00007880: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00007890: 5573 6520 7261 6e6b 206f 6620 3120 6966  Use rank of 1 if
+000078a0: 2072 616e 6b20 6973 206c 6573 7320 7468   rank is less th
+000078b0: 616e 2031 0d0a 2020 2020 2020 2020 2020  an 1..          
+000078c0: 2020 286c 6566 745b 275f 5f52 616e 6b5f    (left['__Rank_
+000078d0: 5f27 5d20 3c20 3129 0d0a 2020 2020 2020  _'] < 1)..      
+000078e0: 2020 2020 2020 5d0d 0a20 2020 2020 2020        ]..       
+000078f0: 200d 0a20 2020 2020 2020 2072 6573 756c   ..        resul
+00007900: 7473 203d 205b 0d0a 2020 2020 2020 2020  ts = [..        
+00007910: 2020 2020 6c65 6674 5b27 5f5f 5369 7a65      left['__Size
+00007920: 5f5f 275d 2c0d 0a20 2020 2020 2020 2020  __'],..         
+00007930: 2020 2031 0d0a 2020 2020 2020 2020 2020     1..          
+00007940: 2020 5d0d 0a20 2020 2020 2020 200d 0a20    ]..        .. 
+00007950: 2020 2020 2020 206c 6566 745b 275f 5f52         left['__R
+00007960: 616e 6b5f 5f27 5d20 3d20 6e70 2e73 656c  ank__'] = np.sel
+00007970: 6563 7428 636f 6e64 6974 696f 6e73 2c20  ect(conditions, 
+00007980: 7265 7375 6c74 732c 206c 6566 745b 275f  results, left['_
+00007990: 5f52 616e 6b5f 5f27 5d29 0d0a 2020 2020  _Rank__'])..    
+000079a0: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+000079b0: 4765 6e65 7261 7465 2070 726f 7869 6d69  Generate proximi
+000079c0: 7479 206f 6620 6561 6368 2072 6573 756c  ty of each resul
+000079d0: 7420 746f 2070 6572 6365 6e74 696c 6520  t to percentile 
+000079e0: 7261 6e6b 2075 7369 6e67 2074 6865 2069  rank using the i
+000079f0: 6e64 6578 0d0a 2020 2020 2020 2020 6c65  ndex..        le
+00007a00: 6674 5b27 5f5f 5072 6f78 696d 6974 795f  ft['__Proximity_
+00007a10: 5f27 5d20 3d20 300d 0a20 2020 2020 2020  _'] = 0..       
+00007a20: 200d 0a20 2020 2020 2020 2063 6f6e 6469   ..        condi
+00007a30: 7469 6f6e 7320 3d20 5b0d 0a20 2020 2020  tions = [..     
+00007a40: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+00007a50: 7065 7263 656e 7469 6c65 2072 616e 6b20  percentile rank 
+00007a60: 6973 2061 2077 686f 6c65 206e 756d 6265  is a whole numbe
+00007a70: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+00007a80: 2320 7468 656e 2075 7365 2074 6861 7420  # then use that 
+00007a90: 696e 6465 7820 7265 7375 6c74 0d0a 2020  index result..  
+00007aa0: 2020 2020 2020 2020 2020 286c 6566 745b            (left[
+00007ab0: 275f 5f52 616e 6b5f 5f27 5d20 3d3d 206c  '__Rank__'] == l
+00007ac0: 6566 745b 275f 5f49 6e64 6578 5f5f 275d  eft['__Index__']
+00007ad0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00007ae0: 2320 4966 2074 6865 2070 6572 6365 6e74  # If the percent
+00007af0: 696c 6520 7261 6e6b 2069 7320 6c65 7373  ile rank is less
+00007b00: 2074 6861 6e20 3120 6162 6f76 6520 7468   than 1 above th
+00007b10: 6520 696e 6465 7820 7661 6c75 652c 0d0a  e index value,..
+00007b20: 2020 2020 2020 2020 2020 2020 2320 7468              # th
+00007b30: 656e 2061 7373 6967 6e20 7468 6520 6170  en assign the ap
+00007b40: 7072 6f70 7269 6174 6520 636f 6e74 7269  propriate contri
+00007b50: 6275 7469 6f6e 2074 6f20 7468 6174 2069  bution to that i
+00007b60: 6e64 6578 2076 616c 7565 0d0a 2020 2020  ndex value..    
+00007b70: 2020 2020 2020 2020 2828 6c65 6674 5b27          ((left['
+00007b80: 5f5f 5261 6e6b 5f5f 275d 202d 206c 6566  __Rank__'] - lef
+00007b90: 745b 275f 5f49 6e64 6578 5f5f 275d 290d  t['__Index__']).
+00007ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007bc0: 2020 2020 2020 2020 2020 2e62 6574 7765            .betwe
+00007bd0: 656e 2830 2c31 2c69 6e63 6c75 7369 7665  en(0,1,inclusive
+00007be0: 3d27 6e65 6974 6865 7227 2929 2c0d 0a20  ='neither')),.. 
+00007bf0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+00007c00: 7468 6520 7065 7263 656e 7469 6c65 2072  the percentile r
+00007c10: 616e 6b20 6973 206c 6573 7320 7468 616e  ank is less than
+00007c20: 2031 2062 656c 6f77 2074 6865 2069 6e64   1 below the ind
+00007c30: 6578 2076 616c 7565 2c0d 0a20 2020 2020  ex value,..     
+00007c40: 2020 2020 2020 2023 2074 6865 6e20 6173         # then as
+00007c50: 7369 676e 2074 6865 2061 7070 726f 7072  sign the appropr
+00007c60: 6961 7465 2063 6f6e 7472 6962 7574 696f  iate contributio
+00007c70: 6e20 746f 2074 6861 7420 696e 6465 7820  n to that index 
+00007c80: 7661 6c75 650d 0a20 2020 2020 2020 2020  value..         
+00007c90: 2020 2028 286c 6566 745b 275f 5f49 6e64     ((left['__Ind
+00007ca0: 6578 5f5f 275d 202d 206c 6566 745b 275f  ex__'] - left['_
+00007cb0: 5f52 616e 6b5f 5f27 5d29 0d0a 2020 2020  _Rank__'])..    
+00007cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ce0: 2020 2020 202e 6265 7477 6565 6e28 302c       .between(0,
+00007cf0: 312c 696e 636c 7573 6976 653d 276e 6569  1,inclusive='nei
+00007d00: 7468 6572 2729 290d 0a20 2020 2020 2020  ther'))..       
+00007d10: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
+00007d20: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+00007d30: 7320 3d20 5b0d 0a20 2020 2020 2020 2020  s = [..         
+00007d40: 2020 2031 2c0d 0a20 2020 2020 2020 2020     1,..         
+00007d50: 2020 2031 202d 2028 6c65 6674 5b27 5f5f     1 - (left['__
+00007d60: 5261 6e6b 5f5f 275d 202d 206c 6566 745b  Rank__'] - left[
+00007d70: 275f 5f49 6e64 6578 5f5f 275d 292c 0d0a  '__Index__']),..
+00007d80: 2020 2020 2020 2020 2020 2020 3120 2d20              1 - 
+00007d90: 286c 6566 745b 275f 5f49 6e64 6578 5f5f  (left['__Index__
+00007da0: 275d 202d 206c 6566 745b 275f 5f52 616e  '] - left['__Ran
+00007db0: 6b5f 5f27 5d29 2c0d 0a20 2020 2020 2020  k__']),..       
+00007dc0: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
+00007dd0: 0d0a 2020 2020 2020 2020 6c65 6674 5b27  ..        left['
+00007de0: 5f5f 5072 6f78 696d 6974 795f 5f27 5d20  __Proximity__'] 
+00007df0: 3d20 6e70 2e73 656c 6563 7428 636f 6e64  = np.select(cond
+00007e00: 6974 696f 6e73 2c20 7265 7375 6c74 732c  itions, results,
+00007e10: 206e 702e 6e61 6e29 0d0a 2020 2020 2020   np.nan)..      
+00007e20: 2020 0d0a 2020 2020 2020 2020 2320 4472    ..        # Dr
+00007e30: 6f70 206e 6f6e 2d63 6f6e 7472 6962 7574  op non-contribut
+00007e40: 696e 6720 726f 7773 0d0a 2020 2020 2020  ing rows..      
+00007e50: 2020 6c65 6674 203d 206c 6566 745b 6c65    left = left[le
+00007e60: 6674 5b27 5f5f 5072 6f78 696d 6974 795f  ft['__Proximity_
+00007e70: 5f27 5d20 3e20 305d 0d0a 2020 2020 2020  _'] > 0]..      
+00007e80: 2020 0d0a 2020 2020 2020 2020 2320 4361    ..        # Ca
+00007e90: 6c63 756c 6174 6520 636f 6e74 7269 6275  lculate contribu
+00007ea0: 7469 6f6e 2066 6f72 2069 6e64 6578 2076  tion for index v
+00007eb0: 616c 7565 7320 7468 6174 2063 6f6e 7472  alues that contr
+00007ec0: 6962 7574 6520 746f 2074 6865 2072 6573  ibute to the res
+00007ed0: 756c 740d 0a20 2020 2020 2020 206c 6566  ult..        lef
+00007ee0: 745b 275f 5f43 6f6e 7472 6962 7574 696f  t['__Contributio
+00007ef0: 6e5f 5f27 5d20 3d20 280d 0a20 2020 2020  n__'] = (..     
+00007f00: 2020 2020 2020 2020 2020 206c 6566 745b             left[
+00007f10: 275f 5f50 726f 7869 6d69 7479 5f5f 275d  '__Proximity__']
+00007f20: 202a 206c 6566 745b 7365 6c66 2e6c 6566   * left[self.lef
+00007f30: 745f 626f 756e 645f 636f 6c5d 0d0a 2020  t_bound_col]..  
+00007f40: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00007f50: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+00007f60: 2049 6620 6772 6f75 7062 795f 636f 6c73   If groupby_cols
+00007f70: 2c20 7468 656e 2067 726f 7570 2064 6174  , then group dat
+00007f80: 610d 0a20 2020 2020 2020 2069 6620 6772  a..        if gr
+00007f90: 6f75 7062 795f 636f 6c73 203d 3d20 4e6f  oupby_cols == No
+00007fa0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00007fb0: 206c 6566 7420 3d20 7064 2e44 6174 6146   left = pd.DataF
+00007fc0: 7261 6d65 280d 0a20 2020 2020 2020 2020  rame(..         
+00007fd0: 2020 2020 2020 205b 5b6d 6178 286c 6566         [[max(lef
+00007fe0: 745b 7365 6c66 2e6c 6566 745f 626f 756e  t[self.left_boun
+00007ff0: 6461 7279 5f63 6f6c 5d29 2c0d 0a20 2020  dary_col]),..   
+00008000: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008010: 756d 286c 6566 745b 275f 5f43 6f6e 7472  um(left['__Contr
+00008020: 6962 7574 696f 6e5f 5f27 5d29 2c0d 0a20  ibution__']),.. 
+00008030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008040: 206d 696e 286c 6566 745b 275f 5f43 6f6e   min(left['__Con
+00008050: 7472 6962 7574 696f 6e5f 5f27 5d29 5d5d  tribution__'])]]
+00008060: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00008070: 2020 2063 6f6c 756d 6e73 3d5b 0d0a 2020     columns=[..  
+00008080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008090: 2020 7365 6c66 2e6c 6566 745f 626f 756e    self.left_boun
+000080a0: 6461 7279 5f63 6f6c 2c0d 0a20 2020 2020  dary_col,..     
+000080b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000080c0: 656c 662e 6c65 6674 5f62 6f75 6e64 5f63  elf.left_bound_c
+000080d0: 6f6c 2c0d 0a20 2020 2020 2020 2020 2020  ol,..           
+000080e0: 2020 2020 2020 2020 2027 5f5f 4d69 6e69           '__Mini
+000080f0: 6d75 6d5f 5f27 0d0a 2020 2020 2020 2020  mum__'..        
+00008100: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
+00008110: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00008120: 0d0a 2020 2020 2020 2020 2320 4465 7465  ..        # Dete
+00008130: 726d 696e 6520 6c65 6674 2062 6f75 6e64  rmine left bound
+00008140: 2061 6e64 2062 6f75 6e64 6172 7920 7573   and boundary us
+00008150: 696e 6720 7468 6520 7375 6d20 6f66 2074  ing the sum of t
+00008160: 6865 2063 6f6e 7472 6962 7574 696f 6e73  he contributions
+00008170: 0d0a 2020 2020 2020 2020 2320 616e 6420  ..        # and 
+00008180: 616e 206f 7065 6e20 626f 756e 6461 7279  an open boundary
+00008190: 2069 6620 616e 7920 6f66 2074 6865 2063   if any of the c
+000081a0: 6f6e 7472 6962 7574 696e 6720 7661 6c75  ontributing valu
+000081b0: 6573 2069 7320 6f70 656e 0d0a 2020 2020  es is open..    
+000081c0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000081d0: 2020 2020 2020 206c 6566 7420 3d20 280d         left = (.
+000081e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000081f0: 206c 6566 742e 6772 6f75 7062 7928 6772   left.groupby(gr
+00008200: 6f75 7062 795f 636f 6c73 290d 0a20 2020  oupby_cols)..   
+00008210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008220: 202e 6167 6728 2a2a 7b0d 0a20 2020 2020   .agg(**{..     
+00008230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008240: 2020 2073 656c 662e 6c65 6674 5f62 6f75     self.left_bou
+00008250: 6e64 6172 795f 636f 6c3a 2028 7365 6c66  ndary_col: (self
+00008260: 2e6c 6566 745f 626f 756e 6461 7279 5f63  .left_boundary_c
+00008270: 6f6c 2c0d 0a20 2020 2020 2020 2020 2020  ol,..           
+00008280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000082a0: 2020 2020 2020 276d 6178 2729 2c0d 0a20        'max'),.. 
+000082b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000082c0: 2020 2020 2020 2073 656c 662e 6c65 6674         self.left
+000082d0: 5f62 6f75 6e64 5f63 6f6c 3a20 2827 5f5f  _bound_col: ('__
+000082e0: 436f 6e74 7269 6275 7469 6f6e 5f5f 272c  Contribution__',
+000082f0: 2027 7375 6d27 292c 0d0a 2020 2020 2020   'sum'),..      
+00008300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008310: 2020 275f 5f4d 696e 696d 756d 5f5f 273a    '__Minimum__':
+00008320: 2028 275f 5f43 6f6e 7472 6962 7574 696f   ('__Contributio
+00008330: 6e5f 5f27 2c20 276d 696e 2729 0d0a 2020  n__', 'min')..  
+00008340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008350: 2020 2020 2020 7d29 0d0a 2020 2020 2020        })..      
+00008360: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00008370: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00008380: 2020 2023 2052 6570 6c61 6365 2074 6865     # Replace the
+00008390: 206e 756d 6572 6963 2076 616c 7565 2066   numeric value f
+000083a0: 6f72 2074 6865 2062 6f75 6e64 6172 790d  or the boundary.
+000083b0: 0a20 2020 2020 2020 206c 6566 745b 7365  .        left[se
+000083c0: 6c66 2e6c 6566 745f 626f 756e 6461 7279  lf.left_boundary
+000083d0: 5f63 6f6c 5d20 3d20 280d 0a20 2020 2020  _col] = (..     
+000083e0: 2020 2020 2020 206c 6566 745b 7365 6c66         left[self
+000083f0: 2e6c 6566 745f 626f 756e 6461 7279 5f63  .left_boundary_c
+00008400: 6f6c 5d0d 0a20 2020 2020 2020 2020 2020  ol]..           
+00008410: 2020 2020 202e 7265 706c 6163 6528 5b30       .replace([0
+00008420: 2c31 5d2c 205b 2743 6c6f 7365 6427 2c27  ,1], ['Closed','
+00008430: 4f70 656e 275d 290d 0a20 2020 2020 2020  Open'])..       
+00008440: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00008450: 0d0a 2020 2020 2020 2020 2320 5375 6d73  ..        # Sums
+00008460: 2077 6974 6820 696e 6669 6e69 7465 2076   with infinite v
+00008470: 616c 7565 7320 7072 6f64 7563 6520 6e61  alues produce na
+00008480: 6e20 7661 6c75 6573 2072 6174 6865 7220  n values rather 
+00008490: 7468 616e 200d 0a20 2020 2020 2020 2023  than ..        #
+000084a0: 206e 702e 696e 6620 7661 6c75 6573 2e20   np.inf values. 
+000084b0: 436f 6e76 6572 7420 6e61 6e20 746f 2069  Convert nan to i
+000084c0: 6e66 206f 6e6c 7920 6966 2069 6e66 696e  nf only if infin
+000084d0: 6974 6520 7661 6c75 6573 2061 7265 0d0a  ite values are..
+000084e0: 2020 2020 2020 2020 2320 696e 636c 7564          # includ
+000084f0: 6564 2069 6e20 7468 6520 7375 6d0d 0a20  ed in the sum.. 
+00008500: 2020 2020 2020 206c 6566 745b 7365 6c66         left[self
+00008510: 2e6c 6566 745f 626f 756e 645f 636f 6c5d  .left_bound_col]
+00008520: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+00008530: 2020 6e70 2e77 6865 7265 286c 6566 745b    np.where(left[
+00008540: 275f 5f4d 696e 696d 756d 5f5f 275d 203d  '__Minimum__'] =
+00008550: 3d20 2d6e 702e 696e 662c 0d0a 2020 2020  = -np.inf,..    
+00008560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008570: 202d 6e70 2e69 6e66 2c0d 0a20 2020 2020   -np.inf,..     
+00008580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008590: 6c65 6674 5b73 656c 662e 6c65 6674 5f62  left[self.left_b
+000085a0: 6f75 6e64 5f63 6f6c 5d0d 0a20 2020 2020  ound_col]..     
+000085b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000085c0: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
+000085d0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+000085e0: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
+000085f0: 7269 6768 7420 626f 756e 6420 616e 6420  right bound and 
+00008600: 626f 756e 6461 7279 2066 6f72 2065 6163  boundary for eac
+00008610: 6820 6772 6f75 700d 0a20 2020 2020 2020  h group..       
+00008620: 200d 0a20 2020 2020 2020 2023 2043 6861   ..        # Cha
+00008630: 6e67 6520 6e6f 7461 7469 6f6e 206f 6620  nge notation of 
+00008640: 2743 6c6f 7365 6427 2061 6e64 2027 4f70  'Closed' and 'Op
+00008650: 656e 2720 626f 756e 6461 7269 6573 2074  en' boundaries t
+00008660: 6f20 3120 616e 6420 302c 0d0a 2020 2020  o 1 and 0,..    
+00008670: 2020 2020 2320 7265 7370 6563 7469 7665      # respective
+00008680: 6c79 2e20 5573 6520 3120 666f 7220 636c  ly. Use 1 for cl
+00008690: 6f73 6564 2074 6f20 656e 7375 7265 2074  osed to ensure t
+000086a0: 6861 7420 636c 6f73 6564 2062 6f75 6e64  hat closed bound
+000086b0: 6172 6965 7320 6172 650d 0a20 2020 2020  aries are..     
+000086c0: 2020 2023 2073 6f72 7465 6420 6c61 7267     # sorted larg
+000086d0: 6572 2074 6861 6e20 6f70 656e 2062 6f75  er than open bou
+000086e0: 6e64 6172 6965 7320 7768 656e 2074 6865  ndaries when the
+000086f0: 2072 6967 6874 2062 6f75 6e64 2069 7320   right bound is 
+00008700: 7469 6564 0d0a 2020 2020 2020 2020 6466  tied..        df
+00008710: 5b73 656c 662e 7269 6768 745f 626f 756e  [self.right_boun
+00008720: 6461 7279 5f63 6f6c 5d20 3d20 280d 0a20  dary_col] = (.. 
+00008730: 2020 2020 2020 2020 2020 2064 665b 7365             df[se
+00008740: 6c66 2e72 6967 6874 5f62 6f75 6e64 6172  lf.right_boundar
+00008750: 795f 636f 6c5d 0d0a 2020 2020 2020 2020  y_col]..        
+00008760: 2020 2020 2020 2020 2e72 6570 6c61 6365          .replace
+00008770: 285b 2743 6c6f 7365 6427 2c27 4f70 656e  (['Closed','Open
+00008780: 275d 2c20 5b31 2c30 5d29 0d0a 2020 2020  '], [1,0])..    
+00008790: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+000087a0: 2020 200d 0a20 2020 2020 2020 2023 2053     ..        # S
+000087b0: 6f72 7420 7269 6768 7420 626f 756e 6420  ort right bound 
+000087c0: 7661 6c75 6573 0d0a 2020 2020 2020 2020  values..        
+000087d0: 6772 6f75 7069 6e67 203d 205b 275f 5f53  grouping = ['__S
+000087e0: 697a 655f 5f27 2c20 7365 6c66 2e72 6967  ize__', self.rig
+000087f0: 6874 5f62 6f75 6e64 6172 795f 636f 6c2c  ht_boundary_col,
+00008800: 2073 656c 662e 7269 6768 745f 626f 756e   self.right_boun
+00008810: 645f 636f 6c5d 0d0a 2020 2020 2020 2020  d_col]..        
+00008820: 6966 2067 726f 7570 6279 5f63 6f6c 7320  if groupby_cols 
+00008830: 213d 204e 6f6e 653a 0d0a 2020 2020 2020  != None:..      
+00008840: 2020 2020 2020 6772 6f75 7069 6e67 203d        grouping =
+00008850: 2067 726f 7570 6279 5f63 6f6c 7320 2b20   groupby_cols + 
+00008860: 6772 6f75 7069 6e67 0d0a 2020 2020 2020  grouping..      
+00008870: 2020 0d0a 2020 2020 2020 2020 7269 6768    ..        righ
+00008880: 7420 3d20 280d 0a20 2020 2020 2020 2020  t = (..         
+00008890: 2020 2064 662e 636f 7079 2829 5b67 726f     df.copy()[gro
+000088a0: 7570 696e 675d 0d0a 2020 2020 2020 2020  uping]..        
+000088b0: 2020 2020 2020 2020 2e73 6f72 745f 7661          .sort_va
+000088c0: 6c75 6573 280d 0a20 2020 2020 2020 2020  lues(..         
+000088d0: 2020 2020 2020 2020 2020 2062 7920 3d20             by = 
+000088e0: 5b73 656c 662e 7269 6768 745f 626f 756e  [self.right_boun
+000088f0: 645f 636f 6c2c 2073 656c 662e 7269 6768  d_col, self.righ
+00008900: 745f 626f 756e 6461 7279 5f63 6f6c 5d0d  t_boundary_col].
+00008910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008920: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00008930: 2020 2020 290d 0a20 2020 2020 2020 200d      )..        .
+00008940: 0a20 2020 2020 2020 2023 2041 6464 2069  .        # Add i
+00008950: 6e64 6578 2066 6f72 2065 6163 6820 6772  ndex for each gr
+00008960: 6f75 700d 0a20 2020 2020 2020 2069 6620  oup..        if 
+00008970: 6772 6f75 7062 795f 636f 6c73 203d 3d20  groupby_cols == 
+00008980: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00008990: 2020 2072 6967 6874 5b27 5f5f 496e 6465     right['__Inde
+000089a0: 785f 5f27 5d20 3d20 7261 6e67 6528 312c  x__'] = range(1,
+000089b0: 2031 2b6c 656e 2872 6967 6874 2929 0d0a   1+len(right))..
+000089c0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000089d0: 2020 2020 2020 2020 2020 2072 6967 6874             right
+000089e0: 5b27 5f5f 496e 6465 785f 5f27 5d20 3d20  ['__Index__'] = 
+000089f0: 7269 6768 742e 6772 6f75 7062 7928 6772  right.groupby(gr
+00008a00: 6f75 7062 795f 636f 6c73 292e 6375 6d63  oupby_cols).cumc
+00008a10: 6f75 6e74 2829 202b 2031 0d0a 2020 2020  ount() + 1..    
+00008a20: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+00008a30: 4465 7465 726d 696e 6520 7468 6520 7261  Determine the ra
+00008a40: 6e6b 2069 6e20 6561 6368 2067 726f 7570  nk in each group
+00008a50: 2066 6f72 2074 6865 2070 6572 6365 6e74   for the percent
+00008a60: 696c 650d 0a20 2020 2020 2020 2072 6967  ile..        rig
+00008a70: 6874 5b27 5f5f 5261 6e6b 5f5f 275d 203d  ht['__Rank__'] =
+00008a80: 2072 6f75 6e64 280d 0a20 2020 2020 2020   round(..       
+00008a90: 2020 2020 2043 202b 2070 6572 6365 6e74       C + percent
+00008aa0: 696c 652a 2872 6967 6874 5b27 5f5f 5369  ile*(right['__Si
+00008ab0: 7a65 5f5f 275d 202b 2031 202d 2032 2a43  ze__'] + 1 - 2*C
+00008ac0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00008ad0: 380d 0a20 2020 2020 2020 2020 2020 2029  8..            )
+00008ae0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00008af0: 2020 2020 2320 4861 6e64 6c65 2073 6974      # Handle sit
+00008b00: 7561 7469 6f6e 7320 7768 6572 6520 7261  uations where ra
+00008b10: 6e6b 2069 7320 6f75 7473 6964 6520 7468  nk is outside th
+00008b20: 6520 7261 6e67 6520 3120 746f 206c 656e  e range 1 to len
+00008b30: 6774 6820 6f66 2064 6174 610d 0a20 2020  gth of data..   
+00008b40: 2020 2020 2063 6f6e 6469 7469 6f6e 7320       conditions 
+00008b50: 3d20 5b0d 0a20 2020 2020 2020 2020 2020  = [..           
+00008b60: 2023 2055 7365 206d 6178 696d 756d 2072   # Use maximum r
+00008b70: 616e 6b20 6966 2072 616e 6b20 6973 206c  ank if rank is l
+00008b80: 6172 6765 7220 7468 616e 2074 6865 206c  arger than the l
+00008b90: 656e 6774 6820 6f66 2074 6865 2064 6174  ength of the dat
+00008ba0: 6173 6574 0d0a 2020 2020 2020 2020 2020  aset..          
+00008bb0: 2020 2872 6967 6874 5b27 5f5f 5261 6e6b    (right['__Rank
+00008bc0: 5f5f 275d 203e 2072 6967 6874 5b27 5f5f  __'] > right['__
+00008bd0: 5369 7a65 5f5f 275d 292c 0d0a 2020 2020  Size__']),..    
+00008be0: 2020 2020 2020 2020 2320 5573 6520 7261          # Use ra
+00008bf0: 6e6b 206f 6620 3120 6966 2072 616e 6b20  nk of 1 if rank 
+00008c00: 6973 206c 6573 7320 7468 616e 2031 0d0a  is less than 1..
+00008c10: 2020 2020 2020 2020 2020 2020 2872 6967              (rig
+00008c20: 6874 5b27 5f5f 5261 6e6b 5f5f 275d 203c  ht['__Rank__'] <
+00008c30: 2031 290d 0a20 2020 2020 2020 2020 2020   1)..           
+00008c40: 205d 0d0a 2020 2020 2020 2020 0d0a 2020   ]..        ..  
+00008c50: 2020 2020 2020 7265 7375 6c74 7320 3d20        results = 
+00008c60: 5b0d 0a20 2020 2020 2020 2020 2020 2072  [..            r
+00008c70: 6967 6874 5b27 5f5f 5369 7a65 5f5f 275d  ight['__Size__']
+00008c80: 2c0d 0a20 2020 2020 2020 2020 2020 2031  ,..            1
+00008c90: 0d0a 2020 2020 2020 2020 2020 2020 5d0d  ..            ].
+00008ca0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00008cb0: 2020 2072 6967 6874 5b27 5f5f 5261 6e6b     right['__Rank
+00008cc0: 5f5f 275d 203d 206e 702e 7365 6c65 6374  __'] = np.select
+00008cd0: 2863 6f6e 6469 7469 6f6e 732c 2072 6573  (conditions, res
+00008ce0: 756c 7473 2c20 7269 6768 745b 275f 5f52  ults, right['__R
+00008cf0: 616e 6b5f 5f27 5d29 0d0a 2020 2020 2020  ank__'])..      
+00008d00: 2020 0d0a 2020 2020 2020 2020 2320 4765    ..        # Ge
+00008d10: 6e65 7261 7465 2070 726f 7869 6d69 7479  nerate proximity
+00008d20: 206f 6620 6561 6368 2072 6573 756c 7420   of each result 
+00008d30: 746f 2070 6572 6365 6e74 696c 6520 7261  to percentile ra
+00008d40: 6e6b 2075 7369 6e67 2074 6865 2069 6e64  nk using the ind
+00008d50: 6578 0d0a 2020 2020 2020 2020 7269 6768  ex..        righ
+00008d60: 745b 275f 5f50 726f 7869 6d69 7479 5f5f  t['__Proximity__
+00008d70: 275d 203d 2030 0d0a 2020 2020 2020 2020  '] = 0..        
+00008d80: 0d0a 2020 2020 2020 2020 636f 6e64 6974  ..        condit
+00008d90: 696f 6e73 203d 205b 0d0a 2020 2020 2020  ions = [..      
+00008da0: 2020 2020 2020 2320 4966 2074 6865 2070        # If the p
+00008db0: 6572 6365 6e74 696c 6520 7261 6e6b 2069  ercentile rank i
+00008dc0: 7320 6120 7768 6f6c 6520 6e75 6d62 6572  s a whole number
+00008dd0: 2c0d 0a20 2020 2020 2020 2020 2020 2023  ,..            #
+00008de0: 2074 6865 6e20 7573 6520 7468 6174 2069   then use that i
+00008df0: 6e64 6578 2072 6573 756c 740d 0a20 2020  ndex result..   
+00008e00: 2020 2020 2020 2020 2028 7269 6768 745b           (right[
+00008e10: 275f 5f52 616e 6b5f 5f27 5d20 3d3d 2072  '__Rank__'] == r
+00008e20: 6967 6874 5b27 5f5f 496e 6465 785f 5f27  ight['__Index__'
+00008e30: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
+00008e40: 2023 2049 6620 7468 6520 7065 7263 656e   # If the percen
+00008e50: 7469 6c65 2072 616e 6b20 6973 206c 6573  tile rank is les
+00008e60: 7320 7468 616e 2031 2061 626f 7665 2074  s than 1 above t
+00008e70: 6865 2069 6e64 6578 2076 616c 7565 2c0d  he index value,.
+00008e80: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
+00008e90: 6865 6e20 6173 7369 676e 2074 6865 2061  hen assign the a
+00008ea0: 7070 726f 7072 6961 7465 2063 6f6e 7472  ppropriate contr
+00008eb0: 6962 7574 696f 6e20 746f 2074 6861 7420  ibution to that 
+00008ec0: 696e 6465 7820 7661 6c75 650d 0a20 2020  index value..   
+00008ed0: 2020 2020 2020 2020 2028 2872 6967 6874           ((right
+00008ee0: 5b27 5f5f 5261 6e6b 5f5f 275d 202d 2072  ['__Rank__'] - r
+00008ef0: 6967 6874 5b27 5f5f 496e 6465 785f 5f27  ight['__Index__'
+00008f00: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00008f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f20: 2020 2020 2020 2020 2020 2020 202e 6265               .be
+00008f30: 7477 6565 6e28 302c 312c 696e 636c 7573  tween(0,1,inclus
+00008f40: 6976 653d 276e 6569 7468 6572 2729 292c  ive='neither')),
+00008f50: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00008f60: 4966 2074 6865 2070 6572 6365 6e74 696c  If the percentil
+00008f70: 6520 7261 6e6b 2069 7320 6c65 7373 2074  e rank is less t
+00008f80: 6861 6e20 3120 6265 6c6f 7720 7468 6520  han 1 below the 
+00008f90: 696e 6465 7820 7661 6c75 652c 0d0a 2020  index value,..  
+00008fa0: 2020 2020 2020 2020 2020 2320 7468 656e            # then
+00008fb0: 2061 7373 6967 6e20 7468 6520 6170 7072   assign the appr
+00008fc0: 6f70 7269 6174 6520 636f 6e74 7269 6275  opriate contribu
+00008fd0: 7469 6f6e 2074 6f20 7468 6174 2069 6e64  tion to that ind
+00008fe0: 6578 2076 616c 7565 0d0a 2020 2020 2020  ex value..      
+00008ff0: 2020 2020 2020 2828 7269 6768 745b 275f        ((right['_
+00009000: 5f49 6e64 6578 5f5f 275d 202d 2072 6967  _Index__'] - rig
+00009010: 6874 5b27 5f5f 5261 6e6b 5f5f 275d 290d  ht['__Rank__']).
+00009020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009040: 2020 2020 2020 2020 2020 2e62 6574 7765            .betwe
+00009050: 656e 2830 2c31 2c69 6e63 6c75 7369 7665  en(0,1,inclusive
+00009060: 3d27 6e65 6974 6865 7227 2929 0d0a 2020  ='neither'))..  
+00009070: 2020 2020 2020 2020 2020 5d0d 0a20 2020            ]..   
+00009080: 2020 2020 200d 0a20 2020 2020 2020 2072       ..        r
+00009090: 6573 756c 7473 203d 205b 0d0a 2020 2020  esults = [..    
+000090a0: 2020 2020 2020 2020 312c 0d0a 2020 2020          1,..    
+000090b0: 2020 2020 2020 2020 3120 2d20 2872 6967          1 - (rig
+000090c0: 6874 5b27 5f5f 5261 6e6b 5f5f 275d 202d  ht['__Rank__'] -
+000090d0: 2072 6967 6874 5b27 5f5f 496e 6465 785f   right['__Index_
+000090e0: 5f27 5d29 2c0d 0a20 2020 2020 2020 2020  _']),..         
+000090f0: 2020 2031 202d 2028 7269 6768 745b 275f     1 - (right['_
+00009100: 5f49 6e64 6578 5f5f 275d 202d 2072 6967  _Index__'] - rig
+00009110: 6874 5b27 5f5f 5261 6e6b 5f5f 275d 292c  ht['__Rank__']),
+00009120: 0d0a 2020 2020 2020 2020 2020 2020 5d0d  ..            ].
+00009130: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00009140: 2020 2072 6967 6874 5b27 5f5f 5072 6f78     right['__Prox
+00009150: 696d 6974 795f 5f27 5d20 3d20 6e70 2e73  imity__'] = np.s
+00009160: 656c 6563 7428 636f 6e64 6974 696f 6e73  elect(conditions
+00009170: 2c20 7265 7375 6c74 732c 206e 702e 6e61  , results, np.na
+00009180: 6e29 0d0a 2020 2020 2020 2020 0d0a 2020  n)..        ..  
+00009190: 2020 2020 2020 2320 4472 6f70 206e 6f6e        # Drop non
+000091a0: 2d63 6f6e 7472 6962 7574 696e 6720 726f  -contributing ro
+000091b0: 7773 0d0a 2020 2020 2020 2020 7269 6768  ws..        righ
+000091c0: 7420 3d20 7269 6768 745b 7269 6768 745b  t = right[right[
+000091d0: 275f 5f50 726f 7869 6d69 7479 5f5f 275d  '__Proximity__']
+000091e0: 203e 2030 5d0d 0a20 2020 2020 2020 200d   > 0]..        .
+000091f0: 0a20 2020 2020 2020 2023 2043 616c 6375  .        # Calcu
+00009200: 6c61 7465 2063 6f6e 7472 6962 7574 696f  late contributio
+00009210: 6e20 666f 7220 696e 6465 7820 7661 6c75  n for index valu
+00009220: 6573 2074 6861 7420 636f 6e74 7269 6275  es that contribu
+00009230: 7465 2074 6f20 7468 6520 7265 7375 6c74  te to the result
+00009240: 0d0a 2020 2020 2020 2020 7269 6768 745b  ..        right[
+00009250: 275f 5f43 6f6e 7472 6962 7574 696f 6e5f  '__Contribution_
+00009260: 5f27 5d20 3d20 280d 0a20 2020 2020 2020  _'] = (..       
+00009270: 2020 2020 2072 6967 6874 5b27 5f5f 5072       right['__Pr
+00009280: 6f78 696d 6974 795f 5f27 5d20 2a20 7269  oximity__'] * ri
+00009290: 6768 745b 7365 6c66 2e72 6967 6874 5f62  ght[self.right_b
+000092a0: 6f75 6e64 5f63 6f6c 5d0d 0a20 2020 2020  ound_col]..     
+000092b0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000092c0: 2020 0d0a 2020 2020 2020 2020 2320 4966    ..        # If
+000092d0: 2067 726f 7570 6279 5f63 6f6c 732c 2074   groupby_cols, t
+000092e0: 6865 6e20 6772 6f75 7020 6461 7461 0d0a  hen group data..
+000092f0: 2020 2020 2020 2020 6966 2067 726f 7570          if group
+00009300: 6279 5f63 6f6c 7320 3d3d 204e 6f6e 653a  by_cols == None:
+00009310: 0d0a 2020 2020 2020 2020 2020 2020 7269  ..            ri
+00009320: 6768 7420 3d20 7064 2e44 6174 6146 7261  ght = pd.DataFra
+00009330: 6d65 280d 0a20 2020 2020 2020 2020 2020  me(..           
+00009340: 2020 2020 205b 5b73 756d 2872 6967 6874       [[sum(right
+00009350: 5b27 5f5f 436f 6e74 7269 6275 7469 6f6e  ['__Contribution
+00009360: 5f5f 275d 292c 0d0a 2020 2020 2020 2020  __']),..        
+00009370: 2020 2020 2020 2020 2020 6d69 6e28 7269            min(ri
+00009380: 6768 745b 7365 6c66 2e72 6967 6874 5f62  ght[self.right_b
+00009390: 6f75 6e64 6172 795f 636f 6c5d 292c 0d0a  oundary_col]),..
+000093a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093b0: 2020 6d61 7828 7269 6768 745b 275f 5f43    max(right['__C
+000093c0: 6f6e 7472 6962 7574 696f 6e5f 5f27 5d29  ontribution__'])
+000093d0: 5d5d 2c0d 0a20 2020 2020 2020 2020 2020  ]],..           
+000093e0: 2020 2020 2063 6f6c 756d 6e73 3d5b 0d0a       columns=[..
+000093f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009400: 2020 2020 7365 6c66 2e72 6967 6874 5f62      self.right_b
+00009410: 6f75 6e64 5f63 6f6c 2c0d 0a20 2020 2020  ound_col,..     
+00009420: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009430: 656c 662e 7269 6768 745f 626f 756e 6461  elf.right_bounda
+00009440: 7279 5f63 6f6c 2c0d 0a20 2020 2020 2020  ry_col,..       
+00009450: 2020 2020 2020 2020 2020 2020 2027 5f5f               '__
+00009460: 4d61 7869 6d75 6d5f 5f27 0d0a 2020 2020  Maximum__'..    
+00009470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009480: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00009490: 2020 2029 0d0a 2020 2020 2020 2020 2320     )..        # 
+000094a0: 4465 7465 726d 696e 6520 6c65 6674 2062  Determine left b
+000094b0: 6f75 6e64 2061 6e64 2062 6f75 6e64 6172  ound and boundar
+000094c0: 7920 7573 696e 6720 7468 6520 7375 6d20  y using the sum 
+000094d0: 6f66 2074 6865 2063 6f6e 7472 6962 7574  of the contribut
+000094e0: 696f 6e73 0d0a 2020 2020 2020 2020 2320  ions..        # 
+000094f0: 616e 6420 616e 206f 7065 6e20 626f 756e  and an open boun
+00009500: 6461 7279 2069 6620 616e 7920 6f66 2074  dary if any of t
+00009510: 6865 2063 6f6e 7472 6962 7574 696e 6720  he contributing 
+00009520: 7661 6c75 6573 2069 7320 6f70 656e 0d0a  values is open..
+00009530: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00009540: 2020 2020 2020 2020 2020 2072 6967 6874             right
+00009550: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+00009560: 2020 2020 2020 7269 6768 742e 6772 6f75        right.grou
+00009570: 7062 7928 6772 6f75 7062 795f 636f 6c73  pby(groupby_cols
+00009580: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00009590: 2020 2020 2020 202e 6167 6728 2a2a 7b0d         .agg(**{.
+000095a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000095b0: 2020 2020 2020 2020 2073 656c 662e 7269           self.ri
+000095c0: 6768 745f 626f 756e 645f 636f 6c3a 2028  ght_bound_col: (
+000095d0: 275f 5f43 6f6e 7472 6962 7574 696f 6e5f  '__Contribution_
+000095e0: 5f27 2c20 2773 756d 2729 2c0d 0a20 2020  _', 'sum'),..   
+000095f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009600: 2020 2020 2073 656c 662e 7269 6768 745f       self.right_
+00009610: 626f 756e 6461 7279 5f63 6f6c 3a20 2873  boundary_col: (s
+00009620: 656c 662e 7269 6768 745f 626f 756e 6461  elf.right_bounda
+00009630: 7279 5f63 6f6c 2c0d 0a20 2020 2020 2020  ry_col,..       
+00009640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009660: 2020 2020 2020 2020 2020 2027 6d69 6e27             'min'
+00009670: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00009680: 2020 2020 2020 2020 2020 2020 275f 5f4d              '__M
+00009690: 6178 696d 756d 5f5f 273a 2028 275f 5f43  aximum__': ('__C
+000096a0: 6f6e 7472 6962 7574 696f 6e5f 5f27 2c20  ontribution__', 
+000096b0: 276d 6178 2729 0d0a 2020 2020 2020 2020  'max')..        
+000096c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000096d0: 7d29 0d0a 2020 2020 2020 2020 2020 2020  })..            
+000096e0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+000096f0: 2020 200d 0a20 2020 2020 2020 2023 2052     ..        # R
+00009700: 6570 6c61 6365 2074 6865 206e 756d 6572  eplace the numer
+00009710: 6963 2076 616c 7565 2066 6f72 2074 6865  ic value for the
+00009720: 2062 6f75 6e64 6172 790d 0a20 2020 2020   boundary..     
+00009730: 2020 2072 6967 6874 5b73 656c 662e 7269     right[self.ri
+00009740: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
+00009750: 5d20 3d20 280d 0a20 2020 2020 2020 2020  ] = (..         
+00009760: 2020 2072 6967 6874 5b73 656c 662e 7269     right[self.ri
+00009770: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
+00009780: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00009790: 2020 202e 7265 706c 6163 6528 5b31 2c30     .replace([1,0
+000097a0: 5d2c 205b 2743 6c6f 7365 6427 2c27 4f70  ], ['Closed','Op
+000097b0: 656e 275d 290d 0a20 2020 2020 2020 2020  en'])..         
+000097c0: 2020 2029 0d0a 2020 2020 2020 2020 0d0a     )..        ..
+000097d0: 2020 2020 2020 2020 2320 5375 6d73 2077          # Sums w
+000097e0: 6974 6820 696e 6669 6e69 7465 2076 616c  ith infinite val
+000097f0: 7565 7320 7072 6f64 7563 6520 6e61 6e20  ues produce nan 
+00009800: 7661 6c75 6573 2072 6174 6865 7220 7468  values rather th
+00009810: 616e 0d0a 2020 2020 2020 2020 2320 6e70  an..        # np
+00009820: 2e69 6e66 2076 616c 7565 732e 2043 6f6e  .inf values. Con
+00009830: 7665 7274 206e 616e 2074 6f20 696e 6620  vert nan to inf 
+00009840: 6f6e 6c79 2069 6620 696e 6669 6e69 7465  only if infinite
+00009850: 2076 616c 7565 7320 6172 650d 0a20 2020   values are..   
+00009860: 2020 2020 2023 2069 6e63 6c75 6465 6420       # included 
+00009870: 696e 2074 6865 2073 756d 0d0a 2020 2020  in the sum..    
+00009880: 2020 2020 7269 6768 745b 7365 6c66 2e72      right[self.r
+00009890: 6967 6874 5f62 6f75 6e64 5f63 6f6c 5d20  ight_bound_col] 
+000098a0: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
+000098b0: 206e 702e 7768 6572 6528 7269 6768 745b   np.where(right[
+000098c0: 275f 5f4d 6178 696d 756d 5f5f 275d 203d  '__Maximum__'] =
+000098d0: 3d20 6e70 2e69 6e66 2c0d 0a20 2020 2020  = np.inf,..     
+000098e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000098f0: 6e70 2e69 6e66 2c0d 0a20 2020 2020 2020  np.inf,..       
+00009900: 2020 2020 2020 2020 2020 2020 2020 7269                ri
+00009910: 6768 745b 7365 6c66 2e72 6967 6874 5f62  ght[self.right_b
+00009920: 6f75 6e64 5f63 6f6c 5d0d 0a20 2020 2020  ound_col]..     
+00009930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009940: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
+00009950: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00009960: 2020 2020 6966 2067 726f 7570 6279 5f63      if groupby_c
+00009970: 6f6c 7320 3d3d 204e 6f6e 653a 0d0a 2020  ols == None:..  
+00009980: 2020 2020 2020 2020 2020 6466 203d 2064            df = d
+00009990: 665b 5b27 5f5f 5761 726e 696e 675f 5f27  f[['__Warning__'
+000099a0: 5d5d 2e64 726f 705f 6475 706c 6963 6174  ]].drop_duplicat
+000099b0: 6573 2829 0d0a 2020 2020 2020 2020 2020  es()..          
+000099c0: 2020 6466 203d 2070 642e 636f 6e63 6174    df = pd.concat
+000099d0: 285b 6c65 6674 2c72 6967 6874 2c64 665d  ([left,right,df]
+000099e0: 2c20 6178 6973 3d31 290d 0a20 2020 2020  , axis=1)..     
+000099f0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00009a00: 2020 2020 2020 2320 4d65 7267 6520 7468        # Merge th
+00009a10: 6520 7477 6f20 626f 756e 6461 7269 6573  e two boundaries
+00009a20: 2074 6f20 6372 6561 7465 2074 6865 2069   to create the i
+00009a30: 6e74 6572 7661 6c20 666f 7220 7468 6520  nterval for the 
+00009a40: 7065 7263 656e 7469 6c65 0d0a 2020 2020  percentile..    
+00009a50: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+00009a60: 7468 6174 2074 6865 206d 6572 6765 2069  that the merge i
+00009a70: 7320 312d 746f 2d31 0d0a 2020 2020 2020  s 1-to-1..      
+00009a80: 2020 2020 2020 6466 203d 2064 665b 6772        df = df[gr
+00009a90: 6f75 7062 795f 636f 6c73 202b 205b 275f  oupby_cols + ['_
+00009aa0: 5f57 6172 6e69 6e67 5f5f 275d 5d2e 6472  _Warning__']].dr
+00009ab0: 6f70 5f64 7570 6c69 6361 7465 7328 290d  op_duplicates().
+00009ac0: 0a20 2020 2020 2020 2020 2020 206c 6566  .            lef
+00009ad0: 7420 3d20 6466 2e6d 6572 6765 286c 6566  t = df.merge(lef
+00009ae0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00009af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b00: 686f 7720 3d20 2769 6e6e 6572 272c 0d0a  how = 'inner',..
+00009b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b20: 2020 2020 2020 2020 2020 2020 6f6e 203d              on =
+00009b30: 2067 726f 7570 6279 5f63 6f6c 7329 0d0a   groupby_cols)..
+00009b40: 2020 2020 2020 2020 2020 2020 6466 203d              df =
+00009b50: 206c 6566 742e 6d65 7267 6528 7269 6768   left.merge(righ
+00009b60: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00009b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b80: 686f 7720 3d20 276f 7574 6572 272c 0d0a  how = 'outer',..
+00009b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ba0: 2020 2020 2020 2020 2020 2020 6f6e 203d              on =
+00009bb0: 2067 726f 7570 6279 5f63 6f6c 732c 0d0a   groupby_cols,..
+00009bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009bd0: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
+00009be0: 6461 7465 203d 2027 313a 3127 0d0a 2020  date = '1:1'..  
+00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c00: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00009c10: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+00009c20: 2043 7265 6174 6520 6120 636f 6c75 6d6e   Create a column
+00009c30: 2074 6861 7420 696e 6469 6361 7465 7320   that indicates 
+00009c40: 7468 6520 6765 6e65 7261 7465 6420 7374  the generated st
+00009c50: 6174 6973 7469 630d 0a20 2020 2020 2020  atistic..       
+00009c60: 2069 6620 7065 7263 656e 7469 6c65 203d   if percentile =
+00009c70: 3d20 302e 353a 0d0a 2020 2020 2020 2020  = 0.5:..        
+00009c80: 2020 2020 6466 5b73 656c 662e 7374 6174      df[self.stat
+00009c90: 5f63 6f6c 5d20 3d20 274d 6564 6961 6e27  _col] = 'Median'
+00009ca0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00009cb0: 0a20 2020 2020 2020 2020 2020 2064 665b  .            df[
+00009cc0: 7365 6c66 2e73 7461 745f 636f 6c5d 203d  self.stat_col] =
+00009cd0: 2066 2750 6572 6365 6e74 696c 652d 7b31   f'Percentile-{1
+00009ce0: 3030 2a70 6572 6365 6e74 696c 657d 270d  00*percentile}'.
+00009cf0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00009d00: 2020 2023 2052 656f 7264 6572 2063 6f6c     # Reorder col
+00009d10: 756d 6e73 0d0a 2020 2020 2020 2020 6966  umns..        if
+00009d20: 2067 726f 7570 6279 5f63 6f6c 7320 3d3d   groupby_cols ==
+00009d30: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00009d40: 2020 2020 6466 203d 2064 665b 5b73 656c      df = df[[sel
+00009d50: 662e 7374 6174 5f63 6f6c 2c0d 0a20 2020  f.stat_col,..   
+00009d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d70: 2020 7365 6c66 2e6c 6566 745f 626f 756e    self.left_boun
+00009d80: 6461 7279 5f63 6f6c 2c0d 0a20 2020 2020  dary_col,..     
+00009d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009da0: 7365 6c66 2e6c 6566 745f 626f 756e 645f  self.left_bound_
+00009db0: 636f 6c2c 0d0a 2020 2020 2020 2020 2020  col,..          
+00009dc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009dd0: 7269 6768 745f 626f 756e 645f 636f 6c2c  right_bound_col,
+00009de0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009df0: 2020 2020 2020 2073 656c 662e 7269 6768         self.righ
+00009e00: 745f 626f 756e 6461 7279 5f63 6f6c 2c0d  t_boundary_col,.
+00009e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e20: 2020 2020 2020 275f 5f57 6172 6e69 6e67        '__Warning
+00009e30: 5f5f 270d 0a20 2020 2020 2020 2020 2020  __'..           
+00009e40: 2020 2020 2020 2020 2020 5d5d 0d0a 2020            ]]..  
+00009e50: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00009e60: 2020 2020 2020 2020 2064 6620 3d20 6466           df = df
+00009e70: 5b67 726f 7570 6279 5f63 6f6c 7320 2b0d  [groupby_cols +.
+00009e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e90: 2020 2020 205b 7365 6c66 2e73 7461 745f       [self.stat_
+00009ea0: 636f 6c2c 0d0a 2020 2020 2020 2020 2020  col,..          
+00009eb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009ec0: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+00009ed0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+00009ee0: 2020 2020 2020 2020 2073 656c 662e 6c65           self.le
+00009ef0: 6674 5f62 6f75 6e64 5f63 6f6c 2c0d 0a20  ft_bound_col,.. 
+00009f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f10: 2020 2020 7365 6c66 2e72 6967 6874 5f62      self.right_b
+00009f20: 6f75 6e64 5f63 6f6c 2c0d 0a20 2020 2020  ound_col,..     
+00009f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f40: 7365 6c66 2e72 6967 6874 5f62 6f75 6e64  self.right_bound
+00009f50: 6172 795f 636f 6c2c 0d0a 2020 2020 2020  ary_col,..      
+00009f60: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00009f70: 5f5f 5761 726e 696e 675f 5f27 0d0a 2020  __Warning__'..  
+00009f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f90: 2020 205d 5d0d 0a20 2020 2020 2020 200d     ]]..        .
+00009fa0: 0a20 2020 2020 2020 2023 2052 6573 6574  .        # Reset
+00009fb0: 2069 6e64 6578 0d0a 2020 2020 2020 2020   index..        
+00009fc0: 2320 6466 203d 2064 662e 7265 7365 745f  # df = df.reset_
+00009fd0: 696e 6465 7828 290d 0a20 2020 2020 2020  index()..       
+00009fe0: 200d 0a20 2020 2020 2020 2023 2052 6570   ..        # Rep
+00009ff0: 6c61 6365 206f 7220 7265 7475 726e 2072  lace or return r
+0000a000: 6573 756c 740d 0a20 2020 2020 2020 2069  esult..        i
+0000a010: 6620 696e 706c 6163 653a 0d0a 2020 2020  f inplace:..    
+0000a020: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+0000a030: 6120 3d20 6466 0d0a 2020 2020 2020 2020  a = df..        
+0000a040: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000a050: 2020 2072 6574 7572 6e20 6466 0d0a 2020     return df..  
+0000a060: 2020 0d0a 2020 2020 2325 2520 4578 6365    ..    #%% Exce
+0000a070: 6564 616e 6365 2061 7373 6573 736d 656e  edance assessmen
+0000a080: 740d 0a20 2020 200d 0a20 2020 2064 6566  t..    ..    def
+0000a090: 2064 6574 6572 6d69 6e65 5f65 7863 6565   determine_excee
+0000a0a0: 6461 6e63 6573 2873 656c 662c 0d0a 2020  dances(self,..  
+0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0c0: 2020 2020 2020 2020 2020 2020 7468 7265              thre
+0000a0d0: 7368 6f6c 642c 0d0a 2020 2020 2020 2020  shold,..        
+0000a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0f0: 2020 2020 2020 7468 7265 7368 6f6c 645f        threshold_
+0000a100: 6973 5f65 7863 6565 6461 6e63 6520 3d20  is_exceedance = 
+0000a110: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
 0000a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a130: 2020 2072 6967 6874 5f62 6f75 6e64 6172     right_boundar
-0000a140: 795f 636f 6c3a 2028 7269 6768 745f 626f  y_col: (right_bo
-0000a150: 756e 6461 7279 5f63 6f6c 2c20 276d 696e  undary_col, 'min
-0000a160: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
-0000a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a180: 2027 5f5f 4d61 7869 6d75 6d5f 5f27 3a20   '__Maximum__': 
-0000a190: 2827 5f5f 436f 6e74 7269 6275 7469 6f6e  ('__Contribution
-0000a1a0: 5f5f 272c 276d 6178 2729 0d0a 2020 2020  __','max')..    
-0000a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1c0: 2020 2020 2020 2020 7d29 0d0a 2020 2020          })..    
-0000a1d0: 0d0a 2020 2020 2320 5265 706c 6163 6520  ..    # Replace 
-0000a1e0: 7468 6520 6e75 6d65 7269 6320 7661 6c75  the numeric valu
-0000a1f0: 6520 666f 7220 7468 6520 626f 756e 6461  e for the bounda
-0000a200: 7279 0d0a 2020 2020 7269 6768 745b 7269  ry..    right[ri
-0000a210: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
-0000a220: 5d20 3d20 7269 6768 745b 7269 6768 745f  ] = right[right_
-0000a230: 626f 756e 6461 7279 5f63 6f6c 5d2e 7265  boundary_col].re
-0000a240: 706c 6163 6528 5b31 2c30 5d2c 205b 2743  place([1,0], ['C
-0000a250: 6c6f 7365 6427 2c27 4f70 656e 275d 290d  losed','Open']).
-0000a260: 0a20 2020 200d 0a20 2020 2023 204d 6561  .    ..    # Mea
-0000a270: 6e73 2077 6974 6820 696e 6669 6e69 7465  ns with infinite
-0000a280: 2076 616c 7565 7320 7072 6f64 7563 6520   values produce 
-0000a290: 6e61 6e20 7661 6c75 6573 2072 6174 6865  nan values rathe
-0000a2a0: 7220 7468 616e 206e 702e 696e 6620 7661  r than np.inf va
-0000a2b0: 6c75 6573 0d0a 2020 2020 2320 436f 6e76  lues..    # Conv
-0000a2c0: 6572 7420 6e61 6e20 746f 2069 6e66 206f  ert nan to inf o
-0000a2d0: 6e6c 7920 6966 2069 6e66 696e 6974 6520  nly if infinite 
-0000a2e0: 7661 6c75 6573 2061 7265 2069 6e63 6c75  values are inclu
-0000a2f0: 6465 6420 696e 2074 6865 206d 6561 6e0d  ded in the mean.
-0000a300: 0a20 2020 2072 6967 6874 5b72 6967 6874  .    right[right
-0000a310: 5f62 6f75 6e64 5f63 6f6c 5d20 3d20 6e70  _bound_col] = np
-0000a320: 2e77 6865 7265 2872 6967 6874 5b27 5f5f  .where(right['__
-0000a330: 4d61 7869 6d75 6d5f 5f27 5d20 3d3d 206e  Maximum__'] == n
-0000a340: 702e 696e 662c 206e 702e 696e 662c 2072  p.inf, np.inf, r
-0000a350: 6967 6874 5b72 6967 6874 5f62 6f75 6e64  ight[right_bound
-0000a360: 5f63 6f6c 5d29 0d0a 2020 2020 0d0a 2020  _col])..    ..  
-0000a370: 2020 2320 4d65 7267 6520 7468 6520 7477    # Merge the tw
-0000a380: 6f20 626f 756e 6461 7269 6573 2074 6f20  o boundaries to 
-0000a390: 6372 6561 7465 2074 6865 2069 6e74 6572  create the inter
-0000a3a0: 7661 6c20 666f 7220 7468 6520 7065 7263  val for the perc
-0000a3b0: 656e 7469 6c65 0d0a 2020 2020 2320 4368  entile..    # Ch
-0000a3c0: 6563 6b20 7468 6174 2074 6865 206d 6572  eck that the mer
-0000a3d0: 6765 2069 7320 312d 746f 2d31 0d0a 2020  ge is 1-to-1..  
-0000a3e0: 2020 6466 203d 206c 6566 742e 6d65 7267    df = left.merg
-0000a3f0: 6528 7269 6768 742c 2068 6f77 203d 2027  e(right, how = '
-0000a400: 6f75 7465 7227 2c20 6f6e 203d 2067 726f  outer', on = gro
-0000a410: 7570 6279 5f63 6f6c 732c 2076 616c 6964  upby_cols, valid
-0000a420: 6174 6520 3d20 2731 3a31 2729 0d0a 2020  ate = '1:1')..  
-0000a430: 2020 0d0a 2020 2020 2320 5265 7365 7420    ..    # Reset 
-0000a440: 696e 6465 780d 0a20 2020 2064 6620 3d20  index..    df = 
-0000a450: 6466 2e72 6573 6574 5f69 6e64 6578 2829  df.reset_index()
-0000a460: 0d0a 2020 2020 0d0a 2020 2020 7265 7475  ..    ..    retu
-0000a470: 726e 2064 660d 0a0d 0a64 6566 2070 6572  rn df....def per
-0000a480: 6365 6e74 696c 6528 6466 2c0d 0a20 2020  centile(df,..   
-0000a490: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0000a4a0: 6c74 735f 636f 6c2c 0d0a 2020 2020 2020  lts_col,..      
-0000a4b0: 2020 2020 2020 2020 2070 6572 6365 6e74           percent
-0000a4c0: 696c 652c 0d0a 2020 2020 2020 2020 2020  ile,..          
-0000a4d0: 2020 2020 206d 6574 686f 6420 3d20 2768       method = 'h
-0000a4e0: 617a 656e 272c 0d0a 2020 2020 2020 2020  azen',..        
-0000a4f0: 2020 2020 2020 2067 726f 7570 6279 5f63         groupby_c
-0000a500: 6f6c 7320 3d20 4e6f 6e65 2c0d 0a20 2020  ols = None,..   
-0000a510: 2020 2020 2020 2020 2020 2020 666f 6375              focu
-0000a520: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
-0000a530: 203d 2054 7275 652c 0d0a 2020 2020 2020   = True,..      
-0000a540: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
-0000a550: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
-0000a560: 616c 203d 2046 616c 7365 2c0d 0a20 2020  al = False,..   
-0000a570: 2020 2020 2020 2020 2020 2020 7072 6563              prec
-0000a580: 6973 696f 6e5f 746f 6c65 7261 6e63 655f  ision_tolerance_
-0000a590: 746f 5f64 726f 705f 6365 6e73 6f72 203d  to_drop_censor =
-0000a5a0: 2030 2e32 352c 0d0a 2020 2020 2020 2020   0.25,..        
-0000a5b0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-0000a5c0: 5f72 6f75 6e64 696e 6720 3d20 5472 7565  _rounding = True
-0000a5d0: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
-0000a5e0: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
-0000a5f0: 2063 6f6d 6269 6e65 7320 7468 6520 7265   combines the re
-0000a600: 6c65 7661 6e74 2070 6572 6365 6e74 696c  levant percentil
-0000a610: 6520 616e 6420 7574 696c 6974 7920 6675  e and utility fu
-0000a620: 6e63 7469 6f6e 7320 746f 0d0a 2020 2020  nctions to..    
-0000a630: 6765 6e65 7261 7465 2074 6865 2070 6572  generate the per
-0000a640: 6365 6e69 746c 6520 7265 7375 6c74 7320  cenitle results 
-0000a650: 666f 7220 6772 6f75 7073 2077 6974 6869  for groups withi
-0000a660: 6e20 6120 4461 7461 4672 616d 652e 0d0a  n a DataFrame...
-0000a670: 0d0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-0000a680: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  ..    ----------
-0000a690: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
-0000a6a0: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
-0000a6b0: 7461 4672 616d 6520 7468 6174 2063 6f6e  taFrame that con
-0000a6c0: 7461 696e 7320 6365 6e73 6f72 6564 206f  tains censored o
-0000a6d0: 7220 756e 6365 6e73 6f72 6564 2072 6573  r uncensored res
-0000a6e0: 756c 7473 0d0a 2020 2020 7265 7375 6c74  ults..    result
-0000a6f0: 735f 636f 6c20 3a20 7374 7269 6e67 0d0a  s_col : string..
-0000a700: 2020 2020 2020 2020 5468 6520 636f 6c75          The colu
-0000a710: 6d6e 206e 616d 6520 666f 7220 7468 6520  mn name for the 
-0000a720: 636f 6c75 6d6e 2074 6861 7420 636f 6e74  column that cont
-0000a730: 6169 6e20 7468 6520 7265 7375 6c74 7320  ain the results 
-0000a740: 6173 2074 6578 742e 0d0a 2020 2020 2020  as text...      
-0000a750: 2020 4f6e 6c79 2066 6f75 7220 706f 7373    Only four poss
-0000a760: 6962 6c65 2063 656e 736f 7273 2073 686f  ible censors sho
-0000a770: 756c 6420 6265 2075 7365 6420 283c 2ce2  uld be used (<,.
-0000a780: 89a4 2ce2 89a5 2c3e 292e 0d0a 2020 2020  ..,...,>)...    
-0000a790: 7065 7263 656e 7469 6c65 203a 2066 6c6f  percentile : flo
-0000a7a0: 6174 0d0a 2020 2020 2020 2020 5468 6520  at..        The 
-0000a7b0: 6465 7369 7265 6420 7065 7263 656e 7469  desired percenti
-0000a7c0: 6c65 2e20 5661 6c75 6573 2073 686f 756c  le. Values shoul
-0000a7d0: 6420 6265 2062 6574 7765 656e 2030 2061  d be between 0 a
-0000a7e0: 6e64 2031 3030 2e0d 0a20 2020 206d 6574  nd 100...    met
-0000a7f0: 686f 6420 3a20 7374 7269 6e67 0d0a 2020  hod : string..  
-0000a800: 2020 2020 2020 5468 6520 7065 7263 656e        The percen
-0000a810: 7469 6c65 206d 6574 686f 642e 2054 6865  tile method. The
-0000a820: 206f 7074 696f 6e73 2061 6e64 2064 6566   options and def
-0000a830: 696e 6974 696f 6e73 2063 6f6d 6520 6672  initions come fr
-0000a840: 6f6d 3a0d 0a20 2020 2020 2020 2020 2020  om:..           
-0000a850: 2068 7474 7073 3a2f 2f65 6e76 6972 6f6e   https://environ
-0000a860: 6d65 6e74 2e67 6f76 742e 6e7a 2f61 7373  ment.govt.nz/ass
-0000a870: 6574 732f 5075 626c 6963 6174 696f 6e73  ets/Publications
-0000a880: 2f46 696c 6573 2f68 617a 656e 2d70 6572  /Files/hazen-per
-0000a890: 6365 6e74 696c 652d 6361 6c63 756c 6174  centile-calculat
-0000a8a0: 6f72 2d32 2e78 6c73 0d0a 2020 2020 2020  or-2.xls..      
-0000a8b0: 2020 2020 2020 4f70 7469 6f6e 7320 696e        Options in
-0000a8c0: 636c 7564 6520 7468 6520 666f 6c6c 6f77  clude the follow
-0000a8d0: 696e 672c 206f 7264 6572 6564 2066 726f  ing, ordered fro
-0000a8e0: 6d20 6c61 7267 6573 7420 746f 2073 6d61  m largest to sma
-0000a8f0: 6c6c 6573 7420 7265 7375 6c74 2e0d 0a20  llest result... 
-0000a900: 2020 2020 2020 2020 2020 202d 2077 6569             - wei
-0000a910: 6261 6c6c 0d0a 2020 2020 2020 2020 2020  ball..          
-0000a920: 2020 2d20 7475 6b65 790d 0a20 2020 2020    - tukey..     
-0000a930: 2020 2020 2020 202d 2062 6c6f 6d0d 0a20         - blom.. 
-0000a940: 2020 2020 2020 2020 2020 202d 2068 617a             - haz
-0000a950: 656e 0d0a 2020 2020 2020 2020 2020 2020  en..            
-0000a960: 2d20 6578 6365 6c0d 0a20 2020 2020 2020  - excel..       
-0000a970: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
-0000a980: 6861 7a65 6e2e 0d0a 2020 2020 6772 6f75  hazen...    grou
-0000a990: 7062 795f 636f 6c73 203a 206c 6973 7473  pby_cols : lists
-0000a9a0: 206f 6620 7374 7269 6e67 7320 286f 7220   of strings (or 
-0000a9b0: 6c69 7374 206f 6620 6c69 7374 7329 2c20  list of lists), 
-0000a9c0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-0000a9d0: 2020 4c69 7374 206f 6620 636f 6c75 6d6e    List of column
-0000a9e0: 206e 616d 6573 2074 6861 7420 7368 6f75   names that shou
-0000a9f0: 6c64 2062 6520 7573 6564 2074 6f20 6372  ld be used to cr
-0000aa00: 6561 7465 2067 726f 7570 732e 2041 2070  eate groups. A p
-0000aa10: 6572 6365 6e74 696c 650d 0a20 2020 2020  ercentile..     
-0000aa20: 2020 2077 696c 6c20 6265 2066 6f75 6e64     will be found
-0000aa30: 2077 6974 6869 6e20 6561 6368 2067 726f   within each gro
-0000aa40: 7570 2e20 4d75 6c74 6970 6c65 206c 6973  up. Multiple lis
-0000aa50: 7473 2063 616e 2062 6520 7375 7070 6c69  ts can be suppli
-0000aa60: 6564 2074 6f0d 0a20 2020 2020 2020 2070  ed to..        p
-0000aa70: 6572 666f 726d 2073 6571 7565 6e74 6961  erform sequentia
-0000aa80: 6c20 6d65 6469 616e 2070 6572 6365 6e74  l median percent
-0000aa90: 696c 6573 2062 6566 6f72 6520 6361 6c63  iles before calc
-0000aaa0: 756c 6174 696e 6720 6120 7065 7263 656e  ulating a percen
-0000aab0: 7469 6c65 0d0a 2020 2020 2020 2020 6f76  tile..        ov
-0000aac0: 6572 2074 6865 2066 696e 616c 2067 726f  er the final gro
-0000aad0: 7570 696e 672e 0d0a 2020 2020 2020 2020  uping...        
-0000aae0: 5468 6520 6465 6661 756c 7420 6973 204e  The default is N
-0000aaf0: 6f6e 652e 0d0a 2020 2020 666f 6375 735f  one...    focus_
-0000ab00: 6869 6768 5f70 6f74 656e 7469 616c 203a  high_potential :
-0000ab10: 2062 6f6f 6c65 616e 2c20 6f70 7469 6f6e   boolean, option
-0000ab20: 616c 0d0a 2020 2020 2020 2020 4966 2054  al..        If T
-0000ab30: 7275 652c 2074 6865 6e20 696e 666f 726d  rue, then inform
-0000ab40: 6174 696f 6e20 6f6e 2074 6865 2068 6967  ation on the hig
-0000ab50: 6865 7374 2070 6f74 656e 7469 616c 2072  hest potential r
-0000ab60: 6573 756c 7420 7769 6c6c 2062 650d 0a20  esult will be.. 
-0000ab70: 2020 2020 2020 2066 6f63 7573 6564 206f         focused o
-0000ab80: 7665 7220 7468 6520 6c6f 7765 7374 2070  ver the lowest p
-0000ab90: 6f74 656e 7469 616c 2072 6573 756c 742e  otential result.
-0000aba0: 0d0a 2020 2020 696e 636c 7564 655f 6e65  ..    include_ne
-0000abb0: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-0000abc0: 3a20 626f 6f6c 6561 6e2c 206f 7074 696f  : boolean, optio
-0000abd0: 6e61 6c0d 0a20 2020 2020 2020 2049 6620  nal..        If 
-0000abe0: 5472 7565 2c20 7468 656e 2061 6c6c 2070  True, then all p
-0000abf0: 6f73 6974 6976 6520 616e 6420 6e65 6761  ositive and nega
-0000ac00: 7469 7665 2076 616c 7565 7320 6172 6520  tive values are 
-0000ac10: 636f 6e73 6964 6572 6564 0d0a 2020 2020  considered..    
-0000ac20: 2020 2020 652e 672e 2c20 3c30 2e35 2077      e.g., <0.5 w
-0000ac30: 6f75 6c64 2062 6520 636f 6e76 6572 7465  ould be converte
-0000ac40: 6420 746f 2028 2d6e 702e 696e 662c 3529  d to (-np.inf,5)
-0000ac50: 2e0d 0a20 2020 2020 2020 2049 6620 4661  ...        If Fa
-0000ac60: 6c73 652c 2074 6865 6e20 6f6e 6c79 206e  lse, then only n
-0000ac70: 6f6e 2d6e 6567 6174 6976 6520 7661 6c75  on-negative valu
-0000ac80: 6573 2061 7265 2063 6f6e 7369 6465 7265  es are considere
-0000ac90: 640d 0a20 2020 2020 2020 2065 2e67 2e2c  d..        e.g.,
-0000aca0: 203c 302e 3520 776f 756c 6420 6265 2063   <0.5 would be c
-0000acb0: 6f6e 7665 7274 6564 2074 6f20 5b30 2c35  onverted to [0,5
-0000acc0: 292e 0d0a 2020 2020 2020 2020 5468 6973  )...        This
-0000acd0: 2073 6574 7469 6e67 206f 6e6c 7920 6166   setting only af
-0000ace0: 6665 6374 7320 7265 7375 6c74 7320 6966  fects results if
-0000acf0: 2066 6f63 7573 5f68 6967 685f 706f 7465   focus_high_pote
-0000ad00: 6e74 6961 6c20 6973 2046 616c 7365 2e0d  ntial is False..
-0000ad10: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-0000ad20: 6175 6c74 2069 7320 4661 6c73 652e 0d0a  ault is False...
-0000ad30: 2020 2020 7072 6563 6973 696f 6e5f 746f      precision_to
-0000ad40: 6c65 7261 6e63 655f 746f 5f64 726f 705f  lerance_to_drop_
-0000ad50: 6365 6e73 6f72 203a 2066 6c6f 6174 2c20  censor : float, 
-0000ad60: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-0000ad70: 2020 5468 7265 7368 6f6c 6420 666f 7220    Threshold for 
-0000ad80: 7265 706f 7274 696e 6720 6365 6e73 6f72  reporting censor
-0000ad90: 6564 2076 7320 6e6f 6e2d 6365 6e73 6f72  ed vs non-censor
-0000ada0: 6564 2072 6573 756c 7473 2e0d 0a20 2020  ed results...   
-0000adb0: 2020 2020 2055 7369 6e67 2074 6865 2064       Using the d
-0000adc0: 6566 6175 6c74 2c20 6120 7265 7375 6c74  efault, a result
-0000add0: 2074 6861 7420 6973 206b 6e6f 776e 2074   that is known t
-0000ade0: 6f20 6265 2069 6e20 7468 6520 696e 7465  o be in the inte
-0000adf0: 7276 616c 2028 302e 332c 2030 2e35 290d  rval (0.3, 0.5).
-0000ae00: 0a20 2020 2020 2020 2077 6f75 6c64 2062  .        would b
-0000ae10: 6520 7265 7475 726e 6564 2061 7320 302e  e returned as 0.
-0000ae20: 342c 2077 6865 7265 6173 2061 2074 6f6c  4, whereas a tol
-0000ae30: 6572 616e 6365 206f 6620 3020 776f 756c  erance of 0 woul
-0000ae40: 6420 7969 656c 6420 610d 0a20 2020 2020  d yield a..     
-0000ae50: 2020 2072 6573 756c 7420 6f66 203c 302e     result of <0.
-0000ae60: 3520 6f72 203e 302e 3320 6465 7065 6e64  5 or >0.3 depend
-0000ae70: 696e 6720 6f6e 2074 6865 2076 616c 7565  ing on the value
-0000ae80: 206f 6620 666f 6375 735f 6869 6768 6573   of focus_highes
-0000ae90: 745f 706f 7465 6e74 6961 6c2e 0d0a 2020  t_potential...  
-0000aea0: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-0000aeb0: 7420 6973 2030 2e32 352e 0d0a 2020 2020  t is 0.25...    
-0000aec0: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
-0000aed0: 6e67 203a 2062 6f6f 6c65 616e 2c20 6f70  ng : boolean, op
-0000aee0: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
-0000aef0: 4966 2054 7275 652c 2061 2072 6f75 6e64  If True, a round
-0000af00: 696e 6720 6d65 7468 6f64 2069 7320 6170  ing method is ap
-0000af10: 706c 6965 6420 746f 2072 6f75 6e64 2072  plied to round r
-0000af20: 6573 756c 7473 2074 6f20 6861 7665 206e  esults to have n
-0000af30: 6f20 6d6f 7265 0d0a 2020 2020 2020 2020  o more..        
-0000af40: 6465 6369 6d61 6c73 2074 6861 6e20 7768  decimals than wh
-0000af50: 6174 2063 616e 2062 6520 6d65 6173 7572  at can be measur
-0000af60: 6564 2e0d 0a20 2020 2020 2020 2054 6865  ed...        The
-0000af70: 2064 6566 6175 6c74 2069 7320 5472 7565   default is True
-0000af80: 2e0d 0a0d 0a20 2020 2052 6574 7572 6e73  .....    Returns
-0000af90: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20  ..    -------.. 
-0000afa0: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
-0000afb0: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
-0000afc0: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
-0000afd0: 6e73 2063 616c 6375 6c61 7465 6420 7065  ns calculated pe
-0000afe0: 7263 656e 7469 6c65 730d 0a0d 0a20 2020  rcentiles....   
-0000aff0: 2027 2727 0d0a 2020 2020 0d0a 2020 2020   '''..    ..    
-0000b000: 2320 4372 6561 7465 2061 2063 6f70 7920  # Create a copy 
-0000b010: 6f66 2074 6865 2044 6174 6146 7261 6d65  of the DataFrame
-0000b020: 0d0a 2020 2020 6466 203d 2064 662e 636f  ..    df = df.co
-0000b030: 7079 2829 0d0a 2020 2020 0d0a 2020 2020  py()..    ..    
-0000b040: 2320 5370 6c69 7420 7468 6520 7265 7375  # Split the resu
-0000b050: 6c74 2069 6e74 6f20 6365 6e73 6f72 2061  lt into censor a
-0000b060: 6e64 206e 756d 6572 6963 2063 6f6d 706f  nd numeric compo
-0000b070: 6e65 6e74 730d 0a20 2020 2064 6620 3d20  nents..    df = 
-0000b080: 7265 7375 6c74 5f74 6f5f 636f 6d70 6f6e  result_to_compon
-0000b090: 656e 7473 2864 662c 7265 7375 6c74 735f  ents(df,results_
-0000b0a0: 636f 6c29 0d0a 2020 2020 0d0a 2020 2020  col)..    ..    
-0000b0b0: 2320 436f 6e76 6572 7420 7468 6520 7265  # Convert the re
-0000b0c0: 7375 6c74 7320 6672 6f6d 2063 656e 736f  sults from censo
-0000b0d0: 7220 616e 6420 6e75 6d65 7269 6320 636f  r and numeric co
-0000b0e0: 6d70 6f6e 656e 7473 2074 6f20 616e 2069  mponents to an i
-0000b0f0: 6e74 6572 7661 6c20 7265 7072 6573 656e  nterval represen
-0000b100: 7461 7469 6f6e 0d0a 2020 2020 6466 203d  tation..    df =
-0000b110: 2063 6f6d 706f 6e65 6e74 735f 746f 5f69   components_to_i
-0000b120: 6e74 6572 7661 6c28 6466 2c20 696e 636c  nterval(df, incl
-0000b130: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
-0000b140: 6572 7661 6c29 0d0a 2020 2020 0d0a 2020  erval)..    ..  
-0000b150: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
-0000b160: 7465 7276 616c 732c 2064 6574 6572 6d69  tervals, determi
-0000b170: 6e65 2074 6865 2072 616e 6765 206f 6620  ne the range of 
-0000b180: 706f 7373 6962 6c65 2070 6572 6365 6e74  possible percent
-0000b190: 696c 6573 0d0a 2020 2020 0d0a 2020 2020  iles..    ..    
-0000b1a0: 2320 4966 2074 6865 7265 2061 7265 206e  # If there are n
-0000b1b0: 6f20 6772 6f75 7062 792d 636f 6c75 6d6e  o groupby-column
-0000b1c0: 732c 2074 6865 6e20 7461 6b65 2070 6572  s, then take per
-0000b1d0: 6365 6e74 696c 6520 6f66 2061 6c6c 2072  centile of all r
-0000b1e0: 6573 756c 7473 0d0a 2020 2020 6966 206e  esults..    if n
-0000b1f0: 6f74 2067 726f 7570 6279 5f63 6f6c 733a  ot groupby_cols:
-0000b200: 0d0a 2020 2020 2020 2020 6466 203d 2070  ..        df = p
-0000b210: 6572 6365 6e74 696c 655f 696e 7465 7276  ercentile_interv
-0000b220: 616c 2864 662c 2067 726f 7570 6279 5f63  al(df, groupby_c
-0000b230: 6f6c 733d 5b5d 2c0d 0a20 2020 2020 2020  ols=[],..       
-0000b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b250: 2020 2020 2020 2020 2020 7065 7263 656e            percen
-0000b260: 7469 6c65 3d70 6572 6365 6e74 696c 652c  tile=percentile,
-0000b270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b290: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
-0000b2a0: 290d 0a20 2020 2023 2049 6620 7468 6520  )..    # If the 
-0000b2b0: 6772 6f75 7062 795f 636f 6c73 2069 7320  groupby_cols is 
-0000b2c0: 6120 6c69 7374 206f 6620 6c69 7374 732c  a list of lists,
-0000b2d0: 2074 6865 6e20 7065 7266 6f72 6d20 6d75   then perform mu
-0000b2e0: 6c74 6970 6c65 2070 6572 6365 6e74 696c  ltiple percentil
-0000b2f0: 6573 0d0a 2020 2020 656c 6966 2069 7369  es..    elif isi
-0000b300: 6e73 7461 6e63 6528 6772 6f75 7062 795f  nstance(groupby_
-0000b310: 636f 6c73 5b30 5d2c 6c69 7374 293a 0d0a  cols[0],list):..
-0000b320: 2020 2020 2020 2020 666f 7220 6772 6f75          for grou
-0000b330: 7069 6e67 2069 6e20 6772 6f75 7062 795f  ping in groupby_
-0000b340: 636f 6c73 3a0d 0a20 2020 2020 2020 2020  cols:..         
-0000b350: 2020 2023 204f 6e6c 7920 6170 706c 7920     # Only apply 
-0000b360: 7065 7263 656e 7469 6c65 2074 6f20 6669  percentile to fi
-0000b370: 6e61 6c20 6772 6f75 7069 6e67 0d0a 2020  nal grouping..  
-0000b380: 2020 2020 2020 2020 2020 6966 2067 726f            if gro
-0000b390: 7570 696e 6720 3d3d 2067 726f 7570 6279  uping == groupby
-0000b3a0: 5f63 6f6c 735b 2d31 5d3a 0d0a 2020 2020  _cols[-1]:..    
-0000b3b0: 2020 2020 2020 2020 2020 2020 2320 5573              # Us
-0000b3c0: 696e 6720 7468 6520 696e 7465 7276 616c  ing the interval
-0000b3d0: 732c 2064 6574 6572 6d69 6e65 2074 6865  s, determine the
-0000b3e0: 2072 616e 6765 206f 6620 706f 7373 6962   range of possib
-0000b3f0: 6c65 2070 6572 6365 6e74 696c 6573 0d0a  le percentiles..
-0000b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b410: 6466 203d 2070 6572 6365 6e74 696c 655f  df = percentile_
-0000b420: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
-0000b430: 7570 696e 672c 2070 6572 6365 6e74 696c  uping, percentil
-0000b440: 652c 206d 6574 686f 6429 0d0a 2020 2020  e, method)..    
-0000b450: 2020 2020 2020 2020 2320 4170 706c 7920          # Apply 
-0000b460: 6d65 6469 616e 2074 6f20 616c 6c20 7072  median to all pr
-0000b470: 696f 7220 6772 6f75 7069 6e67 730d 0a20  ior groupings.. 
-0000b480: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000b490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b4a0: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
-0000b4b0: 7465 7276 616c 732c 2064 6574 6572 6d69  tervals, determi
-0000b4c0: 6e65 2074 6865 2072 616e 6765 206f 6620  ne the range of 
-0000b4d0: 706f 7373 6962 6c65 206d 6564 6961 6e73  possible medians
-0000b4e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b4f0: 2020 6466 203d 2070 6572 6365 6e74 696c    df = percentil
-0000b500: 655f 696e 7465 7276 616c 2864 662c 2067  e_interval(df, g
-0000b510: 726f 7570 696e 672c 2035 302c 206d 6574  rouping, 50, met
-0000b520: 686f 6429 0d0a 2020 2020 2320 456c 7365  hod)..    # Else
-0000b530: 2074 6865 2067 726f 7570 6279 5f63 6f6c   the groupby_col
-0000b540: 7320 6973 2061 206c 6973 7420 6f66 2063  s is a list of c
-0000b550: 6f6c 756d 6e20 6e61 6d65 730d 0a20 2020  olumn names..   
-0000b560: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000b570: 6466 203d 2070 6572 6365 6e74 696c 655f  df = percentile_
-0000b580: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
-0000b590: 7570 6279 5f63 6f6c 732c 2070 6572 6365  upby_cols, perce
-0000b5a0: 6e74 696c 652c 206d 6574 686f 6429 0d0a  ntile, method)..
-0000b5b0: 2020 2020 0d0a 2020 2020 2320 436f 6e76      ..    # Conv
-0000b5c0: 6572 7420 7468 6520 696e 7465 7276 616c  ert the interval
-0000b5d0: 2066 6f72 2074 6865 206d 696e 696d 756d   for the minimum
-0000b5e0: 2069 6e74 6f20 6365 6e73 6f72 2061 6e64   into censor and
-0000b5f0: 206e 756d 6572 6963 206e 6f74 6174 696f   numeric notatio
-0000b600: 6e0d 0a20 2020 2064 6620 3d20 696e 7465  n..    df = inte
-0000b610: 7276 616c 5f74 6f5f 636f 6d70 6f6e 656e  rval_to_componen
-0000b620: 7473 2864 662c 0d0a 2020 2020 2020 2020  ts(df,..        
-0000b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b640: 2020 2020 2020 2020 666f 6375 735f 6869          focus_hi
-0000b650: 6768 5f70 6f74 656e 7469 616c 203d 2066  gh_potential = f
-0000b660: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
-0000b670: 6961 6c2c 0d0a 2020 2020 2020 2020 2020  ial,..          
-0000b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b690: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
-0000b6a0: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-0000b6b0: 3d20 696e 636c 7564 655f 6e65 6761 7469  = include_negati
-0000b6c0: 7665 5f69 6e74 6572 7661 6c2c 0d0a 2020  ve_interval,..  
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000b6f0: 6563 6973 696f 6e5f 746f 6c65 7261 6e63  ecision_toleranc
-0000b700: 655f 746f 5f64 726f 705f 6365 6e73 6f72  e_to_drop_censor
-0000b710: 203d 2070 7265 6369 7369 6f6e 5f74 6f6c   = precision_tol
-0000b720: 6572 616e 6365 5f74 6f5f 6472 6f70 5f63  erance_to_drop_c
-0000b730: 656e 736f 7229 0d0a 2020 2020 0d0a 2020  ensor)..    ..  
-0000b740: 2020 2320 4372 6561 7465 2069 6e74 6572    # Create inter
-0000b750: 7661 6c20 6e6f 7461 7469 6f6e 2066 6f72  val notation for
-0000b760: 2074 6865 2070 6572 6365 6e74 696c 650d   the percentile.
-0000b770: 0a20 2020 2064 6620 3d20 696e 7465 7276  .    df = interv
-0000b780: 616c 5f6e 6f74 6174 696f 6e28 6466 2c20  al_notation(df, 
-0000b790: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
-0000b7a0: 6e67 290d 0a20 2020 200d 0a20 2020 2023  ng)..    ..    #
-0000b7b0: 2043 6f6d 6269 6e65 2074 6865 2063 656e   Combine the cen
-0000b7c0: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
-0000b7d0: 636f 6d70 6f6e 656e 7473 2069 6e74 6f20  components into 
-0000b7e0: 6120 7265 7375 6c74 0d0a 2020 2020 6466  a result..    df
-0000b7f0: 203d 2063 6f6d 706f 6e65 6e74 735f 746f   = components_to
-0000b800: 5f72 6573 756c 7428 6466 2c20 7072 6563  _result(df, prec
-0000b810: 6973 696f 6e5f 726f 756e 6469 6e67 290d  ision_rounding).
-0000b820: 0a20 2020 200d 0a20 2020 2023 2044 726f  .    ..    # Dro
-0000b830: 7020 776f 726b 696e 6720 636f 6c75 6d6e  p working column
-0000b840: 730d 0a20 2020 2064 6620 3d20 6466 2e64  s..    df = df.d
-0000b850: 726f 7028 6466 2e66 696c 7465 7228 7265  rop(df.filter(re
-0000b860: 6765 783d 275f 5f27 292e 636f 6c75 6d6e  gex='__').column
-0000b870: 732c 2061 7869 733d 3129 0d0a 2020 2020  s, axis=1)..    
-0000b880: 0d0a 2020 2020 2320 5265 6f72 6465 7220  ..    # Reorder 
-0000b890: 636f 6c75 6d6e 730d 0a20 2020 2066 6f72  columns..    for
-0000b8a0: 2063 6f6c 2069 6e20 5b73 7461 745f 636f   col in [stat_co
-0000b8b0: 6c2c 7265 7375 6c74 5f63 6f6c 2c63 656e  l,result_col,cen
-0000b8c0: 736f 725f 636f 6c2c 6e75 6d65 7269 635f  sor_col,numeric_
-0000b8d0: 636f 6c2c 696e 7465 7276 616c 5f63 6f6c  col,interval_col
-0000b8e0: 5d3a 0d0a 2020 2020 2020 2020 6466 5b63  ]:..        df[c
-0000b8f0: 6f6c 5d20 3d20 6466 2e70 6f70 2863 6f6c  ol] = df.pop(col
-0000b900: 290d 0a20 2020 200d 0a20 2020 2072 6574  )..    ..    ret
-0000b910: 7572 6e20 6466 0d0a 0d0a 6465 6620 6d65  urn df....def me
-0000b920: 6469 616e 2864 662c 0d0a 2020 2020 2020  dian(df,..      
-0000b930: 2020 2020 2072 6573 756c 7473 5f63 6f6c       results_col
-0000b940: 2c0d 0a20 2020 2020 2020 2020 2020 6772  ,..           gr
-0000b950: 6f75 7062 795f 636f 6c73 203d 204e 6f6e  oupby_cols = Non
-0000b960: 652c 0d0a 2020 2020 2020 2020 2020 2066  e,..           f
-0000b970: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
-0000b980: 6961 6c20 3d20 5472 7565 2c0d 0a20 2020  ial = True,..   
-0000b990: 2020 2020 2020 2020 696e 636c 7564 655f          include_
-0000b9a0: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
-0000b9b0: 6c20 3d20 4661 6c73 652c 0d0a 2020 2020  l = False,..    
-0000b9c0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-0000b9d0: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
-0000b9e0: 6f70 5f63 656e 736f 7220 3d20 302e 3235  op_censor = 0.25
-0000b9f0: 2c0d 0a20 2020 2020 2020 2020 2020 7072  ,..           pr
-0000ba00: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
-0000ba10: 203d 2054 7275 6529 3a0d 0a20 2020 2027   = True):..    '
-0000ba20: 2727 0d0a 2020 2020 4120 6675 6e63 7469  ''..    A functi
-0000ba30: 6f6e 2074 6861 7420 6765 6e65 7261 7465  on that generate
-0000ba40: 7320 6d65 6469 616e 2072 6573 756c 7473  s median results
-0000ba50: 2066 6f72 2067 726f 7570 7320 7769 7468   for groups with
-0000ba60: 696e 2061 2044 6174 6146 7261 6d65 2e0d  in a DataFrame..
-0000ba70: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-0000ba80: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
-0000ba90: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
-0000baa0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
-0000bab0: 6174 6146 7261 6d65 2074 6861 7420 636f  ataFrame that co
-0000bac0: 6e74 6169 6e73 2063 656e 736f 7265 6420  ntains censored 
-0000bad0: 6f72 2075 6e63 656e 736f 7265 6420 7265  or uncensored re
-0000bae0: 7375 6c74 730d 0a20 2020 2072 6573 756c  sults..    resul
-0000baf0: 7473 5f63 6f6c 203a 2073 7472 696e 670d  ts_col : string.
-0000bb00: 0a20 2020 2020 2020 2054 6865 2063 6f6c  .        The col
-0000bb10: 756d 6e20 6e61 6d65 2066 6f72 2074 6865  umn name for the
-0000bb20: 2063 6f6c 756d 6e20 7468 6174 2063 6f6e   column that con
-0000bb30: 7461 696e 2074 6865 2072 6573 756c 7473  tain the results
-0000bb40: 2061 7320 7465 7874 2e0d 0a20 2020 2020   as text...     
-0000bb50: 2020 204f 6e6c 7920 666f 7572 2070 6f73     Only four pos
-0000bb60: 7369 626c 6520 6365 6e73 6f72 7320 7368  sible censors sh
-0000bb70: 6f75 6c64 2062 6520 7573 6564 2028 3c2c  ould be used (<,
-0000bb80: e289 a42c e289 a52c 3e29 2e0d 0a20 2020  ...,...,>)...   
-0000bb90: 2067 726f 7570 6279 5f63 6f6c 7320 3a20   groupby_cols : 
-0000bba0: 6c69 7374 7320 6f66 2073 7472 696e 6773  lists of strings
-0000bbb0: 2028 6f72 206c 6973 7420 6f66 206c 6973   (or list of lis
-0000bbc0: 7473 292c 206f 7074 696f 6e61 6c0d 0a20  ts), optional.. 
-0000bbd0: 2020 2020 2020 204c 6973 7420 6f66 2063         List of c
-0000bbe0: 6f6c 756d 6e20 6e61 6d65 7320 7468 6174  olumn names that
-0000bbf0: 2073 686f 756c 6420 6265 2075 7365 6420   should be used 
-0000bc00: 746f 2063 7265 6174 6520 6772 6f75 7073  to create groups
-0000bc10: 2e20 4120 6d65 6469 616e 0d0a 2020 2020  . A median..    
-0000bc20: 2020 2020 7769 6c6c 2062 6520 666f 756e      will be foun
-0000bc30: 6420 7769 7468 696e 2065 6163 6820 6772  d within each gr
-0000bc40: 6f75 702e 204d 756c 7469 706c 6520 6c69  oup. Multiple li
-0000bc50: 7374 7320 6361 6e20 6265 2073 7570 706c  sts can be suppl
-0000bc60: 6965 6420 746f 0d0a 2020 2020 2020 2020  ied to..        
-0000bc70: 7065 7266 6f72 6d20 7365 7175 656e 7469  perform sequenti
-0000bc80: 616c 206d 6564 6961 6e20 7065 7263 656e  al median percen
-0000bc90: 7469 6c65 7320 6265 666f 7265 2063 616c  tiles before cal
-0000bca0: 6375 6c61 7469 6e67 2061 206d 6564 6961  culating a media
-0000bcb0: 6e0d 0a20 2020 2020 2020 206f 7665 7220  n..        over 
-0000bcc0: 7468 6520 6669 6e61 6c20 6772 6f75 7069  the final groupi
-0000bcd0: 6e67 2e0d 0a20 2020 2020 2020 2054 6865  ng...        The
-0000bce0: 2064 6566 6175 6c74 2069 7320 4e6f 6e65   default is None
-0000bcf0: 2e0d 0a20 2020 2066 6f63 7573 5f68 6967  ...    focus_hig
-0000bd00: 685f 706f 7465 6e74 6961 6c20 3a20 626f  h_potential : bo
-0000bd10: 6f6c 6561 6e2c 206f 7074 696f 6e61 6c0d  olean, optional.
-0000bd20: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
-0000bd30: 2c20 7468 656e 2069 6e66 6f72 6d61 7469  , then informati
-0000bd40: 6f6e 206f 6e20 7468 6520 6869 6768 6573  on on the highes
-0000bd50: 7420 706f 7465 6e74 6961 6c20 7265 7375  t potential resu
-0000bd60: 6c74 2077 696c 6c20 6265 0d0a 2020 2020  lt will be..    
-0000bd70: 2020 2020 666f 6375 7365 6420 6f76 6572      focused over
-0000bd80: 2074 6865 206c 6f77 6573 7420 706f 7465   the lowest pote
-0000bd90: 6e74 6961 6c20 7265 7375 6c74 2e0d 0a20  ntial result... 
-0000bda0: 2020 2069 6e63 6c75 6465 5f6e 6567 6174     include_negat
-0000bdb0: 6976 655f 696e 7465 7276 616c 203a 2062  ive_interval : b
-0000bdc0: 6f6f 6c65 616e 2c20 6f70 7469 6f6e 616c  oolean, optional
-0000bdd0: 0d0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
-0000bde0: 652c 2074 6865 6e20 616c 6c20 706f 7369  e, then all posi
-0000bdf0: 7469 7665 2061 6e64 206e 6567 6174 6976  tive and negativ
-0000be00: 6520 7661 6c75 6573 2061 7265 2063 6f6e  e values are con
-0000be10: 7369 6465 7265 640d 0a20 2020 2020 2020  sidered..       
-0000be20: 2065 2e67 2e2c 203c 302e 3520 776f 756c   e.g., <0.5 woul
-0000be30: 6420 6265 2063 6f6e 7665 7274 6564 2074  d be converted t
-0000be40: 6f20 282d 6e70 2e69 6e66 2c35 292e 0d0a  o (-np.inf,5)...
-0000be50: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-0000be60: 2c20 7468 656e 206f 6e6c 7920 6e6f 6e2d  , then only non-
-0000be70: 6e65 6761 7469 7665 2076 616c 7565 7320  negative values 
-0000be80: 6172 6520 636f 6e73 6964 6572 6564 0d0a  are considered..
-0000be90: 2020 2020 2020 2020 652e 672e 2c20 3c30          e.g., <0
-0000bea0: 2e35 2077 6f75 6c64 2062 6520 636f 6e76  .5 would be conv
-0000beb0: 6572 7465 6420 746f 205b 302c 3529 2e0d  erted to [0,5)..
-0000bec0: 0a20 2020 2020 2020 2054 6869 7320 7365  .        This se
-0000bed0: 7474 696e 6720 6f6e 6c79 2061 6666 6563  tting only affec
-0000bee0: 7473 2072 6573 756c 7473 2069 6620 666f  ts results if fo
-0000bef0: 6375 735f 6869 6768 5f70 6f74 656e 7469  cus_high_potenti
-0000bf00: 616c 2069 7320 4661 6c73 652e 0d0a 2020  al is False...  
-0000bf10: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-0000bf20: 7420 6973 2046 616c 7365 2e0d 0a20 2020  t is False...   
-0000bf30: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
-0000bf40: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
-0000bf50: 736f 7220 3a20 666c 6f61 742c 206f 7074  sor : float, opt
-0000bf60: 696f 6e61 6c0d 0a20 2020 2020 2020 2054  ional..        T
-0000bf70: 6872 6573 686f 6c64 2066 6f72 2072 6570  hreshold for rep
-0000bf80: 6f72 7469 6e67 2063 656e 736f 7265 6420  orting censored 
-0000bf90: 7673 206e 6f6e 2d63 656e 736f 7265 6420  vs non-censored 
-0000bfa0: 7265 7375 6c74 732e 0d0a 2020 2020 2020  results...      
-0000bfb0: 2020 5573 696e 6720 7468 6520 6465 6661    Using the defa
-0000bfc0: 756c 742c 2061 2072 6573 756c 7420 7468  ult, a result th
-0000bfd0: 6174 2069 7320 6b6e 6f77 6e20 746f 2062  at is known to b
-0000bfe0: 6520 696e 2074 6865 2069 6e74 6572 7661  e in the interva
-0000bff0: 6c20 2830 2e33 2c20 302e 3529 0d0a 2020  l (0.3, 0.5)..  
-0000c000: 2020 2020 2020 776f 756c 6420 6265 2072        would be r
-0000c010: 6574 7572 6e65 6420 6173 2030 2e34 2c20  eturned as 0.4, 
-0000c020: 7768 6572 6561 7320 6120 746f 6c65 7261  whereas a tolera
-0000c030: 6e63 6520 6f66 2030 2077 6f75 6c64 2079  nce of 0 would y
-0000c040: 6965 6c64 2061 0d0a 2020 2020 2020 2020  ield a..        
-0000c050: 7265 7375 6c74 206f 6620 3c30 2e35 206f  result of <0.5 o
-0000c060: 7220 3e30 2e33 2064 6570 656e 6469 6e67  r >0.3 depending
-0000c070: 206f 6e20 7468 6520 7661 6c75 6520 6f66   on the value of
-0000c080: 2066 6f63 7573 5f68 6967 6865 7374 5f70   focus_highest_p
-0000c090: 6f74 656e 7469 616c 2e0d 0a20 2020 2020  otential...     
-0000c0a0: 2020 2054 6865 2064 6566 6175 6c74 2069     The default i
-0000c0b0: 7320 302e 3235 2e0d 0a20 2020 2070 7265  s 0.25...    pre
-0000c0c0: 6369 7369 6f6e 5f72 6f75 6e64 696e 6720  cision_rounding 
-0000c0d0: 3a20 626f 6f6c 6561 6e2c 206f 7074 696f  : boolean, optio
-0000c0e0: 6e61 6c0d 0a20 2020 2020 2020 2049 6620  nal..        If 
-0000c0f0: 5472 7565 2c20 6120 726f 756e 6469 6e67  True, a rounding
-0000c100: 206d 6574 686f 6420 6973 2061 7070 6c69   method is appli
-0000c110: 6564 2074 6f20 726f 756e 6420 7265 7375  ed to round resu
-0000c120: 6c74 7320 746f 2068 6176 6520 6e6f 206d  lts to have no m
-0000c130: 6f72 650d 0a20 2020 2020 2020 2064 6563  ore..        dec
-0000c140: 696d 616c 7320 7468 616e 2077 6861 7420  imals than what 
-0000c150: 6361 6e20 6265 206d 6561 7375 7265 642e  can be measured.
-0000c160: 0d0a 2020 2020 2020 2020 5468 6520 6465  ..        The de
-0000c170: 6661 756c 7420 6973 2054 7275 652e 0d0a  fault is True...
-0000c180: 0d0a 2020 2020 5265 7475 726e 730d 0a20  ..    Returns.. 
-0000c190: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-0000c1a0: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
-0000c1b0: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
-0000c1c0: 6520 7468 6174 2063 6f6e 7461 696e 7320  e that contains 
-0000c1d0: 6361 6c63 756c 6174 6564 2070 6572 6365  calculated perce
-0000c1e0: 6e74 696c 6573 0d0a 0d0a 2020 2020 2727  ntiles....    ''
-0000c1f0: 270d 0a20 2020 200d 0a20 2020 2023 2043  '..    ..    # C
-0000c200: 7265 6174 6520 6120 636f 7079 206f 6620  reate a copy of 
-0000c210: 7468 6520 4461 7461 4672 616d 650d 0a20  the DataFrame.. 
-0000c220: 2020 2064 6620 3d20 6466 2e63 6f70 7928     df = df.copy(
-0000c230: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
-0000c240: 616c 6c20 7065 7263 656e 7469 6c65 2066  all percentile f
-0000c250: 756e 6374 696f 6e20 7769 7468 2070 6572  unction with per
-0000c260: 6365 6e74 696c 6520 3d20 3530 0d0a 2020  centile = 50..  
-0000c270: 2020 6466 203d 2070 6572 6365 6e74 696c    df = percentil
-0000c280: 6528 6466 2c0d 0a20 2020 2020 2020 2020  e(df,..         
-0000c290: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0000c2a0: 7473 5f63 6f6c 2c0d 0a20 2020 2020 2020  ts_col,..       
-0000c2b0: 2020 2020 2020 2020 2020 2020 2035 302c               50,
-0000c2c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c2d0: 2020 2020 2020 6772 6f75 7062 795f 636f        groupby_co
-0000c2e0: 6c73 203d 2067 726f 7570 6279 5f63 6f6c  ls = groupby_col
-0000c2f0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0000c300: 2020 2020 2020 2020 666f 6375 735f 6869          focus_hi
-0000c310: 6768 5f70 6f74 656e 7469 616c 203d 2066  gh_potential = f
-0000c320: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
-0000c330: 6961 6c2c 0d0a 2020 2020 2020 2020 2020  ial,..          
-0000c340: 2020 2020 2020 2020 2020 696e 636c 7564            includ
-0000c350: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
-0000c360: 7661 6c20 3d20 696e 636c 7564 655f 6e65  val = include_ne
-0000c370: 6761 7469 7665 5f69 6e74 6572 7661 6c2c  gative_interval,
-0000c380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c390: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
-0000c3a0: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
-0000c3b0: 705f 6365 6e73 6f72 203d 2070 7265 6369  p_censor = preci
-0000c3c0: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
-0000c3d0: 6f5f 6472 6f70 5f63 656e 736f 722c 0d0a  o_drop_censor,..
-0000c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3f0: 2020 2020 7072 6563 6973 696f 6e5f 726f      precision_ro
-0000c400: 756e 6469 6e67 203d 2070 7265 6369 7369  unding = precisi
-0000c410: 6f6e 5f72 6f75 6e64 696e 6729 0d0a 2020  on_rounding)..  
-0000c420: 2020 0d0a 2020 2020 7265 7475 726e 2064    ..    return d
-0000c430: 660d 0a0d 0a23 2525 2050 6572 6365 6e74  f....#%% Percent
-0000c440: 2045 7863 6565 6461 6e63 6520 5265 7375   Exceedance Resu
-0000c450: 6c74 0d0a 0d0a 6465 6620 7065 7263 656e  lt....def percen
-0000c460: 745f 6578 6365 6564 616e 6365 5f61 7373  t_exceedance_ass
-0000c470: 6573 736d 656e 7428 6466 2c0d 0a20 2020  essment(df,..   
-0000c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c490: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000c4a0: 6872 6573 686f 6c64 2c0d 0a20 2020 2020  hreshold,..     
-0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4c0: 2020 2020 2020 2020 2020 2020 2063 6f75               cou
-0000c4d0: 6e74 5f74 6872 6573 686f 6c64 5f61 735f  nt_threshold_as_
-0000c4e0: 6578 6365 6564 616e 6365 3d46 616c 7365  exceedance=False
-0000c4f0: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
-0000c500: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
-0000c510: 2061 6e61 6c79 7365 7320 7468 6520 696e   analyses the in
-0000c520: 7465 7276 616c 206e 6f74 6174 696f 6e20  terval notation 
-0000c530: 666f 726d 206f 6620 7265 7375 6c74 7320  form of results 
-0000c540: 7265 7475 726e 6564 0d0a 2020 2020 6672  returned..    fr
-0000c550: 6f6d 2063 6f6d 706f 6e65 6e74 735f 746f  om components_to
-0000c560: 5f69 6e74 6572 7661 6c20 616e 6420 6465  _interval and de
-0000c570: 7465 726d 696e 6573 2077 6865 7468 6572  termines whether
-0000c580: 2074 6865 2072 6573 756c 7420 6973 2061   the result is a
-0000c590: 6e0d 0a20 2020 2065 7863 6565 6461 6e63  n..    exceedanc
-0000c5a0: 6520 6f72 206e 6f74 2e0d 0a0d 0a20 2020  e or not.....   
-0000c5b0: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
-0000c5c0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
-0000c5d0: 2064 6620 3a20 4461 7461 4672 616d 650d   df : DataFrame.
-0000c5e0: 0a20 2020 2020 2020 2044 6174 6146 7261  .        DataFra
-0000c5f0: 6d65 2074 6861 7420 636f 6e74 6169 6e73  me that contains
-0000c600: 2072 6573 756c 7473 2069 6e20 6120 7370   results in a sp
-0000c610: 6563 6966 6963 2069 6e74 6572 7661 6c20  ecific interval 
-0000c620: 6e6f 7461 7469 6f6e 2e0d 0a20 2020 2074  notation...    t
-0000c630: 6872 6573 686f 6c64 203a 2066 6c6f 6174  hreshold : float
-0000c640: 0d0a 2020 2020 2020 2020 5468 6520 7468  ..        The th
-0000c650: 7265 7368 6f6c 6420 6f66 2069 6e74 6572  reshold of inter
-0000c660: 6573 742e 0d0a 2020 2020 636f 756e 745f  est...    count_
-0000c670: 7468 7265 7368 6f6c 645f 6173 5f65 7863  threshold_as_exc
-0000c680: 6565 6461 6e63 6520 3a20 626f 6f6c 6561  eedance : boolea
-0000c690: 6e0d 0a20 2020 2020 2020 2053 6574 2061  n..        Set a
-0000c6a0: 7320 5472 7565 2069 6620 7468 6520 7468  s True if the th
-0000c6b0: 7265 7368 6f6c 6420 7661 6c75 6520 7368  reshold value sh
-0000c6c0: 6f75 6c64 2062 6520 636f 756e 7465 6420  ould be counted 
-0000c6d0: 6173 2061 6e20 6578 6365 6564 616e 6365  as an exceedance
-0000c6e0: 2e0d 0a20 2020 2020 2020 2054 6865 2064  ...        The d
-0000c6f0: 6566 6175 6c74 2069 7320 4661 6c73 652e  efault is False.
-0000c700: 0d0a 0d0a 2020 2020 5265 7475 726e 730d  ....    Returns.
-0000c710: 0a20 2020 202d 2d2d 2d2d 2d2d 0d0a 2020  .    -------..  
-0000c720: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
-0000c730: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
-0000c740: 616d 6520 7468 6174 2068 6173 2061 6e20  ame that has an 
-0000c750: 6578 6365 6564 616e 6365 2061 7373 6573  exceedance asses
-0000c760: 736d 656e 7420 666f 7220 6561 6368 2072  sment for each r
-0000c770: 6573 756c 742e 0d0a 0d0a 2020 2020 2727  esult.....    ''
-0000c780: 270d 0a20 2020 200d 0a20 2020 2023 2043  '..    ..    # C
-0000c790: 7265 6174 6520 6120 636f 7079 206f 6620  reate a copy of 
-0000c7a0: 7468 6520 4461 7461 4672 616d 650d 0a20  the DataFrame.. 
-0000c7b0: 2020 2064 6620 3d20 6466 2e63 6f70 7928     df = df.copy(
-0000c7c0: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
-0000c7d0: 6865 636b 2074 6861 7420 696e 7075 7420  heck that input 
-0000c7e0: 6973 2069 6e74 6567 6572 206f 7220 666c  is integer or fl
-0000c7f0: 6f61 740d 0a20 2020 2069 6620 6e6f 7420  oat..    if not 
-0000c800: 6973 696e 7374 616e 6365 2874 6872 6573  isinstance(thres
-0000c810: 686f 6c64 2c20 2869 6e74 2c20 666c 6f61  hold, (int, floa
-0000c820: 7429 293a 0d0a 2020 2020 2020 2020 7261  t)):..        ra
-0000c830: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-0000c840: 7468 7265 7368 6f6c 6420 696e 7075 7420  threshold input 
-0000c850: 6e65 6564 7320 746f 2062 6520 696e 7465  needs to be inte
-0000c860: 6765 7220 6f72 2066 6c6f 6174 2074 7970  ger or float typ
-0000c870: 652e 2729 0d0a 2020 2020 0d0a 2020 2020  e.')..    ..    
-0000c880: 2320 5365 7420 636f 6e64 6974 696f 6e73  # Set conditions
-0000c890: 2064 6570 656e 6469 6e67 206f 6e20 7768   depending on wh
-0000c8a0: 6574 6865 7220 7468 6520 7468 7265 7368  ether the thresh
-0000c8b0: 6f6c 6420 6973 2061 6e20 6578 6365 6564  old is an exceed
-0000c8c0: 616e 6365 0d0a 2020 2020 6966 2063 6f75  ance..    if cou
-0000c8d0: 6e74 5f74 6872 6573 686f 6c64 5f61 735f  nt_threshold_as_
-0000c8e0: 6578 6365 6564 616e 6365 3a0d 0a20 2020  exceedance:..   
-0000c8f0: 2020 2020 2023 2053 6574 2063 6f6e 6469       # Set condi
-0000c900: 7469 6f6e 7320 666f 7220 6578 6365 6564  tions for exceed
-0000c910: 616e 6365 7320 616e 6420 6e6f 6e2d 6578  ances and non-ex
-0000c920: 6365 6564 616e 6365 730d 0a20 2020 2020  ceedances..     
-0000c930: 2020 2063 6f6e 6469 7469 6f6e 7320 3d20     conditions = 
-0000c940: 5b0d 0a20 2020 2020 2020 2020 2020 2023  [..            #
-0000c950: 2049 6620 7468 6520 6c65 6674 2062 6f75   If the left bou
-0000c960: 6e64 2069 7320 6772 6561 7465 7220 7468  nd is greater th
-0000c970: 616e 206f 7220 6571 7561 6c20 746f 2074  an or equal to t
-0000c980: 6865 2074 6872 6573 686f 6c64 2074 6861  he threshold tha
-0000c990: 6e20 6578 6365 6564 616e 6365 0d0a 2020  n exceedance..  
-0000c9a0: 2020 2020 2020 2020 2020 2864 665b 6c65            (df[le
-0000c9b0: 6674 5f62 6f75 6e64 5f63 6f6c 5d20 3e3d  ft_bound_col] >=
-0000c9c0: 2074 6872 6573 686f 6c64 292c 0d0a 2020   threshold),..  
-0000c9d0: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
-0000c9e0: 6865 2072 6967 6874 2062 6f75 6e64 2069  he right bound i
-0000c9f0: 7320 6c65 7373 2074 6861 6e20 7468 6520  s less than the 
-0000ca00: 7472 6573 686f 6c64 2074 6861 6e20 6e6f  treshold than no
-0000ca10: 6e2d 6578 6365 6564 616e 6365 0d0a 2020  n-exceedance..  
-0000ca20: 2020 2020 2020 2020 2020 2828 6466 5b72            ((df[r
-0000ca30: 6967 6874 5f62 6f75 6e64 5f63 6f6c 5d20  ight_bound_col] 
-0000ca40: 3c20 7468 7265 7368 6f6c 6429 207c 205c  < threshold) | \
-0000ca50: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000ca60: 4966 2074 6865 2072 6967 6874 2062 6f75  If the right bou
-0000ca70: 6e64 2069 7320 6571 7561 6c20 746f 2074  nd is equal to t
-0000ca80: 6865 2074 7265 7368 6f6c 6420 616e 6420  he treshold and 
-0000ca90: 6f70 656e 2074 6861 6e20 6e6f 6e2d 6578  open than non-ex
-0000caa0: 6365 6564 616e 6365 0d0a 2020 2020 2020  ceedance..      
-0000cab0: 2020 2020 2020 2828 6466 5b72 6967 6874        ((df[right
-0000cac0: 5f62 6f75 6e64 5f63 6f6c 5d20 3d3d 2074  _bound_col] == t
-0000cad0: 6872 6573 686f 6c64 2920 2620 2864 665b  hreshold) & (df[
-0000cae0: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
-0000caf0: 6f6c 5d20 3d3d 2027 4f70 656e 2729 2929  ol] == 'Open')))
-0000cb00: 2c0d 0a20 2020 2020 2020 2020 2020 205d  ,..            ]
-0000cb10: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-0000cb20: 2020 2020 2023 2053 6574 2063 6f6e 6469       # Set condi
-0000cb30: 7469 6f6e 7320 666f 7220 6578 6365 6564  tions for exceed
-0000cb40: 616e 6365 7320 616e 6420 6e6f 6e2d 6578  ances and non-ex
-0000cb50: 6365 6564 616e 6365 730d 0a20 2020 2020  ceedances..     
-0000cb60: 2020 2063 6f6e 6469 7469 6f6e 7320 3d20     conditions = 
-0000cb70: 5b0d 0a20 2020 2020 2020 2020 2020 2023  [..            #
-0000cb80: 2049 6620 7468 6520 6c65 6674 2062 6f75   If the left bou
-0000cb90: 6e64 2069 7320 6772 6561 7465 7220 7468  nd is greater th
-0000cba0: 616e 2074 6865 2074 6872 6573 686f 6c64  an the threshold
-0000cbb0: 2074 6861 6e20 6578 6365 6564 616e 6365   than exceedance
-0000cbc0: 0d0a 2020 2020 2020 2020 2020 2020 2828  ..            ((
-0000cbd0: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
-0000cbe0: 6c5d 203e 2074 6872 6573 686f 6c64 2920  l] > threshold) 
-0000cbf0: 7c20 5c0d 0a20 2020 2020 2020 2020 2020  | \..           
-0000cc00: 2023 2049 6620 7468 6520 6c65 6674 2062   # If the left b
-0000cc10: 6f75 6e64 2069 7365 7175 616c 2074 6f20  ound isequal to 
-0000cc20: 7468 6520 7468 7265 7368 6f6c 6420 616e  the threshold an
-0000cc30: 6420 6f70 656e 2074 6861 6e20 6578 6365  d open than exce
-0000cc40: 6564 616e 6365 0d0a 2020 2020 2020 2020  edance..        
-0000cc50: 2020 2020 2828 6466 5b6c 6566 745f 626f      ((df[left_bo
-0000cc60: 756e 645f 636f 6c5d 203d 3d20 7468 7265  und_col] == thre
-0000cc70: 7368 6f6c 6429 2026 2028 6466 5b6c 6566  shold) & (df[lef
-0000cc80: 745f 626f 756e 6461 7279 5f63 6f6c 5d20  t_boundary_col] 
-0000cc90: 3d3d 2027 4f70 656e 2729 2929 2c0d 0a20  == 'Open'))),.. 
-0000cca0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0000ccb0: 7468 6520 7269 6768 7420 626f 756e 6420  the right bound 
-0000ccc0: 6973 206c 6573 7320 7468 616e 206f 7220  is less than or 
-0000ccd0: 6571 7561 6c20 746f 2074 6865 2074 7265  equal to the tre
-0000cce0: 7368 6f6c 6420 7468 616e 206e 6f6e 2d65  shold than non-e
-0000ccf0: 7863 6565 6461 6e63 650d 0a20 2020 2020  xceedance..     
-0000cd00: 2020 2020 2020 2028 6466 5b72 6967 6874         (df[right
-0000cd10: 5f62 6f75 6e64 5f63 6f6c 5d20 3c3d 2074  _bound_col] <= t
-0000cd20: 6872 6573 686f 6c64 290d 0a20 2020 2020  hreshold)..     
-0000cd30: 2020 2020 2020 205d 0d0a 2020 2020 2320         ]..    # 
-0000cd40: 4578 6365 6564 616e 6365 7320 6172 6520  Exceedances are 
-0000cd50: 696e 6469 6361 7465 6420 6279 2069 6e74  indicated by int
-0000cd60: 6567 6572 730d 0a20 2020 2023 2028 313d  egers..    # (1=
-0000cd70: 6578 6365 6564 616e 6365 2c20 303d 6e6f  exceedance, 0=no
-0000cd80: 6e2d 6578 6365 6564 616e 6365 290d 0a20  n-exceedance).. 
-0000cd90: 2020 2072 6573 756c 7473 203d 205b 0d0a     results = [..
-0000cda0: 2020 2020 2020 2020 312c 0d0a 2020 2020          1,..    
-0000cdb0: 2020 2020 300d 0a20 2020 2020 2020 205d      0..        ]
-0000cdc0: 0d0a 2020 2020 2320 4465 6661 756c 7420  ..    # Default 
-0000cdd0: 6578 6365 6564 616e 6365 2028 6e70 2e6e  exceedance (np.n
-0000cde0: 616e 3d75 6e6b 6e6f 776e 290d 0a20 2020  an=unknown)..   
-0000cdf0: 2064 665b 275f 5f45 7863 6565 6461 6e63   df['__Exceedanc
-0000ce00: 655f 5f27 5d20 3d20 6e70 2e73 656c 6563  e__'] = np.selec
-0000ce10: 7428 636f 6e64 6974 696f 6e73 2c20 7265  t(conditions, re
-0000ce20: 7375 6c74 732c 206e 702e 6e61 6e29 0d0a  sults, np.nan)..
-0000ce30: 2020 2020 0d0a 2020 2020 7265 7475 726e      ..    return
-0000ce40: 2064 660d 0a0d 0a64 6566 2070 6572 6365   df....def perce
-0000ce50: 6e74 5f65 7863 6565 6461 6e63 6528 6466  nt_exceedance(df
-0000ce60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000ce70: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0000ce80: 735f 636f 6c2c 0d0a 2020 2020 2020 2020  s_col,..        
-0000ce90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000cea0: 6872 6573 686f 6c64 2c0d 0a20 2020 2020  hreshold,..     
-0000ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cec0: 2020 636f 756e 745f 7468 7265 7368 6f6c    count_threshol
-0000ced0: 645f 6173 5f65 7863 6565 6461 6e63 653d  d_as_exceedance=
-0000cee0: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
-0000cef0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0000cf00: 726f 7570 6279 5f63 6f6c 7320 3d20 4e6f  roupby_cols = No
-0000cf10: 6e65 2c0d 0a20 2020 2020 2020 2020 2020  ne,..           
-0000cf20: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-0000cf30: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
-0000cf40: 6572 7661 6c20 3d20 4661 6c73 6529 3a0d  erval = False):.
-0000cf50: 0a20 2020 2027 2727 0d0a 2020 2020 4120  .    '''..    A 
-0000cf60: 6675 6e63 7469 6f6e 2074 6861 7420 636f  function that co
-0000cf70: 6d62 696e 6573 2074 6865 2072 656c 6576  mbines the relev
-0000cf80: 616e 7420 7065 7263 656e 7469 6c65 2061  ant percentile a
-0000cf90: 6e64 2075 7469 6c69 7479 2066 756e 6374  nd utility funct
-0000cfa0: 696f 6e73 2074 6f0d 0a20 2020 2067 656e  ions to..    gen
-0000cfb0: 6572 6174 6520 7468 6520 7065 7263 656e  erate the percen
-0000cfc0: 6974 6c65 2072 6573 756c 7473 2066 6f72  itle results for
-0000cfd0: 2067 726f 7570 7320 7769 7468 696e 2061   groups within a
-0000cfe0: 2044 6174 6146 7261 6d65 2e0d 0a0d 0a20   DataFrame..... 
-0000cff0: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-0000d000: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-0000d010: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
-0000d020: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
-0000d030: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
-0000d040: 6e73 2063 656e 736f 7265 6420 6f72 2075  ns censored or u
-0000d050: 6e63 656e 736f 7265 6420 7265 7375 6c74  ncensored result
-0000d060: 730d 0a20 2020 2072 6573 756c 7473 5f63  s..    results_c
-0000d070: 6f6c 203a 2073 7472 696e 670d 0a20 2020  ol : string..   
-0000d080: 2020 2020 2054 6865 2063 6f6c 756d 6e20       The column 
-0000d090: 6e61 6d65 2066 6f72 2074 6865 2063 6f6c  name for the col
-0000d0a0: 756d 6e20 7468 6174 2063 6f6e 7461 696e  umn that contain
-0000d0b0: 2074 6865 2072 6573 756c 7473 2061 7320   the results as 
-0000d0c0: 7465 7874 2e0d 0a20 2020 2020 2020 204f  text...        O
-0000d0d0: 6e6c 7920 666f 7572 2070 6f73 7369 626c  nly four possibl
-0000d0e0: 6520 6365 6e73 6f72 7320 7368 6f75 6c64  e censors should
-0000d0f0: 2062 6520 7573 6564 2028 3c2c e289 a42c   be used (<,...,
-0000d100: e289 a52c 3e29 2e0d 0a20 2020 2074 6872  ...,>)...    thr
-0000d110: 6573 686f 6c64 203a 2066 6c6f 6174 0d0a  eshold : float..
-0000d120: 2020 2020 2020 2020 5468 6520 7468 7265          The thre
-0000d130: 7368 6f6c 6420 6f66 2069 6e74 6572 6573  shold of interes
-0000d140: 742e 0d0a 2020 2020 636f 756e 745f 7468  t...    count_th
-0000d150: 7265 7368 6f6c 645f 6173 5f65 7863 6565  reshold_as_excee
-0000d160: 6461 6e63 6520 3a20 626f 6f6c 6561 6e0d  dance : boolean.
-0000d170: 0a20 2020 2020 2020 2053 6574 2061 7320  .        Set as 
-0000d180: 5472 7565 2069 6620 7468 6520 7468 7265  True if the thre
-0000d190: 7368 6f6c 6420 7661 6c75 6520 7368 6f75  shold value shou
-0000d1a0: 6c64 2062 6520 636f 756e 7465 6420 6173  ld be counted as
-0000d1b0: 2061 6e20 6578 6365 6564 616e 6365 2e0d   an exceedance..
-0000d1c0: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-0000d1d0: 6175 6c74 2069 7320 4661 6c73 652e 0d0a  ault is False...
-0000d1e0: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
-0000d1f0: 203a 206c 6973 7473 206f 6620 7374 7269   : lists of stri
-0000d200: 6e67 7320 286f 7220 6c69 7374 206f 6620  ngs (or list of 
-0000d210: 7477 6f20 6c69 7374 7329 2c20 6f70 7469  two lists), opti
-0000d220: 6f6e 616c 0d0a 2020 2020 2020 2020 4c69  onal..        Li
-0000d230: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
-0000d240: 6573 2074 6861 7420 7368 6f75 6c64 2062  es that should b
-0000d250: 6520 7573 6564 2074 6f20 6372 6561 7465  e used to create
-0000d260: 2067 726f 7570 732e 2050 6572 6365 6e74   groups. Percent
-0000d270: 6167 650d 0a20 2020 2020 2020 206f 6620  age..        of 
-0000d280: 6578 6365 6564 616e 6365 7320 7769 6c6c  exceedances will
-0000d290: 2062 6520 666f 756e 6420 7769 7468 696e   be found within
-0000d2a0: 2065 6163 6820 6772 6f75 702e 2054 776f   each group. Two
-0000d2b0: 206c 6973 7473 2063 616e 2062 650d 0a20   lists can be.. 
-0000d2c0: 2020 2020 2020 2073 7570 706c 6965 6420         supplied 
-0000d2d0: 746f 2066 6972 7374 2066 696e 6420 7468  to first find th
-0000d2e0: 6520 6d61 7869 6d75 6d20 7769 7468 696e  e maximum within
-0000d2f0: 2065 6163 6820 6772 6f75 7020 6265 666f   each group befo
-0000d300: 7265 0d0a 2020 2020 2020 2020 6465 7465  re..        dete
-0000d310: 726d 696e 696e 6720 7468 6520 7065 7263  rmining the perc
-0000d320: 656e 7461 6765 206f 6620 6578 6365 6564  entage of exceed
-0000d330: 616e 6365 7320 6f76 6572 2074 6865 2073  ances over the s
-0000d340: 6563 6f6e 6420 6772 6f75 7069 6e67 2e0d  econd grouping..
-0000d350: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-0000d360: 6175 6c74 2069 7320 4e6f 6e65 2e0d 0a20  ault is None... 
-0000d370: 2020 2069 6e63 6c75 6465 5f6e 6567 6174     include_negat
-0000d380: 6976 655f 696e 7465 7276 616c 203a 2062  ive_interval : b
-0000d390: 6f6f 6c65 616e 2c20 6f70 7469 6f6e 616c  oolean, optional
-0000d3a0: 0d0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
-0000d3b0: 652c 2074 6865 6e20 616c 6c20 706f 7369  e, then all posi
-0000d3c0: 7469 7665 2061 6e64 206e 6567 6174 6976  tive and negativ
-0000d3d0: 6520 7661 6c75 6573 2061 7265 2063 6f6e  e values are con
-0000d3e0: 7369 6465 7265 640d 0a20 2020 2020 2020  sidered..       
-0000d3f0: 2065 2e67 2e2c 203c 302e 3520 776f 756c   e.g., <0.5 woul
-0000d400: 6420 6265 2063 6f6e 7665 7274 6564 2074  d be converted t
-0000d410: 6f20 282d 6e70 2e69 6e66 2c35 292e 0d0a  o (-np.inf,5)...
-0000d420: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-0000d430: 2c20 7468 656e 206f 6e6c 7920 6e6f 6e2d  , then only non-
-0000d440: 6e65 6761 7469 7665 2076 616c 7565 7320  negative values 
-0000d450: 6172 6520 636f 6e73 6964 6572 6564 0d0a  are considered..
-0000d460: 2020 2020 2020 2020 652e 672e 2c20 3c30          e.g., <0
-0000d470: 2e35 2077 6f75 6c64 2062 6520 636f 6e76  .5 would be conv
-0000d480: 6572 7465 6420 746f 205b 302c 3529 2e0d  erted to [0,5)..
-0000d490: 0a20 2020 2020 2020 2054 6869 7320 7365  .        This se
-0000d4a0: 7474 696e 6720 6f6e 6c79 2061 6666 6563  tting only affec
-0000d4b0: 7473 2072 6573 756c 7473 2069 6620 666f  ts results if fo
-0000d4c0: 6375 735f 6869 6768 5f70 6f74 656e 7469  cus_high_potenti
-0000d4d0: 616c 2069 7320 4661 6c73 652e 0d0a 2020  al is False...  
-0000d4e0: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-0000d4f0: 7420 6973 2046 616c 7365 2e0d 0a0d 0a20  t is False..... 
-0000d500: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
-0000d510: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
-0000d520: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
-0000d530: 2020 2020 2044 6174 6146 7261 6d65 2074       DataFrame t
-0000d540: 6861 7420 636f 6e74 6169 6e73 2063 616c  hat contains cal
-0000d550: 6375 6c61 7465 6420 7065 7263 656e 7469  culated percenti
-0000d560: 6c65 730d 0a0d 0a20 2020 2027 2727 0d0a  les....    '''..
-0000d570: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
-0000d580: 7465 2061 2063 6f70 7920 6f66 2074 6865  te a copy of the
-0000d590: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
-0000d5a0: 6466 203d 2064 662e 636f 7079 2829 0d0a  df = df.copy()..
-0000d5b0: 2020 2020 0d0a 2020 2020 2320 5370 6c69      ..    # Spli
-0000d5c0: 7420 7468 6520 7265 7375 6c74 2069 6e74  t the result int
-0000d5d0: 6f20 6365 6e73 6f72 2061 6e64 206e 756d  o censor and num
-0000d5e0: 6572 6963 2063 6f6d 706f 6e65 6e74 730d  eric components.
-0000d5f0: 0a20 2020 2064 6620 3d20 7265 7375 6c74  .    df = result
-0000d600: 5f74 6f5f 636f 6d70 6f6e 656e 7473 2864  _to_components(d
-0000d610: 662c 7265 7375 6c74 735f 636f 6c29 0d0a  f,results_col)..
-0000d620: 2020 2020 0d0a 2020 2020 2320 436f 6e76      ..    # Conv
-0000d630: 6572 7420 7468 6520 7265 7375 6c74 7320  ert the results 
-0000d640: 6672 6f6d 2063 656e 736f 7220 616e 6420  from censor and 
-0000d650: 6e75 6d65 7269 6320 636f 6d70 6f6e 656e  numeric componen
-0000d660: 7473 2074 6f20 616e 2069 6e74 6572 7661  ts to an interva
-0000d670: 6c20 7265 7072 6573 656e 7461 7469 6f6e  l representation
-0000d680: 0d0a 2020 2020 6466 203d 2063 6f6d 706f  ..    df = compo
-0000d690: 6e65 6e74 735f 746f 5f69 6e74 6572 7661  nents_to_interva
-0000d6a0: 6c28 6466 2c20 696e 636c 7564 655f 6e65  l(df, include_ne
-0000d6b0: 6761 7469 7665 5f69 6e74 6572 7661 6c29  gative_interval)
-0000d6c0: 0d0a 2020 2020 0d0a 2020 2020 2320 4173  ..    ..    # As
-0000d6d0: 7365 7373 2065 7863 6565 6461 6e63 6573  sess exceedances
-0000d6e0: 0d0a 2020 2020 6466 203d 2070 6572 6365  ..    df = perce
-0000d6f0: 6e74 5f65 7863 6565 6461 6e63 655f 6173  nt_exceedance_as
-0000d700: 7365 7373 6d65 6e74 2864 662c 0d0a 2020  sessment(df,..  
-0000d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d730: 2020 2020 2074 6872 6573 686f 6c64 3d74       threshold=t
-0000d740: 6872 6573 686f 6c64 2c0d 0a20 2020 2020  hreshold,..     
-0000d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d770: 2020 636f 756e 745f 7468 7265 7368 6f6c    count_threshol
-0000d780: 645f 6173 5f65 7863 6565 6461 6e63 653d  d_as_exceedance=
-0000d790: 636f 756e 745f 7468 7265 7368 6f6c 645f  count_threshold_
-0000d7a0: 6173 5f65 7863 6565 6461 6e63 6529 0d0a  as_exceedance)..
-0000d7b0: 2020 2020 0d0a 2020 2020 2320 4966 2074      ..    # If t
-0000d7c0: 6865 7265 2061 7265 206e 6f20 6772 6f75  here are no grou
-0000d7d0: 7062 792d 636f 6c75 6d6e 732c 2074 6865  pby-columns, the
-0000d7e0: 6e20 6361 6c63 756c 6174 6520 7065 7263  n calculate perc
-0000d7f0: 656e 7420 6578 6365 6564 616e 6365 7320  ent exceedances 
-0000d800: 6f66 2061 6c6c 2072 6573 756c 7473 0d0a  of all results..
-0000d810: 2020 2020 6966 206e 6f74 2067 726f 7570      if not group
-0000d820: 6279 5f63 6f6c 733a 0d0a 2020 2020 2020  by_cols:..      
-0000d830: 2020 6466 203d 2064 662e 6167 6728 2a2a    df = df.agg(**
-0000d840: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
-0000d850: 2020 2065 7863 6565 6461 6e63 6573 5f63     exceedances_c
-0000d860: 6f6c 3a20 2827 5f5f 4578 6365 6564 616e  ol: ('__Exceedan
-0000d870: 6365 5f5f 272c 2773 756d 2729 2c0d 0a20  ce__','sum'),.. 
-0000d880: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000d890: 5f5f 4465 7465 726d 696e 6564 436f 756e  __DeterminedCoun
-0000d8a0: 745f 5f27 3a20 2827 5f5f 4578 6365 6564  t__': ('__Exceed
-0000d8b0: 616e 6365 5f5f 272c 2763 6f75 6e74 2729  ance__','count')
-0000d8c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000d8d0: 2020 2027 5f5f 546f 7461 6c43 6f75 6e74     '__TotalCount
-0000d8e0: 5f5f 273a 2028 275f 5f45 7863 6565 6461  __': ('__Exceeda
-0000d8f0: 6e63 655f 5f27 2c27 7369 7a65 2729 0d0a  nce__','size')..
-0000d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d910: 7d29 2e74 7261 6e73 706f 7365 2829 2e72  }).transpose().r
-0000d920: 6573 6574 5f69 6e64 6578 2864 726f 703d  eset_index(drop=
-0000d930: 5472 7565 290d 0a20 2020 2023 2049 6620  True)..    # If 
-0000d940: 7468 6520 6772 6f75 7062 795f 636f 6c73  the groupby_cols
-0000d950: 2069 7320 6120 6c69 7374 206f 6620 6c69   is a list of li
-0000d960: 7374 732c 2074 6865 6e20 6173 7365 7373  sts, then assess
-0000d970: 206d 6178 696d 756d 7320 666f 7220 6669   maximums for fi
-0000d980: 7273 7420 6772 6f75 7069 6e67 0d0a 2020  rst grouping..  
-0000d990: 2020 2320 616e 6420 7065 7263 656e 7461    # and percenta
-0000d9a0: 6765 206f 6620 6578 6365 6564 616e 6365  ge of exceedance
-0000d9b0: 7320 666f 7220 7468 6520 7365 636f 6e64  s for the second
-0000d9c0: 2067 726f 7570 696e 670d 0a20 2020 2065   grouping..    e
-0000d9d0: 6c69 6620 2869 7369 6e73 7461 6e63 6528  lif (isinstance(
-0000d9e0: 6772 6f75 7062 795f 636f 6c73 5b30 5d2c  groupby_cols[0],
-0000d9f0: 6c69 7374 2929 2026 2028 6c65 6e28 6772  list)) & (len(gr
-0000da00: 6f75 7062 795f 636f 6c73 2920 213d 2032  oupby_cols) != 2
-0000da10: 293a 0d0a 2020 2020 2020 2020 7261 6973  ):..        rais
-0000da20: 6520 5661 6c75 6545 7272 6f72 2827 5477  e ValueError('Tw
-0000da30: 6f20 6c69 7374 7320 6d75 7374 2062 6520  o lists must be 
-0000da40: 696e 636c 7564 6564 2066 6f72 2067 726f  included for gro
-0000da50: 7570 6279 5f63 6f6c 7320 7468 6174 2069  upby_cols that i
-0000da60: 7320 6120 6c69 7374 206f 6620 6c69 7374  s a list of list
-0000da70: 732e 2729 0d0a 2020 2020 656c 6966 2069  s.')..    elif i
-0000da80: 7369 6e73 7461 6e63 6528 6772 6f75 7062  sinstance(groupb
-0000da90: 795f 636f 6c73 5b30 5d2c 6c69 7374 293a  y_cols[0],list):
-0000daa0: 0d0a 2020 2020 2020 2020 2320 5573 6520  ..        # Use 
-0000dab0: 6d61 7869 6d75 6d20 7769 7468 696e 2065  maximum within e
-0000dac0: 6163 6820 6772 6f75 7020 666f 7220 6669  ach group for fi
-0000dad0: 7273 7420 6772 6f75 7069 6e67 0d0a 2020  rst grouping..  
-0000dae0: 2020 2020 2020 6466 203d 2064 662e 6772        df = df.gr
-0000daf0: 6f75 7062 7928 6772 6f75 7062 795f 636f  oupby(groupby_co
-0000db00: 6c73 5b30 5d29 5b27 5f5f 4578 6365 6564  ls[0])['__Exceed
-0000db10: 616e 6365 5f5f 275d 2e6d 6178 2829 2e72  ance__'].max().r
-0000db20: 6573 6574 5f69 6e64 6578 2829 0d0a 2020  eset_index()..  
-0000db30: 2020 2020 2020 2320 5573 6520 7365 636f        # Use seco
-0000db40: 6e64 2067 726f 7570 696e 6720 666f 7220  nd grouping for 
-0000db50: 7065 7263 656e 7461 6765 206f 6620 6578  percentage of ex
-0000db60: 6365 6564 616e 6365 730d 0a20 2020 2020  ceedances..     
-0000db70: 2020 2064 6620 3d20 6466 2e67 726f 7570     df = df.group
-0000db80: 6279 2867 726f 7570 6279 5f63 6f6c 735b  by(groupby_cols[
-0000db90: 315d 292e 6167 6728 2a2a 7b0d 0a20 2020  1]).agg(**{..   
-0000dba0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0000dbb0: 6565 6461 6e63 6573 5f63 6f6c 3a20 2827  eedances_col: ('
-0000dbc0: 5f5f 4578 6365 6564 616e 6365 5f5f 272c  __Exceedance__',
-0000dbd0: 2773 756d 2729 2c0d 0a20 2020 2020 2020  'sum'),..       
-0000dbe0: 2020 2020 2020 2020 2027 5f5f 4465 7465           '__Dete
-0000dbf0: 726d 696e 6564 436f 756e 745f 5f27 3a20  rminedCount__': 
-0000dc00: 2827 5f5f 4578 6365 6564 616e 6365 5f5f  ('__Exceedance__
-0000dc10: 272c 2763 6f75 6e74 2729 2c0d 0a20 2020  ','count'),..   
-0000dc20: 2020 2020 2020 2020 2020 2020 2027 5f5f               '__
-0000dc30: 546f 7461 6c43 6f75 6e74 5f5f 273a 2028  TotalCount__': (
-0000dc40: 275f 5f45 7863 6565 6461 6e63 655f 5f27  '__Exceedance__'
-0000dc50: 2c27 7369 7a65 2729 0d0a 2020 2020 2020  ,'size')..      
-0000dc60: 2020 2020 2020 2020 2020 7d29 0d0a 2020            })..  
-0000dc70: 2020 2320 456c 7365 2074 6865 2067 726f    # Else the gro
-0000dc80: 7570 6279 5f63 6f6c 7320 6973 2061 206c  upby_cols is a l
-0000dc90: 6973 7420 6f66 2063 6f6c 756d 6e20 6e61  ist of column na
-0000dca0: 6d65 730d 0a20 2020 2065 6c73 653a 0d0a  mes..    else:..
-0000dcb0: 2020 2020 2020 2020 6466 203d 2064 662e          df = df.
-0000dcc0: 6772 6f75 7062 7928 6772 6f75 7062 795f  groupby(groupby_
-0000dcd0: 636f 6c73 292e 6167 6728 2a2a 7b0d 0a20  cols).agg(**{.. 
-0000dce0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000dcf0: 7863 6565 6461 6e63 6573 5f63 6f6c 3a20  xceedances_col: 
-0000dd00: 2827 5f5f 4578 6365 6564 616e 6365 5f5f  ('__Exceedance__
-0000dd10: 272c 2773 756d 2729 2c0d 0a20 2020 2020  ','sum'),..     
-0000dd20: 2020 2020 2020 2020 2020 2027 5f5f 4465             '__De
-0000dd30: 7465 726d 696e 6564 436f 756e 745f 5f27  terminedCount__'
-0000dd40: 3a20 2827 5f5f 4578 6365 6564 616e 6365  : ('__Exceedance
-0000dd50: 5f5f 272c 2763 6f75 6e74 2729 2c0d 0a20  __','count'),.. 
-0000dd60: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000dd70: 5f5f 546f 7461 6c43 6f75 6e74 5f5f 273a  __TotalCount__':
-0000dd80: 2028 275f 5f45 7863 6565 6461 6e63 655f   ('__Exceedance_
-0000dd90: 5f27 2c27 7369 7a65 2729 0d0a 2020 2020  _','size')..    
-0000dda0: 2020 2020 2020 2020 2020 2020 7d29 0d0a              })..
-0000ddb0: 2020 2020 0d0a 2020 2020 2320 4465 7465      ..    # Dete
-0000ddc0: 726d 696e 6520 636f 756e 7473 2061 6e64  rmine counts and
-0000ddd0: 2063 616c 6375 6c61 7465 2070 6572 6365   calculate perce
-0000dde0: 6e74 6167 650d 0a20 2020 2064 665b 6e6f  ntage..    df[no
-0000ddf0: 6e5f 6578 6365 6564 616e 6365 735f 636f  n_exceedances_co
-0000de00: 6c5d 203d 2064 665b 275f 5f44 6574 6572  l] = df['__Deter
-0000de10: 6d69 6e65 6443 6f75 6e74 5f5f 275d 202d  minedCount__'] -
-0000de20: 2064 665b 6578 6365 6564 616e 6365 735f   df[exceedances_
-0000de30: 636f 6c5d 0d0a 2020 2020 6466 5b69 676e  col]..    df[ign
-0000de40: 6f72 6564 5f63 6f6c 5d20 3d20 6466 5b27  ored_col] = df['
-0000de50: 5f5f 546f 7461 6c43 6f75 6e74 5f5f 275d  __TotalCount__']
-0000de60: 2d64 665b 275f 5f44 6574 6572 6d69 6e65  -df['__Determine
-0000de70: 6443 6f75 6e74 5f5f 275d 0d0a 2020 2020  dCount__']..    
-0000de80: 6466 5b70 6572 6365 6e74 5f65 7863 6565  df[percent_excee
-0000de90: 6461 6e63 6573 5f63 6f6c 5d20 3d20 6466  dances_col] = df
-0000dea0: 5b65 7863 6565 6461 6e63 6573 5f63 6f6c  [exceedances_col
-0000deb0: 5d20 2f20 6466 5b27 5f5f 4465 7465 726d  ] / df['__Determ
-0000dec0: 696e 6564 436f 756e 745f 5f27 5d20 2a20  inedCount__'] * 
-0000ded0: 3130 300d 0a20 2020 200d 0a20 2020 2023  100..    ..    #
-0000dee0: 2044 726f 7020 776f 726b 696e 6720 636f   Drop working co
-0000def0: 6c75 6d6e 730d 0a20 2020 2064 6620 3d20  lumns..    df = 
-0000df00: 6466 2e64 726f 7028 6466 2e66 696c 7465  df.drop(df.filte
-0000df10: 7228 7265 6765 783d 275f 5f27 292e 636f  r(regex='__').co
-0000df20: 6c75 6d6e 732c 2061 7869 733d 3129 0d0a  lumns, axis=1)..
-0000df30: 2020 2020 0d0a 2020 2020 2320 5265 6f72      ..    # Reor
-0000df40: 6465 7220 636f 6c75 6d6e 730d 0a20 2020  der columns..   
-0000df50: 2066 6f72 2063 6f6c 2069 6e20 5b70 6572   for col in [per
-0000df60: 6365 6e74 5f65 7863 6565 6461 6e63 6573  cent_exceedances
-0000df70: 5f63 6f6c 2c65 7863 6565 6461 6e63 6573  _col,exceedances
-0000df80: 5f63 6f6c 2c6e 6f6e 5f65 7863 6565 6461  _col,non_exceeda
-0000df90: 6e63 6573 5f63 6f6c 2c69 676e 6f72 6564  nces_col,ignored
-0000dfa0: 5f63 6f6c 5d3a 0d0a 2020 2020 2020 2020  _col]:..        
-0000dfb0: 6466 5b63 6f6c 5d20 3d20 6466 2e70 6f70  df[col] = df.pop
-0000dfc0: 2863 6f6c 290d 0a20 2020 200d 0a20 2020  (col)..    ..   
-0000dfd0: 2023 2052 6573 6574 2069 6e64 6578 0d0a   # Reset index..
-0000dfe0: 2020 2020 6466 203d 2064 662e 7265 7365      df = df.rese
-0000dff0: 745f 696e 6465 7828 290d 0a20 2020 200d  t_index()..    .
-0000e000: 0a20 2020 2072 6574 7572 6e20 6466 0d0a  .    return df..
-0000e010: 0d0a 2325 2520 4164 6469 7469 6f6e 0d0a  ..#%% Addition..
-0000e020: 0d0a 6465 6620 6164 645f 696e 7465 7276  ..def add_interv
-0000e030: 616c 7328 6466 2c0d 0a20 2020 2020 2020  als(df,..       
-0000e040: 2020 2020 2020 2020 2020 2067 726f 7570             group
-0000e050: 6279 5f63 6f6c 7329 3a0d 0a20 2020 2027  by_cols):..    '
-0000e060: 2727 0d0a 2020 2020 4120 6675 6e63 7469  ''..    A functi
-0000e070: 6f6e 2074 6861 7420 6164 6473 2074 6865  on that adds the
-0000e080: 2069 6e74 6572 7661 6c20 6e6f 7461 7469   interval notati
-0000e090: 6f6e 2066 6f72 6d20 6f66 2072 6573 756c  on form of resul
-0000e0a0: 7473 2072 6574 7572 6e65 640d 0a20 2020  ts returned..   
-0000e0b0: 2066 726f 6d20 636f 6d70 6f6e 656e 7473   from components
-0000e0c0: 5f74 6f5f 696e 7465 7276 616c 2074 6f20  _to_interval to 
-0000e0d0: 6765 6e65 7261 7465 2061 206e 6577 2069  generate a new i
-0000e0e0: 6e74 6572 7661 6c20 666f 7220 7468 6520  nterval for the 
-0000e0f0: 7375 6d2e 2047 726f 7570 730d 0a20 2020  sum. Groups..   
-0000e100: 206f 6620 7265 7375 6c74 7320 6361 6e20   of results can 
-0000e110: 6265 2064 6566 696e 6564 2062 7920 696e  be defined by in
-0000e120: 636c 7564 696e 6720 7468 6520 636f 6c75  cluding the colu
-0000e130: 6d6e 7320 7468 6174 2073 686f 756c 6420  mns that should 
-0000e140: 6265 2075 7365 6420 746f 0d0a 2020 2020  be used to..    
-0000e150: 6372 6561 7465 2067 726f 7570 732e 0d0a  create groups...
-0000e160: 0d0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-0000e170: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  ..    ----------
-0000e180: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
-0000e190: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
-0000e1a0: 7461 4672 616d 6520 7468 6174 2063 6f6e  taFrame that con
-0000e1b0: 7461 696e 7320 7265 7375 6c74 7320 696e  tains results in
-0000e1c0: 2061 2073 7065 6369 6669 6320 696e 7465   a specific inte
-0000e1d0: 7276 616c 206e 6f74 6174 696f 6e2e 0d0a  rval notation...
-0000e1e0: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
-0000e1f0: 203a 206c 6973 7420 6f66 2073 7472 696e   : list of strin
-0000e200: 6773 0d0a 2020 2020 2020 2020 4c69 7374  gs..        List
-0000e210: 206f 6620 636f 6c75 6d6e 206e 616d 6573   of column names
-0000e220: 2074 6861 7420 7368 6f75 6c64 2062 6520   that should be 
-0000e230: 7573 6564 2074 6f20 6372 6561 7465 2067  used to create g
-0000e240: 726f 7570 732e 0d0a 0d0a 2020 2020 5265  roups.....    Re
-0000e250: 7475 726e 730d 0a20 2020 202d 2d2d 2d2d  turns..    -----
-0000e260: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
-0000e270: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
-0000e280: 4461 7461 4672 616d 6520 7468 6174 2068  DataFrame that h
-0000e290: 6173 2074 6865 2069 6e74 6572 7661 6c20  as the interval 
-0000e2a0: 666f 7220 7468 6520 7375 6d20 2866 6f72  for the sum (for
-0000e2b0: 2065 6163 6820 6772 6f75 7020 6966 0d0a   each group if..
-0000e2c0: 2020 2020 2020 2020 636f 6c75 6d6e 206e          column n
-0000e2d0: 616d 6573 2061 7265 2070 726f 7669 6465  ames are provide
-0000e2e0: 6420 666f 7220 6772 6f75 7069 6e67 290d  d for grouping).
-0000e2f0: 0a0d 0a20 2020 2027 2727 0d0a 2020 2020  ...    '''..    
-0000e300: 0d0a 2020 2020 2320 4372 6561 7465 2061  ..    # Create a
-0000e310: 2063 6f70 7920 6f66 2074 6865 2044 6174   copy of the Dat
-0000e320: 6146 7261 6d65 0d0a 2020 2020 6466 203d  aFrame..    df =
-0000e330: 2064 662e 636f 7079 2829 0d0a 2020 2020   df.copy()..    
-0000e340: 0d0a 2020 2020 2320 4372 6561 7465 2063  ..    # Create c
-0000e350: 6f6c 756d 6e20 7468 6174 2069 6e64 6963  olumn that indic
-0000e360: 6174 6573 2074 6865 2067 656e 6572 6174  ates the generat
-0000e370: 6564 2073 7461 7469 7374 6963 2061 6e64  ed statistic and
-0000e380: 2061 7070 656e 6420 746f 2067 726f 7570   append to group
-0000e390: 696e 6720 6c69 7374 0d0a 2020 2020 6466  ing list..    df
-0000e3a0: 5b73 7461 745f 636f 6c5d 203d 2027 5375  [stat_col] = 'Su
-0000e3b0: 6d27 0d0a 2020 2020 6772 6f75 7062 795f  m'..    groupby_
-0000e3c0: 636f 6c73 2e61 7070 656e 6428 7374 6174  cols.append(stat
-0000e3d0: 5f63 6f6c 290d 0a20 2020 200d 0a20 2020  _col)..    ..   
-0000e3e0: 2023 2043 6861 6e67 6520 6e6f 7461 7469   # Change notati
-0000e3f0: 6f6e 206f 6620 2743 6c6f 7365 6427 2061  on of 'Closed' a
-0000e400: 6e64 2027 4f70 656e 2720 626f 756e 6461  nd 'Open' bounda
-0000e410: 7269 6573 2074 6f20 3020 616e 6420 312c  ries to 0 and 1,
-0000e420: 2072 6573 7065 6374 6976 656c 790d 0a20   respectively.. 
-0000e430: 2020 2023 2054 6865 2070 7265 7365 6e63     # The presenc
-0000e440: 6520 6f66 2061 6e79 206f 7065 6e20 626f  e of any open bo
-0000e450: 756e 6461 7269 6573 206f 6e20 6f6e 6520  undaries on one 
-0000e460: 7369 6465 2065 6e73 7572 6520 7468 6174  side ensure that
-0000e470: 2074 6865 2069 6e74 6572 7661 6c20 666f   the interval fo
-0000e480: 7220 7468 6520 7375 6d20 6973 2061 6c73  r the sum is als
-0000e490: 6f0d 0a20 2020 2023 206f 7065 6e20 6f6e  o..    # open on
-0000e4a0: 2074 6861 7420 7369 6465 0d0a 2020 2020   that side..    
-0000e4b0: 6466 5b5b 6c65 6674 5f62 6f75 6e64 6172  df[[left_boundar
-0000e4c0: 795f 636f 6c2c 7269 6768 745f 626f 756e  y_col,right_boun
-0000e4d0: 6461 7279 5f63 6f6c 5d5d 203d 2064 665b  dary_col]] = df[
-0000e4e0: 5b6c 6566 745f 626f 756e 6461 7279 5f63  [left_boundary_c
-0000e4f0: 6f6c 2c72 6967 6874 5f62 6f75 6e64 6172  ol,right_boundar
-0000e500: 795f 636f 6c5d 5d2e 7265 706c 6163 6528  y_col]].replace(
-0000e510: 5b27 436c 6f73 6564 272c 274f 7065 6e27  ['Closed','Open'
-0000e520: 5d2c 205b 302c 315d 290d 0a20 2020 200d  ], [0,1])..    .
-0000e530: 0a20 2020 2023 2047 6574 2074 6865 206c  .    # Get the l
-0000e540: 6566 742f 7269 6768 7420 626f 756e 6473  eft/right bounds
-0000e550: 206f 6620 7468 6520 7375 6d20 6279 2061   of the sum by a
-0000e560: 6464 696e 6720 626f 756e 6473 2077 6974  dding bounds wit
-0000e570: 6869 6e20 7468 6520 6772 6f75 700d 0a20  hin the group.. 
-0000e580: 2020 2023 2044 6574 6572 6d69 6e65 2077     # Determine w
-0000e590: 6865 7468 6572 2061 6e79 204f 7065 6e20  hether any Open 
-0000e5a0: 286e 6f77 2076 616c 7565 206f 6620 3129  (now value of 1)
-0000e5b0: 2062 6f75 6e64 6172 6965 7320 6578 6973   boundaries exis
-0000e5c0: 742e 2049 6620 7468 6572 6520 6172 650d  t. If there are.
-0000e5d0: 0a20 2020 2023 2061 6e79 206f 7065 6e20  .    # any open 
-0000e5e0: 626f 756e 6461 7269 6573 2075 7365 6420  boundaries used 
-0000e5f0: 696e 2074 6865 2073 756d 2c20 7468 656e  in the sum, then
-0000e600: 2074 6865 2072 6573 756c 7469 6e67 2073   the resulting s
-0000e610: 756d 2077 696c 6c20 6265 206f 7065 6e0d  um will be open.
-0000e620: 0a20 2020 2064 6620 3d20 6466 2e67 726f  .    df = df.gro
-0000e630: 7570 6279 2867 726f 7570 6279 5f63 6f6c  upby(groupby_col
-0000e640: 7329 2e61 6767 282a 2a7b 0d0a 2020 2020  s).agg(**{..    
-0000e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e660: 2020 2020 2020 2020 6c65 6674 5f62 6f75          left_bou
-0000e670: 6e64 6172 795f 636f 6c3a 2028 6c65 6674  ndary_col: (left
-0000e680: 5f62 6f75 6e64 6172 795f 636f 6c2c 2027  _boundary_col, '
-0000e690: 6d61 7827 292c 0d0a 2020 2020 2020 2020  max'),..        
-0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6b0: 2020 2020 275f 5f4d 696e 696d 756d 5f5f      '__Minimum__
-0000e6c0: 273a 2028 6c65 6674 5f62 6f75 6e64 5f63  ': (left_bound_c
-0000e6d0: 6f6c 2c27 6d69 6e27 292c 0d0a 2020 2020  ol,'min'),..    
-0000e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6f0: 2020 2020 2020 2020 6c65 6674 5f62 6f75          left_bou
-0000e700: 6e64 5f63 6f6c 3a20 286c 6566 745f 626f  nd_col: (left_bo
-0000e710: 756e 645f 636f 6c2c 2773 756d 2729 2c0d  und_col,'sum'),.
-0000e720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e730: 2020 2020 2020 2020 2020 2020 2072 6967               rig
-0000e740: 6874 5f62 6f75 6e64 5f63 6f6c 3a20 2872  ht_bound_col: (r
-0000e750: 6967 6874 5f62 6f75 6e64 5f63 6f6c 2c27  ight_bound_col,'
-0000e760: 7375 6d27 292c 0d0a 2020 2020 2020 2020  sum'),..        
-0000e770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e780: 2020 2020 275f 5f4d 6178 696d 756d 5f5f      '__Maximum__
-0000e790: 273a 2028 7269 6768 745f 626f 756e 645f  ': (right_bound_
-0000e7a0: 636f 6c2c 276d 6178 2729 2c0d 0a20 2020  col,'max'),..   
-0000e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7c0: 2020 2020 2020 2020 2072 6967 6874 5f62           right_b
-0000e7d0: 6f75 6e64 6172 795f 636f 6c3a 2028 7269  oundary_col: (ri
-0000e7e0: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
-0000e7f0: 2c27 6d61 7827 290d 0a20 2020 2020 2020  ,'max')..       
-0000e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e810: 2020 2020 207d 290d 0a20 2020 200d 0a20       })..    .. 
-0000e820: 2020 2023 2052 6570 6c61 6365 2069 6e74     # Replace int
-0000e830: 6567 6572 7320 7769 7468 2074 6578 7420  egers with text 
-0000e840: 666f 7220 626f 756e 6461 7269 6573 0d0a  for boundaries..
-0000e850: 2020 2020 6466 5b5b 6c65 6674 5f62 6f75      df[[left_bou
-0000e860: 6e64 6172 795f 636f 6c2c 7269 6768 745f  ndary_col,right_
-0000e870: 626f 756e 6461 7279 5f63 6f6c 5d5d 203d  boundary_col]] =
-0000e880: 2064 665b 5b6c 6566 745f 626f 756e 6461   df[[left_bounda
-0000e890: 7279 5f63 6f6c 2c72 6967 6874 5f62 6f75  ry_col,right_bou
-0000e8a0: 6e64 6172 795f 636f 6c5d 5d2e 7265 706c  ndary_col]].repl
-0000e8b0: 6163 6528 5b30 2c31 5d2c 205b 2743 6c6f  ace([0,1], ['Clo
-0000e8c0: 7365 6427 2c27 4f70 656e 275d 290d 0a20  sed','Open']).. 
-0000e8d0: 2020 200d 0a20 2020 2023 2053 756d 7320     ..    # Sums 
-0000e8e0: 7769 7468 2069 6e66 696e 6974 6520 7661  with infinite va
-0000e8f0: 6c75 6573 2070 726f 6475 6365 206e 616e  lues produce nan
-0000e900: 2076 616c 7565 7320 7261 7468 6572 2074   values rather t
-0000e910: 6861 6e20 6e70 2e69 6e66 2076 616c 7565  han np.inf value
-0000e920: 730d 0a20 2020 2023 2043 6f6e 7665 7274  s..    # Convert
-0000e930: 206e 616e 2074 6f20 696e 6620 6f6e 6c79   nan to inf only
-0000e940: 2069 6620 696e 6669 6e69 7465 2076 616c   if infinite val
-0000e950: 7565 7320 6172 6520 696e 636c 7564 6564  ues are included
-0000e960: 2069 6e20 7468 6520 7375 6d0d 0a20 2020   in the sum..   
-0000e970: 2064 665b 6c65 6674 5f62 6f75 6e64 5f63   df[left_bound_c
-0000e980: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2864  ol] = np.where(d
-0000e990: 665b 275f 5f4d 696e 696d 756d 5f5f 275d  f['__Minimum__']
-0000e9a0: 203d 3d20 2d6e 702e 696e 662c 202d 6e70   == -np.inf, -np
-0000e9b0: 2e69 6e66 2c20 6466 5b6c 6566 745f 626f  .inf, df[left_bo
-0000e9c0: 756e 645f 636f 6c5d 290d 0a20 2020 2064  und_col])..    d
-0000e9d0: 665b 7269 6768 745f 626f 756e 645f 636f  f[right_bound_co
-0000e9e0: 6c5d 203d 206e 702e 7768 6572 6528 6466  l] = np.where(df
-0000e9f0: 5b27 5f5f 4d61 7869 6d75 6d5f 5f27 5d20  ['__Maximum__'] 
-0000ea00: 3d3d 206e 702e 696e 662c 206e 702e 696e  == np.inf, np.in
-0000ea10: 662c 2064 665b 7269 6768 745f 626f 756e  f, df[right_boun
-0000ea20: 645f 636f 6c5d 290d 0a20 2020 200d 0a20  d_col])..    .. 
-0000ea30: 2020 2023 2052 6573 6574 2069 6e64 6578     # Reset index
-0000ea40: 0d0a 2020 2020 6466 203d 2064 662e 7265  ..    df = df.re
-0000ea50: 7365 745f 696e 6465 7828 290d 0a20 2020  set_index()..   
-0000ea60: 200d 0a20 2020 2072 6574 7572 6e20 6466   ..    return df
-0000ea70: 0d0a 0d0a 6465 6620 6164 6469 7469 6f6e  ....def addition
-0000ea80: 2864 662c 0d0a 2020 2020 2020 2020 2020  (df,..          
-0000ea90: 2020 2072 6573 756c 7473 5f63 6f6c 2c0d     results_col,.
-0000eaa0: 0a20 2020 2020 2020 2020 2020 2020 6772  .             gr
-0000eab0: 6f75 7062 795f 636f 6c73 203d 204e 6f6e  oupby_cols = Non
-0000eac0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000ead0: 2066 6f63 7573 5f68 6967 685f 706f 7465   focus_high_pote
-0000eae0: 6e74 6961 6c20 3d20 5472 7565 2c0d 0a20  ntial = True,.. 
-0000eaf0: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-0000eb00: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
-0000eb10: 6572 7661 6c20 3d20 4661 6c73 652c 0d0a  erval = False,..
-0000eb20: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-0000eb30: 6369 7369 6f6e 5f74 6f6c 6572 616e 6365  cision_tolerance
-0000eb40: 5f74 6f5f 6472 6f70 5f63 656e 736f 7220  _to_drop_censor 
-0000eb50: 3d20 302e 3235 2c0d 0a20 2020 2020 2020  = 0.25,..       
-0000eb60: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
-0000eb70: 726f 756e 6469 6e67 203d 2054 7275 6529  rounding = True)
-0000eb80: 3a0d 0a20 2020 2027 2727 0d0a 2020 2020  :..    '''..    
-0000eb90: 4120 6675 6e63 7469 6f6e 2074 6861 7420  A function that 
-0000eba0: 636f 6d62 696e 6573 2074 6865 2072 656c  combines the rel
-0000ebb0: 6576 616e 7420 6164 6469 7469 6f6e 2061  evant addition a
-0000ebc0: 6e64 2075 7469 6c69 7479 2066 756e 6374  nd utility funct
-0000ebd0: 696f 6e73 2074 6f0d 0a20 2020 2073 756d  ions to..    sum
-0000ebe0: 2072 6573 756c 7473 2066 6f72 2067 726f   results for gro
-0000ebf0: 7570 7320 7769 7468 696e 2061 2044 6174  ups within a Dat
-0000ec00: 6146 7261 6d65 2e0d 0a0d 0a20 2020 2050  aFrame.....    P
-0000ec10: 6172 616d 6574 6572 730d 0a20 2020 202d  arameters..    -
-0000ec20: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-0000ec30: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
-0000ec40: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
-0000ec50: 2074 6861 7420 636f 6e74 6169 6e73 2063   that contains c
-0000ec60: 656e 736f 7265 6420 6f72 2075 6e63 656e  ensored or uncen
-0000ec70: 736f 7265 6420 7265 7375 6c74 730d 0a20  sored results.. 
-0000ec80: 2020 2072 6573 756c 7473 5f63 6f6c 203a     results_col :
-0000ec90: 2073 7472 696e 670d 0a20 2020 2020 2020   string..       
-0000eca0: 2054 6865 2063 6f6c 756d 6e20 6e61 6d65   The column name
-0000ecb0: 2066 6f72 2074 6865 2063 6f6c 756d 6e20   for the column 
-0000ecc0: 7468 6174 2063 6f6e 7461 696e 2074 6865  that contain the
-0000ecd0: 2072 6573 756c 7473 2061 7320 7465 7874   results as text
-0000ece0: 2e0d 0a20 2020 2020 2020 204f 6e6c 7920  ...        Only 
-0000ecf0: 666f 7572 2070 6f73 7369 626c 6520 6365  four possible ce
-0000ed00: 6e73 6f72 7320 7368 6f75 6c64 2062 6520  nsors should be 
-0000ed10: 7573 6564 2028 3c2c e289 a42c e289 a52c  used (<,...,...,
-0000ed20: 3e29 2e0d 0a20 2020 2067 726f 7570 6279  >)...    groupby
-0000ed30: 5f63 6f6c 7320 3a20 6c69 7374 7320 6f66  _cols : lists of
-0000ed40: 2073 7472 696e 6773 2028 6f72 206c 6973   strings (or lis
-0000ed50: 7420 6f66 206c 6973 7473 292c 206f 7074  t of lists), opt
-0000ed60: 696f 6e61 6c0d 0a20 2020 2020 2020 204c  ional..        L
-0000ed70: 6973 7420 6f66 2063 6f6c 756d 6e20 6e61  ist of column na
-0000ed80: 6d65 7320 7468 6174 2073 686f 756c 6420  mes that should 
-0000ed90: 6265 2075 7365 6420 746f 2063 7265 6174  be used to creat
-0000eda0: 6520 6772 6f75 7073 2e20 416e 2061 7665  e groups. An ave
-0000edb0: 7261 6765 0d0a 2020 2020 2020 2020 7769  rage..        wi
-0000edc0: 6c6c 2062 6520 666f 756e 6420 7769 7468  ll be found with
-0000edd0: 696e 2065 6163 6820 6772 6f75 702e 204d  in each group. M
-0000ede0: 756c 7469 706c 6520 6c69 7374 7320 6361  ultiple lists ca
-0000edf0: 6e20 6265 2073 7570 706c 6965 6420 746f  n be supplied to
-0000ee00: 0d0a 2020 2020 2020 2020 7065 7266 6f72  ..        perfor
-0000ee10: 6d20 7365 7175 656e 7469 616c 2061 7665  m sequential ave
-0000ee20: 7261 6769 6e67 2062 6566 6f72 6520 636f  raging before co
-0000ee30: 6e76 6572 7469 6e67 2069 6e74 6572 7661  nverting interva
-0000ee40: 6c73 2074 6f20 6120 7265 7375 6c74 2e0d  ls to a result..
-0000ee50: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-0000ee60: 6175 6c74 2069 7320 4e6f 6e65 2e0d 0a20  ault is None... 
-0000ee70: 2020 2066 6f63 7573 5f68 6967 685f 706f     focus_high_po
-0000ee80: 7465 6e74 6961 6c20 3a20 626f 6f6c 6561  tential : boolea
-0000ee90: 6e2c 206f 7074 696f 6e61 6c0d 0a20 2020  n, optional..   
-0000eea0: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-0000eeb0: 656e 2069 6e66 6f72 6d61 7469 6f6e 206f  en information o
-0000eec0: 6e20 7468 6520 6869 6768 6573 7420 706f  n the highest po
-0000eed0: 7465 6e74 6961 6c20 7265 7375 6c74 2077  tential result w
-0000eee0: 696c 6c20 6265 0d0a 2020 2020 2020 2020  ill be..        
-0000eef0: 666f 6375 7365 6420 6f76 6572 2074 6865  focused over the
-0000ef00: 206c 6f77 6573 7420 706f 7465 6e74 6961   lowest potentia
-0000ef10: 6c20 7265 7375 6c74 2e0d 0a20 2020 2069  l result...    i
-0000ef20: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
-0000ef30: 696e 7465 7276 616c 203a 2062 6f6f 6c65  interval : boole
-0000ef40: 616e 2c20 6f70 7469 6f6e 616c 0d0a 2020  an, optional..  
-0000ef50: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-0000ef60: 6865 6e20 616c 6c20 706f 7369 7469 7665  hen all positive
-0000ef70: 2061 6e64 206e 6567 6174 6976 6520 7661   and negative va
-0000ef80: 6c75 6573 2061 7265 2063 6f6e 7369 6465  lues are conside
-0000ef90: 7265 640d 0a20 2020 2020 2020 2065 2e67  red..        e.g
-0000efa0: 2e2c 203c 302e 3520 776f 756c 6420 6265  ., <0.5 would be
-0000efb0: 2063 6f6e 7665 7274 6564 2074 6f20 282d   converted to (-
-0000efc0: 6e70 2e69 6e66 2c35 292e 0d0a 2020 2020  np.inf,5)...    
-0000efd0: 2020 2020 4966 2046 616c 7365 2c20 7468      If False, th
-0000efe0: 656e 206f 6e6c 7920 6e6f 6e2d 6e65 6761  en only non-nega
-0000eff0: 7469 7665 2076 616c 7565 7320 6172 6520  tive values are 
-0000f000: 636f 6e73 6964 6572 6564 0d0a 2020 2020  considered..    
-0000f010: 2020 2020 652e 672e 2c20 3c30 2e35 2077      e.g., <0.5 w
-0000f020: 6f75 6c64 2062 6520 636f 6e76 6572 7465  ould be converte
-0000f030: 6420 746f 205b 302c 3529 2e0d 0a20 2020  d to [0,5)...   
-0000f040: 2020 2020 2054 6869 7320 7365 7474 696e       This settin
-0000f050: 6720 6f6e 6c79 2061 6666 6563 7473 2072  g only affects r
-0000f060: 6573 756c 7473 2069 6620 666f 6375 735f  esults if focus_
-0000f070: 6869 6768 5f70 6f74 656e 7469 616c 2069  high_potential i
-0000f080: 7320 4661 6c73 652e 0d0a 2020 2020 2020  s False...      
-0000f090: 2020 5468 6520 6465 6661 756c 7420 6973    The default is
-0000f0a0: 2046 616c 7365 2e0d 0a20 2020 2070 7265   False...    pre
-0000f0b0: 6369 7369 6f6e 5f74 6f6c 6572 616e 6365  cision_tolerance
-0000f0c0: 5f74 6f5f 6472 6f70 5f63 656e 736f 7220  _to_drop_censor 
-0000f0d0: 3a20 666c 6f61 742c 206f 7074 696f 6e61  : float, optiona
-0000f0e0: 6c0d 0a20 2020 2020 2020 2054 6872 6573  l..        Thres
-0000f0f0: 686f 6c64 2066 6f72 2072 6570 6f72 7469  hold for reporti
-0000f100: 6e67 2063 656e 736f 7265 6420 7673 206e  ng censored vs n
-0000f110: 6f6e 2d63 656e 736f 7265 6420 7265 7375  on-censored resu
-0000f120: 6c74 732e 0d0a 2020 2020 2020 2020 5573  lts...        Us
-0000f130: 696e 6720 7468 6520 6465 6661 756c 742c  ing the default,
-0000f140: 2061 2072 6573 756c 7420 7468 6174 2069   a result that i
-0000f150: 7320 6b6e 6f77 6e20 746f 2062 6520 696e  s known to be in
-0000f160: 2074 6865 2069 6e74 6572 7661 6c20 2830   the interval (0
-0000f170: 2e33 2c20 302e 3529 0d0a 2020 2020 2020  .3, 0.5)..      
-0000f180: 2020 776f 756c 6420 6265 2072 6574 7572    would be retur
-0000f190: 6e65 6420 6173 2030 2e34 2c20 7768 6572  ned as 0.4, wher
-0000f1a0: 6561 7320 6120 746f 6c65 7261 6e63 6520  eas a tolerance 
-0000f1b0: 6f66 2030 2077 6f75 6c64 2079 6965 6c64  of 0 would yield
-0000f1c0: 2061 0d0a 2020 2020 2020 2020 7265 7375   a..        resu
-0000f1d0: 6c74 206f 6620 3c30 2e35 206f 7220 3e30  lt of <0.5 or >0
-0000f1e0: 2e33 2064 6570 656e 6469 6e67 206f 6e20  .3 depending on 
-0000f1f0: 7468 6520 7661 6c75 6520 6f66 2066 6f63  the value of foc
-0000f200: 7573 5f68 6967 6865 7374 5f70 6f74 656e  us_highest_poten
-0000f210: 7469 616c 2e0d 0a20 2020 2020 2020 2054  tial...        T
-0000f220: 6865 2064 6566 6175 6c74 2069 7320 302e  he default is 0.
-0000f230: 3235 2e0d 0a20 2020 2070 7265 6369 7369  25...    precisi
-0000f240: 6f6e 5f72 6f75 6e64 696e 6720 3a20 626f  on_rounding : bo
-0000f250: 6f6c 6561 6e2c 206f 7074 696f 6e61 6c0d  olean, optional.
-0000f260: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
-0000f270: 2c20 6120 726f 756e 6469 6e67 206d 6574  , a rounding met
-0000f280: 686f 6420 6973 2061 7070 6c69 6564 2074  hod is applied t
-0000f290: 6f20 726f 756e 6420 7265 7375 6c74 7320  o round results 
-0000f2a0: 746f 2068 6176 6520 6e6f 206d 6f72 650d  to have no more.
-0000f2b0: 0a20 2020 2020 2020 2064 6563 696d 616c  .        decimal
-0000f2c0: 7320 7468 616e 2077 6861 7420 6361 6e20  s than what can 
-0000f2d0: 6265 206d 6561 7375 7265 642e 0d0a 2020  be measured...  
-0000f2e0: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-0000f2f0: 7420 6973 2054 7275 652e 0d0a 0d0a 2020  t is True.....  
-0000f300: 2020 5265 7475 726e 730d 0a20 2020 202d    Returns..    -
-0000f310: 2d2d 2d2d 2d2d 0d0a 2020 2020 6466 203a  ------..    df :
-0000f320: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
-0000f330: 2020 2020 4461 7461 4672 616d 6520 7468      DataFrame th
-0000f340: 6174 2063 6f6e 7461 696e 7320 6361 6c63  at contains calc
-0000f350: 756c 6174 6564 2061 7665 7261 6765 730d  ulated averages.
-0000f360: 0a0d 0a20 2020 2027 2727 0d0a 2020 2020  ...    '''..    
-0000f370: 0d0a 2020 2020 2320 4372 6561 7465 2061  ..    # Create a
-0000f380: 2063 6f70 7920 6f66 2074 6865 2044 6174   copy of the Dat
-0000f390: 6146 7261 6d65 0d0a 2020 2020 6466 203d  aFrame..    df =
-0000f3a0: 2064 662e 636f 7079 2829 0d0a 2020 2020   df.copy()..    
-0000f3b0: 0d0a 2020 2020 2320 5370 6c69 7420 7468  ..    # Split th
-0000f3c0: 6520 7265 7375 6c74 2069 6e74 6f20 6365  e result into ce
-0000f3d0: 6e73 6f72 2061 6e64 206e 756d 6572 6963  nsor and numeric
-0000f3e0: 2063 6f6d 706f 6e65 6e74 730d 0a20 2020   components..   
-0000f3f0: 2064 6620 3d20 7265 7375 6c74 5f74 6f5f   df = result_to_
-0000f400: 636f 6d70 6f6e 656e 7473 2864 662c 7265  components(df,re
-0000f410: 7375 6c74 735f 636f 6c29 0d0a 2020 2020  sults_col)..    
-0000f420: 0d0a 2020 2020 2320 436f 6e76 6572 7420  ..    # Convert 
-0000f430: 7468 6520 7265 7375 6c74 7320 6672 6f6d  the results from
-0000f440: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
-0000f450: 7269 6320 636f 6d70 6f6e 656e 7473 2074  ric components t
-0000f460: 6f20 616e 2069 6e74 6572 7661 6c20 7265  o an interval re
-0000f470: 7072 6573 656e 7461 7469 6f6e 0d0a 2020  presentation..  
-0000f480: 2020 6466 203d 2063 6f6d 706f 6e65 6e74    df = component
-0000f490: 735f 746f 5f69 6e74 6572 7661 6c28 6466  s_to_interval(df
-0000f4a0: 2c20 696e 636c 7564 655f 6e65 6761 7469  , include_negati
-0000f4b0: 7665 5f69 6e74 6572 7661 6c29 0d0a 2020  ve_interval)..  
-0000f4c0: 2020 0d0a 2020 2020 2320 5573 696e 6720    ..    # Using 
-0000f4d0: 7468 6520 696e 7465 7276 616c 732c 2064  the intervals, d
-0000f4e0: 6574 6572 6d69 6e65 2074 6865 2072 616e  etermine the ran
-0000f4f0: 6765 206f 6620 706f 7373 6962 6c65 2061  ge of possible a
-0000f500: 7665 7261 6765 730d 0a20 2020 200d 0a20  verages..    .. 
-0000f510: 2020 2023 2049 6620 7468 6572 6520 6172     # If there ar
-0000f520: 6520 6e6f 2067 726f 7570 6279 2d63 6f6c  e no groupby-col
-0000f530: 756d 6e73 2c20 7468 656e 2074 616b 6520  umns, then take 
-0000f540: 6176 6572 6167 6520 6f66 2061 6c6c 2072  average of all r
-0000f550: 6573 756c 7473 0d0a 2020 2020 6966 206e  esults..    if n
-0000f560: 6f74 2067 726f 7570 6279 5f63 6f6c 733a  ot groupby_cols:
-0000f570: 0d0a 2020 2020 2020 2020 6466 203d 2061  ..        df = a
-0000f580: 6464 5f69 6e74 6572 7661 6c73 2864 662c  dd_intervals(df,
-0000f590: 2067 726f 7570 6279 5f63 6f6c 733d 5b5d   groupby_cols=[]
-0000f5a0: 290d 0a20 2020 2023 2049 6620 7468 6520  )..    # If the 
-0000f5b0: 6772 6f75 7062 795f 636f 6c73 2069 7320  groupby_cols is 
-0000f5c0: 6120 6c69 7374 206f 6620 6c69 7374 732c  a list of lists,
-0000f5d0: 2074 6865 6e20 7065 7266 6f72 6d20 6d75   then perform mu
-0000f5e0: 6c74 6970 6c65 2061 7665 7261 6765 730d  ltiple averages.
-0000f5f0: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
-0000f600: 616e 6365 2867 726f 7570 6279 5f63 6f6c  ance(groupby_col
-0000f610: 735b 305d 2c6c 6973 7429 3a0d 0a20 2020  s[0],list):..   
-0000f620: 2020 2020 2066 6f72 2067 726f 7570 696e       for groupin
-0000f630: 6720 696e 2067 726f 7570 6279 5f63 6f6c  g in groupby_col
-0000f640: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0000f650: 2320 5573 696e 6720 7468 6520 696e 7465  # Using the inte
-0000f660: 7276 616c 732c 2064 6574 6572 6d69 6e65  rvals, determine
-0000f670: 2074 6865 2072 616e 6765 206f 6620 706f   the range of po
-0000f680: 7373 6962 6c65 206d 6178 696d 610d 0a20  ssible maxima.. 
-0000f690: 2020 2020 2020 2020 2020 2064 6620 3d20             df = 
-0000f6a0: 6164 645f 696e 7465 7276 616c 7328 6466  add_intervals(df
-0000f6b0: 2c20 6772 6f75 7069 6e67 290d 0a20 2020  , grouping)..   
-0000f6c0: 2023 2045 6c73 6520 7468 6520 6772 6f75   # Else the grou
-0000f6d0: 7062 795f 636f 6c73 2069 7320 6120 6c69  pby_cols is a li
-0000f6e0: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
-0000f6f0: 6573 0d0a 2020 2020 656c 7365 3a0d 0a20  es..    else:.. 
-0000f700: 2020 2020 2020 2064 6620 3d20 6164 645f         df = add_
-0000f710: 696e 7465 7276 616c 7328 6466 2c20 6772  intervals(df, gr
-0000f720: 6f75 7062 795f 636f 6c73 290d 0a20 2020  oupby_cols)..   
-0000f730: 200d 0a20 2020 2023 2043 6f6e 7665 7274   ..    # Convert
-0000f740: 2074 6865 2069 6e74 6572 7661 6c20 666f   the interval fo
-0000f750: 7220 7468 6520 6176 6572 6167 6520 696e  r the average in
-0000f760: 746f 2063 656e 736f 7220 616e 6420 6e75  to censor and nu
-0000f770: 6d65 7269 6320 6e6f 7461 7469 6f6e 0d0a  meric notation..
-0000f780: 2020 2020 6466 203d 2069 6e74 6572 7661      df = interva
-0000f790: 6c5f 746f 5f63 6f6d 706f 6e65 6e74 7328  l_to_components(
-0000f7a0: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
-0000f7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7c0: 2020 2020 2066 6f63 7573 5f68 6967 685f       focus_high_
-0000f7d0: 706f 7465 6e74 6961 6c20 3d20 666f 6375  potential = focu
-0000f7e0: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
-0000f7f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f810: 2020 2069 6e63 6c75 6465 5f6e 6567 6174     include_negat
-0000f820: 6976 655f 696e 7465 7276 616c 203d 2069  ive_interval = i
-0000f830: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
-0000f840: 696e 7465 7276 616c 2c0d 0a20 2020 2020  interval,..     
-0000f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f860: 2020 2020 2020 2020 2020 2070 7265 6369             preci
-0000f870: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
-0000f880: 6f5f 6472 6f70 5f63 656e 736f 7220 3d20  o_drop_censor = 
-0000f890: 7072 6563 6973 696f 6e5f 746f 6c65 7261  precision_tolera
-0000f8a0: 6e63 655f 746f 5f64 726f 705f 6365 6e73  nce_to_drop_cens
-0000f8b0: 6f72 290d 0a20 2020 200d 0a20 2020 2023  or)..    ..    #
-0000f8c0: 2043 7265 6174 6520 696e 7465 7276 616c   Create interval
-0000f8d0: 206e 6f74 6174 696f 6e20 666f 7220 7468   notation for th
-0000f8e0: 6520 6176 6572 6167 650d 0a20 2020 2064  e average..    d
-0000f8f0: 6620 3d20 696e 7465 7276 616c 5f6e 6f74  f = interval_not
-0000f900: 6174 696f 6e28 6466 2c20 7072 6563 6973  ation(df, precis
-0000f910: 696f 6e5f 726f 756e 6469 6e67 290d 0a20  ion_rounding).. 
-0000f920: 2020 200d 0a20 2020 2023 2043 6f6d 6269     ..    # Combi
-0000f930: 6e65 2074 6865 2063 656e 736f 7220 616e  ne the censor an
-0000f940: 6420 6e75 6d65 7269 6320 636f 6d70 6f6e  d numeric compon
-0000f950: 656e 7473 2069 6e74 6f20 6120 7265 7375  ents into a resu
-0000f960: 6c74 0d0a 2020 2020 6466 203d 2063 6f6d  lt..    df = com
-0000f970: 706f 6e65 6e74 735f 746f 5f72 6573 756c  ponents_to_resul
-0000f980: 7428 6466 2c20 7072 6563 6973 696f 6e5f  t(df, precision_
-0000f990: 726f 756e 6469 6e67 290d 0a20 2020 200d  rounding)..    .
-0000f9a0: 0a20 2020 2023 2044 726f 7020 776f 726b  .    # Drop work
-0000f9b0: 696e 6720 636f 6c75 6d6e 730d 0a20 2020  ing columns..   
-0000f9c0: 2064 6620 3d20 6466 2e64 726f 7028 6466   df = df.drop(df
-0000f9d0: 2e66 696c 7465 7228 7265 6765 783d 275f  .filter(regex='_
-0000f9e0: 5f27 292e 636f 6c75 6d6e 732c 2061 7869  _').columns, axi
-0000f9f0: 733d 3129 0d0a 2020 2020 0d0a 2020 2020  s=1)..    ..    
-0000fa00: 2320 5265 6f72 6465 7220 636f 6c75 6d6e  # Reorder column
-0000fa10: 730d 0a20 2020 2066 6f72 2063 6f6c 2069  s..    for col i
-0000fa20: 6e20 5b73 7461 745f 636f 6c2c 7265 7375  n [stat_col,resu
-0000fa30: 6c74 5f63 6f6c 2c63 656e 736f 725f 636f  lt_col,censor_co
-0000fa40: 6c2c 6e75 6d65 7269 635f 636f 6c2c 696e  l,numeric_col,in
-0000fa50: 7465 7276 616c 5f63 6f6c 5d3a 0d0a 2020  terval_col]:..  
-0000fa60: 2020 2020 2020 6466 5b63 6f6c 5d20 3d20        df[col] = 
-0000fa70: 6466 2e70 6f70 2863 6f6c 290d 0a20 2020  df.pop(col)..   
-0000fa80: 200d 0a20 2020 2072 6574 7572 6e20 6466   ..    return df
-0000fa90: 0d0a                                     ..
+0000a130: 2020 2020 2020 696e 706c 6163 6520 3d20        inplace = 
+0000a140: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+0000a150: 200d 0a20 2020 2020 2020 2023 2043 6865   ..        # Che
+0000a160: 636b 2074 6861 7420 7468 7265 7368 6f6c  ck that threshol
+0000a170: 6420 6973 2069 6e74 6567 6572 206f 7220  d is integer or 
+0000a180: 666c 6f61 740d 0a20 2020 2020 2020 2069  float..        i
+0000a190: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+0000a1a0: 2874 6872 6573 686f 6c64 2c20 2869 6e74  (threshold, (int
+0000a1b0: 2c20 666c 6f61 7429 293a 0d0a 2020 2020  , float)):..    
+0000a1c0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000a1d0: 6c75 6545 7272 6f72 2827 496e 7075 7420  lueError('Input 
+0000a1e0: 666f 7220 7468 7265 7368 6f6c 6420 6e65  for threshold ne
+0000a1f0: 6564 7320 746f 2062 6520 696e 7465 6765  eds to be intege
+0000a200: 7220 6f72 2027 0d0a 2020 2020 2020 2020  r or '..        
+0000a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a220: 2020 2020 2027 666c 6f61 7420 7479 7065       'float type
+0000a230: 2e27 290d 0a20 2020 2020 2020 200d 0a20  .')..        .. 
+0000a240: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+0000a250: 6120 636f 7079 206f 6620 7468 6520 6461  a copy of the da
+0000a260: 7461 0d0a 2020 2020 2020 2020 6466 203d  ta..        df =
+0000a270: 2073 656c 662e 6461 7461 2e63 6f70 7928   self.data.copy(
+0000a280: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+0000a290: 2020 2020 2023 2053 6574 2063 6f6e 6469       # Set condi
+0000a2a0: 7469 6f6e 7320 6465 7065 6e64 696e 6720  tions depending 
+0000a2b0: 6f6e 2077 6865 7468 6572 2074 6865 2074  on whether the t
+0000a2c0: 6872 6573 686f 6c64 2069 7320 616e 2065  hreshold is an e
+0000a2d0: 7863 6565 6461 6e63 650d 0a20 2020 2020  xceedance..     
+0000a2e0: 2020 2069 6620 7468 7265 7368 6f6c 645f     if threshold_
+0000a2f0: 6973 5f65 7863 6565 6461 6e63 653a 0d0a  is_exceedance:..
+0000a300: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
+0000a310: 7420 636f 6e64 6974 696f 6e73 2066 6f72  t conditions for
+0000a320: 2065 7863 6565 6461 6e63 6573 2061 6e64   exceedances and
+0000a330: 206e 6f6e 2d65 7863 6565 6461 6e63 6573   non-exceedances
+0000a340: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+0000a350: 6e64 6974 696f 6e73 203d 205b 0d0a 2020  nditions = [..  
+0000a360: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000a370: 4578 6365 6564 616e 6365 2063 6f6e 6469  Exceedance condi
+0000a380: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
+0000a390: 2020 2020 2020 2320 5468 6520 6c65 6674        # The left
+0000a3a0: 2062 6f75 6e64 2069 7320 6772 6561 7465   bound is greate
+0000a3b0: 7220 7468 616e 206f 7220 6571 7561 6c20  r than or equal 
+0000a3c0: 746f 2074 6865 2074 6872 6573 686f 6c64  to the threshold
+0000a3d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a3e0: 2020 2864 665b 7365 6c66 2e6c 6566 745f    (df[self.left_
+0000a3f0: 626f 756e 645f 636f 6c5d 203e 3d20 7468  bound_col] >= th
+0000a400: 7265 7368 6f6c 6429 2c0d 0a20 2020 2020  reshold),..     
+0000a410: 2020 2020 2020 2020 2020 2023 204e 6f6e             # Non
+0000a420: 2d65 7863 6565 6461 6e63 6520 636f 6e64  -exceedance cond
+0000a430: 6974 696f 6e73 0d0a 2020 2020 2020 2020  itions..        
+0000a440: 2020 2020 2020 2020 280d 0a20 2020 2020          (..     
+0000a450: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000a460: 2054 6865 2072 6967 6874 2062 6f75 6e64   The right bound
+0000a470: 2069 7320 6c65 7373 2074 6861 6e20 7468   is less than th
+0000a480: 6520 7468 7265 7368 6f6c 640d 0a20 2020  e threshold..   
+0000a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4a0: 2028 6466 5b73 656c 662e 7269 6768 745f   (df[self.right_
+0000a4b0: 626f 756e 645f 636f 6c5d 203c 2074 6872  bound_col] < thr
+0000a4c0: 6573 686f 6c64 2920 7c0d 0a20 2020 2020  eshold) |..     
+0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000a4e0: 2054 6865 2072 6967 6874 2062 6f75 6e64   The right bound
+0000a4f0: 2069 7320 6571 7561 6c20 746f 2074 6865   is equal to the
+0000a500: 2074 6872 6573 686f 6c64 2061 6e64 206f   threshold and o
+0000a510: 7065 6e0d 0a20 2020 2020 2020 2020 2020  pen..           
+0000a520: 2020 2020 2020 2020 2028 2864 665b 7365           ((df[se
+0000a530: 6c66 2e72 6967 6874 5f62 6f75 6e64 5f63  lf.right_bound_c
+0000a540: 6f6c 5d20 3d3d 2074 6872 6573 686f 6c64  ol] == threshold
+0000a550: 2920 260d 0a20 2020 2020 2020 2020 2020  ) &..           
+0000a560: 2020 2020 2020 2020 2020 2864 665b 7365            (df[se
+0000a570: 6c66 2e72 6967 6874 5f62 6f75 6e64 6172  lf.right_boundar
+0000a580: 795f 636f 6c5d 203d 3d20 274f 7065 6e27  y_col] == 'Open'
+0000a590: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0000a5a0: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+0000a5b0: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
+0000a5c0: 2020 2320 5365 7420 636f 6e64 6974 696f    # Set conditio
+0000a5d0: 6e73 2077 6865 6e20 7468 7265 7368 6f6c  ns when threshol
+0000a5e0: 6420 6973 206e 6f74 2061 6e20 6578 6365  d is not an exce
+0000a5f0: 6564 616e 6365 0d0a 2020 2020 2020 2020  edance..        
+0000a600: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000a610: 2020 2023 2053 6574 2063 6f6e 6469 7469     # Set conditi
+0000a620: 6f6e 7320 666f 7220 6578 6365 6564 616e  ons for exceedan
+0000a630: 6365 7320 616e 6420 6e6f 6e2d 6578 6365  ces and non-exce
+0000a640: 6564 616e 6365 730d 0a20 2020 2020 2020  edances..       
+0000a650: 2020 2020 2063 6f6e 6469 7469 6f6e 7320       conditions 
+0000a660: 3d20 5b0d 0a20 2020 2020 2020 2020 2020  = [..           
+0000a670: 2020 2020 2023 2045 7863 6565 6461 6e63       # Exceedanc
+0000a680: 6573 2063 6f6e 6469 7469 6f6e 730d 0a20  es conditions.. 
+0000a690: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0000a6a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a6b0: 2020 2020 2020 2320 5468 6520 6c65 6674        # The left
+0000a6c0: 2062 6f75 6e64 2069 7320 6772 6561 7465   bound is greate
+0000a6d0: 7220 7468 616e 2074 6865 2074 6872 6573  r than the thres
+0000a6e0: 686f 6c64 0d0a 2020 2020 2020 2020 2020  hold..          
+0000a6f0: 2020 2020 2020 2020 2020 2864 665b 7365            (df[se
+0000a700: 6c66 2e6c 6566 745f 626f 756e 645f 636f  lf.left_bound_co
+0000a710: 6c5d 203e 2074 6872 6573 686f 6c64 2920  l] > threshold) 
+0000a720: 7c0d 0a20 2020 2020 2020 2020 2020 2020  |..             
+0000a730: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+0000a740: 6c65 6674 2062 6f75 6e64 2069 7320 6571  left bound is eq
+0000a750: 7561 6c20 746f 2074 6865 2074 6872 6573  ual to the thres
+0000a760: 686f 6c64 2061 6e64 206f 7065 6e0d 0a20  hold and open.. 
+0000a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a780: 2020 2028 2864 665b 7365 6c66 2e6c 6566     ((df[self.lef
+0000a790: 745f 626f 756e 645f 636f 6c5d 203d 3d20  t_bound_col] == 
+0000a7a0: 7468 7265 7368 6f6c 6429 2026 0d0a 2020  threshold) &..  
+0000a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7c0: 2020 2028 6466 5b73 656c 662e 6c65 6674     (df[self.left
+0000a7d0: 5f62 6f75 6e64 6172 795f 636f 6c5d 203d  _boundary_col] =
+0000a7e0: 3d20 274f 7065 6e27 2929 0d0a 2020 2020  = 'Open'))..    
+0000a7f0: 2020 2020 2020 2020 2020 2020 292c 0d0a              ),..
+0000a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a810: 2320 4e6f 6e2d 6578 6365 6564 616e 6365  # Non-exceedance
+0000a820: 2063 6f6e 6469 7469 6f6e 0d0a 2020 2020   condition..    
+0000a830: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+0000a840: 6520 7269 6768 7420 626f 756e 6420 6973  e right bound is
+0000a850: 206c 6573 7320 7468 616e 206f 7220 6571   less than or eq
+0000a860: 7561 6c20 746f 2074 6865 2074 6872 6573  ual to the thres
+0000a870: 686f 6c64 0d0a 2020 2020 2020 2020 2020  hold..          
+0000a880: 2020 2020 2020 2864 665b 7365 6c66 2e72        (df[self.r
+0000a890: 6967 6874 5f62 6f75 6e64 5f63 6f6c 5d20  ight_bound_col] 
+0000a8a0: 3c3d 2074 6872 6573 686f 6c64 290d 0a20  <= threshold).. 
+0000a8b0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+0000a8c0: 0d0a 2020 2020 2020 2020 2320 4578 6365  ..        # Exce
+0000a8d0: 6564 616e 6365 7320 6172 6520 696e 6469  edances are indi
+0000a8e0: 6361 7465 6420 6279 2069 6e74 6567 6572  cated by integer
+0000a8f0: 730d 0a20 2020 2020 2020 2023 2028 313d  s..        # (1=
+0000a900: 6578 6365 6564 616e 6365 2c20 303d 6e6f  exceedance, 0=no
+0000a910: 6e2d 6578 6365 6564 616e 6365 290d 0a20  n-exceedance).. 
+0000a920: 2020 2020 2020 2072 6573 756c 7473 203d         results =
+0000a930: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
+0000a940: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+0000a950: 300d 0a20 2020 2020 2020 2020 2020 205d  0..            ]
+0000a960: 0d0a 2020 2020 2020 2020 2320 4465 6661  ..        # Defa
+0000a970: 756c 7420 6578 6365 6564 616e 6365 2028  ult exceedance (
+0000a980: 6e70 2e6e 616e 3d75 6e6b 6e6f 776e 290d  np.nan=unknown).
+0000a990: 0a20 2020 2020 2020 2064 665b 7365 6c66  .        df[self
+0000a9a0: 2e65 7863 6565 6461 6e63 6573 5f63 6f6c  .exceedances_col
+0000a9b0: 5d20 3d20 6e70 2e73 656c 6563 7428 636f  ] = np.select(co
+0000a9c0: 6e64 6974 696f 6e73 2c20 7265 7375 6c74  nditions, result
+0000a9d0: 732c 206e 702e 6e61 6e29 0d0a 2020 2020  s, np.nan)..    
+0000a9e0: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+0000a9f0: 5265 706c 6163 6520 6f72 2072 6574 7572  Replace or retur
+0000aa00: 6e20 7265 7375 6c74 0d0a 2020 2020 2020  n result..      
+0000aa10: 2020 6966 2069 6e70 6c61 6365 3a0d 0a20    if inplace:.. 
+0000aa20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000aa30: 6461 7461 203d 2064 660d 0a20 2020 2020  data = df..     
+0000aa40: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000aa50: 2020 2020 2020 7265 7475 726e 2064 660d        return df.
+0000aa60: 0a20 2020 200d 0a20 2020 2023 2525 2053  .    ..    #%% S
+0000aa70: 7461 7469 7374 6963 206d 6574 686f 6473  tatistic methods
+0000aa80: 0d0a 2020 2020 0d0a 2020 2020 6465 6620  ..    ..    def 
+0000aa90: 6765 6e65 7261 6c5f 7374 6174 2873 656c  general_stat(sel
+0000aaa0: 662c 0d0a 2020 2020 2020 2020 2020 2020  f,..            
+0000aab0: 2020 2020 2020 2020 2073 7461 742c 0d0a           stat,..
+0000aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aad0: 2020 2020 2067 726f 7570 6279 5f63 6f6c       groupby_col
+0000aae0: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2020  s = None,..     
+0000aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab00: 636f 756e 745f 636f 6c73 203d 204e 6f6e  count_cols = Non
+0000ab10: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0000ab20: 2020 2020 2020 2020 2069 6e70 6c61 6365           inplace
+0000ab30: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+0000ab40: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000ab50: 3a0d 0a20 2020 2020 2020 200d 0a20 2020  :..        ..   
+0000ab60: 2020 2020 2023 2043 7265 6174 6520 6120       # Create a 
+0000ab70: 636f 7079 206f 6620 7468 6520 4365 6e73  copy of the Cens
+0000ab80: 6f72 6564 4461 7461 206f 626a 6563 740d  oredData object.
+0000ab90: 0a20 2020 2020 2020 2063 6466 203d 2063  .        cdf = c
+0000aba0: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
+0000abb0: 6629 0d0a 2020 2020 2020 2020 0d0a 2020  f)..        ..  
+0000abc0: 2020 2020 2020 2320 4966 206e 6f20 6772        # If no gr
+0000abd0: 6f75 7062 795f 636f 6c73 2070 726f 7669  oupby_cols provi
+0000abe0: 6465 642c 2063 616c 6375 6c61 7465 2073  ded, calculate s
+0000abf0: 7461 7420 666f 7220 6675 6c6c 2064 6174  tat for full dat
+0000ac00: 6173 6574 0d0a 2020 2020 2020 2020 6966  aset..        if
+0000ac10: 2067 726f 7570 6279 5f63 6f6c 7320 3d3d   groupby_cols ==
+0000ac20: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0000ac30: 2020 2020 7374 6174 2863 6466 2c20 5b5d      stat(cdf, []
+0000ac40: 2c20 696e 706c 6163 6520 3d20 5472 7565  , inplace = True
+0000ac50: 290d 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
+0000ac60: 6772 6f75 7062 795f 636f 6c73 2069 7320  groupby_cols is 
+0000ac70: 6120 6c69 7374 206f 6620 6c69 7374 732c  a list of lists,
+0000ac80: 2074 6865 6e20 6361 6c63 756c 6174 6520   then calculate 
+0000ac90: 7374 6174 2066 6f72 2065 6163 680d 0a20  stat for each.. 
+0000aca0: 2020 2020 2020 2023 2073 6571 7565 6e74         # sequent
+0000acb0: 6961 6c20 6772 6f75 700d 0a20 2020 2020  ial group..     
+0000acc0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+0000acd0: 6365 2867 726f 7570 6279 5f63 6f6c 735b  ce(groupby_cols[
+0000ace0: 305d 2c20 6c69 7374 293a 0d0a 2020 2020  0], list):..    
+0000acf0: 2020 2020 2020 2020 666f 7220 6772 6f75          for grou
+0000ad00: 7069 6e67 2069 6e20 6772 6f75 7062 795f  ping in groupby_
+0000ad10: 636f 6c73 3a0d 0a20 2020 2020 2020 2020  cols:..         
+0000ad20: 2020 2020 2020 2073 7461 7428 6364 662c         stat(cdf,
+0000ad30: 2067 726f 7570 696e 672c 2069 6e70 6c61   grouping, inpla
+0000ad40: 6365 203d 2054 7275 6529 0d0a 2020 2020  ce = True)..    
+0000ad50: 2020 2020 2320 4966 2074 6865 2067 726f      # If the gro
+0000ad60: 7570 6279 5f63 6f6c 7320 6973 2061 206c  upby_cols is a l
+0000ad70: 6973 7420 6f66 2063 6f6c 756d 6e20 6e61  ist of column na
+0000ad80: 6d65 732c 2074 6865 6e20 6361 6c63 756c  mes, then calcul
+0000ad90: 6174 6520 7374 6174 0d0a 2020 2020 2020  ate stat..      
+0000ada0: 2020 2320 666f 7220 6561 6368 2067 726f    # for each gro
+0000adb0: 7570 0d0a 2020 2020 2020 2020 656c 6966  up..        elif
+0000adc0: 2069 7369 6e73 7461 6e63 6528 6772 6f75   isinstance(grou
+0000add0: 7062 795f 636f 6c73 2c20 6c69 7374 293a  pby_cols, list):
+0000ade0: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+0000adf0: 6174 2863 6466 2c20 6772 6f75 7062 795f  at(cdf, groupby_
+0000ae00: 636f 6c73 2c20 696e 706c 6163 6520 3d20  cols, inplace = 
+0000ae10: 5472 7565 290d 0a20 2020 2020 2020 2023  True)..        #
+0000ae20: 2045 6c73 6520 756e 6578 7065 6374 6564   Else unexpected
+0000ae30: 2066 6f72 6d61 7420 666f 7220 6772 6f75   format for grou
+0000ae40: 7062 795f 636f 6c73 0d0a 2020 2020 2020  pby_cols..      
+0000ae50: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000ae60: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000ae70: 4572 726f 7228 2754 6865 2076 616c 7565  Error('The value
+0000ae80: 2070 726f 7669 6465 6420 666f 7220 2267   provided for "g
+0000ae90: 726f 7570 6279 5f63 6f6c 7322 206d 7573  roupby_cols" mus
+0000aea0: 7420 6265 2061 2027 0d0a 2020 2020 2020  t be a '..      
+0000aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aec0: 2020 2020 2020 2027 6c69 7374 2072 6174         'list rat
+0000aed0: 6865 7220 7468 616e 207b 7479 7065 2867  her than {type(g
+0000aee0: 726f 7570 6279 5f63 6f6c 7329 7d2e 2729  roupby_cols)}.')
+0000aef0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0000af00: 2020 2020 2320 5365 7420 666f 6375 7320      # Set focus 
+0000af10: 6f66 2068 6967 6820 6f72 206c 6f77 0d0a  of high or low..
+0000af20: 2020 2020 2020 2020 6966 2073 7461 7420          if stat 
+0000af30: 3d3d 2043 656e 736f 7265 6444 6174 612e  == CensoredData.
+0000af40: 6d61 7869 6d75 6d5f 696e 7465 7276 616c  maximum_interval
+0000af50: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
+0000af60: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
+0000af70: 6961 6c20 3d20 5472 7565 0d0a 2020 2020  ial = True..    
+0000af80: 2020 2020 656c 6966 2073 7461 7420 3d3d      elif stat ==
+0000af90: 2043 656e 736f 7265 6444 6174 612e 6d69   CensoredData.mi
+0000afa0: 6e69 6d75 6d5f 696e 7465 7276 616c 3a0d  nimum_interval:.
+0000afb0: 0a20 2020 2020 2020 2020 2020 2066 6f63  .            foc
+0000afc0: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
+0000afd0: 6c20 3d20 4661 6c73 650d 0a20 2020 2020  l = False..     
+0000afe0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000aff0: 2020 2020 2020 666f 6375 735f 6869 6768        focus_high
+0000b000: 5f70 6f74 656e 7469 616c 203d 2073 656c  _potential = sel
+0000b010: 662e 666f 6375 735f 6869 6768 5f70 6f74  f.focus_high_pot
+0000b020: 656e 7469 616c 0d0a 2020 2020 2020 2020  ential..        
+0000b030: 0d0a 2020 2020 2020 2020 2320 436f 6e76  ..        # Conv
+0000b040: 6572 7420 7468 6520 696e 7465 7276 616c  ert the interval
+0000b050: 2066 6f72 2074 6865 2073 7461 7420 696e   for the stat in
+0000b060: 746f 2063 656e 736f 7220 616e 6420 6e75  to censor and nu
+0000b070: 6d65 7269 6320 6e6f 7461 7469 6f6e 0d0a  meric notation..
+0000b080: 2020 2020 2020 2020 6364 662e 636f 6d70          cdf.comp
+0000b090: 6f6e 656e 7473 5f66 726f 6d5f 696e 7465  onents_from_inte
+0000b0a0: 7276 616c 2866 6f63 7573 5f68 6967 685f  rval(focus_high_
+0000b0b0: 706f 7465 6e74 6961 6c2c 2069 6e70 6c61  potential, inpla
+0000b0c0: 6365 203d 2054 7275 6529 0d0a 2020 2020  ce = True)..    
+0000b0d0: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+0000b0e0: 4372 6561 7465 2063 6f6c 756d 6e20 7769  Create column wi
+0000b0f0: 7468 2069 6e74 6572 7661 6c20 6e6f 7461  th interval nota
+0000b100: 7469 6f6e 0d0a 2020 2020 2020 2020 6364  tion..        cd
+0000b110: 662e 696e 7465 7276 616c 5f6e 6f74 6174  f.interval_notat
+0000b120: 696f 6e28 696e 706c 6163 6520 3d20 5472  ion(inplace = Tr
+0000b130: 7565 290d 0a20 2020 2020 2020 200d 0a20  ue)..        .. 
+0000b140: 2020 2020 2020 2023 2043 6f6d 6269 6e65         # Combine
+0000b150: 2074 6865 2063 656e 736f 7220 616e 6420   the censor and 
+0000b160: 6e75 6d65 7269 6320 636f 6d70 6f6e 656e  numeric componen
+0000b170: 7473 2069 6e74 6f20 6120 7265 7375 6c74  ts into a result
+0000b180: 0d0a 2020 2020 2020 2020 6364 662e 7265  ..        cdf.re
+0000b190: 7375 6c74 5f66 726f 6d5f 636f 6d70 6f6e  sult_from_compon
+0000b1a0: 656e 7473 2869 6e70 6c61 6365 203d 2054  ents(inplace = T
+0000b1b0: 7275 6529 0d0a 2020 2020 2020 2020 0d0a  rue)..        ..
+0000b1c0: 2020 2020 2020 2020 2320 5265 6f72 6465          # Reorde
+0000b1d0: 7220 636f 6c75 6d6e 730d 0a20 2020 2020  r columns..     
+0000b1e0: 2020 206f 7574 7075 745f 636f 6c73 203d     output_cols =
+0000b1f0: 205b 6364 662e 7374 6174 5f63 6f6c 2c0d   [cdf.stat_col,.
+0000b200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b210: 2020 2020 2020 2020 2020 2063 6466 2e72             cdf.r
+0000b220: 6573 756c 745f 636f 6c2c 0d0a 2020 2020  esult_col,..    
+0000b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b240: 2020 2020 2020 6364 662e 6365 6e73 6f72        cdf.censor
+0000b250: 5f63 6f6c 2c0d 0a20 2020 2020 2020 2020  _col,..         
+0000b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b270: 2063 6466 2e6e 756d 6572 6963 5f63 6f6c   cdf.numeric_col
+0000b280: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000b290: 2020 2020 2020 2020 2020 2020 2063 6466               cdf
+0000b2a0: 2e69 6e74 6572 7661 6c5f 636f 6c5d 0d0a  .interval_col]..
+0000b2b0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0000b2c0: 2020 6966 2067 726f 7570 6279 5f63 6f6c    if groupby_col
+0000b2d0: 7320 3d3d 204e 6f6e 653a 0d0a 2020 2020  s == None:..    
+0000b2e0: 2020 2020 2020 2020 6364 662e 6461 7461          cdf.data
+0000b2f0: 203d 2063 6466 2e64 6174 615b 6f75 7470   = cdf.data[outp
+0000b300: 7574 5f63 6f6c 735d 0d0a 2020 2020 2020  ut_cols]..      
+0000b310: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000b320: 2020 2020 2063 6466 2e64 6174 6120 3d20       cdf.data = 
+0000b330: 6364 662e 6461 7461 5b67 726f 7570 6279  cdf.data[groupby
+0000b340: 5f63 6f6c 7320 2b20 6f75 7470 7574 5f63  _cols + output_c
+0000b350: 6f6c 735d 0d0a 2020 2020 2020 2020 0d0a  ols]..        ..
+0000b360: 2020 2020 2020 2020 2320 4d65 7267 6520          # Merge 
+0000b370: 636f 756e 7420 696e 666f 0d0a 2020 2020  count info..    
+0000b380: 2020 2020 6966 2063 6f75 6e74 5f63 6f6c      if count_col
+0000b390: 7320 213d 204e 6f6e 653a 0d0a 2020 2020  s != None:..    
+0000b3a0: 2020 2020 2020 2020 6364 662e 6461 7461          cdf.data
+0000b3b0: 203d 2073 656c 662e 6d65 7267 655f 636f   = self.merge_co
+0000b3c0: 756e 7473 2863 6466 2e64 6174 612c 0d0a  unts(cdf.data,..
+0000b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3f0: 2020 2020 2020 2020 2063 6f75 6e74 5f63           count_c
+0000b400: 6f6c 732c 0d0a 2020 2020 2020 2020 2020  ols,..          
+0000b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b420: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0000b430: 726f 7570 6279 5f63 6f6c 7329 0d0a 2020  roupby_cols)..  
+0000b440: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000b450: 2320 5265 706c 6163 6520 6f72 2072 6574  # Replace or ret
+0000b460: 7572 6e20 7265 7375 6c74 0d0a 2020 2020  urn result..    
+0000b470: 2020 2020 6966 2069 6e70 6c61 6365 3a0d      if inplace:.
+0000b480: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000b490: 662e 6461 7461 203d 2063 6466 2e64 6174  f.data = cdf.dat
+0000b4a0: 610d 0a20 2020 2020 2020 2065 6c73 653a  a..        else:
+0000b4b0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000b4c0: 7475 726e 2063 6466 2e64 6174 610d 0a20  turn cdf.data.. 
+0000b4d0: 2020 200d 0a20 2020 2064 6566 206d 6178     ..    def max
+0000b4e0: 696d 756d 2873 656c 662c 0d0a 2020 2020  imum(self,..    
+0000b4f0: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
+0000b500: 7062 795f 636f 6c73 203d 204e 6f6e 652c  pby_cols = None,
+0000b510: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b520: 2020 636f 756e 745f 636f 6c73 203d 204e    count_cols = N
+0000b530: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
+0000b540: 2020 2020 2020 696e 706c 6163 6520 3d20        inplace = 
+0000b550: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+0000b560: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
+0000b570: 6e20 7365 6c66 2e67 656e 6572 616c 5f73  n self.general_s
+0000b580: 7461 7428 4365 6e73 6f72 6564 4461 7461  tat(CensoredData
+0000b590: 2e6d 6178 696d 756d 5f69 6e74 6572 7661  .maximum_interva
+0000b5a0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5c0: 2020 2020 2067 726f 7570 6279 5f63 6f6c       groupby_col
+0000b5d0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5f0: 2020 2020 2063 6f75 6e74 5f63 6f6c 732c       count_cols,
+0000b600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b620: 2020 2069 6e70 6c61 6365 290d 0a20 2020     inplace)..   
+0000b630: 200d 0a20 2020 2064 6566 206d 696e 696d   ..    def minim
+0000b640: 756d 2873 656c 662c 0d0a 2020 2020 2020  um(self,..      
+0000b650: 2020 2020 2020 2020 2020 6772 6f75 7062            groupb
+0000b660: 795f 636f 6c73 203d 204e 6f6e 652c 0d0a  y_cols = None,..
+0000b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b680: 636f 756e 745f 636f 6c73 203d 204e 6f6e  count_cols = Non
+0000b690: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0000b6a0: 2020 2020 696e 706c 6163 6520 3d20 4661      inplace = Fa
+0000b6b0: 6c73 6529 3a0d 0a20 2020 2020 2020 200d  lse):..        .
+0000b6c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000b6d0: 7365 6c66 2e67 656e 6572 616c 5f73 7461  self.general_sta
+0000b6e0: 7428 4365 6e73 6f72 6564 4461 7461 2e6d  t(CensoredData.m
+0000b6f0: 696e 696d 756d 5f69 6e74 6572 7661 6c2c  inimum_interval,
+0000b700: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b720: 2020 2067 726f 7570 6279 5f63 6f6c 732c     groupby_cols,
+0000b730: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b750: 2020 2063 6f75 6e74 5f63 6f6c 732c 0d0a     count_cols,..
+0000b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b780: 2069 6e70 6c61 6365 290d 0a20 2020 200d   inplace)..    .
+0000b790: 0a20 2020 2064 6566 206d 6561 6e28 7365  .    def mean(se
+0000b7a0: 6c66 2c0d 0a20 2020 2020 2020 2020 2020  lf,..           
+0000b7b0: 2020 2020 2067 726f 7570 6279 5f63 6f6c       groupby_col
+0000b7c0: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2020  s = None,..     
+0000b7d0: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
+0000b7e0: 5f63 6f6c 7320 3d20 4e6f 6e65 2c0d 0a20  _cols = None,.. 
+0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b800: 6e70 6c61 6365 203d 2046 616c 7365 293a  nplace = False):
+0000b810: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0000b820: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000b830: 6765 6e65 7261 6c5f 7374 6174 2843 656e  general_stat(Cen
+0000b840: 736f 7265 6444 6174 612e 6d65 616e 5f69  soredData.mean_i
+0000b850: 6e74 6572 7661 6c2c 0d0a 2020 2020 2020  nterval,..      
+0000b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b870: 2020 2020 2020 2020 2020 2067 726f 7570             group
+0000b880: 6279 5f63 6f6c 732c 0d0a 2020 2020 2020  by_cols,..      
+0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8a0: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
+0000b8b0: 5f63 6f6c 732c 0d0a 2020 2020 2020 2020  _cols,..        
+0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8d0: 2020 2020 2020 2020 2069 6e70 6c61 6365           inplace
+0000b8e0: 290d 0a20 2020 200d 0a20 2020 2064 6566  )..    ..    def
+0000b8f0: 2061 6464 2873 656c 662c 0d0a 2020 2020   add(self,..    
+0000b900: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
+0000b910: 7062 795f 636f 6c73 203d 204e 6f6e 652c  pby_cols = None,
+0000b920: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b930: 2020 636f 756e 745f 636f 6c73 203d 204e    count_cols = N
+0000b940: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
+0000b950: 2020 2020 2020 696e 706c 6163 6520 3d20        inplace = 
+0000b960: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+0000b970: 200d 0a20 2020 2020 2020 2072 6574 7572   ..        retur
+0000b980: 6e20 7365 6c66 2e67 656e 6572 616c 5f73  n self.general_s
+0000b990: 7461 7428 4365 6e73 6f72 6564 4461 7461  tat(CensoredData
+0000b9a0: 2e61 6464 5f69 6e74 6572 7661 6c2c 0d0a  .add_interval,..
+0000b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9d0: 2067 726f 7570 6279 5f63 6f6c 732c 0d0a   groupby_cols,..
+0000b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba00: 2063 6f75 6e74 5f63 6f6c 732c 0d0a 2020   count_cols,..  
+0000ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ba30: 6e70 6c61 6365 290d 0a20 2020 2020 2020  nplace)..       
+0000ba40: 200d 0a20 2020 2064 6566 2070 6572 6365   ..    def perce
+0000ba50: 6e74 696c 6528 7365 6c66 2c0d 0a20 2020  ntile(self,..   
+0000ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba70: 6772 6f75 7062 795f 636f 6c73 203d 204e  groupby_cols = N
+0000ba80: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
+0000ba90: 2020 2020 2020 2020 2063 6f75 6e74 5f63           count_c
+0000baa0: 6f6c 7320 3d20 4e6f 6e65 2c0d 0a20 2020  ols = None,..   
+0000bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bac0: 7065 7263 656e 7469 6c65 203d 204e 6f6e  percentile = Non
+0000bad0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0000bae0: 2020 2020 2020 206d 6574 686f 6420 3d20         method = 
+0000baf0: 2768 617a 656e 272c 0d0a 2020 2020 2020  'hazen',..      
+0000bb00: 2020 2020 2020 2020 2020 2020 2069 6e70               inp
+0000bb10: 6c61 6365 203d 2046 616c 7365 0d0a 2020  lace = False..  
+0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb30: 2029 3a0d 0a20 2020 2020 2020 200d 0a20   ):..        .. 
+0000bb40: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+0000bb50: 6120 636f 7079 206f 6620 7468 6520 4365  a copy of the Ce
+0000bb60: 6e73 6f72 6564 4461 7461 206f 626a 6563  nsoredData objec
+0000bb70: 740d 0a20 2020 2020 2020 2063 6466 203d  t..        cdf =
+0000bb80: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
+0000bb90: 656c 6629 0d0a 2020 2020 2020 2020 0d0a  elf)..        ..
+0000bba0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+0000bbb0: 666f 7220 7065 7263 656e 7469 6c65 0d0a  for percentile..
+0000bbc0: 2020 2020 2020 2020 6966 2028 7065 7263          if (perc
+0000bbd0: 656e 7469 6c65 203e 2031 3030 2920 7c20  entile > 100) | 
+0000bbe0: 2870 6572 6365 6e74 696c 6520 3c20 3029  (percentile < 0)
+0000bbf0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0000bc00: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0000bc10: 2754 6865 2070 6572 6365 6e74 696c 6520  'The percentile 
+0000bc20: 6d75 7374 2062 6520 6265 7477 6565 6e20  must be between 
+0000bc30: 3020 616e 6420 3130 302e 2729 0d0a 2020  0 and 100.')..  
+0000bc40: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000bc50: 2320 4966 206e 6f20 6772 6f75 7062 795f  # If no groupby_
+0000bc60: 636f 6c73 2070 726f 7669 6465 642c 2063  cols provided, c
+0000bc70: 616c 6375 6c61 7465 2073 7461 7420 666f  alculate stat fo
+0000bc80: 7220 6675 6c6c 2064 6174 6173 6574 0d0a  r full dataset..
+0000bc90: 2020 2020 2020 2020 6966 2067 726f 7570          if group
+0000bca0: 6279 5f63 6f6c 7320 3d3d 204e 6f6e 653a  by_cols == None:
+0000bcb0: 0d0a 2020 2020 2020 2020 2020 2020 6364  ..            cd
+0000bcc0: 662e 7065 7263 656e 7469 6c65 5f69 6e74  f.percentile_int
+0000bcd0: 6572 7661 6c28 6772 6f75 7062 795f 636f  erval(groupby_co
+0000bce0: 6c73 2c0d 0a20 2020 2020 2020 2020 2020  ls,..           
+0000bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd00: 2020 2020 2020 2020 2070 6572 6365 6e74           percent
+0000bd10: 696c 652c 0d0a 2020 2020 2020 2020 2020  ile,..          
+0000bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd30: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+0000bd40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd60: 2020 2020 2020 2069 6e70 6c61 6365 203d         inplace =
+0000bd70: 2054 7275 6529 0d0a 2020 2020 2020 2020   True)..        
+0000bd80: 2320 4966 2067 726f 7570 6279 5f63 6f6c  # If groupby_col
+0000bd90: 7320 6973 2061 206c 6973 7420 6f66 206c  s is a list of l
+0000bda0: 6973 7473 2c20 7468 656e 2063 616c 6375  ists, then calcu
+0000bdb0: 6c61 7465 2073 7461 7420 666f 7220 6561  late stat for ea
+0000bdc0: 6368 0d0a 2020 2020 2020 2020 2320 7365  ch..        # se
+0000bdd0: 7175 656e 7469 616c 2067 726f 7570 2c20  quential group, 
+0000bde0: 7573 6520 6d65 6469 616e 2066 6f72 2061  use median for a
+0000bdf0: 6c6c 2062 7574 206c 6173 7420 6772 6f75  ll but last grou
+0000be00: 700d 0a20 2020 2020 2020 2065 6c69 6620  p..        elif 
+0000be10: 6973 696e 7374 616e 6365 2867 726f 7570  isinstance(group
+0000be20: 6279 5f63 6f6c 735b 305d 2c20 6c69 7374  by_cols[0], list
+0000be30: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000be40: 666f 7220 6772 6f75 7069 6e67 2069 6e20  for grouping in 
+0000be50: 6772 6f75 7062 795f 636f 6c73 3a0d 0a20  groupby_cols:.. 
+0000be60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000be70: 6620 6772 6f75 7069 6e67 203d 3d20 6772  f grouping == gr
+0000be80: 6f75 7062 795f 636f 6c73 5b2d 315d 3a0d  oupby_cols[-1]:.
+0000be90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bea0: 2020 2020 2063 6466 2e70 6572 6365 6e74       cdf.percent
+0000beb0: 696c 655f 696e 7465 7276 616c 2867 726f  ile_interval(gro
+0000bec0: 7570 696e 672c 0d0a 2020 2020 2020 2020  uping,..        
+0000bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bef0: 2020 2020 7065 7263 656e 7469 6c65 2c0d      percentile,.
+0000bf00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf20: 2020 2020 2020 2020 2020 2020 206d 6574               met
+0000bf30: 686f 642c 0d0a 2020 2020 2020 2020 2020  hod,..          
+0000bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf60: 2020 696e 706c 6163 653d 5472 7565 290d    inplace=True).
+0000bf70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bf80: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0000bf90: 2020 2020 2020 2020 2020 2020 6364 662e              cdf.
+0000bfa0: 7065 7263 656e 7469 6c65 5f69 6e74 6572  percentile_inter
+0000bfb0: 7661 6c28 6772 6f75 7069 6e67 2c0d 0a20  val(grouping,.. 
+0000bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfe0: 2020 2020 2020 2020 2020 2035 302c 0d0a             50,..
+0000bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c010: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+0000c020: 6f64 2c0d 0a20 2020 2020 2020 2020 2020  od,..           
+0000c030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c050: 2069 6e70 6c61 6365 3d54 7275 6529 0d0a   inplace=True)..
+0000c060: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
+0000c070: 2067 726f 7570 6279 5f63 6f6c 7320 6973   groupby_cols is
+0000c080: 2061 206c 6973 7420 6f66 2063 6f6c 756d   a list of colum
+0000c090: 6e20 6e61 6d65 732c 2074 6865 6e20 6361  n names, then ca
+0000c0a0: 6c63 756c 6174 6520 7374 6174 0d0a 2020  lculate stat..  
+0000c0b0: 2020 2020 2020 2320 666f 7220 6561 6368        # for each
+0000c0c0: 2067 726f 7570 0d0a 2020 2020 2020 2020   group..        
+0000c0d0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+0000c0e0: 6772 6f75 7062 795f 636f 6c73 2c20 6c69  groupby_cols, li
+0000c0f0: 7374 293a 0d0a 2020 2020 2020 2020 2020  st):..          
+0000c100: 2020 6364 662e 7065 7263 656e 7469 6c65    cdf.percentile
+0000c110: 5f69 6e74 6572 7661 6c28 6772 6f75 7062  _interval(groupb
+0000c120: 795f 636f 6c73 2c0d 0a20 2020 2020 2020  y_cols,..       
+0000c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c140: 2020 2020 2020 2020 2020 2020 2070 6572               per
+0000c150: 6365 6e74 696c 652c 0d0a 2020 2020 2020  centile,..      
+0000c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c170: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+0000c180: 7468 6f64 2c0d 0a20 2020 2020 2020 2020  thod,..         
+0000c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1a0: 2020 2020 2020 2020 2020 2069 6e70 6c61             inpla
+0000c1b0: 6365 3d54 7275 6529 0d0a 2020 2020 2020  ce=True)..      
+0000c1c0: 2020 2320 456c 7365 2075 6e65 7870 6563    # Else unexpec
+0000c1d0: 7465 6420 666f 726d 6174 2066 6f72 2067  ted format for g
+0000c1e0: 726f 7570 6279 5f63 6f6c 730d 0a20 2020  roupby_cols..   
+0000c1f0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000c200: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000c210: 6c75 6545 7272 6f72 2827 5468 6520 7661  lueError('The va
+0000c220: 6c75 6520 7072 6f76 6964 6564 2066 6f72  lue provided for
+0000c230: 2022 6772 6f75 7062 795f 636f 6c73 2220   "groupby_cols" 
+0000c240: 6d75 7374 2062 6520 6120 270d 0a20 2020  must be a '..   
+0000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c260: 2020 2020 2020 2020 2020 276c 6973 7420            'list 
+0000c270: 7261 7468 6572 2074 6861 6e20 7b74 7970  rather than {typ
+0000c280: 6528 6772 6f75 7062 795f 636f 6c73 297d  e(groupby_cols)}
+0000c290: 2e27 290d 0a20 2020 2020 2020 200d 0a20  .')..        .. 
+0000c2a0: 2020 2020 2020 2023 2043 6f6e 7665 7274         # Convert
+0000c2b0: 2074 6865 2069 6e74 6572 7661 6c20 666f   the interval fo
+0000c2c0: 7220 7468 6520 7374 6174 2069 6e74 6f20  r the stat into 
+0000c2d0: 6365 6e73 6f72 2061 6e64 206e 756d 6572  censor and numer
+0000c2e0: 6963 206e 6f74 6174 696f 6e0d 0a20 2020  ic notation..   
+0000c2f0: 2020 2020 2063 6466 2e63 6f6d 706f 6e65       cdf.compone
+0000c300: 6e74 735f 6672 6f6d 5f69 6e74 6572 7661  nts_from_interva
+0000c310: 6c28 6364 662e 666f 6375 735f 6869 6768  l(cdf.focus_high
+0000c320: 5f70 6f74 656e 7469 616c 2c20 696e 706c  _potential, inpl
+0000c330: 6163 6520 3d20 5472 7565 290d 0a20 2020  ace = True)..   
+0000c340: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+0000c350: 2043 7265 6174 6520 636f 6c75 6d6e 2077   Create column w
+0000c360: 6974 6820 696e 7465 7276 616c 206e 6f74  ith interval not
+0000c370: 6174 696f 6e0d 0a20 2020 2020 2020 2063  ation..        c
+0000c380: 6466 2e69 6e74 6572 7661 6c5f 6e6f 7461  df.interval_nota
+0000c390: 7469 6f6e 2869 6e70 6c61 6365 203d 2054  tion(inplace = T
+0000c3a0: 7275 6529 0d0a 2020 2020 2020 2020 0d0a  rue)..        ..
+0000c3b0: 2020 2020 2020 2020 2320 436f 6d62 696e          # Combin
+0000c3c0: 6520 7468 6520 6365 6e73 6f72 2061 6e64  e the censor and
+0000c3d0: 206e 756d 6572 6963 2063 6f6d 706f 6e65   numeric compone
+0000c3e0: 6e74 7320 696e 746f 2061 2072 6573 756c  nts into a resul
+0000c3f0: 740d 0a20 2020 2020 2020 2063 6466 2e72  t..        cdf.r
+0000c400: 6573 756c 745f 6672 6f6d 5f63 6f6d 706f  esult_from_compo
+0000c410: 6e65 6e74 7328 696e 706c 6163 6520 3d20  nents(inplace = 
+0000c420: 5472 7565 290d 0a20 2020 2020 2020 200d  True)..        .
+0000c430: 0a20 2020 2020 2020 2063 6466 2e64 6174  .        cdf.dat
+0000c440: 615b 6364 662e 7265 7375 6c74 5f63 6f6c  a[cdf.result_col
+0000c450: 5d20 2b3d 2063 6466 2e64 6174 615b 275f  ] += cdf.data['_
+0000c460: 5f57 6172 6e69 6e67 5f5f 275d 0d0a 2020  _Warning__']..  
+0000c470: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000c480: 2320 5265 6f72 6465 7220 636f 6c75 6d6e  # Reorder column
+0000c490: 730d 0a20 2020 2020 2020 206f 7574 7075  s..        outpu
+0000c4a0: 745f 636f 6c73 203d 205b 6364 662e 7374  t_cols = [cdf.st
+0000c4b0: 6174 5f63 6f6c 2c0d 0a20 2020 2020 2020  at_col,..       
+0000c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4d0: 2020 2063 6466 2e72 6573 756c 745f 636f     cdf.result_co
+0000c4e0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 6364                cd
+0000c500: 662e 6365 6e73 6f72 5f63 6f6c 2c0d 0a20  f.censor_col,.. 
+0000c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c520: 2020 2020 2020 2020 2063 6466 2e6e 756d           cdf.num
+0000c530: 6572 6963 5f63 6f6c 2c0d 0a20 2020 2020  eric_col,..     
+0000c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c550: 2020 2020 2063 6466 2e69 6e74 6572 7661       cdf.interva
+0000c560: 6c5f 636f 6c5d 0d0a 2020 2020 2020 2020  l_col]..        
+0000c570: 0d0a 2020 2020 2020 2020 6966 2067 726f  ..        if gro
+0000c580: 7570 6279 5f63 6f6c 7320 3d3d 204e 6f6e  upby_cols == Non
+0000c590: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000c5a0: 6364 662e 6461 7461 203d 2063 6466 2e64  cdf.data = cdf.d
+0000c5b0: 6174 615b 6f75 7470 7574 5f63 6f6c 735d  ata[output_cols]
+0000c5c0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+0000c5d0: 0a20 2020 2020 2020 2020 2020 2063 6466  .            cdf
+0000c5e0: 2e64 6174 6120 3d20 6364 662e 6461 7461  .data = cdf.data
+0000c5f0: 5b67 726f 7570 6279 5f63 6f6c 7320 2b20  [groupby_cols + 
+0000c600: 6f75 7470 7574 5f63 6f6c 735d 0d0a 2020  output_cols]..  
+0000c610: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000c620: 2320 4d65 7267 6520 636f 756e 7420 696e  # Merge count in
+0000c630: 666f 0d0a 2020 2020 2020 2020 6966 2063  fo..        if c
+0000c640: 6f75 6e74 5f63 6f6c 7320 213d 204e 6f6e  ount_cols != Non
+0000c650: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000c660: 6364 662e 6461 7461 203d 2073 656c 662e  cdf.data = self.
+0000c670: 6d65 7267 655f 636f 756e 7473 2863 6466  merge_counts(cdf
+0000c680: 2e64 6174 612c 0d0a 2020 2020 2020 2020  .data,..        
+0000c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6b0: 2063 6f75 6e74 5f63 6f6c 732c 0d0a 2020   count_cols,..  
+0000c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6e0: 2020 2020 2020 2067 726f 7570 6279 5f63         groupby_c
+0000c6f0: 6f6c 7329 0d0a 2020 2020 2020 2020 0d0a  ols)..        ..
+0000c700: 2020 2020 2020 2020 2320 5265 706c 6163          # Replac
+0000c710: 6520 6f72 2072 6574 7572 6e20 7265 7375  e or return resu
+0000c720: 6c74 0d0a 2020 2020 2020 2020 6966 2069  lt..        if i
+0000c730: 6e70 6c61 6365 3a0d 0a20 2020 2020 2020  nplace:..       
+0000c740: 2020 2020 2073 656c 662e 6461 7461 203d       self.data =
+0000c750: 2063 6466 2e64 6174 610d 0a20 2020 2020   cdf.data..     
+0000c760: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000c770: 2020 2020 2020 7265 7475 726e 2063 6466        return cdf
+0000c780: 2e64 6174 610d 0a20 2020 200d 0a20 2020  .data..    ..   
+0000c790: 2064 6566 206d 6564 6961 6e28 7365 6c66   def median(self
+0000c7a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000c7b0: 2020 6772 6f75 7062 795f 636f 6c73 203d    groupby_cols =
+0000c7c0: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
+0000c7d0: 2020 2020 2020 2063 6f75 6e74 5f63 6f6c         count_col
+0000c7e0: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2020  s = None,..     
+0000c7f0: 2020 2020 2020 2020 2020 696e 706c 6163            inplac
+0000c800: 6520 3d20 4661 6c73 6529 3a0d 0a20 2020  e = False):..   
+0000c810: 2020 2020 200d 0a20 2020 2020 2020 2072       ..        r
+0000c820: 6574 7572 6e20 7365 6c66 2e70 6572 6365  eturn self.perce
+0000c830: 6e74 696c 6528 6772 6f75 7062 795f 636f  ntile(groupby_co
+0000c840: 6c73 2c0d 0a20 2020 2020 2020 2020 2020  ls,..           
+0000c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c860: 2020 2020 636f 756e 745f 636f 6c73 2c0d      count_cols,.
+0000c870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c890: 3530 2c0d 0a20 2020 2020 2020 2020 2020  50,..           
+0000c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c8b0: 2020 2020 696e 706c 6163 653d 696e 706c      inplace=inpl
+0000c8c0: 6163 6529 0d0a 2020 2020 0d0a 2020 2020  ace)..    ..    
+0000c8d0: 6465 6620 7065 7263 656e 745f 6578 6365  def percent_exce
+0000c8e0: 6564 616e 6365 7328 7365 6c66 2c0d 0a20  edances(self,.. 
+0000c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c900: 2020 2020 2020 2020 2020 2074 6872 6573             thres
+0000c910: 686f 6c64 2c0d 0a20 2020 2020 2020 2020  hold,..         
+0000c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c930: 2020 2074 6872 6573 686f 6c64 5f69 735f     threshold_is_
+0000c940: 6578 6365 6564 616e 6365 2c0d 0a20 2020  exceedance,..   
+0000c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c960: 2020 2020 2020 2020 2067 726f 7570 6279           groupby
+0000c970: 5f63 6f6c 7320 3d20 4e6f 6e65 2c0d 0a20  _cols = None,.. 
+0000c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c990: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
+0000c9a0: 5f63 6f6c 7320 3d20 4e6f 6e65 2c0d 0a20  _cols = None,.. 
+0000c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9c0: 2020 2020 2020 2020 2020 2069 6e70 6c61             inpla
+0000c9d0: 6365 203d 2046 616c 7365 293a 0d0a 2020  ce = False):..  
+0000c9e0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000c9f0: 2320 4372 6561 7465 2061 2063 6f70 7920  # Create a copy 
+0000ca00: 6f66 2074 6865 2043 656e 736f 7265 6444  of the CensoredD
+0000ca10: 6174 6120 6f62 6a65 6374 0d0a 2020 2020  ata object..    
+0000ca20: 2020 2020 6364 6620 3d20 636f 7079 2e64      cdf = copy.d
+0000ca30: 6565 7063 6f70 7928 7365 6c66 290d 0a20  eepcopy(self).. 
+0000ca40: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000ca50: 2023 2044 6574 6572 6d69 6e65 2065 7863   # Determine exc
+0000ca60: 6565 6461 6e63 6573 2066 6f72 2065 6163  eedances for eac
+0000ca70: 6820 7361 6d70 6c65 0d0a 2020 2020 2020  h sample..      
+0000ca80: 2020 6364 662e 6465 7465 726d 696e 655f    cdf.determine_
+0000ca90: 6578 6365 6564 616e 6365 7328 7468 7265  exceedances(thre
+0000caa0: 7368 6f6c 642c 0d0a 2020 2020 2020 2020  shold,..        
+0000cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cac0: 2020 2020 2020 2020 2020 7468 7265 7368            thresh
+0000cad0: 6f6c 645f 6973 5f65 7863 6565 6461 6e63  old_is_exceedanc
+0000cae0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0000caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb00: 2020 2020 2020 696e 706c 6163 6520 3d20        inplace = 
+0000cb10: 5472 7565 290d 0a20 2020 2020 2020 200d  True)..        .
+0000cb20: 0a20 2020 2020 2020 2064 6620 3d20 6364  .        df = cd
+0000cb30: 662e 6461 7461 0d0a 2020 2020 2020 2020  f.data..        
+0000cb40: 0d0a 2020 2020 2020 2020 2320 4966 206e  ..        # If n
+0000cb50: 6f20 6772 6f75 7062 795f 636f 6c73 2070  o groupby_cols p
+0000cb60: 726f 7669 6465 642c 2063 616c 6375 6c61  rovided, calcula
+0000cb70: 7465 2073 7461 7420 666f 7220 6675 6c6c  te stat for full
+0000cb80: 2064 6174 6173 6574 0d0a 2020 2020 2020   dataset..      
+0000cb90: 2020 6966 2067 726f 7570 6279 5f63 6f6c    if groupby_col
+0000cba0: 7320 3d3d 204e 6f6e 653a 0d0a 2020 2020  s == None:..    
+0000cbb0: 2020 2020 2020 2020 6466 203d 2028 6466          df = (df
+0000cbc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000cbd0: 2020 2e61 6767 282a 2a7b 0d0a 2020 2020    .agg(**{..    
+0000cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbf0: 2320 5375 6d20 6578 6365 6564 616e 6365  # Sum exceedance
+0000cc00: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+0000cc10: 2020 2020 2020 2063 6466 2e65 7863 6565         cdf.excee
+0000cc20: 6461 6e63 6573 5f63 6f6c 3a20 2863 6466  dances_col: (cdf
+0000cc30: 2e65 7863 6565 6461 6e63 6573 5f63 6f6c  .exceedances_col
+0000cc40: 2c27 7375 6d27 292c 0d0a 2020 2020 2020  ,'sum'),..      
+0000cc50: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000cc60: 436f 756e 7420 6f66 2061 7373 6573 7361  Count of assessa
+0000cc70: 626c 6520 7661 6c75 6573 0d0a 2020 2020  ble values..    
+0000cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc90: 275f 5f44 6574 6572 6d69 6e65 6443 6f75  '__DeterminedCou
+0000cca0: 6e74 5f5f 273a 2028 6364 662e 6578 6365  nt__': (cdf.exce
+0000ccb0: 6564 616e 6365 735f 636f 6c2c 2763 6f75  edances_col,'cou
+0000ccc0: 6e74 2729 2c0d 0a20 2020 2020 2020 2020  nt'),..         
+0000ccd0: 2020 2020 2020 2020 2020 2023 2043 6f75             # Cou
+0000cce0: 6e74 206f 6620 616c 6c20 7661 6c75 6573  nt of all values
+0000ccf0: 2028 696e 636c 7564 696e 6720 6e61 6e29   (including nan)
+0000cd00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000cd10: 2020 2020 2020 275f 5f54 6f74 616c 436f        '__TotalCo
+0000cd20: 756e 745f 5f27 3a20 2863 6466 2e65 7863  unt__': (cdf.exc
+0000cd30: 6565 6461 6e63 6573 5f63 6f6c 2c27 7369  eedances_col,'si
+0000cd40: 7a65 2729 0d0a 2020 2020 2020 2020 2020  ze')..          
+0000cd50: 2020 2020 2020 2020 2020 7d29 0d0a 2020            })..  
+0000cd60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000cd70: 466c 6970 2073 6572 6965 7320 696e 746f  Flip series into
+0000cd80: 2061 2074 6162 6c65 0d0a 2020 2020 2020   a table..      
+0000cd90: 2020 2020 2020 2020 2020 2e74 7261 6e73            .trans
+0000cda0: 706f 7365 2829 0d0a 2020 2020 2020 2020  pose()..        
+0000cdb0: 2020 2020 2020 2020 2e72 6573 6574 5f69          .reset_i
+0000cdc0: 6e64 6578 2864 726f 703d 5472 7565 290d  ndex(drop=True).
+0000cdd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cde0: 2029 0d0a 2020 2020 2020 2020 2320 4966   )..        # If
+0000cdf0: 2067 726f 7570 6279 5f63 6f6c 7320 6973   groupby_cols is
+0000ce00: 2061 206c 6973 7420 6f66 206c 6973 7473   a list of lists
+0000ce10: 2c20 7468 656e 2061 7373 6573 7320 6d61  , then assess ma
+0000ce20: 7869 6d75 6d73 2066 6f72 2066 6972 7374  ximums for first
+0000ce30: 0d0a 2020 2020 2020 2020 2320 6772 6f75  ..        # grou
+0000ce40: 7069 6e67 2061 6e64 2070 6572 6365 6e74  ping and percent
+0000ce50: 6167 6520 6f66 2065 7863 6565 6461 6e63  age of exceedanc
+0000ce60: 6573 2066 6f72 2074 6865 2073 6563 6f6e  es for the secon
+0000ce70: 6420 6772 6f75 7069 6e67 0d0a 2020 2020  d grouping..    
+0000ce80: 2020 2020 656c 6966 2028 6973 696e 7374      elif (isinst
+0000ce90: 616e 6365 2867 726f 7570 6279 5f63 6f6c  ance(groupby_col
+0000cea0: 735b 305d 2c6c 6973 7429 2920 2620 286c  s[0],list)) & (l
+0000ceb0: 656e 2867 726f 7570 6279 5f63 6f6c 7329  en(groupby_cols)
+0000cec0: 2021 3d20 3229 3a0d 0a20 2020 2020 2020   != 2):..       
+0000ced0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000cee0: 4572 726f 7228 274f 6e6c 7920 7477 6f20  Error('Only two 
+0000cef0: 6c69 7374 7320 6361 6e20 6265 2069 6e63  lists can be inc
+0000cf00: 6c75 6465 6420 666f 7220 6772 6f75 7062  luded for groupb
+0000cf10: 795f 636f 6c73 2027 0d0a 2020 2020 2020  y_cols '..      
+0000cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf30: 2020 2020 2020 2027 7468 6174 2069 7320         'that is 
+0000cf40: 6120 6c69 7374 206f 6620 6c69 7374 732e  a list of lists.
+0000cf50: 2052 6576 6965 7720 7468 6520 270d 0a20   Review the '.. 
+0000cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf70: 2020 2020 2020 2020 2020 2020 2764 6f63              'doc
+0000cf80: 756d 656e 7461 7469 6f6e 2066 6f72 2074  umentation for t
+0000cf90: 6869 7320 6d65 7468 6f64 2e27 290d 0a20  his method.').. 
+0000cfa0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+0000cfb0: 7374 616e 6365 2867 726f 7570 6279 5f63  stance(groupby_c
+0000cfc0: 6f6c 735b 305d 2c6c 6973 7429 3a0d 0a20  ols[0],list):.. 
+0000cfd0: 2020 2020 2020 2020 2020 2023 2055 7365             # Use
+0000cfe0: 206d 6178 696d 756d 2077 6974 6869 6e20   maximum within 
+0000cff0: 6561 6368 2067 726f 7570 2066 6f72 2066  each group for f
+0000d000: 6972 7374 2067 726f 7570 696e 670d 0a20  irst grouping.. 
+0000d010: 2020 2020 2020 2020 2020 2064 6620 3d20             df = 
+0000d020: 2864 662e 6772 6f75 7062 7928 6772 6f75  (df.groupby(grou
+0000d030: 7062 795f 636f 6c73 5b30 5d29 5b63 6466  pby_cols[0])[cdf
+0000d040: 2e65 7863 6565 6461 6e63 6573 5f63 6f6c  .exceedances_col
+0000d050: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0000d060: 2020 2020 2020 2020 202e 6d61 7828 290d           .max().
+0000d070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d080: 2020 2020 2020 202e 7265 7365 745f 696e         .reset_in
+0000d090: 6465 7828 2929 0d0a 2020 2020 2020 2020  dex())..        
+0000d0a0: 2020 2020 2320 5573 6520 7365 636f 6e64      # Use second
+0000d0b0: 2067 726f 7570 696e 6720 666f 7220 7065   grouping for pe
+0000d0c0: 7263 656e 7461 6765 206f 6620 6578 6365  rcentage of exce
+0000d0d0: 6564 616e 6365 730d 0a20 2020 2020 2020  edances..       
+0000d0e0: 2020 2020 2064 6620 3d20 2864 662e 6772       df = (df.gr
+0000d0f0: 6f75 7062 7928 6772 6f75 7062 795f 636f  oupby(groupby_co
+0000d100: 6c73 5b31 5d29 0d0a 2020 2020 2020 2020  ls[1])..        
+0000d110: 2020 2020 2020 2020 2020 2e61 6767 282a            .agg(*
+0000d120: 2a7b 0d0a 2020 2020 2020 2020 2020 2020  *{..            
+0000d130: 2020 2020 2020 2020 2020 6364 662e 6578            cdf.ex
+0000d140: 6365 6564 616e 6365 735f 636f 6c3a 2028  ceedances_col: (
+0000d150: 6364 662e 6578 6365 6564 616e 6365 735f  cdf.exceedances_
+0000d160: 636f 6c2c 2773 756d 2729 2c0d 0a20 2020  col,'sum'),..   
+0000d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d180: 2020 2027 5f5f 4465 7465 726d 696e 6564     '__Determined
+0000d190: 436f 756e 745f 5f27 3a20 2863 6466 2e65  Count__': (cdf.e
+0000d1a0: 7863 6565 6461 6e63 6573 5f63 6f6c 2c27  xceedances_col,'
+0000d1b0: 636f 756e 7427 292c 0d0a 2020 2020 2020  count'),..      
+0000d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1d0: 275f 5f54 6f74 616c 436f 756e 745f 5f27  '__TotalCount__'
+0000d1e0: 3a20 2863 6466 2e65 7863 6565 6461 6e63  : (cdf.exceedanc
+0000d1f0: 6573 5f63 6f6c 2c27 7369 7a65 2729 0d0a  es_col,'size')..
+0000d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d210: 2020 2020 7d29 0d0a 2020 2020 2020 2020      })..        
+0000d220: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+0000d230: 2020 2023 2049 6620 7468 6520 6772 6f75     # If the grou
+0000d240: 7062 795f 636f 6c73 2069 7320 6120 6c69  pby_cols is a li
+0000d250: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
+0000d260: 6573 2c20 7468 656e 2063 616c 6375 6c61  es, then calcula
+0000d270: 7465 2073 7461 740d 0a20 2020 2020 2020  te stat..       
+0000d280: 2023 2066 6f72 2065 6163 6820 6772 6f75   # for each grou
+0000d290: 700d 0a20 2020 2020 2020 2065 6c69 6620  p..        elif 
+0000d2a0: 6973 696e 7374 616e 6365 2867 726f 7570  isinstance(group
+0000d2b0: 6279 5f63 6f6c 732c 206c 6973 7429 3a0d  by_cols, list):.
+0000d2c0: 0a20 2020 2020 2020 2020 2020 2064 6620  .            df 
+0000d2d0: 3d20 2864 662e 6772 6f75 7062 7928 6772  = (df.groupby(gr
+0000d2e0: 6f75 7062 795f 636f 6c73 290d 0a20 2020  oupby_cols)..   
+0000d2f0: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+0000d300: 6167 6728 2a2a 7b0d 0a20 2020 2020 2020  agg(**{..       
+0000d310: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000d320: 6466 2e65 7863 6565 6461 6e63 6573 5f63  df.exceedances_c
+0000d330: 6f6c 3a20 2863 6466 2e65 7863 6565 6461  ol: (cdf.exceeda
+0000d340: 6e63 6573 5f63 6f6c 2c27 7375 6d27 292c  nces_col,'sum'),
+0000d350: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d360: 2020 2020 2020 2020 275f 5f44 6574 6572          '__Deter
+0000d370: 6d69 6e65 6443 6f75 6e74 5f5f 273a 2028  minedCount__': (
+0000d380: 6364 662e 6578 6365 6564 616e 6365 735f  cdf.exceedances_
+0000d390: 636f 6c2c 2763 6f75 6e74 2729 2c0d 0a20  col,'count'),.. 
+0000d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3b0: 2020 2020 2027 5f5f 546f 7461 6c43 6f75       '__TotalCou
+0000d3c0: 6e74 5f5f 273a 2028 6364 662e 6578 6365  nt__': (cdf.exce
+0000d3d0: 6564 616e 6365 735f 636f 6c2c 2773 697a  edances_col,'siz
+0000d3e0: 6527 290d 0a20 2020 2020 2020 2020 2020  e')..           
+0000d3f0: 2020 2020 2020 2020 207d 290d 0a20 2020           })..   
+0000d400: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0000d410: 2020 2020 2020 2020 2320 456c 7365 2075          # Else u
+0000d420: 6e65 7870 6563 7465 6420 666f 726d 6174  nexpected format
+0000d430: 2066 6f72 2067 726f 7570 6279 5f63 6f6c   for groupby_col
+0000d440: 730d 0a20 2020 2020 2020 2065 6c73 653a  s..        else:
+0000d450: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0000d460: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+0000d470: 5468 6520 7661 6c75 6520 7072 6f76 6964  The value provid
+0000d480: 6564 2066 6f72 2022 6772 6f75 7062 795f  ed for "groupby_
+0000d490: 636f 6c73 2220 6d75 7374 2062 6520 6120  cols" must be a 
+0000d4a0: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+0000d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4c0: 276c 6973 7420 7261 7468 6572 2074 6861  'list rather tha
+0000d4d0: 6e20 7b74 7970 6528 6772 6f75 7062 795f  n {type(groupby_
+0000d4e0: 636f 6c73 297d 2e27 290d 0a20 2020 2020  cols)}.')..     
+0000d4f0: 2020 200d 0a20 2020 2020 2020 2023 2044     ..        # D
+0000d500: 6574 6572 6d69 6e65 2063 6f75 6e74 7320  etermine counts 
+0000d510: 616e 6420 6361 6c63 756c 6174 6520 7065  and calculate pe
+0000d520: 7263 656e 7461 6765 0d0a 2020 2020 2020  rcentage..      
+0000d530: 2020 6466 5b63 6466 2e6e 6f6e 5f65 7863    df[cdf.non_exc
+0000d540: 6565 6461 6e63 6573 5f63 6f6c 5d20 3d20  eedances_col] = 
+0000d550: 280d 0a20 2020 2020 2020 2020 2020 2064  (..            d
+0000d560: 665b 275f 5f44 6574 6572 6d69 6e65 6443  f['__DeterminedC
+0000d570: 6f75 6e74 5f5f 275d 202d 2064 665b 6364  ount__'] - df[cd
+0000d580: 662e 6578 6365 6564 616e 6365 735f 636f  f.exceedances_co
+0000d590: 6c5d 0d0a 2020 2020 2020 2020 2020 2020  l]..            
+0000d5a0: 290d 0a20 2020 2020 2020 2064 665b 6364  )..        df[cd
+0000d5b0: 662e 6967 6e6f 7265 645f 636f 6c5d 203d  f.ignored_col] =
+0000d5c0: 2064 665b 275f 5f54 6f74 616c 436f 756e   df['__TotalCoun
+0000d5d0: 745f 5f27 5d20 2d20 6466 5b27 5f5f 4465  t__'] - df['__De
+0000d5e0: 7465 726d 696e 6564 436f 756e 745f 5f27  terminedCount__'
+0000d5f0: 5d0d 0a20 2020 2020 2020 2064 665b 6364  ]..        df[cd
+0000d600: 662e 6e75 6d65 7269 635f 636f 6c5d 203d  f.numeric_col] =
+0000d610: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+0000d620: 726f 756e 6428 6466 5b63 6466 2e65 7863  round(df[cdf.exc
+0000d630: 6565 6461 6e63 6573 5f63 6f6c 5d20 2f20  eedances_col] / 
+0000d640: 6466 5b27 5f5f 4465 7465 726d 696e 6564  df['__Determined
+0000d650: 436f 756e 745f 5f27 5d20 2a20 3130 302c  Count__'] * 100,
+0000d660: 2034 290d 0a20 2020 2020 2020 2020 2020   4)..           
+0000d670: 2029 0d0a 2020 2020 2020 2020 6466 5b63   )..        df[c
+0000d680: 6466 2e72 6573 756c 745f 636f 6c5d 203d  df.result_col] =
+0000d690: 2064 665b 6364 662e 6e75 6d65 7269 635f   df[cdf.numeric_
+0000d6a0: 636f 6c5d 2e61 7374 7970 6528 7374 7229  col].astype(str)
+0000d6b0: 202b 2027 2527 0d0a 2020 2020 2020 2020   + '%'..        
+0000d6c0: 6466 2e6c 6f63 5b64 665b 6364 662e 6967  df.loc[df[cdf.ig
+0000d6d0: 6e6f 7265 645f 636f 6c5d 203e 2030 2c20  nored_col] > 0, 
+0000d6e0: 6364 662e 7265 7375 6c74 5f63 6f6c 5d20  cdf.result_col] 
+0000d6f0: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
+0000d700: 2064 665b 6364 662e 7265 7375 6c74 5f63   df[cdf.result_c
+0000d710: 6f6c 5d20 2b0d 0a20 2020 2020 2020 2020  ol] +..         
+0000d720: 2020 2027 2028 2720 2b20 6466 5b63 6466     ' (' + df[cdf
+0000d730: 2e69 676e 6f72 6564 5f63 6f6c 5d2e 6173  .ignored_col].as
+0000d740: 7479 7065 2873 7472 2920 2b20 2720 7661  type(str) + ' va
+0000d750: 6c75 6573 2069 676e 6f72 6564 2927 0d0a  lues ignored)'..
+0000d760: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0000d770: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000d780: 2023 2043 7265 6174 6520 6120 636f 6c75   # Create a colu
+0000d790: 6d6e 2074 6861 7420 696e 6469 6361 7465  mn that indicate
+0000d7a0: 7320 7468 6520 6765 6e65 7261 7465 6420  s the generated 
+0000d7b0: 7374 6174 6973 7469 6320 0d0a 2020 2020  statistic ..    
+0000d7c0: 2020 2020 6466 5b63 6466 2e73 7461 745f      df[cdf.stat_
+0000d7d0: 636f 6c5d 203d 2027 5065 7263 656e 7420  col] = 'Percent 
+0000d7e0: 4578 6365 6564 616e 6365 270d 0a20 2020  Exceedance'..   
+0000d7f0: 2020 2020 2064 665b 6364 662e 7468 7265       df[cdf.thre
+0000d800: 7368 6f6c 645f 636f 6c5d 203d 2066 277b  shold_col] = f'{
+0000d810: 7468 7265 7368 6f6c 647d 270d 0a20 2020  threshold}'..   
+0000d820: 2020 2020 2069 6620 7468 7265 7368 6f6c       if threshol
+0000d830: 645f 6973 5f65 7863 6565 6461 6e63 653a  d_is_exceedance:
+0000d840: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
+0000d850: 5b63 6466 2e74 6872 6573 686f 6c64 5f63  [cdf.threshold_c
+0000d860: 6f6c 5d20 3d20 273c 2720 2b20 6466 5b63  ol] = '<' + df[c
+0000d870: 6466 2e74 6872 6573 686f 6c64 5f63 6f6c  df.threshold_col
+0000d880: 5d0d 0a20 2020 2020 2020 200d 0a20 2020  ]..        ..   
+0000d890: 2020 2020 2023 2052 6573 6574 2069 6e64       # Reset ind
+0000d8a0: 6578 0d0a 2020 2020 2020 2020 6466 203d  ex..        df =
+0000d8b0: 2064 662e 7265 7365 745f 696e 6465 7828   df.reset_index(
+0000d8c0: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+0000d8d0: 2020 2020 2023 2052 656f 7264 6572 2063       # Reorder c
+0000d8e0: 6f6c 756d 6e73 0d0a 2020 2020 2020 2020  olumns..        
+0000d8f0: 6f75 7470 7574 5f63 6f6c 7320 3d20 5b63  output_cols = [c
+0000d900: 6466 2e73 7461 745f 636f 6c2c 0d0a 2020  df.stat_col,..  
+0000d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d920: 2020 2020 2063 6466 2e74 6872 6573 686f       cdf.thresho
+0000d930: 6c64 5f63 6f6c 2c0d 0a20 2020 2020 2020  ld_col,..       
+0000d940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d950: 6364 662e 7265 7375 6c74 5f63 6f6c 2c0d  cdf.result_col,.
+0000d960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d970: 2020 2020 2020 2020 6364 662e 6e75 6d65          cdf.nume
+0000d980: 7269 635f 636f 6c2c 0d0a 2020 2020 2020  ric_col,..      
+0000d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9a0: 2063 6466 2e65 7863 6565 6461 6e63 6573   cdf.exceedances
+0000d9b0: 5f63 6f6c 2c0d 0a20 2020 2020 2020 2020  _col,..         
+0000d9c0: 2020 2020 2020 2020 2020 2020 2020 6364                cd
+0000d9d0: 662e 6e6f 6e5f 6578 6365 6564 616e 6365  f.non_exceedance
+0000d9e0: 735f 636f 6c2c 0d0a 2020 2020 2020 2020  s_col,..        
+0000d9f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000da00: 6466 2e69 676e 6f72 6564 5f63 6f6c 5d0d  df.ignored_col].
+0000da10: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+0000da20: 2020 2069 6620 6772 6f75 7062 795f 636f     if groupby_co
+0000da30: 6c73 203d 3d20 4e6f 6e65 3a0d 0a20 2020  ls == None:..   
+0000da40: 2020 2020 2020 2020 2063 6466 2e64 6174           cdf.dat
+0000da50: 6120 3d20 6466 5b6f 7574 7075 745f 636f  a = df[output_co
+0000da60: 6c73 5d0d 0a20 2020 2020 2020 2065 6c73  ls]..        els
+0000da70: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000da80: 6364 662e 6461 7461 203d 2064 665b 6772  cdf.data = df[gr
+0000da90: 6f75 7062 795f 636f 6c73 202b 206f 7574  oupby_cols + out
+0000daa0: 7075 745f 636f 6c73 5d0d 0a20 2020 2020  put_cols]..     
+0000dab0: 2020 200d 0a20 2020 2020 2020 2023 204d     ..        # M
+0000dac0: 6572 6765 2063 6f75 6e74 2069 6e66 6f0d  erge count info.
+0000dad0: 0a20 2020 2020 2020 2069 6620 636f 756e  .        if coun
+0000dae0: 745f 636f 6c73 2021 3d20 4e6f 6e65 3a0d  t_cols != None:.
+0000daf0: 0a20 2020 2020 2020 2020 2020 2063 6466  .            cdf
+0000db00: 2e64 6174 6120 3d20 7365 6c66 2e6d 6572  .data = self.mer
+0000db10: 6765 5f63 6f75 6e74 7328 6364 662e 6461  ge_counts(cdf.da
+0000db20: 7461 2c0d 0a20 2020 2020 2020 2020 2020  ta,..           
+0000db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db40: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000db50: 756e 745f 636f 6c73 2c0d 0a20 2020 2020  unt_cols,..     
+0000db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db80: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
+0000db90: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+0000dba0: 2020 2020 2023 2052 6570 6c61 6365 206f       # Replace o
+0000dbb0: 7220 7265 7475 726e 2072 6573 756c 740d  r return result.
+0000dbc0: 0a20 2020 2020 2020 2069 6620 696e 706c  .        if inpl
+0000dbd0: 6163 653a 0d0a 2020 2020 2020 2020 2020  ace:..          
+0000dbe0: 2020 7365 6c66 2e64 6174 6120 3d20 6364    self.data = cd
+0000dbf0: 662e 6461 7461 0d0a 2020 2020 2020 2020  f.data..        
+0000dc00: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000dc10: 2020 2072 6574 7572 6e20 6364 662e 6461     return cdf.da
+0000dc20: 7461 0d0a                                ta..
```

### Comparing `censoredsummarystats-0.0.5/censoredsummarystats/utils.py` & `censoredsummarystats-0.2.0/censoredsummarystats/utils.py`

 * *Files identical despite different names*

### Comparing `censoredsummarystats-0.0.5/LICENSE` & `censoredsummarystats-0.2.0/LICENSE`

 * *Files identical despite different names*

### Comparing `censoredsummarystats-0.0.5/pyproject.toml` & `censoredsummarystats-0.2.0/pyproject.toml`

 * *Files 3% similar despite different names*

```diff
@@ -1,18 +1,18 @@
 [tool.poetry]
 name = "censoredsummarystats"
-version = "0.0.5"
+version = "0.2.0"
 description = "A python package for calculating summary stats on censored data (data that contains < and > symbols)."
 authors = ["Kurt van Ness <vanness.kurt@gmail.com>"]
 readme = "README.md"
 repository = "https://github.com/kurtvanness/CensoredSummaryStats"
 license = "Apache-2.0"
 packages = [{include = "censoredsummarystats"}]
 
 [tool.poetry.dependencies]
 python = "^3.9"
-numpy = "^1.24.2"
+numpy = "^1.24.0"
 
 
 [build-system]
 requires = ["poetry-core"]
 build-backend = "poetry.core.masonry.api"
```

